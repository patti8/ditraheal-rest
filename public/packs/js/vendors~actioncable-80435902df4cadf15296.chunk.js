(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{49:function(t,e,n){"use strict";n.r(e),n.d(e,"Connection",(function(){return y})),n.d(e,"ConnectionMonitor",(function(){return a})),n.d(e,"Consumer",(function(){return j})),n.d(e,"INTERNAL",(function(){return l})),n.d(e,"Subscription",(function(){return S})),n.d(e,"Subscriptions",(function(){return T})),n.d(e,"SubscriptionGuarantor",(function(){return A})),n.d(e,"adapters",(function(){return i})),n.d(e,"createWebSocketURL",(function(){return R})),n.d(e,"logger",(function(){return o})),n.d(e,"createConsumer",(function(){return _})),n.d(e,"getConfig",(function(){return E}));var i={logger:self.console,WebSocket:self.WebSocket},o={log:function(){if(this.enabled){for(var t,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];n.push(Date.now()),(t=i.logger).log.apply(t,["[ActionCable]"].concat(n))}}};function r(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var s=function(){return(new Date).getTime()},c=function(t){return(s()-t)/1e3},u=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.visibilityDidChange=this.visibilityDidChange.bind(this),this.connection=e,this.reconnectAttempts=0}var e,n,i;return e=t,(n=[{key:"start",value:function(){this.isRunning()||(this.startedAt=s(),delete this.stoppedAt,this.startPolling(),addEventListener("visibilitychange",this.visibilityDidChange),o.log("ConnectionMonitor started. stale threshold = ".concat(this.constructor.staleThreshold," s")))}},{key:"stop",value:function(){this.isRunning()&&(this.stoppedAt=s(),this.stopPolling(),removeEventListener("visibilitychange",this.visibilityDidChange),o.log("ConnectionMonitor stopped"))}},{key:"isRunning",value:function(){return this.startedAt&&!this.stoppedAt}},{key:"recordPing",value:function(){this.pingedAt=s()}},{key:"recordConnect",value:function(){this.reconnectAttempts=0,this.recordPing(),delete this.disconnectedAt,o.log("ConnectionMonitor recorded connect")}},{key:"recordDisconnect",value:function(){this.disconnectedAt=s(),o.log("ConnectionMonitor recorded disconnect")}},{key:"startPolling",value:function(){this.stopPolling(),this.poll()}},{key:"stopPolling",value:function(){clearTimeout(this.pollTimeout)}},{key:"poll",value:function(){var t=this;this.pollTimeout=setTimeout((function(){t.reconnectIfStale(),t.poll()}),this.getPollInterval())}},{key:"getPollInterval",value:function(){var t=this.constructor,e=t.staleThreshold,n=t.reconnectionBackoffRate;return 1e3*e*Math.pow(1+n,Math.min(this.reconnectAttempts,10))*(1+(0===this.reconnectAttempts?1:n)*Math.random())}},{key:"reconnectIfStale",value:function(){this.connectionIsStale()&&(o.log("ConnectionMonitor detected stale connection. reconnectAttempts = ".concat(this.reconnectAttempts,", time stale = ").concat(c(this.refreshedAt)," s, stale threshold = ").concat(this.constructor.staleThreshold," s")),this.reconnectAttempts++,this.disconnectedRecently()?o.log("ConnectionMonitor skipping reopening recent disconnect. time disconnected = ".concat(c(this.disconnectedAt)," s")):(o.log("ConnectionMonitor reopening"),this.connection.reopen()))}},{key:"refreshedAt",get:function(){return this.pingedAt?this.pingedAt:this.startedAt}},{key:"connectionIsStale",value:function(){return c(this.refreshedAt)>this.constructor.staleThreshold}},{key:"disconnectedRecently",value:function(){return this.disconnectedAt&&c(this.disconnectedAt)<this.constructor.staleThreshold}},{key:"visibilityDidChange",value:function(){var t=this;"visible"===document.visibilityState&&setTimeout((function(){!t.connectionIsStale()&&t.connection.isOpen()||(o.log("ConnectionMonitor reopening stale connection on visibilitychange. visibilityState = ".concat(document.visibilityState)),t.connection.reopen())}),200)}}])&&r(e.prototype,n),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();u.staleThreshold=6,u.reconnectionBackoffRate=.15;var a=u,l={message_types:{welcome:"welcome",disconnect:"disconnect",ping:"ping",confirmation:"confirm_subscription",rejection:"reject_subscription"},disconnect_reasons:{unauthorized:"unauthorized",invalid_request:"invalid_request",server_restart:"server_restart"},default_mount_path:"/cable",protocols:["actioncable-v1-json","actioncable-unsupported"]};function f(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var h=l.message_types,p=l.protocols,d=p.slice(0,p.length-1),b=[].indexOf,v=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.open=this.open.bind(this),this.consumer=e,this.subscriptions=this.consumer.subscriptions,this.monitor=new a(this),this.disconnected=!0}var e,n,r;return e=t,n=[{key:"send",value:function(t){return!!this.isOpen()&&(this.webSocket.send(JSON.stringify(t)),!0)}},{key:"open",value:function(){return this.isActive()?(o.log("Attempted to open WebSocket, but existing socket is ".concat(this.getState())),!1):(o.log("Opening WebSocket, current state is ".concat(this.getState(),", subprotocols: ").concat(p)),this.webSocket&&this.uninstallEventHandlers(),this.webSocket=new i.WebSocket(this.consumer.url,p),this.installEventHandlers(),this.monitor.start(),!0)}},{key:"close",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{allowReconnect:!0},e=t.allowReconnect;if(e||this.monitor.stop(),this.isActive())return this.webSocket.close()}},{key:"reopen",value:function(){if(o.log("Reopening WebSocket, current state is ".concat(this.getState())),!this.isActive())return this.open();try{return this.close()}catch(t){o.log("Failed to reopen WebSocket",t)}finally{o.log("Reopening WebSocket in ".concat(this.constructor.reopenDelay,"ms")),setTimeout(this.open,this.constructor.reopenDelay)}}},{key:"getProtocol",value:function(){if(this.webSocket)return this.webSocket.protocol}},{key:"isOpen",value:function(){return this.isState("open")}},{key:"isActive",value:function(){return this.isState("open","connecting")}},{key:"isProtocolSupported",value:function(){return b.call(d,this.getProtocol())>=0}},{key:"isState",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return b.call(e,this.getState())>=0}},{key:"getState",value:function(){if(this.webSocket)for(var t in i.WebSocket)if(i.WebSocket[t]===this.webSocket.readyState)return t.toLowerCase();return null}},{key:"installEventHandlers",value:function(){for(var t in this.events){var e=this.events[t].bind(this);this.webSocket["on".concat(t)]=e}}},{key:"uninstallEventHandlers",value:function(){for(var t in this.events)this.webSocket["on".concat(t)]=function(){}}}],n&&f(e.prototype,n),r&&f(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();v.reopenDelay=500,v.prototype.events={message:function(t){if(this.isProtocolSupported()){var e=JSON.parse(t.data),n=e.identifier,i=e.message,r=e.reason,s=e.reconnect;switch(e.type){case h.welcome:return this.monitor.recordConnect(),this.subscriptions.reload();case h.disconnect:return o.log("Disconnecting. Reason: ".concat(r)),this.close({allowReconnect:s});case h.ping:return this.monitor.recordPing();case h.confirmation:return this.subscriptions.confirmSubscription(n),this.subscriptions.notify(n,"connected");case h.rejection:return this.subscriptions.reject(n);default:return this.subscriptions.notify(n,"received",i)}}},open:function(){if(o.log("WebSocket onopen event, using '".concat(this.getProtocol(),"' subprotocol")),this.disconnected=!1,!this.isProtocolSupported())return o.log("Protocol is unsupported. Stopping monitor and disconnecting."),this.close({allowReconnect:!1})},close:function(t){if(o.log("WebSocket onclose event"),!this.disconnected)return this.disconnected=!0,this.monitor.recordDisconnect(),this.subscriptions.notifyAll("disconnected",{willAttemptReconnect:this.monitor.isRunning()})},error:function(){o.log("WebSocket onerror event")}};var y=v;function g(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function m(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var k=function(t,e){if(null!=e)for(var n in e){var i=e[n];t[n]=i}return t},S=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;g(this,t),this.consumer=e,this.identifier=JSON.stringify(n),k(this,i)}var e,n,i;return e=t,n=[{key:"perform",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.action=t,this.send(e)}},{key:"send",value:function(t){return this.consumer.send({command:"message",identifier:this.identifier,data:JSON.stringify(t)})}},{key:"unsubscribe",value:function(){return this.consumer.subscriptions.remove(this)}}],n&&m(e.prototype,n),i&&m(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();function w(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var A=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.subscriptions=e,this.pendingSubscriptions=[]}var e,n,i;return e=t,(n=[{key:"guarantee",value:function(t){-1==this.pendingSubscriptions.indexOf(t)?(o.log("SubscriptionGuarantor guaranteeing ".concat(t.identifier)),this.pendingSubscriptions.push(t)):o.log("SubscriptionGuarantor already guaranteeing ".concat(t.identifier)),this.startGuaranteeing()}},{key:"forget",value:function(t){o.log("SubscriptionGuarantor forgetting ".concat(t.identifier)),this.pendingSubscriptions=this.pendingSubscriptions.filter((function(e){return e!==t}))}},{key:"startGuaranteeing",value:function(){this.stopGuaranteeing(),this.retrySubscribing()}},{key:"stopGuaranteeing",value:function(){clearTimeout(this.retryTimeout)}},{key:"retrySubscribing",value:function(){var t=this;this.retryTimeout=setTimeout((function(){t.subscriptions&&"function"===typeof t.subscriptions.subscribe&&t.pendingSubscriptions.map((function(e){o.log("SubscriptionGuarantor resubscribing ".concat(e.identifier)),t.subscriptions.subscribe(e)}))}),500)}}])&&w(e.prototype,n),i&&w(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();function C(t){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C(t)}function P(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var T=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.consumer=e,this.guarantor=new A(this),this.subscriptions=[]}var e,n,i;return e=t,n=[{key:"create",value:function(t,e){var n=t,i="object"===C(n)?n:{channel:n},o=new S(this.consumer,i,e);return this.add(o)}},{key:"add",value:function(t){return this.subscriptions.push(t),this.consumer.ensureActiveConnection(),this.notify(t,"initialized"),this.subscribe(t),t}},{key:"remove",value:function(t){return this.forget(t),this.findAll(t.identifier).length||this.sendCommand(t,"unsubscribe"),t}},{key:"reject",value:function(t){var e=this;return this.findAll(t).map((function(t){return e.forget(t),e.notify(t,"rejected"),t}))}},{key:"forget",value:function(t){return this.guarantor.forget(t),this.subscriptions=this.subscriptions.filter((function(e){return e!==t})),t}},{key:"findAll",value:function(t){return this.subscriptions.filter((function(e){return e.identifier===t}))}},{key:"reload",value:function(){var t=this;return this.subscriptions.map((function(e){return t.subscribe(e)}))}},{key:"notifyAll",value:function(t){for(var e=this,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return this.subscriptions.map((function(n){return e.notify.apply(e,[n,t].concat(i))}))}},{key:"notify",value:function(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];return("string"===typeof t?this.findAll(t):[t]).map((function(t){return"function"===typeof t[e]?t[e].apply(t,i):void 0}))}},{key:"subscribe",value:function(t){this.sendCommand(t,"subscribe")&&this.guarantor.guarantee(t)}},{key:"confirmSubscription",value:function(t){var e=this;o.log("Subscription confirmed ".concat(t)),this.findAll(t).map((function(t){return e.guarantor.forget(t)}))}},{key:"sendCommand",value:function(t,e){var n=t.identifier;return this.consumer.send({command:e,identifier:n})}}],n&&P(e.prototype,n),i&&P(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();function O(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var j=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._url=e,this.subscriptions=new T(this),this.connection=new y(this)}var e,n,i;return e=t,(n=[{key:"url",get:function(){return R(this._url)}},{key:"send",value:function(t){return this.connection.send(t)}},{key:"connect",value:function(){return this.connection.open()}},{key:"disconnect",value:function(){return this.connection.close({allowReconnect:!1})}},{key:"ensureActiveConnection",value:function(){if(!this.connection.isActive())return this.connection.open()}}])&&O(e.prototype,n),i&&O(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();function R(t){if("function"===typeof t&&(t=t()),t&&!/^wss?:/i.test(t)){var e=document.createElement("a");return e.href=t,e.href=e.href,e.protocol=e.protocol.replace("http","ws"),e.href}return t}function _(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E("url")||l.default_mount_path;return new j(t)}function E(t){var e=document.head.querySelector("meta[name='action-cable-".concat(t,"']"));if(e)return e.getAttribute("content")}}}]);
//# sourceMappingURL=vendors~actioncable-80435902df4cadf15296.chunk.js.map