Ext.define("perencanaan.materialrequest.Model",{extend:"data.model.Model",serviceName:"perencanaan/materialrequest",fields:[{name:"NO_MR",type:"string"},{name:"UNIT",type:"string"},{name:"TANGGAL",type:"date",dateFormat:"Y-m-d"},{name:"RUMUS_KATEGORI_A",type:"int"},{name:"RUMUS_KATEGORI_B",type:"int"},{name:"RUMUS_KATEGORI_C",type:"int"},{name:"STATUS",type:"int",defaultValue:1},{name:"OLEH",type:"int"}],idProperty:"NO_MR"});Ext.define("perencanaan.materialrequest.Store",{extend:"data.store.Store",model:"perencanaan.materialrequest.Model",alias:"store.perencanaan-materialrequest-store"});Ext.define("perencanaan.materialrequest.detail.Model",{extend:"data.model.Model",serviceName:"perencanaan/materialrequestdetil",fields:[{name:"ID",type:"int"},{name:"NO_MR",type:"string"},{name:"BARANG",type:"int"},{name:"KATEGORI",type:"string"},{name:"SISA_STOK",type:"float"},{name:"BARANG_KELUAR",type:"float"},{name:"JML_RUMUS",type:"float"},{name:"JUMLAH",type:"float"},{name:"TANGGAL",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("perencanaan.materialrequest.detail.Store",{extend:"data.store.Store",model:"perencanaan.materialrequest.detail.Model",alias:"store.perencanaan-materialrequest-detail-store"});Ext.define("perencanaan.penerimaanbarang.detil.Model",{extend:"data.model.Model",serviceName:"perencanaan/penerimaanbarang/detil",fields:[{name:"ID",type:"int"},{name:"PENERIMAAN",type:"int"},{name:"BARANG",type:"int"},{name:"NO_BATCH",type:"string"},{name:"JUMLAH",type:"float"},{name:"HARGA",type:"float"},{name:"DISKON",type:"float"},{name:"MASA_BERLAKU",type:"date",dateFormat:"Y-m-d"},{name:"STATUS",type:"int",defaultValue:1},{name:"REF_PO_DETIL",type:"int"}],idProperty:"ID"});Ext.define("perencanaan.penerimaanbarang.detil.Store",{extend:"data.store.Store",model:"perencanaan.penerimaanbarang.detil.Model",alias:"store.perencanaan-penerimaanbarang-detil-store"});Ext.define("perencanaan.penerimaanpo.temp.Model",{extend:"data.model.Model",serviceName:"perencanaan/penerimaanpotemp",fields:[{name:"ID_PO_DETIL",type:"int"},{name:"ID_PB",type:"int"},{name:"BARANG",type:"int"},{name:"JUMLAH_PESAN",type:"float"},{name:"JUMLAH_TERIMA",type:"float"},{name:"BONUS",type:"float"},{name:"TERIMA_BONUS",type:"float"},{name:"NO_BATCH",type:"string"},{name:"MASA_BERLAKU",type:"date",dateFormat:"Y-m-d"},{name:"STATUS",type:"int",defaultValue:1},{name:"REF_PO_DETIL",type:"int"}]});Ext.define("perencanaan.penerimaanpo.temp.Store",{extend:"data.store.Store",model:"perencanaan.penerimaanpo.temp.Model",alias:"store.perencanaan-penerimaanpo-temp-store"});Ext.define("perencanaan.perencanaan.rumus.Model",{extend:"data.model.Model",serviceName:"perencanaan/rumusperencanaan",fields:[{name:"ID_RUMUS",type:"int"},{name:"KATEGORI",type:"string"},{name:"PERIODE_PERENCANAAN",type:"int"},{name:"VOLUME_PRESENTASE",type:"int"},{name:"LEAD_TIME",type:"int"},{name:"STATUS",type:"int",defaultValue:1},{name:"OLEH",type:"int"},{name:"UPDATE_TIME",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID_RUMUS"});Ext.define("perencanaan.perencanaan.rumus.Store",{extend:"data.store.Store",model:"perencanaan.perencanaan.rumus.Model",alias:"store.perencanaan-perencanaan-rumus-store"});Ext.define("perencanaan.perencanaan.supplier.Model",{extend:"data.model.Model",serviceName:"perencanaan/viewsupplierperencanaan",fields:[{name:"NO_MR",type:"string"},{name:"SUPPLIER",type:"int"},{name:"DESKRIPSI",type:"string"}],idProperty:"NO_MR"});Ext.define("perencanaan.perencanaan.supplier.Store",{extend:"data.store.Store",model:"perencanaan.perencanaan.supplier.Model",alias:"store.perencanaan-perencanaan-supplier-store"});Ext.define("perencanaan.purchaseorder.Model",{extend:"data.model.Model",serviceName:"perencanaan/purchaseorder",fields:[{name:"NO_PO",type:"string"},{name:"NO_MR",type:"string"},{name:"SUPPLIER",type:"int"},{name:"TANGGAL",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"ALOKASI_ANGGARAN",type:"int"},{name:"ONGKIR",type:"float",defaultValue:0},{name:"PPN",type:"int"},{name:"STATUS",type:"int",defaultValue:1},{name:"OLEH",type:"int"},{name:"UPDATE_TIME",type:"date",dateFormat:"Y-m-d H:i:s"}],idProperty:"NO_PO"});Ext.define("perencanaan.purchaseorder.Store",{extend:"data.store.Store",model:"perencanaan.purchaseorder.Model",alias:"store.perencanaan-purchaseorder-store"});Ext.define("perencanaan.purchaseorder.detail.Model",{extend:"data.model.Model",serviceName:"perencanaan/purchaseorderdetil",fields:[{name:"ID",type:"int"},{name:"ID_PO",type:"string"},{name:"BARANG",type:"int"},{name:"ID_MR_DETIL",type:"int"},{name:"ID_SPH_DETIL",type:"int"},{name:"HRG_SATUAN",type:"float"},{name:"JUMLAH",type:"float"},{name:"JUMLAH_BONUS",type:"float"},{name:"ONGKIR",type:"float",defaultValue:0},{name:"STATUS",type:"int",defaultValue:1},{name:"UPDATE_TIME",type:"date",dateFormat:"Y-m-d H:i:s"}],idProperty:"ID"});Ext.define("perencanaan.purchaseorder.detail.Store",{extend:"data.store.Store",model:"perencanaan.purchaseorder.detail.Model",alias:"store.perencanaan-purchaseorder-detail-store"});Ext.define("perencanaan.purchaseorder.getpenyediabybarang.Model",{extend:"data.model.Model",serviceName:"perencanaan/getpenyediabybarang",fields:[{name:"NAMA",type:"string"},{name:"HARGA",type:"float"},{name:"DISKON_PERSEN",type:"float"},{name:"DISKON_RUPIAH",type:"float"}]});Ext.define("perencanaan.purchaseorder.getpenyediabybarang.Store",{extend:"data.store.Store",model:"perencanaan.purchaseorder.getpenyediabybarang.Model",alias:"store.perencanaan-purchaseorder-getpenyediabybarang-store"});Ext.define("perencanaan.suratpenawaranharga.Model",{extend:"data.model.Model",serviceName:"perencanaan/suratpenawaranharga",fields:[{name:"NOMOR",type:"string"},{name:"NO_SPH",type:"string"},{name:"SUPPLIER",type:"int"},{name:"PERIODE_AWAL",type:"date",dateFormat:"Y-m-d"},{name:"PERIODE_AKHIR",type:"date",dateFormat:"Y-m-d"},{name:"EXPIRED",type:"date",dateFormat:"Y-m-d"},{name:"STATUS",type:"int",defaultValue:1},{name:"OLEH",type:"int"},{name:"TANGGAL",type:"date",dateFormat:"Y-m-d H:i:s"}],idProperty:"NOMOR"});Ext.define("perencanaan.suratpenawaranharga.Store",{extend:"data.store.Store",model:"perencanaan.suratpenawaranharga.Model",alias:"store.perencanaan-suratpenawaranharga-store"});Ext.define("perencanaan.suratpenawaranharga.detail.Model",{extend:"data.model.Model",serviceName:"perencanaan/suratpenawaranhargadetil",fields:[{name:"ID",type:"int"},{name:"ID_PENAWARAN",type:"string"},{name:"BARANG",type:"int"},{name:"HARGA",type:"float"},{name:"DISKON_PERSEN",type:"float"},{name:"DISKON_RUPIAH",type:"float"},{name:"DISKON_BELI",type:"float"},{name:"DISKON_BONUS",type:"float"},{name:"STATUS",type:"int",defaultValue:1},{name:"OLEH",type:"int"},{name:"TANGGAL",type:"date",dateFormat:"Y-m-d H:i:s"}],idProperty:"ID"});Ext.define("perencanaan.suratpenawaranharga.detail.Store",{extend:"data.store.Store",model:"perencanaan.suratpenawaranharga.detail.Model",alias:"store.perencanaan-suratpenawaranharga-detail-store"});Ext.define("perencanaan.Workspace",{extend:"com.Form",xtype:"perencanaan-workspace",controller:"perencanaan-workspace",layout:"fit",bodyPadding:2,items:[{xtype:"com-form",ui:"panel-purple",title:"perencanaan & Perencanaan",fullscreenEnabled:true,menuConfig:{enabled:true,width:260,buttonConfig:{}},fullscreenConfig:{},header:{items:[{}]}}],load:function(a){var e=this,d=this.down("com-form");d.setMenus(e.childmenu("9019",2,2))},childmenu:function(g,f,a){var e=this,d=[];xuam=Ext.JSON.decode(Ext.util.Base64.decode(e.app.xuam));xuam.forEach(function(i,h){i=Ext.JSON.decode(Ext.util.Base64.decode(i));if(i.ID.substring(0,a+2)==g&&i.LEVEL==f+1){var j={text:i.DESKRIPSI,leaf:i.HAVE_CHILD==0,iconCls:i.ICON_CLS};if(i.HAVE_CHILD==0||i.CLASS){j.className=i.CLASS;j.idClassName=e.replaceAll(i.CLASS.toLowerCase(),".","_")}else{j.children=e.childmenu(i.ID,parseInt(i.LEVEL),a+2)}d.push(j)}});return d}});Ext.define("perencanaan.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.perencanaan-workspace"});Ext.define("perencanaan.barang.stok.Combo",{extend:"com.Combo",xtype:"perencanaan-barang-stok-combo",viewModel:{stores:{store:{type:"stokbarangminimum-store"}}},bind:{store:"{store}"},emptyText:"[ Masukkan Nama Obat ]",queryMode:"remote",hideTrigger:true,queryParam:"QUERY",displayField:"NAMA",valueField:"BARANG",typeAhead:true,minChars:2,tpl:new Ext.XTemplate('<tpl for=".">','<div class="x-boundlist-item" style="font-size: 12px; line-height: 15px; padding: 3px 10px">','<div style="font-weight: bold; white-space:normal !important;">[ {BARANG} ] - {REFERENSI.BARANG.NAMA}</div>','<div style="white-space:normal !important;">Kategory: {REFERENSI.BARANG.REFERENSI.KATEGORI.NAMA}</div>','<div style="white-space:normal !important;">Merk: {REFERENSI.BARANG.REFERENSI.MERK.DESKRIPSI}</div>','<div style="font-weight: bold; white-space:normal !important;">Stok: {STOKTERSEDIA}</div>',"</div>","</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{BARANG} - {REFERENSI.BARANG.NAMA}","</tpl>")});Ext.define("perencanaan.materialrequest.Form",{extend:"com.Form",xtype:"perencanaan-materialrequest-form",requires:["Ext.picker.Time"],controller:"perencanaan-materialrequest-form",layout:{type:"vbox",align:"stretch"},model:"perencanaan.materialrequest.detail.Model",bodyPadding:10,initComponent:function(){var a=this;a.items=[{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},defaultType:"combobox",items:[{xtype:"perencanaan-barang-stok-combo",name:"BARANG",labelWidth:120,flex:1,fieldLabel:"Barang",emptyText:"[ Masukkan Nama Barang ]",margin:"0 70 0 0",allowBlank:false,listeners:{select:"onSelectBarang"}},{xtype:"hiddenfield",name:"SISA_STOK"},{xtype:"numberfield",hideTrigger:true,name:"SISA_STOK_TEMP",labelWidth:75,disabled:true,fieldLabel:"Sisa Stok",margin:"0 10 0 0",width:150}]},{xtype:"numberfield",name:"JUMLAH",reference:"jumlah",labelWidth:120,fieldLabel:"Rencana Order",allowBlank:false,hideTrigger:true,width:250,margin:"0 10 0 0"}],a.buttons=[{text:"Simpan",ui:"soft-blue",handler:"onAddBarangBaru"}];a.callParent(arguments)},onLoadRecord:function(d){var a=this;a.down("[name=BARANG]").focus()}});Ext.define("perencanaan.materialrequest.FormController",{extend:"Ext.app.ViewController",alias:"controller.perencanaan-materialrequest-form",init:function(){var d=this,a=d.getView();a.down("[name=BARANG]").focus(false,1000)},onSelectBarang:function(e,d){var f=this,a=f.getView(),g=a.down("[name=SISA_STOK]");f.recordSelection=d;if(d){a.down("[name=SISA_STOK_TEMP]").setValue(d.get("STOKTERSEDIA"));a.down("[name=SISA_STOK]").setValue(d.get("STOKTERSEDIA"))}else{a.down("[name=SISA_STOK_TEMP]").setValue(0);a.down("[name=SISA_STOK]").setValue(0)}},onAddBarangBaru:function(h){var g=this,a=g.getView(),j=a.getForm().getValues(),i=g.getViewModel().get("record");if(a.getForm().isValid()){i.set(j);i.showError=true;i.animateTarget=h;i.scope=g;i.set("JML_RUMUS",0);i.set("KATEGORI","C");i.save({callback:function(e,f,d){if(f.hasException()||!d){}if(d){a.notifyMessage("Data telah tersimpan");a.fireEvent("success",e)}}})}}});Ext.define("perencanaan.materialrequest.List",{extend:"com.Grid",xtype:"perencanaan-materialrequest-list",controller:"perencanaan-materialrequest-list",viewModel:{stores:{store:{type:"perencanaan-materialrequest-detail-store",autoSync:true},storeQty:{type:"perencanaan-materialrequest-detail-store"},storeMr:{type:"perencanaan-materialrequest-store"}},data:{recordNomorMr:0,recordPerencanaan:undefined,btnFinal:true,btnBatalFinal:true,totalQty:0,totalItem:0,recChange:undefined}},header:{iconCls:"x-fa fa-credit-card",padding:"5 10 5 10",cls:"x-color-w",items:[{xtype:"checkboxfield",name:"ALL",hideLabel:true,reference:"semua",margin:"0 10 0 0",boxLabel:"Pilih Semua",bind:{hidden:"{btnFinal}"},listeners:{change:"onChangeAll"}},{xtype:"button",text:"Tambah",margin:"0 0 0 1",tooltip:"Tambah Barang Baru",reference:"BtnTambahBarang",handler:"onTambahBarangPerencanaan",bind:{hidden:"{btnFinal}"}},{xtype:"button",ui:"soft-cerulen",margin:"0 0 0 1",tooltip:"Batal Final Perencanaan",text:"Batal Final",reference:"BtnOnBatalFinalPerencanaan",handler:"onBatalFinalPerencanaan",bind:{hidden:"{btnBatalFinal}"}},{xtype:"button",ui:"soft-cerulen",margin:"0 0 0 1",tooltip:"Final Perencanaan",text:"Final",reference:"BtnOnFinalPerencanaan",handler:"onFinalPerencanaan",bind:{hidden:"{btnFinal}"}},{xtype:"button",ui:"soft-blue",margin:"0 0 0 1",tooltip:"Cetak Perencanaan",text:"Cetak",reference:"BtnOnCetakPerencanaan",handler:"onCetakPerencanaan",bind:{hidden:"{!btnFinal}"}}]},initComponent:function(){var a=this;a.cellEditing=new Ext.grid.plugin.CellEditing({clicksToEdit:1,listeners:{beforeedit:"BeforeEdit"}});a.plugins=[a.cellEditing];a.columns=[{xtype:"rownumberer",text:"No",align:"left",width:50},{xtype:"templatecolumn",text:"Kategori",align:"center",width:75,sortable:false,tpl:'<div style="white-space:normal">{KATEGORI}</div>'},{xtype:"templatecolumn",text:"Nama Barang",flex:3,sortable:false,tpl:'<div style="white-space:normal">{REFERENSI.BARANG.NAMA}</div>'},{xtype:"templatecolumn",text:"Satuan",flex:1,sortable:false,tpl:'<div style="white-space:normal">{REFERENSI.BARANG.REFERENSI.SATUAN.DESKRIPSI}</div>'},{xtype:"templatecolumn",text:"Stok",width:75,align:"right",tpl:'<div style="white-space:normal">{SISA_STOK}</div>'},{text:"Rata - Rata",flex:1,columns:[{text:"Pelayanan 4 Bulan",flex:1,align:"right",renderer:"onRataPenjualanRenderer",summaryRenderer:"onSummaryRendererLabel"}]},{text:"QTY",flex:1,columns:[{text:"Permintaan",flex:1,align:"right",renderer:"onQtyRequestRenderer",summaryRenderer:"onSummaryRendererLabel2"},{text:"Perencanaan",dataIndex:"JUMLAH",align:"right",renderer:"onQtyOrderRenderer",summaryRenderer:"onSummaryRendererValue",flex:1,editor:{xtype:"numberfield",hideTrigger:true,bind:{readOnly:"{btnFinal}"},reference:"jumlah",name:"JUMLAH"}}]},{xtype:"checkcolumn",header:"Status",dataIndex:"STATUS",width:60,bind:{hidden:"{btnFinal}"},listeners:{checkchange:"onChange"}}],a.features=[{ftype:"summary",style:"border:1px #CCC solid;background:red",dock:"bottom"}],a.dockedItems=[{xtype:"toolbar",dock:"bottom",items:[{xtype:"search-field",cls:"x-text-border",autoFocus:true,emptyText:"Cari Nama Obat",flex:1,listeners:{search:"onsearch",clear:"onClear"}},{xtype:"component",flex:1}]}];a.callParent(arguments)},onLoadRecord:function(e){var d=this,a=d.getViewModel().get("store");d.getViewModel().set("recordNomorMr",e.get("NO_MR"));d.getViewModel().set("recordPerencanaan",e);a.removeAll();delete a.queryParams.page;delete a.queryParams.start;delete a.queryParams.limit;a.queryParams.NO_MR=e.get("NO_MR");a.queryParams.ALL=1;a.load({callback:function(g){var f=d.setCheckAll()}});if(e.get("STATUS")==1){d.getViewModel().set("btnFinal",false);d.getViewModel().set("btnBatalFinal",true)}else{if(e.get("STATUS")==2){if(e.get("STATUSX")==3){d.getViewModel().set("btnBatalFinal",true);d.getViewModel().set("btnFinal",true)}else{d.getViewModel().set("btnBatalFinal",false);d.getViewModel().set("btnFinal",true)}}else{d.getViewModel().set("btnFinal",true);d.getViewModel().set("btnBatalFinal",true)}}},setCheckAll:function(){var d=this,a=d.getViewModel().get("store"),g=d.down("[reference=semua]"),f=0,e=0;a.each(function(h){if(h.get("STATUS")==1){e+=1}else{e+=0}f=f+1});if(e==f){if(e>0){g.setValue(1)}else{g.setValue(0)}}else{g.setValue(0)}return true},getTotalData:function(){var e=this,d=e.getViewModel().get("store"),f=e.down("[reference=semua]"),a=0;jmlItem=0;d.each(function(g){if(g.get("STATUS")==1){a+=g.get("JUMLAH");jmlItem+=1}else{a+=0;jmlItem+=0}});dat={JML_QTY:a,JML_ITEM:jmlItem};return dat},getData:function(){var e=this,d=e.getViewModel().get("store"),f=[];d.each(function(a){f.push(a.data)});return f}});Ext.define("perencanaan.materialrequest.ListController",{extend:"Ext.app.ViewController",alias:"controller.perencanaan-materialrequest-list",currentRecord:undefined,onChangeAll:function(m,d,a,j){this.getViewModel().set("recChange",1);var k=this,l=k.getView(),e=k.getViewModel().get("recChange"),h=k.getViewModel().get("store");if(d!=a){if(e){var g=1,f=h.getData().length;h.each(function(i){i.set("STATUS",d?1:0);i.save({callback:function(p,n,o){if(o){g+=1}}})});if(g==f){l.notifyMessage("Status di "+(d==true?"Aktifkan":"NonAktifkan"))}}}},onTambahBarangPerencanaan:function(d){var g=this,a=g.getView(),h=g.getViewModel().get("recordNomorMr"),e={};e.NO_MR=h;var f=a.openDialog("",true,"50%","35%",{title:"Form Tambah Barang Baru",xtype:"perencanaan-materialrequest-form",ui:"panel-cyan",scrollable:true,showCloseButton:true,listeners:{close:function(){f.close();a.reload()}}},function(k,j){var i=j.down("perencanaan-materialrequest-form");i.createRecord(e);i.on("success",function(l){a.refresh();j.close()})},d,true,true)},onChange:function(k,g,i){var f=this,h=f.getView(),a=f.getViewModel(),j=a.get("store"),e=j.getAt(g),d=e.get("NO_MR");if(e){e.set("STATUS",i?1:0);e.scope=f;e.save({callback:function(n,l,m){if(m){h.notifyMessage("Status di "+(i==true?"Aktifkan":"NonAktifkan"))}else{e.set("STATUS",i?0:1)}}})}},BeforeEdit:function(d,g,a){var f=this;f.currentRecord=g.record},removeStoreData:function(e,f){var a=this;a.getViewModel().get(f).removeAll();e.select(null)},onClear:function(){var e=this,f=e.getViewModel(),a=f.get("store");delete a.queryParams.QUERY;a.load()},onsearch:function(j,g){var h=this,i=h.getViewModel(),a=i.get("store");recordNomorMr=i.get("recordNomorMr");a.queryParams={ALL:1,QUERY:g,NO_MR:recordNomorMr};a.load()},onFinalPerencanaan:function(f){var h=this,d=h.getView(),e=h.getViewModel().get("recordPerencanaan"),i=h.getStore("storeMr").getAt(0),g=e.get("NO_MR"),a=Ext.create("perencanaan.materialrequest.Model",{});Ext.Msg.show({title:"Final Material Request",message:"Anda yakin ingin MemFinalkan Material Request Ini?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,animateTarget:f,fn:function(j){if(j==="yes"){if(e){e.set("STATUS",2);e.showError=true;e.animateTarget=f;e.scope=h;e.save({callback:function(k,l,m){if(m){d.notifyMessage("Sukses, Perencanaan Berhasil Di Finalkan");d.onLoadRecord(e)}}})}}}})},onBatalFinalPerencanaan:function(f){var h=this,d=h.getView(),e=h.getViewModel().get("recordPerencanaan"),i=h.getStore("storeMr").getAt(0),g=e.get("NO_MR"),a=Ext.create("perencanaan.materialrequest.Model",{});Ext.Msg.show({title:"Batal Final Material Request",message:"Anda yakin ingin Batal Final Material Request Ini?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,animateTarget:f,fn:function(j){if(j==="yes"){if(e){e.set("STATUS",1);e.showError=true;e.animateTarget=f;e.scope=h;e.save({callback:function(k,l,m){if(m){d.notifyMessage("Sukses, Perencanaan Berhasil Di Batal Finalkan");d.onLoadRecord(e)}}})}}}})},onRataPenjualanRenderer:function(g,d,f){var a=f.get("RATAPENJUALAN"),e=a?(a?a:""):"";return Ext.util.Format.number(e,"0,000.00")},onQtyRequestRenderer:function(g,e,f){var d=this,a=f.get("JML_RUMUS"),h=a?(a?a:""):"";return Ext.util.Format.number(h,"0,000.00")},onQtyOrderRenderer:function(g,e,f){var d=this,a=f.get("JUMLAH"),h=a?(a?a:""):"";return Ext.util.Format.number(h,"0,000.00")},onSummaryRendererLabel:function(){return'<span style="font-size: 12px; font-weight: bold">Jumlah QTY </span></br><span style="font-size: 12px; font-weight: bold">Jumlah Item </span>'},onSummaryRendererLabel2:function(){var a=this;return'<span style="font-size: 12px; font-weight: bold">:</span></br><span style="font-size: 12px; font-weight: bold">:</span>'},onSummaryRendererValue:function(f,a,d){var e=this;data=e.getView().getTotalData(),totalQty=data.JML_QTY,totalItem=data.JML_ITEM;desk='<span style="font-size: 12px; font-weight: bold"> '+Ext.util.Format.number(totalQty,"0,000.00")+'</span></br><span style="font-size: 12px; font-weight: bold"> '+Ext.util.Format.number(totalItem,"0,000.00")+"</span>";return desk},onCetakPerencanaan:function(f){var e=this,d=e.getView(),a=e.getViewModel().get("recordNomorMr");this.cetakBuktiPengiriman(a)},privates:{cetakBuktiPengiriman:function(i){var g=this,a=g.getView(),d="Word",f="docx",h=true,e="Cetak Perencanaan :"+i;Ext.Msg.show({title:e,message:"Tekan tombol Yes/Ya utk cetak langsung<br/>Tekan tombol No/Tidak untuk Preview",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,defaultButton:"yes",animateTarget:g,fn:function(j){a.cetak({NAME:"plugins.perencanaan.CetakMaterialRequest",TYPE:"Pdf",EXT:"pdf",PARAMETER:{PNOMOR:i},REQUEST_FOR_PRINT:false,PRINT_NAME:"CetakRincian"},function(k){a.printPreview(e,k)})}})}}});Ext.define("perencanaan.materialrequest.Periode",{extend:"com.Grid",xtype:"perencanaan-materialrequest-periode",viewModel:{stores:{store:{type:"perencanaan-materialrequest-store"},cekStore:{type:"perencanaan-materialrequest-store",queryParams:{STATUS:1,start:0,limit:1}}},data:{recordUnit:undefined}},hideHeaders:true,waitRefresh:true,bind:{store:"{store}"},initComponent:function(){var a=this;a.columns=[{xtype:"templatecolumn",sortable:false,flex:1,tpl:new Ext.XTemplate('<div class="thumb-wrap">','<div class="thumb">','<div style="font-size: 12px; white-space:normal !important; font-weight: bold">Nomor / Periode : {NO_MR} / {[this.tanggalFormat(values.TANGGAL)]}</div>','<div style="font-weight: bold;font-size: 12px; white-space:normal !important;">{[this.getStatus(values.STATUS)]}</div>',"</div>","</div>",{tanggalFormat:function(d){var e=Ext.isDate(d)?d:Ext.Date.parse(d,"Y-m-d H:i:s");return Ext.Date.format(e,"d-m-Y H:i:s")},getStatus:function(d){var e=Ext.util.Format.number(d,"0");if(d==1){return'<span style="color:#CCC;"> Status : Pending </span>'}else{if(d==2){return'<span style="color:blue;">Status : Proses Perencanaan</span>'}else{if(d==3){return'<span style="color:green;">Status : Proses PO</span>'}else{if(d==0){return'<span style="color:red;">Status : Di Batalkan</span>'}}}}return e}})},{xtype:"widgetcolumn",align:"center",width:100,widget:{xtype:"fieldcontainer",defaults:{padding:2,margin:"0 5 5 0"},items:[{xtype:"button",iconCls:"x-fa fa-ban",flex:1,ui:"soft-red",tooltip:"Batalkan",handler:"onBatalPerencanaan"},{xtype:"button",iconCls:"x-fa fa-sign-in",flex:1,tooltip:"Detil Item Perencanaan",handler:"onViewDetilPerencanaan"}]}}],a.dockedItems=[{xtype:"pagingtoolbar",bind:{store:"{store}"},dock:"bottom"}];a.callParent(arguments)},onLoadRecord:function(e){var d=this,a=d.getViewModel().get("store");d.getViewModel().set("recordUnit",e.UNIT);if(a){a.removeAll();a.queryParams.UNIT=e.UNIT;a.load()}},isCekStatus:function(e){var d=this,a=d.getViewModel().get("cekStore");unit=d.getViewModel().get("recordUnit");if(a){a.queryParams.UNIT=unit;a.queryParams.STATUS=1;a.queryParams.start=0;a.queryParams.limit=1;a.load(function(g,f,h){if(Ext.isArray(g)){e(g.length>0)}})}},onRefresh:function(){var d=this,a=d.getViewModel().get("store");a.reload()}});Ext.define("perencanaan.materialrequest.Rumus",{extend:"com.Grid",xtype:"perencanaan-materialrequest-rumus",viewModel:{stores:{store:{type:"perencanaan-perencanaan-rumus-store",autoLoad:true}}},hideHeaders:true,waitRefresh:true,initComponent:function(){var a=this;a.columns=[{xtype:"templatecolumn",sortable:false,flex:1,tpl:new Ext.XTemplate('<div class="thumb-wrap">','<div class="thumb">','<div style="font-size: 14px; white-space:normal !important; font-weight: bold">Kategori : {KATEGORI}</div>','<div style="font-weight: bold; white-space:normal !important;">(R_P 4 Bln x ({PERIODE_PERENCANAAN} Bln / 4)) + {VOLUME_PRESENTASE} % + LT {LEAD_TIME} Hari - Sisa Stok</div>',"</div>","</div>")}];a.callParent(arguments)},onLoadRecord:function(e){var d=this,a=d.getViewModel().get("store");a.queryParams.STATUS=1;a.load()},getData:function(){var d=this,e=d.getViewModel().get("store"),f=[];e.each(function(a){f.push({RUMUS:a.get("ID_RUMUS")})});return f}});Ext.define("perencanaan.materialrequest.Workspace",{extend:"com.Form",xtype:"perencanaan-materialrequest-workspace",controller:"perencanaan-materialrequest-workspace",viewModel:{data:{formConfig:{disabledField:true}}},layout:"border",border:true,ruangan:undefined,initComponent:function(){var a=this;a.items=[{region:"west",flex:1,xtype:"perencanaan-materialrequest-rumus",reference:"materialrequestrumus",title:"Rumus Perencanaan",ui:"panel-cyan",margin:"0 10px 0 0",header:{items:[{xtype:"button",iconCls:"x-fa fa-cog",margin:"0 0 0 1",tooltip:"Setting",reference:"BtnSettingRumus",handler:"onSettingRumusPerencanaan"}]}},{region:"center",xtype:"perencanaan-materialrequest-periode",flex:3,reference:"formperiodematerialrequest",title:"Periode Perencanaan",ui:"panel-cyan",header:{items:[{xtype:"combobox",name:"RUANGAN",allowBlank:false,enterFocus:true,flex:2,reference:"ruanganasal",margin:"0 10 0 0",displayField:"DESKRIPSI",valueField:"ID",queryMode:"local",emptyText:"[Ruangan ASAL]",store:{model:"data.model.Ruangan"},listeners:{select:"onSelectRuangan"}},{name:"TANGGAL",reference:"periodematerialrequest",xtype:"datefield",format:"Y-m-d",bind:{disabled:"{formConfig.disabledField}"}},{xtype:"button",iconCls:"x-fa fa-sign-in",margin:"0 0 0 1",text:"Create",tooltip:"Create",reference:"BtnCreatePeriode",handler:"onCreateMaterialRequest",bind:{disabled:"{formConfig.disabledField}"}}]}}];a.callParent(arguments)},load:function(h){var f=this,e=f.down("[reference=periodematerialrequest]"),a=this.down("perencanaan-materialrequest-rumus"),g=this.down("perencanaan-materialrequest-periode"),d=f.down("[name=RUANGAN]");e.setValue(f.getSysdate());a.onLoadRecord({});if(f.ruangan==undefined){d.select(null);d.getStore().removeAll();f.setFormConfig({disabledField:true})}else{d.select(f.ruangan)}d.getStore().loadData(f.getPenggunaRuangan());g.onLoadRecord({})}});Ext.define("perencanaan.materialrequest.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.perencanaan-materialrequest-workspace",onSelectRuangan:function(e,h){var g=this,a=g.getView(),f=g.getReferences(),d=g.getViewModel();if(h){a.setFormConfig({disabledField:false});f.formperiodematerialrequest.onLoadRecord({UNIT:h.get("ID")})}},onCreateMaterialRequest:function(i){var k=this,l=k.getView(),f=k.getReferences(),h=k.getReferences().formperiodematerialrequest,j=k.getReferences().materialrequestrumus,g=k.getReferences().periodematerialrequest.getValue(),m=k.getReferences().ruanganasal.getValue(),e=j.getData()[0].RUMUS,d=j.getData()[1].RUMUS,a=j.getData()[2].RUMUS;if(m){Ext.Msg.show({title:"Konfirmasi",message:"Apakah anda Yakin ingin Melakukan Perencanaan Pada Periode Tersebut ..?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(o){if(o=="yes"){var n=[{UNIT:m,TANGGAL:g,RUMUS_KATEGORI_A:e,RUMUS_KATEGORI_B:d,RUMUS_KATEGORI_C:a}];i=n[0];r=Ext.create("perencanaan.materialrequest.Model",{});r.set(i);r.save({callback:function(s,p,q){if(q){h.onRefresh()}}})}}})}else{l.notifyMessage("Silahkan Pilih Unit Terlebih Dahulu")}},onViewDetilPerencanaan:function(d){var f=this,a=f.getView(),h=f.getReferences().formperiodematerialrequest,g=d.ownerCt.getWidgetRecord(),e=a.openDialog("",false,"100%","100%",{title:"Daftar Barang",xtype:"perencanaan-materialrequest-list",ui:"panel-cyan",scrollable:true,showCloseButton:true,listeners:{close:function(){e.close();h.onRefresh()}}},function(k,j){var i=j.down("perencanaan-materialrequest-list");i.onLoadRecord(g);i.on("success",function(l){a.refresh();j.close()})},d,true,false)},onBatalPerencanaan:function(i){var g=this,e=g.getStore("store"),h=g.getReferences().formperiodematerialrequest,f=g.lookupReference("mrperiode"),d=i.ownerCt.getWidgetRecord();if(d.get("STATUS")=="2"){d.showError=true;d.animateTarget=i;d.scope=g;Ext.Msg.show({title:"Pembatalan Perencanaan",message:"Anda yakin ingin membatalkan Perencanaan Barang Ini ?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,animateTarget:i,fn:function(a){if(a==="yes"){d.set("STATUS",0);d.save({callback:function(j,k,l){if(l){g.getView().notifyMessage("Pembatalan Sukses","danger-blue");h.onRefresh()}else{d.set("STATUS",1)}}})}}})}else{g.getView().notifyMessage("Material Request Tidak Bisa Di Batalkan","danger-blue")}},onSettingRumusPerencanaan:function(d){var e=this,a=e.getView();a.openDialog("",true,"","",{title:"Setting Rumus",xtype:"com-form",layout:"border",bodyPadding:0,items:[{flex:1,region:"center",bodyPadding:0,xtype:"perencanaan-perencanaan-rumus-workspace"}],ui:"panel-cyan",showCloseButton:true},function(h,g){var f=g.down("perencanaan-perencanaan-rumus-workspace");f.load({});f.on("success",function(i){a.refresh();g.close()})},d,true,false)}});Ext.define("perencanaan.penerimaanpo.Detail",{extend:"com.Form",xtype:"perencanaan-penerimaanpo-detail",layout:"hbox",border:false,defaults:{border:false,width:"47%"},items:[{layout:"vbox",defaults:{readOnly:true,margin:"2.2.2.2",width:"95%"},items:[{xtype:"textfield",name:"rekanan",fieldLabel:"Rekanan"},{xtype:"textfield",name:"fax",fieldLabel:"Fax"},{xtype:"textfield",name:"tlpn",fieldLabel:"No. Tlpn"}]},{layout:"vbox",defaults:{readOnly:true,width:"95%"},items:[{xtype:"textarea",name:"alamat",fieldLabel:"Alamat"}]}],load:function(a){if(a.get("REFERENSI")){this.down("[name=rekanan]").setValue(a.get("REFERENSI").SUPPLIER.NAMA);this.down("[name=fax]").setValue(a.get("REFERENSI").SUPPLIER.FAX);this.down("[name=tlpn]").setValue(a.get("REFERENSI").SUPPLIER.TELEPON);this.down("[name=alamat]").setValue(a.get("REFERENSI").SUPPLIER.ALAMAT)}}});Ext.define("perencanaan.penerimaanpo.List",{extend:"com.Grid",xtype:"perencanaan-penerimaanpo-list",controller:"perencanaan-penerimaanpo-list",viewModel:{stores:{store:{type:"perencanaan-purchaseorder-store",queryParams:{STATUS:2}}}},header:{iconCls:"x-fa fa-list",padding:"7px 7px 7px 7px",title:"Daftar Pesanan"},ui:"panel-cyan",layout:"fit",initComponent:function(){var a=this;a.columns=[{xtype:"rownumberer",text:"No",align:"left",width:50},{text:"SP/SPK",flex:1.7,columns:[{align:"left",text:"Nomor",dataIndex:"NO_PO",renderer:"onRenderNoPo",flex:1},{align:"left",text:"Tanggal",dataIndex:"TANGGAL",renderer:"onRenderTanggal",flex:1}]},{align:"left",text:"Supplier/Rekanan",dataIndex:"SUPPLIER",renderer:"onRenderSupplier",flex:2},{text:"Jumlah",flex:1.5,columns:[{align:"right",text:"Pesanan",renderer:"onRenderQtyPesanan",flex:1},{align:"right",text:"Diterima",renderer:"onRenderQtyTerima",flex:1}]},{align:"left",text:"Progres",renderer:"onRenderProgres",flex:0.5}],a.dockedItems=[{xtype:"pagingtoolbar",bind:{store:"{store}"},dock:"bottom"}];a.callParent(arguments)},onLoadRecord:function(){var d=this,a=d.getViewModel().get("store");a.load()}});Ext.define("perencanaan.penerimaanpo.ListController",{extend:"Ext.app.ViewController",alias:"controller.perencanaan-penerimaanpo-list",onRenderNoPo:function(d,a,f){var e=f.get("NO_PO");this.setBackGround(a,f.get("STATUSX"));return e},onRenderTanggal:function(d,a,e){this.setBackGround(a,e.get("STATUSX"));return Ext.Date.format(e.get("TANGGAL"),"d-m-Y")},onRenderSupplier:function(d,a,f){var e=f.get("REFERENSI").SUPPLIER.NAMA;this.setBackGround(a,f.get("STATUSX"));return e},onRenderQtyPesanan:function(e,d,f){var a=f.get("REFERENSI").QTY_PESANAN;this.setBackGround(d,f.get("STATUSX"));return a},onRenderQtyTerima:function(e,d,f){var a=f.get("REFERENSI").QTY_TERIMA;this.setBackGround(d,f.get("STATUSX"));return a},onRenderProgres:function(e,d,f){var a=f.get("REFERENSI").PROGRES;this.setBackGround(d,f.get("STATUSX"));return a},setBackGround:function(d,a){if(a==3){d.style="color:#000;font-weight: bold";d.tdCls="jadwalDinasHijau"}else{d.tdCls="jadwalDinasMerah";d.style="color:#FFF;font-weight: bold"}},onRefresh:function(){var a=this.getView();a.reload()}});Ext.define("perencanaan.penerimaanpo.Workspace",{extend:"com.Form",xtype:"perencanaan-penerimaanpo-workspace",controller:"perencanaan-penerimaanpo-workspace",layout:"border",bodyPadding:0,defaults:{flex:1,ui:"panel-cyan"},items:[{region:"center",xtype:"perencanaan-penerimaanpo-list",listeners:{itemdblclick:"onItemDoubleClick"}}],onLoadRecord:function(){var a=this,d=a.down("perencanaan-penerimaanpo-list");d.onLoadRecord()}});Ext.define("perencanaan.penerimaanpo.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.perencanaan-penerimaanpo-workspace",onItemDoubleClick:function(d,f,a){var e=this;e.onProsesPenerimaan(f)},onProsesPenerimaan:function(e){var d=this,a=d.getView();a.openDialog("",false,"100%","100%",{title:"Penerimaan Barang",xtype:"perencanaan-penerimaanpo-faktur-workspace",ui:"panel-cyan",scrollable:true,showCloseButton:true},function(h,g){var f=g.down("perencanaan-penerimaanpo-faktur-workspace");f.onLoadRecord(e);f.on("success",function(i){a.refresh();g.close()});g.on("close",function(){a.onLoadRecord()})},e,true,false)}});Ext.define("perencanaan.penerimaanpo.faktur.Detil",{extend:"com.Form",xtype:"perencanaan-penerimaanpo-faktur-detil",requires:["Ext.picker.Time"],viewModel:{data:{noPo:"-",tglPo:"00-00-0000",nmSupplier:"-",ongkir:"0",ppn:"0",alokasiAnggaran:"-"}},layout:{type:"hbox",align:"stretch"},bodyPadding:15,initComponent:function(){var a=this;a.items=[{layout:{type:"hbox",align:"stretch"},flex:1,items:[{layout:{type:"vbox",align:"stretch"},width:150,defaultType:"component",items:[{html:"No.Purchase Order",margin:"0 0 5 0"},{html:"Tgl.Order",margin:"0 0 5 0"},{html:"Nama Supplier",margin:"0 0 5 0"}]},{layout:{type:"vbox",align:"stretch"},width:20,defaultType:"component",items:[{html:" : ",margin:"0 0 5 0"},{html:" : ",margin:"0 0 5 0"},{html:" : ",margin:"0 0 5 0"}]},{layout:{type:"vbox",align:"stretch"},flex:1,defaultType:"component",items:[{bind:{html:"{noPo}",margin:"0 0 5 0"}},{bind:{html:"{tglPo}",margin:"0 0 5 0"}},{bind:{html:"{nmSupplier}",margin:"0 0 5 0"}}]}]},{layout:{type:"hbox",align:"stretch"},flex:1,items:[{layout:{type:"vbox",align:"stretch"},width:150,defaultType:"component",items:[{html:"Alokasi Anggaran",margin:"0 0 5 0"},{html:"Ongkos Kirim",margin:"0 0 5 0"},{html:"Status PPN",margin:"0 0 5 0"}]},{layout:{type:"vbox",align:"stretch"},width:20,defaultType:"component",items:[{html:" : ",margin:"0 0 5 0"},{html:" : ",margin:"0 0 5 0"},{html:" : ",margin:"0 0 5 0"}]},{layout:{type:"vbox",align:"stretch"},flex:1,defaultType:"component",items:[{bind:{html:"{alokasiAnggaran}"},margin:"0 0 5 0"},{bind:{html:"{ongkir}"},margin:"0 0 5 0"},{bind:{html:"{ppn}"},margin:"0 0 5 0"}]}]}];a.callParent(arguments)},onLoadRecord:function(e){var d=this;if(e.get("PPN")==1){var a="Sudah Termasuk PPN (10%)"}else{var a="Belum Termasuk PPN (10%)"}d.getViewModel().set("noPo",e.get("NO_PO"));d.getViewModel().set("tglPo",Ext.Date.format(e.get("TANGGAL"),"d-m-Y H:i:s"));d.getViewModel().set("nmSupplier",e.get("REFERENSI").SUPPLIER.NAMA);d.getViewModel().set("ongkir",Ext.util.Format.number(e.get("ONGKIR"),"0,00"));d.getViewModel().set("ppn",a);d.getViewModel().set("alokasiAnggaran",e.get("REFERENSI").DESKRIPSI.DESKRIPSI)}});Ext.define("perencanaan.penerimaanpo.faktur.Form",{extend:"com.Form",xtype:"perencanaan-penerimaanpo-faktur-form",viewModel:{stores:{store:{type:"inventory-eksternal-penerimaanbarang-store"}},data:{isAktifForm:true,isEditForm:true,isFinalForm:true,isBtnSimpan:true,isBtnUpdate:true,isBtnFinal:true,isBtnCetak:true,isBtnBatalFinal:true,isBtnBatalTerima:true}},layout:"hbox",defaults:{margin:"2.2.2.2"},model:"inventory.eksternal.penerimaanbarang.Model",initComponent:function(){var a=this;a.items=[{xtype:"textfield",name:"FAKTUR",flex:1,allowBlank:false,emptyText:"[ Nomor Faktur ]",bind:{readOnly:"{isAktifForm}"}},{xtype:"datetimefield",name:"TANGGAL",flex:1,allowBlank:false,format:"Y-m-d H:i:s",emptyText:"[ Tanggal Faktur ]",bind:{readOnly:"{isAktifForm}"}},{xtype:"datetimefield",name:"TANGGAL_PENERIMAAN",flex:1,allowBlank:false,format:"Y-m-d H:i:s",emptyText:"[ Tanggal Penerimaan ]",bind:{readOnly:"{isAktifForm}"}},{xtype:"datetimefield",name:"TANGGAL_DIBUAT",flex:1,allowBlank:false,format:"Y-m-d H:i:s",emptyText:"[ Tanggal Transaksi ]",bind:{readOnly:"{isAktifForm}"}},{xtype:"datefield",name:"MASA_BERLAKU",flex:1,allowBlank:false,format:"Y-m-d",emptyText:"[ Tanggal Jatuh Tempo ]",bind:{readOnly:"{isAktifForm}"}},{xtype:"combobox",name:"RUANGAN",allowBlank:false,flex:1,enterFocus:true,reference:"ruanganasal",enforceMaxLength:true,forceSelection:true,validateOnBlur:true,displayField:"DESKRIPSI",valueField:"ID",queryMode:"local",emptyText:"[Ruangan]",editable:false,store:{model:"data.model.Ruangan"},bind:{readOnly:"{isAktifForm}"}},{xtype:"button",reference:"btnsave",tooltip:"Simpan",text:"Simpan",ui:"soft-blue",iconCls:"x-fa fa-save",handler:"onSimpanFaktur",bind:{hidden:"{isBtnSimpan}"}},{xtype:"button",reference:"btnupdate",tooltip:"Update",text:"Update",ui:"soft-blue",iconCls:"x-fa fa-save",handler:"onUpdateFaktur",bind:{hidden:"{isBtnUpdate}"}},{xtype:"button",reference:"btncetak",tooltip:"Cetak Faktur",text:"Cetak",ui:"soft-blue",iconCls:"x-fa fa-print",handler:"onCetakFaktur",bind:{hidden:"{isBtnCetak}"}},{xtype:"button",reference:"btnfinal",tooltip:"Final",text:"Final",iconCls:"x-fa fa-send",ui:"soft-green",handler:"onFinalFaktur",bind:{hidden:"{isBtnFinal}"}},{xtype:"button",reference:"btnbatalfinal",tooltip:"Batal Final",text:"Batal Final",iconCls:"x-fa fa-ban",ui:"soft-red",handler:"onBatalFinalFaktur",bind:{hidden:"{isBtnBatalFinal}"}},{xtype:"button",reference:"btnbatalterima",tooltip:"Batal Terima",iconCls:"x-fa fa-ban",ui:"soft-black",handler:"onBatalTerimaFaktur",bind:{hidden:"{isBtnBatalTerima}"}}];a.callParent(arguments)},onLoadRecord:function(e){var d=this,a=d.getViewModel()},load:function(f){var e=this,d=e.down("[reference = btnfinal]"),a=e.down("datetimefield");vm=e.getViewModel(),store=vm.get("store"),cmbruangan=e.down("[name=RUANGAN]"),datas=e.getPenggunaRuangan();a.setMaxValue(Ext.Date.subtract(e.getSysdate(),Ext.Date.DAY,-1));cmbruangan.getStore().loadData(datas);if(datas.length>0){cmbruangan.select(Ext.create("data.model.Ruangan",datas[0]));e.focus("RUANGAN")}store.setQueryParams({REF_PO:f.get("NO_PO"),JENIS:2,STATUS:1});store.load({callback:function(h,g,i){if(i){e.loadRecord(h[0]);d.setHidden(h[0].get("STATUS")==2)}else{d.setHidden(true);e.createRecord({STATUS:1,REF_PO:f.get("NO_PO"),REKANAN:f.get("REFERENSI").SUPPLIER.ID,JENIS:2,TANGGAL_DIBUAT:Ext.Date.format(e.getSysdate(),"Y-m-d H:i:s")})}}})},isAktifForm:function(){var d=this,a=d.down("[name=RUANGAN]");vm=d.getViewModel();vm.set("isAktifForm",false);a.getStore().loadData(d.getPenggunaRuangan())},isNonAktifForm:function(){var d=this,a=d.down("[name=RUANGAN]");vm=d.getViewModel();vm.set("isAktifForm",true);a.getStore().loadData(d.getPenggunaRuangan())},isBtnStatus:function(e){var d=this,a=d.getViewModel();if(e==5){a.set("isBtnUpdate",true);a.set("isBtnFinal",true);a.set("isBtnSimpan",false);a.set("isBtnCetak",true);a.set("isBtnBatalFinal",true);a.set("isBtnBatalTerima",true)}if(e==0){a.set("isBtnUpdate",true);a.set("isBtnFinal",true);a.set("isBtnSimpan",true);a.set("isBtnCetak",true);a.set("isBtnBatalFinal",true);a.set("isBtnBatalTerima",true)}if(e==1){a.set("isBtnUpdate",false);a.set("isBtnFinal",false);a.set("isBtnSimpan",true);a.set("isBtnCetak",true);a.set("isBtnBatalFinal",true);a.set("isBtnBatalTerima",false)}if(e==2){a.set("isBtnUpdate",true);a.set("isBtnFinal",true);a.set("isBtnSimpan",true);a.set("isBtnCetak",false);a.set("isBtnBatalFinal",false);a.set("isBtnBatalTerima",true)}}});Ext.define("perencanaan.penerimaanpo.faktur.FormController",{extend:"Ext.app.ViewController",alias:"controller.perencanaan-penerimaanpo-faktur-form",onNewFaktur:function(){this.getView().fireEvent("fakturbaru",true)},onSimpanFaktur:function(d){var f=this,a=f.getView(),e=a.getForm();if(e.isValid()){a.fireEvent("simpan",a.getRecord())}},onFinalFaktur:function(d){var e=this,a=e.getView();a.showMessageBox({message:"Apakah anda yakin ingin memfinalkan faktur ini",title:"Perhatian",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(g){if(g=="yes"){a.fireEvent("finalFaktur",a.getRecord())}}})},onAdd:function(){var a=this.getView();a.fireEvent("reset",true)}});Ext.define("perencanaan.penerimaanpo.faktur.History",{extend:"com.Grid",xtype:"perencanaan-penerimaanpo-faktur-history",viewModel:{stores:{store:{type:"inventory-eksternal-penerimaanbarang-store"}}},header:{iconCls:"x-fa fa-list",padding:"7 7 7 7",title:"History"},ui:"panel-cyan",layout:"fit",border:true,initComponent:function(){var a=this;a.columns=[{xtype:"templatecolumn",sortable:false,flex:1,tpl:new Ext.XTemplate('<div class="thumb-wrap">','<div class="thumb">','<div style="font-size: 12px; white-space:normal !important; font-weight: bold">No.Faktur : {FAKTUR}</div>','<div style="font-weight: bold;font-size: 10px; white-space:normal !important;">Tanggal : {[this.tanggalFormat(values.TANGGAL)]}</div>','<div style="font-weight: bold;font-size: 10px; white-space:normal !important;">{[this.getStatus(values.STATUS)]}</div>',"</div>","</div>",{tanggalFormat:function(d){var e=Ext.isDate(d)?d:Ext.Date.parse(d,"Y-m-d H:i:s");return Ext.Date.format(e,"d-m-Y")},getStatus:function(d){var e=Ext.util.Format.number(d,"0");if(d==1){return'<span style="color:blue;"> Status : Simpan </span>'}else{if(d==2){return'<span style="color:green;">Status : Final</span>'}else{if(d==0){return'<span style="color:red;">Status : Di Batalkan</span>'}}}return e}})}],a.dockedItems=[{xtype:"toolbar",dock:"top",items:[{xtype:"search-field",cls:"x-text-border",flex:1,autoFocus:true,emptyText:"Cari No.Faktur",listeners:{search:"onsearch",clear:"onClear"}}]}];a.callParent(arguments)},onLoadRecord:function(f){var e=this,d=e.getViewModel(),a=d.get("store");a.queryParams={REF_PO:f.get("NO_PO"),sort:Ext.JSON.encode({property:"TANGGAL",direction:"DESC"})};a.load()},getStatusBelumFinal:function(){var e=false,d=this.getViewModel().get("store"),a=d.findRecord("STATUS",1,0,false,true,true);if(a){e=true}return e}});Ext.define("perencanaan.penerimaanpo.faktur.List",{extend:"com.Grid",xtype:"perencanaan-penerimaanpo-faktur-list",controller:"perencanaan-penerimaanpo-faktur-list",viewModel:{stores:{store:{type:"perencanaan-penerimaanbarang-detil-store"}},data:{recordPo:0}},header:{iconCls:"x-fa fa-list",padding:"7px 7px 7px 7px",title:"Daftar Item"},initComponent:function(){var a=this;a.cellEditing=new Ext.grid.plugin.CellEditing({clicksToEdit:1,listeners:{beforeedit:"onBeforeEdit",validateedit:"validateEdit"}});a.plugins=[a.cellEditing];a.columns=[{text:"Barang",dataIndex:"BARANG",xtype:"templatecolumn",tpl:"<div>{REFERENSI.BARANG.NAMA}</div>",flex:1},{xtype:"numbercolumn",header:"Harga Satuan",align:"right",format:"0,00",renderer:"onRenderHarga"},{text:"Jumlah Pesanan",flex:1,columns:[{align:"right",text:"Sisa",dataIndex:"JUMLAH_SISA",flex:1},{align:"right",text:"Bonus",dataIndex:"BONUS_SISA",flex:1}]},{text:"Jumlah Terima",flex:1,columns:[{align:"right",text:"Terima",dataIndex:"JUMLAH",flex:1,editor:{xtype:"numberfield",hideTrigger:true}},{align:"right",text:"Bonus",dataIndex:"BONUS",flex:1,editor:{xtype:"numberfield",hideTrigger:true}}]},{text:"No. Batch",align:"right",dataIndex:"NO_BATCH",editor:{xtype:"textfield"}},{xtype:"datecolumn",format:"Y-m-d",text:"Tgl. Kadaluarsa",align:"right",dataIndex:"MASA_BERLAKU",editor:{xtype:"datefield",format:"Y-m-d"}},{align:"right",text:"Ongkir",dataIndex:"ONGKIR",renderer:"onRenderOngkir",summaryRenderer:"onSummaryRendererLabelTotal"},{text:"Total (Rp.)",align:"right",renderer:"onRenderJmlHrg",summaryRenderer:"onSummaryRendererTotalHrg"}],a.features=[{ftype:"summary",style:"border:1px #CCC solid;background:red",dock:"bottom"}];a.callParent(arguments)},onLoadRecord:function(f){var e=this,d=e.getViewModel(),a=d.get("store");d.set("recordPo",f);a.queryParams={GET_PO:f.get("NO_PO"),ALL:1};a.load()},onLoadRecordUpdate:function(a,e){var g=this,f=g.getViewModel(),d=f.get("store");f.set("recordPo",a);d.queryParams={GET_PO_UPDATE:a.get("NO_PO"),PENERIMAAN:e.get("ID"),ALL:1};d.load()},onLoadRecordFinal:function(f){var e=this,d=e.getViewModel(),a=d.get("store");d.set("recordPo",f);a.queryParams={PENERIMAAN:f.get("ID")};a.load()},getTotalJumlah:function(){var d=this,e=d.getViewModel().get("store"),f=0;e.each(function(k){if(k.getData().JUMLAH>0){var g=k.getData().HARGA,j=k.getData().ONGKIR,a=k.getData().JUMLAH,h=g*a,l=j*a,i=h+l;f+=i}});return f},getData:function(){var e=this,d=e.getViewModel(),a=d.get("store"),f=[];a.each(function(h,g){if(h.get("JUMLAH")>0){f.push({BARANG:h.get("BARANG"),NO_BATCH:h.get("NO_BATCH"),JUMLAH:h.get("JUMLAH"),BONUS:h.get("BONUS"),HARGA:h.get("HARGA"),DISKON:h.get("DISKON"),ONGKIR:h.get("ONGKIR"),MASA_BERLAKU:h.get("MASA_BERLAKU"),REF_PO_DETIL:h.get("REF_PO_DETIL"),STATUS:1})}});return f},getDataUpdate:function(){var e=this,d=e.getViewModel(),a=d.get("store"),f=[];a.each(function(g){f.push(g.getData())});return f}});Ext.define("perencanaan.penerimaanpo.faktur.ListController",{extend:"Ext.app.ViewController",alias:"controller.perencanaan-penerimaanpo-faktur-list",totalHrg:0,currentRecord:undefined,onBeforeEdit:function(d,g,a){var f=this;rec=g.record;f.currentRecord=g.record;if(rec.get("STATUS")==2){g.cancel=true}},validateEdit:function(h,j,d){var i=this,a=i.getView(),g=i.getViewModel().get("store"),k=g.getAt(j.rowIdx),f=k.get("JUMLAH_SISA");if(j.field=="JUMLAH"){if(f<j.value){a.showMessageBox({title:"Perhatian",message:"Qty terima harus kurang atau sama dengan qty sisa.",ui:"window-red",buttons:Ext.Msg.OK,animateTarget:j});k.set("JUMLAH",f);j.cancel=true}else{if(j.value<0){k.set("JUMLAH",0);j.cancel=true}}}},onRenderHarga:function(d,a,g){var f=this,e=g.data.HARGA;return Ext.util.Format.number(e,"0,00")},onRenderOngkir:function(d,a,g){var f=this,e=g.data.ONGKIR;return Ext.util.Format.number(e,"0,00")},onRenderJmlHrg:function(g,m,d){var k=this,j=d.data.HARGA,e=d.data.ONGKIR,h=d.data.JUMLAH,f=j*h,a=e*h,l=f+a;return Ext.util.Format.number(l,"0,00")},onSummaryRendererLabelTotal:function(e,a,d){return'<p style="color:black;margin:5px"> Jumlah Rp. </p><p style="color:black;margin:5px"> PPN Rp. </p><p style="color:black;margin:5px"> Total Rp. </p>'},onSummaryRendererTotalHrg:function(f,d,e){var a=this.getView();a.fireEvent("getongkir");return'<p style="color:black;margin:5px">'+Ext.util.Format.number(a.getTotalJumlah(),"0,00")+'</p><p style="color:black;margin:5px"> '+Ext.util.Format.number(this.getPpn(),"0,00")+'</p><p style="color:black;margin:5px"> '+Ext.util.Format.number(this.getTotalPo(),"0,00")+"</p>"},getOngkirnya:function(){var a=this.getView().getViewModel().get("onkosKirim");return a},getPpn:function(){var f=this,a=f.getView(),d=f.getViewModel().get("recordPo");var e=d.get("PPN")==1?0:d.get("PPN")==null?10:10;total=a.getTotalJumlah()*e/100;return total},getTotalPo:function(){var f=this,a=f.getView(),e=a.getTotalJumlah(),d=f.getPpn(),g=f.getOngkirnya(),h=e+g+d;return h}});Ext.define("perencanaan.penerimaanpo.faktur.Workspace",{extend:"com.Form",xtype:"perencanaan-penerimaanpo-faktur-workspace",controller:"perencanaan-penerimaanpo-faktur-workspace",viewModel:{data:{recordPo:undefined}},layout:"border",bodyPadding:0,defaults:{ui:"panel-cyan",margin:"2.2.2.2"},items:[{region:"north",xtype:"perencanaan-penerimaanpo-faktur-detil"},{region:"center",flex:1,layout:"border",defaults:{ui:"panel-cyan"},items:[{region:"north",header:{iconCls:"x-fa fa-file",title:"Form Faktur",items:[{xtype:"button",iconCls:"x-fa fa-file",ui:"soft-green",margin:"0 0 0 1",tooltip:"Faktur Baru",reference:"BtnNewFaktur",handler:"onNewFaktur"}]},xtype:"perencanaan-penerimaanpo-faktur-form",reference:"formfaktur",listeners:{simpan:"onSimpan",finalFaktur:"onFinalFaktur",fakturbaru:"onFakturBaru",reset:"onReset"}},{region:"center",layout:"fit",flex:1,title:"Detail Faktur",reference:"detailfaktur",xtype:"perencanaan-penerimaanpo-faktur-list"}]},{region:"east",flex:0.3,collapsible:true,collapsed:false,split:true,header:{iconCls:"x-fa fa-history",padding:"7px 7px 7px 7px",title:"History"},layout:"fit",reference:"historyfaktur",xtype:"perencanaan-penerimaanpo-faktur-history",listeners:{select:"onSelectFaktur"}}],onLoadRecord:function(i){var f=this,d=f.getViewModel(),a=f.down("perencanaan-penerimaanpo-faktur-detil"),g=f.down("perencanaan-penerimaanpo-faktur-list"),h=f.down("perencanaan-penerimaanpo-faktur-history"),e=f.down("perencanaan-penerimaanpo-faktur-form");d.set("recordPo",i);a.onLoadRecord(i);h.onLoadRecord(i)}});Ext.define("perencanaan.penerimaanpo.faktur.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.perencanaan-penerimaanpo-faktur-workspace",onsearch:function(j,h){var g=this,e=g.getViewModel(),d=g.getReferences(),a=d.historyfaktur.getStore(),i=a.getQueryParams();a.queryParams={FAKTUR:h,REF_PO:i.REF_PO,ORDER_BY:i.ORDER_BY};a.load()},onClear:function(){var f=this,e=f.getViewModel(),d=f.getReferences(),a=d.historyfaktur.getStore();delete a.queryParams.FAKTUR;delete a.queryParams.start;delete a.queryParams.page;a.load()},onNewFaktur:function(e){var g=this,a=g.getView(),h=g.getViewModel().get("recordPo"),d=g.getReferences(),f=d.historyfaktur.getStatusBelumFinal();if(!f){d.formfaktur.createRecord({TANGGAL_DIBUAT:g.getView().getSysdate(),JENIS:2,REKANAN:h.get("SUPPLIER"),PPN:h.get("PPN")==1?"Ya":"Tidak",REF_PO:h.get("NO_PO")});d.formfaktur.isAktifForm();d.formfaktur.isBtnStatus(5);d.formfaktur.focus("FAKTUR");d.detailfaktur.onLoadRecord(h)}else{a.showMessageBox({title:"Perhatian",message:"Tidak dapat create penerimaan baru karena terdapat penerimaan yang belum di finalkan<br>Silahkan finalkan peneriman sebelumnya yang belum terfinalkan",ui:"window-red",buttons:Ext.Msg.OK,animateTarget:e})}},onSimpanFaktur:function(e){var g=this,a=g.getView(),f=g.getViewModel(),d=g.getReferences(),h=d.formfaktur.getRecord();detils=d.detailfaktur.getData();if(h&&detils.length>0){h.set("PENERIMAAN_BARANG_DETIL",detils);a.setLoading(true);d.formfaktur.save(e,{success:"Penerimaan Barang Berhasil Di Simpan"},function(k,i,j){if(j){a.setLoading(false);d.formfaktur.createRecord({TANGGAL_DIBUAT:g.getView().getSysdate(),JENIS:2});d.formfaktur.isNonAktifForm();d.formfaktur.isBtnStatus(0);d.formfaktur.focus("FAKTUR");d.detailfaktur.onLoadRecord(f.get("recordPo"));g.getView().onLoadRecord(f.get("recordPo"))}else{a.setLoading(false)}})}else{a.showMessageBox({message:"Item Barang Yang Di terima Masih Kosong",buttons:Ext.Msg.OK,icon:Ext.Msg.QUESTION,title:"Perhatian"})}},onUpdateFaktur:function(e){var g=this,a=g.getView(),f=g.getViewModel(),d=g.getReferences(),h=d.formfaktur.getRecord();detils=d.detailfaktur.getDataUpdate();if(h&&detils.length>0){a.setLoading(true);h.set("PENERIMAAN_BARANG_PO_DETIL",detils);d.formfaktur.save(e,{success:"Penerimaan Barang Berhasil Di Update"},function(k,i,j){if(j){a.setLoading(false);g.onRefreshFaktur(k);g.getView().onLoadRecord(f.get("recordPo"))}else{a.setLoading(false)}})}else{a.showMessageBox({message:"Item Barang Yang Di terima Masih Kosong",buttons:Ext.Msg.OK,icon:Ext.Msg.QUESTION,title:"Perhatian"})}},onFinalFaktur:function(e){var g=this,a=g.getView(),f=g.getViewModel(),d=g.getReferences(),h=d.formfaktur.getRecord();detils=d.detailfaktur.getDataUpdate();if(h&&detils.length>0){Ext.Msg.show({title:"Final Penerimaan Barang",message:"Anda yakin ingin final penermiaan barang ini ?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,animateTarget:e,fn:function(i){if(i==="yes"){a.setLoading(true);h.set("FINAL_PENERIMAAN_PO",1);h.set("STATUS",2);d.formfaktur.save(e,{success:"Penerimaan Barang Berhasil Di Finalkan"},function(l,j,k){if(k){a.setLoading(false);g.onRefreshFaktur(l);g.getView().onLoadRecord(f.get("recordPo"))}else{a.setLoading(false)}})}}})}else{a.showMessageBox({message:"Item Barang Yang Di terima Masih Kosong",buttons:Ext.Msg.OK,icon:Ext.Msg.QUESTION,title:"Perhatian"})}},onBatalFinalFaktur:function(e){var g=this,a=g.getView(),f=g.getViewModel(),d=g.getReferences(),h=d.formfaktur.getRecord();detils=d.detailfaktur.getDataUpdate();Ext.Msg.show({title:"Batal Final Penerimaan Barang",message:"Anda yakin ingin batal final penermiaan barang ini ?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,animateTarget:e,fn:function(i){if(i==="yes"){if(h){a.setLoading(true);h.set("BATAL_FINAL_PENERIMAAN_PO",1);h.set("STATUS",1);d.formfaktur.save(e,{success:"Penerimaan Barang Berhasil Di Batal Final"},function(l,j,k){if(k){a.setLoading(false);g.onRefreshFaktur(l);g.getView().onLoadRecord(f.get("recordPo"))}else{a.setLoading(false)}})}}}})},onBatalTerimaFaktur:function(e){var g=this,a=g.getView(),f=g.getViewModel(),d=g.getReferences(),h=d.formfaktur.getRecord();detils=d.detailfaktur.getDataUpdate();Ext.Msg.show({title:"Batal Penerimaan Barang",message:"Anda yakin ingin membatalkan penermiaan barang ini ?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,animateTarget:e,fn:function(i){if(i==="yes"){if(h){a.setLoading(true);h.set("BATAL_TERIMA_PENERIMAAN_PO",1);h.set("STATUS",0);d.formfaktur.save(e,{success:"Penerimaan Barang Berhasil Di Batal Final"},function(l,j,k){if(k){a.setLoading(false);g.onRefreshFaktur(l);g.getView().onLoadRecord(f.get("recordPo"))}else{a.setLoading(false)}})}}}})},onCetakFaktur:function(d){var e=this,a=e.getView();preview=true,refs=e.getReferences(),rec=refs.formfaktur.getRecord();a.cetak({NAME:"inventory.CetakPenerimaanBarang",TYPE:preview?"Pdf":"Word",EXT:preview?"pdf":"docx",PARAMETER:{PID:rec.get("ID")},REQUEST_FOR_PRINT:!preview,PRINT_NAME:"CetakFaktur"},function(f){if(preview){a.openDialog("Print Preview",true,0,0,{xtype:"panel",title:"Preview Faktur Penerimaan Barang"},function(g,h){h.down("panel").update("<iframe style='width: 100%; height: 100%' src='"+f+"'></iframe>")})}})},onReset:function(e){var h=this,d=h.getView(),g=h.getViewModel(),f=h.getReferences(),j=f.detailfaktur,i=j.getStore();delete i.queryParams.ID_PB;d.onLoadRecord(g.get("po"))},onSelectFaktur:function(k,e,a){var g=this,f=g.getViewModel().get("recordPo"),i=g.getView(),h=g.getReferences(),d=h.formfaktur,j=h.detailfaktur;if(e.get("STATUS")==0){h.formfaktur.isNonAktifForm();h.formfaktur.loadRecord(e);h.formfaktur.isBtnStatus(0);h.detailfaktur.onLoadRecordFinal(e)}else{if(e.get("STATUS")==1){h.formfaktur.isAktifForm();h.formfaktur.loadRecord(e);h.formfaktur.isBtnStatus(1);h.detailfaktur.onLoadRecordUpdate(f,e)}else{if(e.get("STATUS")==2){h.formfaktur.isNonAktifForm();h.formfaktur.loadRecord(e);h.formfaktur.isBtnStatus(2);h.detailfaktur.onLoadRecordFinal(e)}else{h.formfaktur.createRecord({TANGGAL_DIBUAT:g.getView().getSysdate(),JENIS:2,REKANAN:f.get("SUPPLIER"),PPN:f.get("PPN")==1?"Ya":"Tidak",REF_PO:f.get("NO_PO")});h.formfaktur.isAktifForm();h.formfaktur.isBtnStatus(0);h.formfaktur.focus("FAKTUR");h.detailfaktur.onLoadRecord(f)}}}},onRefreshFaktur:function(i){var f=this,g=f.getViewModel().get("recordPo"),d=f.getView(),e=f.getReferences(),a=e.formfaktur,h=e.detailfaktur;if(i.get("STATUS")==0){e.formfaktur.isNonAktifForm();e.formfaktur.loadRecord(i);e.formfaktur.isBtnStatus(0);e.detailfaktur.onLoadRecordFinal(i)}else{if(i.get("STATUS")==1){e.formfaktur.isAktifForm();e.formfaktur.loadRecord(i);e.formfaktur.isBtnStatus(1);e.detailfaktur.onLoadRecordUpdate(g,i)}else{if(i.get("STATUS")==2){e.formfaktur.isNonAktifForm();e.formfaktur.loadRecord(i);e.formfaktur.isBtnStatus(2);e.detailfaktur.onLoadRecordFinal(i)}else{e.formfaktur.createRecord({TANGGAL_DIBUAT:f.getView().getSysdate(),JENIS:2,REKANAN:g.get("SUPPLIER"),PPN:g.get("PPN")==1?"Ya":"Tidak",REF_PO:g.get("NO_PO")});e.formfaktur.isAktifForm();e.formfaktur.isBtnStatus(0);e.formfaktur.focus("FAKTUR");e.detailfaktur.onLoadRecord(g)}}}}});Ext.define("perencanaan.penerimaanpo.faktur.detail.List",{extend:"com.Grid",xtype:"perencanaan-penerimaanpo-faktur-detail-list",controller:"perencanaan-penerimaanpo-faktur-detail-list",viewModel:{stores:{store:{type:"perencanaan-penerimaanpo-temp-store"}},data:{sumHarga:0}},header:{iconCls:"x-fa fa-list",padding:"7px 7px 7px 7px",title:"Daftar Item"},initComponent:function(){var a=this;a.cellEditing=new Ext.grid.plugin.CellEditing({clicksToEdit:1,listeners:{afteredit:"onAfterEdit",beforeedit:"onBeforeEdit"}});a.plugins=[a.cellEditing];a.columns=[{text:"Barang",dataIndex:"BARANG",xtype:"templatecolumn",tpl:"<div>{REFERENSI.PO_DETIL.REFERENSI.BARANG.NAMA}</div>",flex:1},{align:"right",text:"Harga Satuan",dataIndex:"ID_SPH_DETIL",xtype:"templatecolumn",tpl:"<div>{REFERENSI.PO_DETIL.HRG_SATUAN}</div>"},{text:"Jumlah",flex:1,columns:[{align:"right",text:"Sisa Pesanan",dataIndex:"JUMLAH_PESAN",flex:1},{align:"right",text:"Terima",dataIndex:"JUMLAH_TERIMA",flex:1,editor:{xtype:"numberfield",hideTrigger:true}},{align:"right",text:"Bonus",dataIndex:"BONUS",flex:1},{align:"right",text:"Terima Bonus",dataIndex:"TERIMA_BONUS",flex:1,editor:{xtype:"numberfield",hideTrigger:true}}]},{text:"No. Batch",align:"right",dataIndex:"NO_BATCH",editor:{xtype:"textfield"}},{xtype:"datecolumn",format:"Y-m-d",text:"Tgl. Kadaluarsa",align:"right",dataIndex:"MASA_BERLAKU",editor:{xtype:"datefield",format:"Y-m-d"}},{align:"right",text:"Ongkir",dataIndex:"TOTALONGKIR"},{text:"Total (Rp.)",align:"right",dataIndex:"TOTALHARGA"}],a.dockedItems=[{xtype:"toolbar",flex:1,dock:"bottom",items:["->",{xtype:"component",html:"<h3><b>Total :</b></h3>",margin:"0 5 0 0"},{xtype:"component",flex:0.3,style:{textAlign:"right"},bind:{html:"<h3><b>Rp. {sumHarga},-</b></h3>"}}]}];a.callParent(arguments)},doAfterLoad:function(d,e,f,a){if(Ext.isArray(e)){if(e.length>0){vm=d.getViewModel();store=vm.get("store");store.each(function(l,g){l.set("JUMLAH_TERIMA_TEMP",l.get("JUMLAH_TERIMA"));l.set("TERIMA_BONUS_TEMP",l.get("TERIMA_BONUS"));var h=(l.get("JUMLAH_TERIMA")==0)?l.get("JUMLAH_PESAN"):l.get("JUMLAH_TERIMA"),i=l.get("JUMLAH_TERIMA")*l.get("REFERENSI").PO_DETIL.HRG_SATUAN,j=l.get("JUMLAH_TERIMA")*l.get("ONGKIR"),k=i+j;l.set("JUMLAH_TERIMA",h);l.set("TOTALHARGA",k);l.set("TOTALONGKIR",j)})}(new Ext.util.DelayedTask(function(){d.hitungUlangTotal()})).delay(100)}},hitungUlangTotal:function(){var f=this,e=f.getViewModel(),d=e.get("store"),a=0;d.each(function(h,g){total=h.get("TOTALHARGA")?h.get("TOTALHARGA"):0;a=a+total});e.set("sumHarga",Ext.util.Format.number(a,"0.00"))},getData:function(){var f=this,e=f.getViewModel(),d=e.get("store"),g=[],a=[];d.each(function(i,h){if(i.get("JUMLAH_TERIMA")>0){a.push({ID_PO_DETIL:i.get("REFERENSI").PO_DETIL.ID,BARANG:i.get("BARANG"),JUMLAH_PESAN:i.get("JUMLAH_PESAN"),JUMLAH_TERIMA:i.get("JUMLAH_TERIMA"),TERIMA_BONUS:i.get("TERIMA_BONUS"),BONUS:i.get("BONUS"),NO_BATCH:i.get("NO_BATCH"),MASA_BERLAKU:i.get("MASA_BERLAKU"),ONGKIR:i.get("REFERENSI").PO_DETIL.ONGKIR,STATUS:1});g.push({BARANG:i.get("BARANG"),JUMLAH:i.get("JUMLAH_TERIMA")+i.get("TERIMA_BONUS"),HARGA:i.get("REFERENSI").PO_DETIL.HRG_SATUAN,DISKON:0,REF_PO_DETIL:i.get("REFERENSI").PO_DETIL.ID,NO_BATCH:i.get("NO_BATCH"),MASA_BERLAKU:i.get("MASA_BERLAKU"),STATUS:1,ONGKIR:i.get("REFERENSI").PO_DETIL.ONGKIR,TEMP:a})}});return g},dataUpdateInsert:function(g){var f=this,e=f.getViewModel(),d=e.get("store"),a=[];d.each(function(i,h){if(g=="update"){if(Ext.isNumeric(i.get("ID_PB"))){if(i.get("ID_PB")!=0){a.push({ID_PO_DETIL:i.get("REFERENSI").PO_DETIL.ID,BARANG:i.get("BARANG"),ID_PB:i.get("ID_PB"),STATUS:2})}}}else{if(g=="insert"){if((i.get("JUMLAH_PESAN")>i.get("JUMLAH_TERIMA_TEMP"))||(i.get("BONUS")>i.get("TERIMA_BONUS_TEMP"))){if(i.get("ID_PB")!=0){a.push({ID_PO_DETIL:i.get("REFERENSI").PO_DETIL.ID,BARANG:i.get("BARANG"),JUMLAH_PESAN:i.get("JUMLAH_PESAN")-i.get("JUMLAH_TERIMA_TEMP"),BONUS:i.get("BONUS")-i.get("TERIMA_BONUS_TEMP"),JUMLAH_TERIMA:0,TERIMA_BONUS:0,STATUS:1})}}}}});return a}});Ext.define("perencanaan.penerimaanpo.faktur.detail.ListController",{extend:"Ext.app.ViewController",alias:"controller.perencanaan-penerimaanpo-faktur-detail-list",onAfterEdit:function(g,h,n){var j=this,l=j.getView(),m=h.field,d=h.record,k=d.get("JUMLAH_TERIMA")*d.get("REFERENSI").PO_DETIL.HRG_SATUAN,f=d.get("JUMLAH_TERIMA")*d.get("REFERENSI").PO_DETIL.ONGKIR,a=k+f,i=j.errorMessage(d,m);if(!i){d.set("TOTALHARGA",a);d.set("TOTALONGKIR",f)}l.hitungUlangTotal()},privates:{errorMessage:function(h,g){var f=this,d=f.getView(),a=false,e=(g=="JUMLAH_TERIMA")?"barang":"bonus";if((h.get("JUMLAH_PESAN")<h.get("JUMLAH_TERIMA"))||(h.get("BONUS")<h.get("TERIMA_BONUS"))){a=true;e="Penerimaan "+e+" tidak boleh lebih besar dari yang telah ditetapkan";if(g=="JUMLAH_TERIMA"){h.set("JUMLAH_TERIMA",0);h.set("TOTALHARGA",0)}else{h.set("TERIMA_BONUS",0)}}else{if((h.get("JUMLAH_TERIMA")<0)||(h.get("TERIMA_BONUS")<0)){a=true;e="Jumlah "+e+" yang diterima tidak boleh dibawah 0";if(g=="JUMLAH_TERIMA"){h.set("JUMLAH_TERIMA",0);h.set("TOTALHARGA",0)}else{h.set("TERIMA_BONUS",0)}}}if(a){d.showMessageBox({message:e,buttons:Ext.Msg.OK,icon:Ext.Msg.QUESTION,title:"Perhatian"})}return a}},onBeforeEdit:function(d,a){var e=this,f=a.record;if(f.get("STATUS")==2){a.cancel=true}}});Ext.define("perencanaan.perencanaan.rumus.Form",{extend:"com.Form",xtype:"perencanaan-perencanaan-rumus-form",controller:"perencanaan-perencanaan-rumus-form",model:"perencanaan.perencanaan.rumus.Model",viewModel:{data:{temp:undefined,statusganti:false}},layout:"fit",border:false,fieldDefaults:{labelAlign:"top"},initComponent:function(){var a=this;a.items=[{flex:1,layout:{type:"vbox",align:"stretch"},title:"FORM",iconCls:"x-fa fa-file-o",border:false,items:[{layout:"hbox",defaults:{flex:1,margin:"2 2 2 2",bind:{readOnly:"{!formConfig.viewOnly}"},border:false},bodyPadding:10,border:false,items:[{xtype:"numberfield",hideTrigger:true,reference:"hargajual",fieldLabel:"PERIODE PERENCANAAN (1/2/3/4 DALAM SATUAN MINGGU)",name:"PERIODE_PERENCANAAN"}]},{layout:"hbox",defaults:{flex:1,margin:"2 2 2 2",border:false,bind:{readOnly:"{!formConfig.viewOnly}"}},bodyPadding:10,border:false,items:[{xtype:"numberfield",hideTrigger:true,fieldLabel:"VOLUME ( SATUAN % )",name:"VOLUME_PRESENTASE"},{xtype:"numberfield",fieldLabel:"LEAD TIME",hideTrigger:true,name:"LEAD_TIME"}]}],buttons:[{text:"Simpan",ui:"soft-blue",iconCls:"x-fa fa-save",handler:"onSimpan",bind:{hidden:"{formConfig.simpan}"},tooltip:{text:"Simpan",mouseOffset:[0,-75]}},{text:"Reset",ui:"soft-red",iconCls:"x-fa fa-refresh",handler:"onReset",bind:{hidden:"{formConfig.simpan}"},tooltip:{text:"Reset",mouseOffset:[0,-75]}},{text:"Ganti Rumus",ui:"soft-green",iconCls:"x-fa fa-history",handler:"onGanti",bind:{hidden:"{!formConfig.simpan}"},tooltip:{text:"Ganti Rumus",mouseOffset:[0,-75]}}]}];a.callParent(arguments)}});Ext.define("perencanaan.perencanaan.rumus.FormController",{extend:"Ext.app.ViewController",alias:"controller.perencanaan-perencanaan-rumus-form",onReset:function(){var e=this,a=e.getView(),d=e.getViewModel().get("temp"),f=a.getRecord();if(d){obj={KATEGORI:d.get("KATEGORI"),PERIODE_PERENCANAAN:d.get("PERIODE_PERENCANAAN"),VOLUME_PRESENTASE:d.get("VOLUME_PRESENTASE"),LEAD_TIME:d.get("LEAD_TIME"),STATUS:1,UPDATE_TIME:a.getSysdate()}}else{obj={KATEGORI:f.get("KATEGORI"),PERIODE_PERENCANAAN:d.get("PERIODE_PERENCANAAN"),VOLUME_PRESENTASE:d.get("VOLUME_PRESENTASE"),LEAD_TIME:d.get("LEAD_TIME"),STATUS:1,UPDATE_TIME:a.getSysdate()}}a.getForm().reset();a.createRecord(obj)},onSimpan:function(f){var g=this,d=g.getView(),a=d.getRecord(),e=g.getViewModel().get("temp");if(e){e.set("STATUS",0);e.animateTarget=f;e.scope=g;e.showError=true;e.save({callback:function(j,h,i){if(i){d.save(f,{},function(m,k,l){if(l){g.getViewModel().set("temp",undefined)}})}}})}else{d.save(f)}},onGanti:function(f){var h=this,d=h.getView(),g=h.getViewModel(),a=d.getRecord(),e={success:"Data Rumus Perencanaan telah terganti",failed:"Gagal dalam menganti Rumus"};Ext.Msg.show({title:"Konfirmasi",message:"Apakah anda ingin mengganti rumus perencanaan?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(i){if(i=="yes"){g.set("temp",Ext.create("perencanaan.perencanaan.rumus.Model",a.data));d.setFormConfig({viewOnly:true,simpan:false});g.set("statusganti",true);h.onReset()}}})}});Ext.define("perencanaan.perencanaan.rumus.List",{extend:"com.Grid",xtype:"perencanaan-perencanaan-rumus-list",border:true,viewModel:{stores:{store:{type:"perencanaan-perencanaan-rumus-store"}}},title:"HISTORY",columns:[{xtype:"rownumberer",text:"No",align:"left",width:70},{text:"KATEGORI",dataIndex:"KATEGORI",flex:1},{text:"PERIODE PERENCANAAN",dataIndex:"PERIODE_PERENCANAAN",flex:1},{text:"VOLUME PRESENTASE",dataIndex:"VOLUME_PRESENTASE",flex:1},{text:"LEAD TIME",dataIndex:"LEAD_TIME",flex:1},{xtype:"datecolumn",format:"d-m-Y H:i:s",text:"TANGGAL",dataIndex:"UPDATE_TIME",flex:1}]});Ext.define("perencanaan.perencanaan.rumus.Workspace",{extend:"com.Tab",xtype:"perencanaan-perencanaan-rumus-workspace",controller:"perencanaan-perencanaan-rumus-workspace",viewModel:{stores:{store:{type:"perencanaan-perencanaan-rumus-store"}}},activeTab:0,cls:"x-br-top",ui:"header-tab",bodyPadding:5,initComponent:function(){this.items=[{title:"RUMUS PERENCANAAN",iconCls:"x-fa fa-calculator",layout:"hbox",defaults:{xtype:"container",width:"40%",height:"70%",margin:"1 1 1 1",border:true},items:[{title:"KATEGORI A",xtype:"perencanaan-perencanaan-rumus-form",flex:1,layout:"fit",reference:"form1",listeners:{save:"onSave"}},{title:"KATEGORI B",xtype:"perencanaan-perencanaan-rumus-form",flex:1,layout:"fit",reference:"form2",listeners:{save:"onSave"}},{title:"KATEGORI C",xtype:"perencanaan-perencanaan-rumus-form",flex:1,layout:"fit",reference:"form3",listeners:{save:"onSave"}}]},{title:"HISTORY",iconCls:"x-fa fa-history",flex:1,xtype:"container",layout:"fit",items:[{xtype:"perencanaan-perencanaan-rumus-list",reference:"rumuslist"}]}];this.callParent(arguments)},load:function(e){var d=this,a=d.getViewModel().get("store"),f=d.down("[reference = form1]");formB=d.down("[reference = form2]");formC=d.down("[reference = form3]");rumuslist=d.down("[reference = rumuslist]");obj=a.queryParams={STATUS:1},a.load({callback:function(g,j,k){if(k){for(var h=0;h<g.length;h++){if(g[h].get("KATEGORI")=="A"){d.dataSet(f,g[h],true)}else{if(g[h].get("KATEGORI")=="B"){d.dataSet(formB,g[h],true)}else{if(g[h].get("KATEGORI")=="C"){d.dataSet(formC,g[h],true)}}}}}}});rumuslist.load({STATUS:0});rumuslist.setGridConfig({paging:true})},dataSet:function(g,d,e){var f=this;if(e){var a=d.get("STATUS")==1;g.setFormConfig({viewOnly:!a,simpan:a});g.loadRecord(d)}}});Ext.define("inventory.perencanaan.rumus.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.perencanaan-perencanaan-rumus-workspace",onSave:function(e){var d=this,a=d.getView();if(e){a.load({})}}});Ext.define("perencanaan.perencanaan.sph.Form",{extend:"com.Form",xtype:"perencanaan-perencanaan-sph-form",layout:{type:"hbox",align:"stretch"},bodyPadding:5,margin:"0 0 15 0",flex:1,initComponent:function(){var a=this;a.items=[{layout:"hbox",flex:1,defaults:{margin:"0 5 0 0"},defaultType:"textfield",items:[{xtype:"barang-combo-master",flex:2,hideTrigger:true,reference:"barangcombo",allowBlank:false,name:"BARANG"},{name:"HARGA",flex:1,reference:"harga",emptyText:"[ Harga Penawaran ]",allowBlank:false},{name:"DISKON_PERSEN",flex:1,reference:"diskonpersen",emptyText:"[ Diskon ( % ) ]"},{name:"DISKON_RUPIAH",flex:1,reference:"diskonrupiah",emptyText:"[ Diskon ( Rp. ) ]"},{xtype:"button",ui:"soft-blue",width:75,iconCls:"x-fa fa-plus-square",reference:"btnadditembarangpenawaran",handler:"AddItemBarangPenawaran"}]}];a.callParent(arguments)},onLoadRecord:function(g){var f=this,a=f.down("barang-combo-master"),e=a.getViewModel().get("store"),d=f.getPenggunaRuangan()},onBeforeGetRecord:function(f,h){var d=f.down("barang-combo-master").getSelection(),g=f.down("[reference=harga]").getValue(),a=f.down("[reference=diskonpersen]").getValue(),e=f.down("[reference=diskonrupiah]").getValue();h.REFERENSI={};if(d){h.REFERENSI=d.data}}});Ext.define("perencanaan.perencanaan.sph.List",{extend:"com.Grid",xtype:"perencanaan-perencanaan-sph-list",cls:"x-br-top",border:false,initComponent:function(){var a=this;a.cellEditing=new Ext.grid.plugin.CellEditing({clicksToEdit:1,listeners:{beforeedit:"BeforeEdit"}});a.plugins=[a.cellEditing];a.columns=[{xtype:"templatecolumn",text:"Nama Barang",flex:3,sortable:false,tpl:"<div>{REFERENSI.NAMA}</div>"},{xtype:"templatecolumn",text:"Satuan",flex:3,sortable:false,tpl:"<div>{REFERENSI.REFERENSI.SATUAN.DESKRIPSI}</div>"},{xtype:"templatecolumn",text:"Harga",flex:3,sortable:false,tpl:"<div>{HARGA}</div>"},{xtype:"templatecolumn",text:"Diskon (%)",flex:3,sortable:false,tpl:"<div>{DISKON_PERSEN}%</div>"},{xtype:"templatecolumn",text:"Diskon (Rp)",flex:3,sortable:false,tpl:"<div>Rp.{DISKON_RUPIAH}</div>"},{xtype:"widgetcolumn",align:"center",text:"#",width:70,onWidgetAttach:function(e,d,f){d.setHidden(Ext.isNumeric(f.get("ID")))},widget:{xtype:"button",action:0,iconCls:"x-fa fa-minus-circle",ui:"soft-red",handler:"onBatal"}}],a.dockedItems=[{xtype:"pagingtoolbar",bind:{store:"{store}"},dock:"bottom",items:[{xtype:"component",flex:1},{xtype:"button",ui:"soft-red",iconCls:"x-fa fa-ban",text:"Reset",handler:"OnResetSph"},{xtype:"button",ui:"soft-green",iconCls:"x-fa fa-check-square",text:"Final",reference:"btnFinalSph",disabled:false,handler:"onFinalSuratPenawaranHarga"}]}];a.callParent(arguments)},getData:function(){var d=this,e=d.getViewModel().get("store"),f=[];e.each(function(a){f.push(a.data)});return f},addRow:function(f){var d=this,e=d.getViewModel().get("store");console.log(f);e.add(f)},removeDataStore:function(){this.getViewModel().get("store").removeAll()},removeAnotherModels:function(){var f=this.getViewModel().get("store"),e=[];f.each(function(a){if(Ext.getClassName(a)!="data.model.PermintaanDetil"){e.push(a)}});var d=new Ext.util.DelayedTask(function(){f.remove(e)});d.delay(100)}});Ext.define("perencanaan.perencanaan.sph.PeriodeForm",{extend:"com.Form",xtype:"perencanaan-perencanaan-sph-periode-form",layout:{type:"vbox",align:"stretch"},bodyPadding:5,margin:"0 0 5 0",initComponent:function(){var a=this;a.items=[{xtype:"fieldcontainer",layout:"hbox",defaults:{flex:1,hideLabel:true},defaultType:"datefield",items:[{name:"PERIODE_AWAL",emptyText:"[ Tgl Awal ]",margin:"0 5 0 0",format:"Y-m-d",allowBlank:false},{name:"PERIODE_AKHIR",emptyText:"[ Tgl Akhir ]",format:"Y-m-d",allowBlank:false}]},{xtype:"fieldcontainer",layout:"hbox",defaults:{flex:1},items:[{xtype:"penyedia-combo",params:{STATUS:1},reference:"pbfcombo",allowBlank:false,margin:"0 5 5 0",name:"SUPPLIER",emptyText:"[ Nama Rekanan / Supplier]"},{xtype:"textfield",name:"KETERANGAN",emptyText:"[ Keterangan ]"}]}];a.callParent(arguments)}});Ext.define("perencanaan.perencanaan.sph.Workspace",{extend:"com.Form",xtype:"perencanaan-perencanaan-sph-workspace",controller:"perencanaan-perencanaan-sph-workspace",layout:"border",border:false,initComponent:function(){var a=this;a.items=[{region:"center",xtype:"form",layout:"border",bodyPadding:2,flex:1,margin:"0 5 5 0",items:[{region:"north",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"perencanaan-perencanaan-sph-periode-form",reference:"sphperiodeform"},{xtype:"perencanaan-perencanaan-sph-form",reference:"sphform"}]},{region:"center",xtype:"perencanaan-perencanaan-sph-list",reference:"sphlist",flex:2}]},{html:"permintaan-history-workspace",region:"east",title:"History Perjanjian Harga",reference:"permintaanhistorylist",collapsible:true,collapsed:true,floatable:true,split:true,flex:1,header:{iconCls:"x-fa fa-list",padding:"10 10 10 5"}}];a.callParent(arguments)},onLoadRecord:function(a,d){var a=this;list=a.down("perencanaan-perencanaan-sph-list"),periodeForm=a.down("perencanaan-perencanaan-sph-periode-form"),form=a.down("perencanaan-perencanaan-sph-form");form.createRecord({});periodeForm.createRecord({})}});Ext.define("perencanaan.perencanaan.sph.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.perencanaan-perencanaan-sph-workspace",AddItemBarangPenawaran:function(a){console.log("add item");var f=this,d=f.getView(),e=f.getReferences(),g=e.sphform.getRecord();if(g){e.sphlist.addRow(g);e.sphform.createRecord({});e.sphform.focus("BARANG")}},onFinalSuratPenawaranHarga:function(d){var f=this,a=f.getReferences(),g=a.sphperiodeform.getRecord(),e=a.sphlist.getData();console.log(a.sphperiodeform.getValues());console.log(a.sphperiodeform.getRecord());g.set("EXPIRED",g.get("PERIODE_AKHIR"));if(g&&e.length>0){g.set("SURAT_PENAWARAN_HARGA_DETIL",e);a.sphperiodeform.save(d,{success:"Data Berhasil Di Simpan.."},function(j,h,i){if(i){f.onReset()}})}},onReset:function(){var a=this,d=a.getReferences();d.sphform.reset();d.sphperiodeform.reset();d.sphperiodeform.createRecord({});d.sphform.focus("BARANG");d.sphform.createRecord({});d.sphlist.removeDataStore()}});Ext.define("perencanaan.perencanaan.supplier.Combo",{extend:"com.Combo",alias:"widget.perencanaan-perencanaan-supplier-combo",viewModel:{stores:{store:{type:"perencanaan-perencanaan-supplier-store"}}},bind:{store:"{store}"},emptyText:"[ Masukkan Nama Penyedia ]",queryMode:"remote",hideTrigger:true,queryParam:"QUERY",displayField:"DESKRIPSI",valueField:"SUPPLIER",typeAhead:true,minChars:2,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">',"<strong>{DESKRIPSI}</strong>","</div>","</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{DESKRIPSI}","</tpl>")});Ext.define("perencanaan.purchaseorder.Form.Detil",{extend:"com.Grid",alias:"widget.perencanaan-purchaseorder-form-detil",controller:"perencanaan-purchaseorder-form-detil",viewModel:{stores:{store:{type:"perencanaan-purchaseorder-detail-store"}},data:{onkosKirim:0,statusPpn:0,supplier:undefined,nomr:undefined,po:undefined,hiddenCreate:true,hiddenFinal:true,isFinal:true}},header:{iconCls:"x-fa fa-list",padding:"7px 7px 7px 7px"},ui:"panel-cyan",layout:"fit",total:0,initComponent:function(){var a=this;a.cellEditing=new Ext.grid.plugin.CellEditing({clicksToEdit:1,listeners:{beforeedit:"BeforeEdit",validateedit:"validateEdit"}});a.plugins=[a.cellEditing];a.columns=[{xtype:"templatecolumn",text:"Kode",flex:1,sortable:false,hidden:true,tpl:"<div>{BARANG}</div>"},{xtype:"templatecolumn",text:"Idmrdetil",flex:1,sortable:false,hidden:true,tpl:"<div>{ID}</div>"},{xtype:"templatecolumn",text:"Idsphdetil",flex:1,sortable:false,hidden:true,tpl:"<div>{IDSPHDETIL}</div>"},{xtype:"templatecolumn",text:"Deskripsi",flex:2,sortable:false,tpl:"<div>{REFERENSI.BARANG.NAMA}</div>"},{xtype:"templatecolumn",text:"Satuan",flex:1,sortable:false,tpl:"<div>{REFERENSI.BARANG.REFERENSI.SATUAN.DESKRIPSI}</div>"},{text:"QTY",flex:2,columns:[{xtype:"templatecolumn",text:"Request",flex:1,align:"right",tpl:"<div>{REFERENSI.MRDETIL.JUMLAH}</div>"},{xtype:"templatecolumn",text:"Sisa",flex:1,align:"right",tpl:"<div>{REFERENSI.MRDETIL.REFERENSI.SISA}</div>"},{text:"Order",dataIndex:"JUMLAH",align:"right",flex:1,editor:{xtype:"numberfield",hideTrigger:true,reference:"jumlah",name:"JUMLAH",bind:{readOnly:"{isFinal}"}}}]},{header:"Harga",dataIndex:"HRG_SATUAN",flex:1,align:"right",sortable:false,editor:{xtype:"numberfield",hideTrigger:true,reference:"jumlah",name:"HRG_SATUAN",bind:{readOnly:"{isFinal}"}},summaryRenderer:"onSummaryRendererLabelTotal"},{xtype:"numbercolumn",header:"Jumlah",align:"right",format:"0,00",flex:1,renderer:"onRenderJmlHarga",summaryRenderer:"onSummaryRendererTotalHrg"}],a.features=[{ftype:"summary",style:"border:1px #CCC solid;background:red",dock:"bottom"}];a.callParent(arguments)},onLoadRecord:function(h,d){var g=this,f=g.getViewModel(),e=g.getSysdate(),a=f.get("store");if(h){a.removeAll();a.queryParams={getMateial:1,TANGGAL:e,SUPPLIER:h.get("SUPPLIER"),NOMR:d};a.load()}f.set("isFinal",false)},onLoadRecordEdit:function(f){var e=this,d=e.getViewModel(),a=d.get("store");if(f){a.removeAll();a.queryParams={ID_PO:f.get("NO_PO")};a.load()}d.set("isFinal",false)},onLoadRecordFinal:function(f){var e=this,d=e.getViewModel(),a=d.get("store");if(f){a.removeAll();a.queryParams={ID_PO:f.get("NO_PO")};a.load()}d.set("isFinal",true)},getTotalJumlah:function(){var d=this,e=d.getViewModel().get("store"),f=0;e.each(function(a){if(a.getData().JUMLAH>0){f+=a.getData().JUMLAH*a.getData().HRG_SATUAN}});return f},getJumlahQty:function(){var d=this,e=d.getViewModel().get("store"),f=0;e.each(function(a){if(a.getData().JUMLAH>0){f+=a.getData().JUMLAH}});return f},getData:function(){var e=this,d=e.getViewModel().get("store"),f=[];d.each(function(l){if(l.getData().JUMLAH>0){var j=l.getData().JUMLAH,a=parseFloat(l.getData().REFERENSI.SPH?l.getData().REFERENSI.SPH.DISKON_BELI:0),i=parseFloat(l.getData().REFERENSI.SPH?l.getData().REFERENSI.SPH.DISKON_BONUS:0),m=j>0?j:1,k=m/a,g=i*k,h=Math.floor(g);f.push({BARANG:l.get("BARANG"),ID_MR_DETIL:l.get("REFERENSI").MRDETIL.ID,ID_SPH_DETIL:l.get("IDSPHDETIL"),HRG_SATUAN:l.get("HRG_SATUAN"),JUMLAH:l.getData().JUMLAH,JUMLAH_BONUS:h,ONGKIR:parseInt(e.getOngkosKirim()/e.getJumlahQty()),STATUS:1})}});return f},getDataUpdate:function(){var e=this,d=e.getViewModel().get("store"),f=[];d.each(function(l){if(l.getData().JUMLAH>0){var j=l.getData().JUMLAH,a=parseFloat(l.getData().REFERENSI.SPH?l.getData().REFERENSI.SPH.DISKON_BELI:0),i=parseFloat(l.getData().REFERENSI.SPH?l.getData().REFERENSI.SPH.DISKON_BONUS:0),m=j>0?j:1,k=m/a,g=i*k,h=Math.floor(g);f.push({ID:l.get("ID"),BARANG:l.get("BARANG"),ID_MR_DETIL:l.get("REFERENSI").MRDETIL.ID,ID_SPH_DETIL:l.get("IDSPHDETIL"),HRG_SATUAN:l.get("HRG_SATUAN"),JUMLAH:l.getData().JUMLAH,JUMLAH_BONUS:h,ONGKIR:parseInt(e.getOngkosKirim()/e.getJumlahQty()),STATUS:1})}});return f},getOngkosKirim:function(){var a=this,d=a.getViewModel().get("onkosKirim");return d},onCekDoubleBarang:function(f){var d=this,e=d.getViewModel().get("store"),g=[];e.each(function(a){if(a.get("BARANG")==f.get("BARANG")){g.push({BARANG:a.get("BARANG")})}});return g}});Ext.define("perencanaan.purchaseorder.Form.DetilController",{extend:"Ext.app.ViewController",alias:"controller.perencanaan-purchaseorder-form-detil",totalHrg:0,currentRecord:undefined,BeforeEdit:function(d,g,a){var f=this;f.currentRecord=g.record},validateEdit:function(h,j,d){var i=this,a=i.getView(),g=i.getViewModel().get("store"),k=g.getAt(j.rowIdx),f=k.data.REFERENSI.MRDETIL.REFERENSI.SISA;jns=k.data.REFERENSI.MRDETIL.JENIS},onClickAdd:function(){var e=this,d=e.getViewModel(),a=e.getView();a.fireEvent("resetlist",d.get("po"))},onFinalPurchaseOrder:function(d){var e=this,a=e.getView();vm=e.getViewModel();Ext.Msg.show({title:"Information",msg:"Data yang telah final tidak dapat diubah...",icon:Ext.Msg.INFO,buttons:Ext.Msg.YESNO,animateTarget:d,fn:function(f){if(f=="yes"){a.setFinal();c=vm.get("store");c.sync({callback:function(h,l,g){if(h){a.notifyMessage("Data Berhasil Difinalkan..");a.fireEvent("successdetil",vm.get("po"))}}})}}})},onRenderJmlHarga:function(f,e,j){var g=this,a=j.data.HRG_SATUAN,h=j.data.JUMLAH,d=parseFloat(h*a);g.totalHrg=g.totalHrg+d;return Ext.util.Format.number(d,"0,00")},onSummaryRendererLabelTotal:function(e,a,d){return'<p style="color:black;margin:5px"> Jumlah Rp. </p><p style="color:black;margin:5px"> Ongkir Rp. </p><p style="color:black;margin:5px"> PPN Rp. </p><p style="color:black;margin:5px"> Total Rp. </p>'},onSummaryRendererTotalHrg:function(f,d,e){var a=this.getView();a.fireEvent("getongkir");return'<p style="color:black;margin:5px">'+Ext.util.Format.number(a.getTotalJumlah(),"0,00")+'</p><p style="color:black;margin:5px"> '+Ext.util.Format.number(this.getOngkirnya(),"0,00")+'</p><p style="color:black;margin:5px"> '+Ext.util.Format.number(this.getPpn(),"0,00")+'</p><p style="color:black;margin:5px"> '+Ext.util.Format.number(this.getTotalPo(),"0,00")+"</p>"},getOngkirnya:function(){var a=this.getView().getViewModel().get("onkosKirim");return a},getPpn:function(){var e=this,a=e.getView();var d=a.getViewModel().get("statusPpn")==1?0:a.getViewModel().get("statusPpn")==null?0:10;total=a.getTotalJumlah()*d/100;return total},getTotalPo:function(){var f=this,a=f.getView(),e=a.getTotalJumlah(),d=f.getPpn(),g=f.getOngkirnya(),h=e+g+d;return h}});Ext.define("perencanaan.purchaseorder.Form.Form",{extend:"com.Form",alias:"widget.perencanaan-purchaseorder-form-form",viewModel:{stores:{Store:{type:"perencanaan-purchaseorder-detail-store"}},data:{isNew:true,isUpdate:true,isFinal:true,isCetak:true,isAktifForm:true}},model:"perencanaan.purchaseorder.Model",layout:{type:"hbox"},initComponent:function(){var a=this;a.items=[{xtype:"perencanaan-perencanaan-supplier-combo",name:"SUPPLIER",hideTrigger:true,allowBlank:false,margin:"0 10 0 0",emptyText:"[ Masukkan Nama PBF ]",flex:2,listeners:{select:"onSelectSupplier",blur:"onBlurSupplier"},bind:{disabled:"{isAktifForm}"}},{xtype:"numberfield",hideTrigger:true,margin:"0 10 0 0",name:"ONGKIR",reference:"ongkoskirim",flex:1,emptyText:"Ongkos Kirim",reference:"ongkir",bind:{disabled:"{isAktifForm}"}},{xtype:"combobox",reference:"alokasianggaran",name:"ALOKASI_ANGGARAN",margin:"0 10 0 0",flex:1,emptyText:"Alokasi Anggaran",store:Ext.create("Ext.data.Store",{fields:["value","desk"],data:[{value:"1",desk:"PNBP"},{value:"2",desk:"Rupiah Murni"}]}),queryMode:"local",displayField:"desk",valueField:"value",bind:{disabled:"{isAktifForm}"}},{xtype:"combobox",reference:"jenisppn",name:"PPN",margin:"0 10 0 0",flex:1,emptyText:"PPN",store:Ext.create("Ext.data.Store",{fields:["value","desk"],data:[{value:"0",desk:"Belum Termasuk PPN"},{value:"1",desk:"Sudah Termasuk PPN"}]}),queryMode:"local",displayField:"desk",valueField:"value",value:0,bind:{disabled:"{isAktifForm}"}},{xtype:"button",ui:"soft-blue",iconCls:"x-fa fa-save",text:"Simpan",handler:"onSimpanPurchaseOrder",bind:{hidden:"{isNew}"}},{xtype:"button",ui:"soft-blue",iconCls:"x-fa fa-save",text:"Update",handler:"onUpdatePurchaseOrder",bind:{hidden:"{isUpdate}"}},{xtype:"button",iconCls:"x-fa fa-check",ui:"soft-green",text:"Final",handler:"onFinalPurchaseOrder",bind:{hidden:"{isFinal}"}},{xtype:"button",iconCls:"x-fa fa-print",ui:"soft-blue",text:"Cetak",handler:"onCetakPurchaseOrder",bind:{hidden:"{isCetak}"}}];a.callParent(arguments)},load:function(e){var a=this,d=a.down("perencanaan-perencanaan-supplier-combo");if(a.getPropertyConfig("27")=="TRUE"){d.getStore().queryParams={ALL_SUPPLIER:1};d.getStore().load()}else{d.getStore().load()}},isNonAktifForm:function(){var d=this,a=d.getViewModel();a.set("isAktifForm",true);a.set("isNew",true);a.set("isUpdate",true);a.set("isFinal",true);a.set("isCetak",true)},isNewForm:function(){var d=this,a=d.getViewModel(),e=d.down("perencanaan-perencanaan-supplier-combo");a.set("isAktifForm",false);a.set("isNew",false);a.set("isUpdate",true);a.set("isFinal",true);a.set("isCetak",true)},isEditForm:function(){var d=this,e=d.down("perencanaan-perencanaan-supplier-combo"),a=d.getViewModel();a.set("isAktifForm",false);a.set("isNew",true);a.set("isUpdate",false);a.set("isFinal",false);a.set("isCetak",true)},isFinalForm:function(){var d=this,a=d.getViewModel();a.set("isAktifForm",true);a.set("isNew",true);a.set("isUpdate",true);a.set("isFinal",true);a.set("isCetak",false)},onBeforeGetRecord:function(a,e){var d=a.down("perencanaan-perencanaan-supplier-combo").getSelection();e.REFERENSI={};if(d){e.REFERENSI=d.data.REFERENSI}},getOngkir:function(){var a=this,d=a.down("[name=ONGKIR]").getValue();return d}});Ext.define("perencanaan.purchaseorder.Form.History",{extend:"com.Grid",xtype:"perencanaan-purchaseorder-form-history",viewModel:{stores:{store:{type:"perencanaan-purchaseorder-store"}}},header:{iconCls:"x-fa fa-list",padding:"7 7 7 7",title:"History"},ui:"panel-cyan",layout:"fit",border:true,initComponent:function(){var a=this;a.columns=[{xtype:"templatecolumn",sortable:false,flex:1,tpl:new Ext.XTemplate('<div class="thumb-wrap">','<div class="thumb">','<div style="font-size: 12px; white-space:normal !important; font-weight: bold">Nomor : {NO_PO}</div>','<div style="font-size: 10px; white-space:normal !important; font-weight: bold">Nomor : {REFERENSI.SUPPLIER.NAMA}</div>','<div style="font-weight: bold;font-size: 10px; white-space:normal !important;">Periode : {[this.tanggalFormat(values.TANGGAL)]}</div>','<div style="font-weight: bold;font-size: 10px; white-space:normal !important;">{[this.getStatus(values.STATUS)]}</div>',"</div>","</div>",{tanggalFormat:function(d){var e=Ext.isDate(d)?d:Ext.Date.parse(d,"Y-m-d H:i:s");return Ext.Date.format(e,"d-m-Y")},getStatus:function(d){var e=Ext.util.Format.number(d,"0");if(d==1){return'<span style="color:blue;"> Status : Simpan </span>'}else{if(d==2){return'<span style="color:green;">Status : Final</span>'}else{if(d==0){return'<span style="color:red;">Status : Di Batalkan</span>'}}}return e}})}],a.dockedItems=[{xtype:"toolbar",dock:"top",items:[{xtype:"search-field",cls:"x-text-border",flex:1,autoFocus:true,emptyText:"Cari Nama Supplier",listeners:{search:"onsearch",clear:"onClear"}}]}];a.callParent(arguments)},onLoadRecord:function(f){var e=this,d=e.getViewModel(),a=d.get("store");a.queryParams={NO_MR:f.get("NO_MR"),ORDER_BY:"STATUS_ASC"};a.load()},doAfterLoad:function(e,g,f,d){if(g.length>0){var a=[];g.forEach(function(h){if(h.getData().STATUS==1){a=h;e.setSelection(a);return false}})}}});Ext.define("perencanaan.purchaseorder.Form.List",{extend:"com.Grid",alias:"widget.perencanaan-purchaseorder-form-list",viewModel:{stores:{store:{type:"perencanaan-materialrequest-detail-store"}}},header:{iconCls:"x-fa fa-list",padding:"7px 7px 7px 7px"},ui:"panel-cyan",layout:"fit",initComponent:function(){var a=this;a.columns=[{xtype:"templatecolumn",align:"left",text:"Item Barang",dataIndex:"BARANG",flex:2,tpl:'<div style="white-space:normal !important;color:black">{REFERENSI.BARANG.NAMA}</div>'},{align:"right",text:"Qty",dataIndex:"JUMLAH",width:70}];a.dockedItems=[{xtype:"toolbar",dock:"top",items:[{xtype:"search-field",cls:"x-text-border",flex:1,autoFocus:true,emptyText:"Cari Nama Barang",listeners:{search:"onsearch",clear:"onClear"}}]}];a.callParent(arguments)},onLoadRecord:function(e){var d=this,a=d.getViewModel().get("store");a.queryParams={NO_MR:e.get("NO_MR"),STATUS:1};a.load()}});Ext.define("perencanaan.purchaseorder.Form.ListSupplier",{extend:"com.Grid",xtype:"perencanaan-purchaseorder-form-list-supplier",viewModel:{stores:{store:{type:"perencanaan-purchaseorder-getpenyediabybarang-store"}}},header:{iconCls:"x-fa fa-list",padding:"7px 7px 7px 7px"},ui:"panel-red",initComponent:function(){var a=this;a.columns=[{xtype:"templatecolumn",align:"left",text:"Nama",flex:2,tpl:"{NAMA}"},{align:"right",text:"Harga Satuan",dataIndex:"HargaSatuan",flex:1}];a.callParent(arguments)},onLoadRecord:function(d){var e=this,a=e.getViewModel().get("store");a.removeAll();a.queryParams={BARANG:d.get("BARANG")};a.load()}});Ext.define("perencanaan.purchaseorder.Form.Workspace",{extend:"com.Form",xtype:"perencanaan-purchaseorder-form-workspace",controller:"perencanaan-purchaseorder-form-workspace",viewModel:{stores:{requeststore:{type:"perencanaan-materialrequest-store"}},data:{isRecordMr:undefined}},layout:"border",border:true,header:{iconCls:"x-fa fa-credit-card",padding:"5 10 5 10",cls:"x-color-w",items:[{xtype:"button",ui:"soft-cerulen",margin:"0 0 0 1",iconCls:"x-fa fa-file",tooltip:"Purchase Order (PO) Baru",text:"Buat PO Baru",reference:"btnPoBaru",handler:"onNewPo"}]},initComponent:function(){var a=this;a.items=[{region:"west",flex:0.75,collapsible:true,floatable:false,split:true,xtype:"perencanaan-purchaseorder-form-list",reference:"purchaseorderformlist",title:"Daftar Barang",listeners:{itemdblclick:"onItemDoubleClick"},viewConfig:{plugins:{ptype:"gridviewdragdrop",enableDrop:false},copy:true}},{region:"center",flex:2,layout:{type:"vbox",align:"stretch"},items:[{xtype:"perencanaan-purchaseorder-form-form",reference:"purchaseorderformform"},{flex:1,xtype:"perencanaan-purchaseorder-form-detil",reference:"purchaseorderformdetil",listeners:{scope:a.getController(),getongkir:"onGetOngkir"},viewConfig:{plugins:{ptype:"gridviewdragdrop",enableDrag:false},listeners:{scope:a.getController(),drop:"onDropBarang",beforedrop:"onBeforeDropBarang"}}}]},{region:"east",title:"History",flex:0.75,collapsible:true,floatable:true,split:true,xtype:"perencanaan-purchaseorder-form-history",reference:"purchaseorderformhistory",listeners:{select:"onSelectHistory"}}];a.callParent(arguments)},onLoadRecord:function(h){var e=this,a=e.getViewModel(),f=e.down("perencanaan-purchaseorder-form-list"),d=e.down("perencanaan-purchaseorder-form-form"),g=e.down("perencanaan-purchaseorder-form-history");a.set("isRecordMr",h);d.load(h);d.isNonAktifForm();f.onLoadRecord(h);g.onLoadRecord(h)},onLoadRecordEdit:function(h){var e=this,a=e.getViewModel(),f=e.down("perencanaan-purchaseorder-form-list"),d=e.down("perencanaan-purchaseorder-form-form"),g=e.down("perencanaan-purchaseorder-form-history");a.set("isRecordMr",h);d.onLoadRecord(h);d.isEditForm();f.onLoadRecord(h);g.onLoadRecord(h)},getDataRequest:function(f,d){var e=this,a=e.getViewModel().get("requeststore"),g=Ext.create("data.model.PurchaseOrderDetil"),h=[];a.queryParams={SUPPLIER:f,NO_MR:d};a.load(function(j,i,k){if(Ext.isArray(j)){j.each(function(m){var l={BARANG:m.data.BARANG,ID_MR_DETIL:m.data.JUMLAH,ID_SPH_DETIL:m.data.JUMLAH,HRG_SATUAN:m.data.JUMLAH,JUMLAH:m.data.JUMLAH,JUMLAH_BONUS:m.data.JUMLAH,ONGKIR:m.data.JUMLAH,REFERENSI:{BARANG:{REFERENSI:m.data.REFERENSI},JUMLAH:m.data.JUMLAH}};h.push(l);g.set(h)});return h}})}});Ext.define("perencanaan.purchaseorder.Form.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.perencanaan-purchaseorder-form-workspace",onItemDoubleClick:function(d,k,j,g,l){var i=this,e=i.getView(),h=e.openDialog("",true,"50%","50%",{title:"Daftar Penyedia per Item Barang",xtype:"perencanaan-purchaseorder-form-list-supplier",ui:"panel-cyan",scrollable:true,showCloseButton:true,listeners:{close:function(){h.close()}}},function(m,f){var a=f.down("perencanaan-purchaseorder-form-list-supplier");a.onLoadRecord(k);a.on("success",function(n){f.close()})},k,true,false)},onNewPo:function(f){var g=this,e=g.getView().getViewModel().get("isRecordMr"),d=e.get("NO_MR"),a=g.getReferences();a.purchaseorderformform.createRecord({TANGGAL:g.getView().getSysdate(),NO_MR:d,PPN:0,ONGKIR:0});a.purchaseorderformform.isNewForm({});a.purchaseorderformform.focus("SUPPLIER");a.purchaseorderformdetil.getStore().removeAll()},onSelectHistory:function(e,a){var f=this,d=f.getReferences();if(a.get("STATUS")==2){d.purchaseorderformform.loadRecord(a);d.purchaseorderformform.isFinalForm({});d.purchaseorderformdetil.onLoadRecordFinal(a)}if(a.get("STATUS")==1){d.purchaseorderformform.loadRecord(a);d.purchaseorderformform.isEditForm({});d.purchaseorderformdetil.onLoadRecordEdit(a)}if(a.get("STATUS")==0){d.purchaseorderformform.loadRecord(a);d.purchaseorderformform.isNonAktifForm({});d.purchaseorderformdetil.onLoadRecordFinal(a)}},onSelectSupplier:function(h,d){var i=this,a=i.getView(),g=i.getView().getViewModel().get("isRecordMr"),f=g.get("NO_MR"),e=i.getReferences();if(d){i.recordSelectionSupplier=d;e.purchaseorderformdetil.onLoadRecord(d,f)}},onBlurSupplier:function(d){var h=this,a=d.getSelection(),g=h.getView().getViewModel().get("isRecordMr"),f=g.get("NO_MR"),e=h.getReferences();if(a==null){d.select(null);e.purchaseorderformdetil.onLoadRecord(false,f)}},onBeforeDropBarang:function(j,h,i,o,k){var l=this,n=l.getView(),d=l.getViewModel(),m=l.getReferences(),a=h.view.selection;if(m.purchaseorderformform.getViewModel().get("record")==null){n.notifyMessage("Silahkan Pilih Supplier Atau Create PO Terlebih Dahulu");k.cancelDrop()}else{if(m.purchaseorderformform.getRecord()){if(m.purchaseorderformform.getRecord().get("SUPPLIER")==0){n.notifyMessage("Silahkan Pilih Supplier Terlebih Dahulu");k.cancelDrop()}if(m.purchaseorderformform.getRecord().get("NO_MR")==""){n.notifyMessage("Terjadi Kesalahan Load Data, Silahkan Reload Aplikasi");k.cancelDrop()}if(m.purchaseorderformdetil.onCekDoubleBarang(a).length>0){n.notifyMessage("Item Barang Tersebut Sudah Ada");k.cancelDrop()}}else{k.cancelDrop()}}},onDropBarang:function(n,l,m,u){var q=this,t=q.getView(),a=q.getViewModel(),s=q.getReferences(),i=a.get("isRecordMr"),o=Ext.Array.clone(l.records),k=i.get("ID"),e=new Date(),p=0;l.records=[];Ext.Array.each(o,function(d){})},onBatalDrop:function(d){var f=this,a=f.getReferences(),e=a.purchaseorderformdetil.getViewModel();view=f.getView();e.get("store").remove(d)},onSimpanPurchaseOrder:function(e){var g=this,d=g.getReferences(),h=d.purchaseorderformform.getRecord(),f=d.purchaseorderformdetil.getData(),a=g.getViewModel().get("isRecordMr");if(h&&f.length>0){h.set("PO_DETAIL",f);d.purchaseorderformform.save(e,{success:"Purchase Order (PO) Berhasil Di Simpan"},function(k,i,j){if(j){g.getView().onLoadRecord(a)}})}},onUpdatePurchaseOrder:function(e){var g=this,d=g.getReferences(),h=d.purchaseorderformform.getRecord(),f=d.purchaseorderformdetil.getDataUpdate(),a=g.getViewModel().get("isRecordMr");if(h&&f.length>0){h.set("PO_DETAIL",f);d.purchaseorderformform.save(e,{success:"Purchase Order (PO) Berhasil Di Update"},function(k,i,j){if(j){g.getView().onLoadRecordEdit(a)}})}},onFinalPurchaseOrder:function(f){var i=this,e=i.getReferences(),a=i.getView(),h=e.purchaseorderformform.getRecord(),g=e.purchaseorderformdetil.getDataUpdate(),d=i.getViewModel().get("isRecordMr");Ext.Msg.show({title:"Konfirmasi",message:"Apakah anda yakin ingin Final Purchase Order (PO) tersebut?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(j){if(j=="yes"){a.waitRefresh=true;if(h&&g.length>0){h.set("STATUS",2);e.purchaseorderformform.save(f,{success:"Purchase Order (PO) Berhasil Di Final"},function(k,l,m){if(m){a.onLoadRecord(d)}})}}}})},onCetakPurchaseOrder:function(e){var g=this,d=g.getReferences(),a=g.getView(),h=true,f=d.purchaseorderformform.getViewModel().get("record");a.cetak({NAME:"plugins.perencanaan.CetakPurchaseOrder",TYPE:h?"Pdf":"Word",EXT:h?"pdf":"docx",PARAMETER:{PNOPO:f.get("NO_PO")},REQUEST_FOR_PRINT:!h,PRINT_NAME:"CetakFaktur"},function(i){if(h){a.openDialog("Print Preview",true,0,0,{xtype:"panel",title:"Preview Purchase Order (PO)"},function(j,k){k.down("panel").update("<iframe style='width: 100%; height: 100%' src='"+i+"'></iframe>")})}})},onGetOngkir:function(){var f=this,e=f.getReferences(),g=e.purchaseorderformform.getOngkir()?e.purchaseorderformform.getOngkir():0,a=e.purchaseorderformform.getViewModel().get("record")?e.purchaseorderformform.getViewModel().get("record"):e.purchaseorderformform.getValues(),d=e.purchaseorderformdetil.getViewModel();d.set("onkosKirim",a.get("ONGKIR"));d.set("statusPpn",a.get("PPN"))}});Ext.define("perencanaan.purchaseorder.List",{extend:"com.Grid",alias:"widget.perencanaan-purchaseorder-list",controller:"perencanaan-purchaseorder-list",viewModel:{stores:{store:{type:"perencanaan-materialrequest-store"}}},header:{iconCls:"x-fa fa-list",padding:"7px 7px 7px 7px",title:"Daftar Perencanaan"},ui:"panel-cyan",layout:"fit",initComponent:function(){var a=this;a.columns=[{xtype:"rownumberer",text:"No",align:"left",width:50,style:"padding:6px 6px 6px 6px"},{align:"left",text:"Nomor",renderer:"onRenderNoMr",dataIndex:"NO_MR",flex:1},{align:"left",text:"Unit",renderer:"onRenderUnit",dataIndex:"UNIT",flex:1},{align:"left",text:"Periode",dataIndex:"TANGGAL",renderer:"onRenderTanggal",flex:1},{text:"Jumlah",flex:1.5,columns:[{align:"right",text:"Perencanaan",renderer:"onRenderQtyRequest",flex:1},{align:"right",text:"Sudah PO",renderer:"onRenderQtyOrder",flex:1}]},{align:"left",text:"Progres",renderer:"onRenderProgres",flex:0.5}],a.dockedItems=[{xtype:"pagingtoolbar",bind:{store:"{store}"},dock:"bottom"}];a.callParent(arguments)},onLoadRecord:function(e){var d=this,a=d.getViewModel().get("store");a.queryParams.STATUS=e.STATUS;a.load()}});Ext.define("perencanaan.purchaseorder.ListController",{extend:"Ext.app.ViewController",alias:"controller.perencanaan-purchaseorder-list",onRenderNoMr:function(d,a,f){var e=f.get("NO_MR");this.setBackGround(a,f.get("STATUSX"));return e},onRenderTanggal:function(d,a,e){this.setBackGround(a,e.get("STATUSX"));return Ext.Date.format(e.get("TANGGAL"),"d-m-Y")},onRenderUnit:function(d,a,f){var e=f.get("REFERENSI").UNIT.DESKRIPSI;this.setBackGround(a,f.get("STATUSX"));return e},onRenderQtyRequest:function(e,d,f){var a=f.get("REFERENSI").QTY_REQUEST;this.setBackGround(d,f.get("STATUSX"));return a},onRenderQtyOrder:function(e,d,f){var a=f.get("REFERENSI").QTY_PO;this.setBackGround(d,f.get("STATUSX"));return a},onRenderProgres:function(e,d,f){var a=f.get("REFERENSI").PROGRES;this.setBackGround(d,f.get("STATUSX"));return a},setBackGround:function(d,a){if(a==3){d.style="color:#000;font-weight: bold";d.tdCls="jadwalDinasHijau"}else{if(a==2){d.tdCls="jadwalDinasKuning";d.style="color:#000;font-weight: bold"}else{d.tdCls="jadwalDinasMerah";d.style="color:#FFF;font-weight: bold"}}},onTerimaRequest:function(e){var f=this,g=e.ownerCt.getWidgetRecord(),d=f.getViewModel().get("store"),a=f.getView();g.showError=true;g.animateTarget=e;g.scope=f;Ext.Msg.show({title:"Terima Request",message:"Anda yakin ingin menerima Perencanaan Ini ?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,animateTarget:e,fn:function(h){if(h==="yes"){g.set("STATUS",3);g.save({callback:function(i,j,k){if(k){a.notifyMessage("Perencanaan Berhasil Di Terima");d.reload()}else{a.notifyMessage("Perencanaan Gagal Di Terima");g.set("STATUS",1)}}})}else{b.set("STATUS",2)}}})},onProsesPo:function(a){var d=this,e=a.ownerCt.getWidgetRecord();d.getView().fireEvent("viewpo",e)}});Ext.define("perencanaan.purchaseorder.Workspace",{extend:"com.Form",xtype:"perencanaan-purchaseorder-workspace",controller:"perencanaan-purchaseorder-workspace",cls:"shadow-panel",border:true,layout:"border",bodyPadding:0,items:[{region:"center",xtype:"perencanaan-purchaseorder-list",reference:"PurchaseOrderList",flex:1,listeners:{itemdblclick:"onItemDoubleClick"}}],onLoadRecord:function(d){var a=this.down("perencanaan-purchaseorder-list");a.onLoadRecord({STATUS:2})}});Ext.define("perencanaan.purchaseorder.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.perencanaan-purchaseorder-workspace",recordSelection:undefined,onItemDoubleClick:function(d,k,j,g,l){var i=this,e=i.getView(),h=e.openDialog("",false,"100%","100%",{title:"Form Purchase Order",xtype:"perencanaan-purchaseorder-form-workspace",ui:"panel-cyan",scrollable:true,showCloseButton:true,listeners:{close:function(){h.close();e.onLoadRecord()}}},function(m,f){var a=f.down("perencanaan-purchaseorder-form-workspace");a.onLoadRecord(k);a.on("success",function(n){e.refresh();f.close()})},k,true,false)},onCreatePo:function(a){var d=this;var e=Ext.widget("window",{maximized:true,maximizable:true,layout:"fit",items:{xtype:"perencanaan-purchaseorder-form-workspace"}});e.on("show",function(){var f=e.down("perencanaan-purchaseorder-form-workspace");f.onLoadRecord(a)});e.show()}});Ext.define("perencanaan.suratperjanjian.Form.Form",{extend:"com.Form",xtype:"perencanaan-suratperjanjian-form-form",requires:["Ext.picker.Time"],controller:"perencanaan-suratperjanjian-form-form",viewModel:{data:{isNewForm:true,recordSph:undefined},getDiskonPrToRp:function(a,d){var e=(a*d)/100;return e},getDiskonRpToPr:function(e,a){var d=(a/e)*100;return d}},layout:{type:"hbox"},model:"perencanaan.suratpenawaranharga.detail.Model",initComponent:function(){var a=this;a.items=[{xtype:"barang-combo-master",name:"BARANG",emptyText:"[ Masukkan Nama Barang ]",flex:2,allowBlank:false,margin:"0 10 0 0",bind:{disabled:"{isNewForm}"}},{xtype:"numberfield",emptyText:"[ Harga Satuan]",name:"HARGA",reference:"harga",flex:1,allowBlank:false,hideTrigger:true,margin:"0 10 0 0",bind:{disabled:"{isNewForm}"}},{xtype:"numberfield",emptyText:"[ Diskon % ]",name:"DISKON_PR",reference:"diskon_pr",flex:1,hideTrigger:true,margin:"0 10 0 0",listeners:{change:"onChangeDiskonPr"},bind:{disabled:"{isNewForm}"}},{xtype:"numberfield",emptyText:"[ Diskon Rp ]",name:"DISKON_RP",reference:"diskon_rp",flex:1,hideTrigger:true,margin:"0 10 0 0",listeners:{change:"onChangeDiskonRp"},bind:{disabled:"{isNewForm}"}},{xtype:"numberfield",emptyText:"[ Diskon QTY (Beli) ]",name:"DISKON_BELI",reference:"diskon_beli",flex:1,minValue:1,hideTrigger:true,margin:"0 10 0 0",bind:{disabled:"{isNewForm}"}},{xtype:"numberfield",emptyText:"[ Diskon QTY (Bonus) ]",name:"DISKON_BONUS",reference:"diskon_bonus",flex:1,hideTrigger:true,margin:"0 10 0 0",bind:{disabled:"{isNewForm}"}},{xtype:"button",text:"Simpan",ui:"soft-blue",handler:"onAddItem",bind:{disabled:"{isNewForm}"}}];a.callParent(arguments)},onLoadRecord:function(){var a=this;a.getViewModel().set("isNewForm",false);a.onSetAwal()},onBeforeGetRecord:function(g,i){var d=g.down("barang-combo-master").getSelection(),h=g.down("[reference=harga]").getValue(),e=g.down("[reference=diskon_pr]").getValue(),j=g.down("[reference=diskon_rp]").getValue(),f=g.down("[reference=diskon_beli]").getValue(),a=g.down("[reference=diskon_bonus]").getValue();i.REFERENSI={DESKRIPSI:{KETERANGAN:"Add Item"}};i.HARGA=h;i.DISKON_PERSEN=e;i.DISKON_RUPIAH=j;i.DISKON_BELI=f;i.DISKON_BONUS=a;if(d){i.REFERENSI.BARANG=d.data}},onSetAwal:function(){var a=this;a.down("barang-combo-master").setValue("");a.down("[reference=harga]").setValue("");a.down("[reference=diskon_pr]").setValue("");a.down("[reference=diskon_rp]").setValue("");a.down("[reference=diskon_beli]").setValue("");a.down("[reference=diskon_bonus]").setValue("")},onSetAktifItem:function(d){var a=this;a.getViewModel().set("isNewForm",false);a.getViewModel().set("recordSph",d)},onSetNonAktif:function(d){var a=this;a.getViewModel().set("isNewForm",true)}});Ext.define("perencanaan.suratperjanjian.Form.FormController",{extend:"Ext.app.ViewController",alias:"controller.perencanaan-suratperjanjian-form-form",changePr:true,changeRp:true,onChangeDiskonPr:function(e,h,a,d){var g=this,f=g.getReferences().harga.getValue();g.changeRp=false;if(g.changePr){nilaiRp=g.getViewModel().getDiskonPrToRp(f,h);g.getReferences().diskon_rp.setValue(nilaiRp)}g.changeRp=true},onChangeDiskonRp:function(e,h,a,d){var g=this,f=g.getReferences().harga.getValue();g.changePr=false;if(g.changeRp){nilaiPr=g.getViewModel().getDiskonRpToPr(f,h);g.getReferences().diskon_pr.setValue(nilaiPr)}g.changePr=true},onAddItem:function(){this.getView().fireEvent("additemsph")}});Ext.define("perencanaan.suratperjanjian.Form.List",{extend:"com.Grid",xtype:"perencanaan-suratperjanjian-form-list",controller:"perencanaan-suratperjanjian-form-list",viewModel:{stores:{store:{type:"perencanaan-suratpenawaranharga-detail-store"}},data:{setStatus:true}},header:{iconCls:"x-fa fa-list",padding:"7px 7px 7px 7px",title:"Detail"},ui:"panel-cyan",layout:"fit",border:true,initComponent:function(){var a=this;a.columns=[{xtype:"templatecolumn",align:"left",text:"Item Barang",dataIndex:"BARANG",flex:3,tpl:'<div style="white-space:normal !important;color:black">{REFERENSI.BARANG.NAMA}</div>'},{align:"right",text:"Harga",dataIndex:"HARGA",flex:1},{text:"Diskon Harga",flex:1,columns:[{align:"right",text:"Persen (%)",dataIndex:"DISKON_PERSEN",flex:1},{align:"right",text:"Rupiah (Rp)",dataIndex:"DISKON_RUPIAH",flex:1}]},{text:"Diskon QTY",flex:1,columns:[{align:"right",text:"Beli",dataIndex:"DISKON_BELI",flex:1},{align:"right",text:"Gratis",dataIndex:"DISKON_BONUS",flex:1}]},{xtype:"checkcolumn",text:"Status",bind:{hidden:"{setStatus}"},dataIndex:"STATUS",width:60,listeners:{checkchange:"onChange"}}];a.dockedItems=[{xtype:"pagingtoolbar",bind:{store:"{store}"},dock:"bottom"}];a.callParent(arguments)}});Ext.define("perencanaan.suratperjanjian.Form.ListController",{extend:"Ext.app.ViewController",alias:"controller.perencanaan-suratperjanjian-form-list",onChange:function(f,j,i){var h=this,a=h.getView(),g=h.getViewModel(),d=g.get("store"),e=d.getAt(j);if(e){e.set("STATUS",i?1:0);e.scope=h;e.save({callback:function(m,k,l){if(l){a.notifyMessage("Status di "+(i==true?"Aktifkan":"NonAktifkan"))}else{e.set("STATUS",i?0:1)}}})}},onHapusItemSph:function(d,h,a){var f=this,e=f.getViewModel(),g=d.getStore().getAt(h);e.get("store").remove(g)}});Ext.define("perencanaan.suratperjanjian.Form.Rekanan",{extend:"com.Form",xtype:"perencanaan-suratperjanjian-form-rekanan",requires:["Ext.picker.Time"],viewModel:{data:{isNewForm:true,isFinalForm:true,minDate:null}},ui:"panel-cyan",layout:{type:"hbox"},border:true,model:"perencanaan.suratpenawaranharga.Model",initComponent:function(){var a=this;a.items=[{xtype:"penyedia-combo",name:"SUPPLIER",flex:2,params:{STATUS:1},emptyText:"[ Masukkan Nama PBF ]",margin:"0 10 0 0",allowBlank:false,listeners:{select:"onSelectSupplier",blur:"onBlurSupplier"}},{xtype:"textfield",emptyText:"[ Nomor ]",name:"NO_SPH",reference:"nomor",flex:1,allowBlank:false,hideTrigger:true,margin:"0 10 0 0",bind:{disabled:"{isNewForm}"}},{xtype:"datefield",emptyText:"[ Periode Awal ]",name:"PERIODE_AWAL",bind:{minValue:"{minDate}",disabled:"{isNewForm}"},reference:"periode_awal",margin:"0 10 0 0",format:"Y-m-d",allowBlank:false},{xtype:"datefield",emptyText:"[ Periode Akhir ]",name:"PERIODE_AKHIR",bind:{minValue:"{minDate}",disabled:"{isNewForm}"},reference:"periode_akhir",margin:"0 10 0 0",format:"Y-m-d",allowBlank:false},{xtype:"datefield",emptyText:"[ Expired ]",name:"EXPIRED",reference:"expired",margin:"0 10 0 0",format:"Y-m-d",bind:{disabled:"{isNewForm}"}},{xtype:"button",text:"Create",ui:"soft-blue",tooltip:"Create SPH",handler:"onCreateSph",margin:"0 10 0 0",bind:{hidden:"{isNewForm}"}},{xtype:"button",text:"Final",ui:"soft-green",tooltip:"Final",handler:"onFinalSph",bind:{hidden:"{isFinalForm}"}}];a.callParent(arguments)},onLoadRecord:function(d){var a=this;a.getViewModel().set("isNewForm",true);a.getViewModel().set("isFinalForm",true);a.getViewModel().set("minDate",d.TANGGAL)},onSetNewSph:function(d){var a=this;a.getViewModel().set("isNewForm",false);a.getViewModel().set("isFinalForm",true)},onSetUpdateSph:function(d){var a=this;a.getViewModel().set("isNewForm",true);a.getViewModel().set("isFinalForm",false)},onSetFinalSph:function(d){var a=this;a.getViewModel().set("isNewForm",true);a.getViewModel().set("isFinalForm",true)},onBeforeGetRecord:function(d,e){var a=d.down("penyedia-combo").getSelection();e.REFERENSI={SPH:{DESKRIPSI:"Simpan"}}}});Ext.define("perencanaan.suratperjanjian.Form.Workspace",{extend:"com.Form",xtype:"perencanaan-suratperjanjian-form-workspace",controller:"perencanaan-suratperjanjian-form-workspace",layout:{type:"hbox",align:"stretch"},items:[{flex:3,margin:"0 10px 0 0",layout:"border",items:[{region:"north",border:true,xtype:"perencanaan-suratperjanjian-form-form",reference:"formperjanjianharga",listeners:{additemsph:"OnAddItemSph"}},{region:"center",border:true,xtype:"perencanaan-suratperjanjian-form-list",reference:"listperjanjianharga",listeners:{success:"onSuccess"}}]},{flex:1,border:true,xtype:"perencanaan-suratperjanjian-history-list",reference:"rekananperjanjianharga",listeners:{select:"onSelectHistory"}}],onLoadRecord:function(f){var d=this,a=d.down("perencanaan-suratperjanjian-form-form"),e=d.down("perencanaan-suratperjanjian-form-rekanan")},onCariHistory:function(g){var e=this,f=e.down("perencanaan-suratperjanjian-history-list"),d=g.get("ID"),a=f.getStore();a.removeAll();delete a.queryParams.page;delete a.queryParams.start;delete a.queryParams.limit;a.queryParams.SUPPLIER=d;a.load({callback:function(h){if(h.length==0){e.fireEvent("onselecthistory","")}}})},onSetAktifItem:function(g){var e=this,a=e.down("perencanaan-suratperjanjian-form-list").getViewModel(),f=e.down("perencanaan-suratperjanjian-form-list").getStore(),d=e.down("perencanaan-suratperjanjian-form-form");f.removeAll();delete f.queryParams.page;delete f.queryParams.start;delete f.queryParams.limit;f.queryParams.SPH=g.get("NOMOR");f.load();a.set("setStatus",false);d.createRecord({TANGGAL:e.getSysdate(),ID_PENAWARAN:g.get("NOMOR")});d.onSetAktifItem(g);d.focus("BARANG")},onSetNonAktif:function(g){var e=this,a=e.down("perencanaan-suratperjanjian-form-list").getViewModel(),f=e.down("perencanaan-suratperjanjian-form-list").getStore(),d=e.down("perencanaan-suratperjanjian-form-form");f.removeAll();delete f.queryParams.page;delete f.queryParams.start;delete f.queryParams.limit;f.queryParams.SPH=g.get("NOMOR");f.load();a.set("setStatus",true);d.onSetNonAktif(g)},onSetNewSph:function(g){var e=this,a=e.down("perencanaan-suratperjanjian-form-list").getViewModel(),f=e.down("perencanaan-suratperjanjian-form-list").getStore(),d=e.down("perencanaan-suratperjanjian-form-form");f.removeAll();a.set("setStatus",true);d.onSetNonAktif(g)}});Ext.define("perencanaan.suratperjanjian.Form.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.perencanaan-suratperjanjian-form-workspace",onSelectHistory:function(d,a){this.getView().fireEvent("onselecthistory",a)},onSuccess:function(e,h,d){var g=this,a=g.getView(),f=g.getViewModel(),i=f.get("kjgn");a.load(i)},OnAddItemSph:function(e){var g=this,d=g.getReferences(),f=g.recordSelectionSupplier,a=d.formperjanjianharga.getRecord();if(a){if(a.get("DISKON_BELI")>0){var h=a.get("DISKON_BELI")}else{var h=1}a.set("DISKON_BELI",h);a.set("STATUS",1);d.formperjanjianharga.save(e,{success:"Add Item SPH Success.."},function(i,j,k){if(k){g.getView().onSetAktifItem(d.formperjanjianharga.getViewModel().get("recordSph"))}})}else{g.getView().notifyMessage("Add Item SPH Failed..")}},onReset:function(){var d=this,a=d.getReferences();a.formperjanjianharga.reset();a.rekananperjanjianharga.reset();a.rekananperjanjianharga.createRecord({});a.formperjanjianharga.focus("BARANG");a.formperjanjianharga.createRecord({});a.listperjanjianharga.removeDataStore()}});Ext.define("perencanaan.suratperjanjian.History.Detil",{extend:"com.Grid",xtype:"perencanaan-suratperjanjian-history-detil",viewModel:{stores:{store:{type:"perencanaan-suratpenawaranharga-store"}}},ui:"panel-gray",layout:"fit",initComponent:function(){var a=this;a.columns=[{xtype:"templatecolumn",align:"left",text:"Item Barang",dataIndex:"BARANG",flex:3,tpl:'<div style="white-space:normal !important;color:black">{REFERENSI.BARANG.NAMA}</div>'},{align:"right",text:"Harga",dataIndex:"HARGA",flex:1},{align:"right",text:"Diskon %",dataIndex:"DISKON_PERSEN",flex:1},{align:"right",text:"Riskon Rp",dataIndex:"DISKON_RUPIAH",flex:1}];a.callParent(arguments)},onLoadRecord:function(e){var d=this,a=d.getViewModel().get("store");a.load()}});Ext.define("perencanaan.suratperjanjian.History.List",{extend:"com.Grid",xtype:"perencanaan-suratperjanjian-history-list",viewModel:{stores:{store:{type:"perencanaan-suratpenawaranharga-store"}}},header:{iconCls:"x-fa fa-list",padding:"7 7 7 7",title:"History"},ui:"panel-cyan",layout:"fit",border:true,initComponent:function(){var a=this;a.columns=[{xtype:"templatecolumn",sortable:false,flex:1,tpl:new Ext.XTemplate('<div class="thumb-wrap">','<div class="thumb">','<div style="font-size: 12px; white-space:normal !important; font-weight: bold">Nomor : {NOMOR}</div>','<div style="font-weight: bold;font-size: 12px; white-space:normal !important;">Periode : {[this.tanggalFormat(values.PERIODE_AWAL)]} S/d {[this.tanggalFormat(values.PERIODE_AKHIR)]}</div>','<div style="font-weight: bold;font-size: 12px; white-space:normal !important;">{[this.getStatus(values.STATUS)]}</div>',"</div>","</div>",{tanggalFormat:function(d){var e=Ext.isDate(d)?d:Ext.Date.parse(d,"Y-m-d H:i:s");return Ext.Date.format(e,"d-m-Y")},getStatus:function(d){var e=Ext.util.Format.number(d,"0");if(d==1){return'<span style="color:blue;"> Status : Simpan </span>'}else{if(d==2){return'<span style="color:green;">Status : Final</span>'}else{if(d==0){return'<span style="color:red;">Status : Di Batalkan</span>'}}}return e}})}],a.dockedItems=[{xtype:"pagingtoolbar",bind:{store:"{store}"},dock:"bottom"}];a.callParent(arguments)},doAfterLoad:function(d,f,e,a){if(f.length>0){d.setSelection(f[0])}}});Ext.define("perencanaan.suratperjanjian.History.Workspace",{extend:"com.Form",xtype:"perencanaan-suratperjanjian-history-workspace",controller:"perencanaan-suratperjanjian-history-workspace",margin:"1 1 1 1",layout:"border",border:true,items:[{region:"center",xtype:"perencanaan-suratperjanjian-history-list",reference:"historylistperjanjianharga",listeners:{success:"onSuccess",itemdblclick:"onItemDoubleClick"}}],onLoadRecord:function(e){var a=this,d=a.down("perencanaan-suratperjanjian-history-list");d.onLoadRecord({})}});Ext.define("perencanaan.suratperjanjian.History.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.perencanaan-suratperjanjian-history-workspace",recordSelection:undefined,onItemDoubleClick:function(e,l,k,h,m){var j=this,g=j.getView(),i=g.openDialog("",false,"70%","70%",{title:"Detail",xtype:"perencanaan-suratperjanjian-history-detil",ui:"panel-cyan",scrollable:true,showCloseButton:true,listeners:{close:function(){i.close();g.onLoadRecord()}}},function(f,d){var a=d.down("perencanaan-suratperjanjian-history-detil");a.onLoadRecord(l);a.on("success",function(n){g.refresh();d.close()})},l,true,false)}});Ext.define("perencanaan.suratperjanjian.Workspace",{extend:"com.Form",xtype:"perencanaan-suratperjanjian-workspace",controller:"perencanaan-suratperjanjian-workspace",bodyPadding:0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"perencanaan-suratperjanjian-form-rekanan",title:"Form Rekanan",reference:"formrekanansph",header:{items:[{xtype:"button",iconCls:"x-fa fa-file",margin:"0 0 0 1",tooltip:"Buat SPH Baru",reference:"BtnNewForm",handler:"onNewSphForm"}]}},{flex:1,border:true,reference:"detilformrekanansph",xtype:"perencanaan-suratperjanjian-form-workspace",listeners:{onselecthistory:"onSelectHistory"}}],onLoadRecord:function(){var d=this,a=d.down("perencanaan-suratperjanjian-form-workspace");a.onLoadRecord({})}});Ext.define("perencanaan.suratperjanjian.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.perencanaan-suratperjanjian-workspace",recordSelectionSupplier:undefined,recordSelectionHistory:undefined,onNewSphForm:function(a){var e=this,d=e.getReferences();d.formrekanansph.createRecord({TANGGAL:e.getView().getSysdate(),SUPPLIER:e.recordSelectionSupplier.get("ID")});d.formrekanansph.onSetNewSph({});d.formrekanansph.focus("NO_SPH");d.detilformrekanansph.onSetNewSph({})},onCreateSph:function(d){var g=this,a=g.getReferences(),e=g.recordSelectionSupplier,f=a.formrekanansph.getRecord();if(f){f.set("STATUS",1);a.formrekanansph.save(d,{success:"Create SPH Success.."},function(h,i,j){if(j){a.detilformrekanansph.onCariHistory(e)}})}else{g.getView().notifyMessage("Create SPH Failed..")}},onFinalSph:function(d){var g=this,a=g.getReferences(),e=g.recordSelectionSupplier,f=a.formrekanansph.getRecord();if(f){f.set("STATUS",2);a.formrekanansph.save(d,{success:"Final SPH Success.."},function(h,i,j){if(j){a.detilformrekanansph.onCariHistory(e)}})}else{g.getView().notifyMessage("Final SPH Failed..")}},onSelectHistory:function(a){var e=this,d=e.getReferences();e.recordSelectionHistory=a;if(a){if(a.get("STATUS")==1){d.formrekanansph.loadRecord(a);d.formrekanansph.onSetUpdateSph(a);d.detilformrekanansph.onSetAktifItem(a)}else{d.formrekanansph.loadRecord(a);d.formrekanansph.onSetFinalSph(a);d.detilformrekanansph.onSetNonAktif(a)}}else{d.formrekanansph.createRecord({TANGGAL:e.getView().getSysdate(),SUPPLIER:e.recordSelectionSupplier.get("ID")});d.formrekanansph.onSetNewSph(a);d.formrekanansph.focus("NO_SPH");d.detilformrekanansph.onSetNewSph(a)}},onSelectSupplier:function(f,d){var g=this,a=g.getView(),e=g.getReferences();g.recordSelectionSupplier=d;e.detilformrekanansph.onCariHistory(d)},onBlurSupplier:function(d){var f=this,a=d.getSelection(),e=f.getReferences();if(a==null){d.select(null);e.formrekanansph.onResetForm({});e.detilformrekanansph.onSetNonAktif({})}}});