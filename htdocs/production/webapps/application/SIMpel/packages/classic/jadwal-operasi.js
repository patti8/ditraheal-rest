Ext.define(null,{override:"rekammedis.perencanaan.Workspace",initComponent:function(){var a=this;a.callParent(arguments);a.suspendLayouts();a.add({title:"Jadwal Operasi",xtype:"jadwal-operasi-request-workspace",reference:"jadwaloperasi"});a.resumeLayouts()},onLoadRecord:function(a,c){this.callParent(arguments)}});Ext.define("jadwal-operasi.jadwal.Model",{extend:"data.model.Model",serviceName:"jadwaloperasi/jadwaloperasi",fields:[{name:"ID",type:"int"},{name:"KODE",type:"string"},{name:"KAMAR",type:"int"},{name:"TANGGAL",type:"date",dateFormat:"Y-m-d"},{name:"MULAI",type:"date",dateFormat:"H:i:s"},{name:"SELESAI",type:"date",dateFormat:"H:i:s"},{name:"OLEH",type:"int"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("jadwaloperasi.jadwal.Store",{extend:"data.store.Store",model:"jadwal-operasi.jadwal.Model",alias:"store.jadwal-operasi-jadwal-store"});Ext.define("jadwal-operasi.jadwal.detail.Model",{extend:"data.model.Model",serviceName:"jadwaloperasi/jadwaloperasidetail",fields:[{name:"ID",type:"int"},{name:"KEGIATAN",type:"int"},{name:"JAM",type:"date",dateFormat:"H:i:s"},{name:"KETERANGAN",type:"string"},{name:"OLEH",type:"int"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("jadwaloperasi.jadwal.detail.Store",{extend:"data.store.Store",model:"jadwal-operasi.jadwal.detail.Model",alias:"store.jadwal-operasi-jadwal-detail-store"});Ext.define("jadwal-operasi.request.Model",{extend:"data.model.Model",serviceName:"jadwaloperasi/requestjadwaloperasi",fields:[{name:"KODE",type:"string"},{name:"KUNJUNGAN",type:"string"},{name:"TANGGAL",type:"date",dateFormat:"Y-m-d"},{name:"JAM",type:"date",dateFormat:"H:i:s"},{name:"RUANGAN",type:"string"},{name:"DURASI",type:"date",dateFormat:"H:i:s"},{name:"TINDAKAN",type:"string"},{name:"DIAGNOSA",type:"string"},{name:"DOKTER",type:"int"},{name:"KETERANGAN",type:"string"},{name:"ACC",type:"int"},{name:"OLEH",type:"int"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"KODE"});Ext.define("jadwaloperasi.request.Store",{extend:"data.store.Store",model:"jadwal-operasi.request.Model",alias:"store.jadwal-operasi-request-store"});Ext.define("jadwaloperasi.Workspace",{extend:"com.Form",xtype:"jadwal-operasi-workspace",controller:"jadwal-operasi-workspace",layout:"fit",bodyPadding:2,items:[{xtype:"com-form",ui:"panel-blue",title:"Jadwal Operasi",titleFieldConfig:{},fullscreenEnabled:true,menuConfig:{enabled:true,width:200,buttonConfig:{}},fullscreenConfig:{},header:{items:[{}]}}],load:function(a){var d=this,c=this.down("com-form");c.setMenus(d.childmenu("9008",2,2))},childmenu:function(f,e,a){var d=this,c=[];xuam=Ext.JSON.decode(Ext.util.Base64.decode(d.app.xuam));xuam.forEach(function(h,g){h=Ext.JSON.decode(Ext.util.Base64.decode(h));if(h.ID.substring(0,a+2)==f&&h.LEVEL==e+1){var j={text:h.DESKRIPSI,leaf:h.HAVE_CHILD==0,iconCls:h.ICON_CLS};if(h.HAVE_CHILD==0||h.CLASS){j.className=h.CLASS;j.idClassName=d.replaceAll(h.CLASS.toLowerCase(),".","_")}else{j.children=d.childmenu(h.ID,parseInt(h.LEVEL),a+2)}c.push(j)}});return c}});Ext.define("jadwaloperasi.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.jadwal-operasi-workspace",onTabChange:function(c,a){if(a.load){a.load({})}},onRefresh:function(a){var c=this;c.getView().loadStore({})}});Ext.define("jadwaloperasi.jadwal.Workspace",{extend:"com.Tab",alias:"widget.jadwal-operasi-jadwal-workspace",controller:"jadwal-operasi-jadwal-workspace",activeTab:0,cls:"x-br-top",ui:"header-tab",rec:undefined,initComponent:function(){var a=this;a.items=[{title:"Request Jadwal",xtype:"jadwal-operasi-jadwal-terima-workspace"},{title:"Jadwal Operasi",xtype:"jadwal-operasi-jadwal-info-acc-workspace"},{title:"Sign In Sign Out",xtype:"jadwal-operasi-jadwal-info-workspace"},{title:"List Operasi",xtype:"jadwal-operasi-jadwal-summary-workspace"}];a.callParent(arguments)},loadStore:function(d){var c=this,a=this.getActiveTab();c.rec=d;if(a){a.load({})}else{if(c.items.getCount()>0){c.setActiveTab(0)}}},listeners:{tabchange:"onTabChange"}});Ext.define("jadwal-operasi.jadwal.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.jadwal-operasi-jadwal-workspace",onTabChange:function(c,d){var a=this.getViewModel();if(d.load){d.load()}}});Ext.define("jadwaloperasi.jadwal.info.Grid",{extend:"com.Grid",xtype:"jadwal-operasi-jadwal-info-grid",controller:"jadwal-operasi-jadwal-info-grid",viewModel:{stores:{store:{type:"jadwal-operasi-jadwal-store"},detail:{type:"jadwal-operasi-jadwal-detail-store"}}},columns:[{xtype:"rownumberer",text:"No",menuDisabled:true,sortable:false,align:"left",width:50},{text:"Tanggal",dataIndex:"TANGGAL",xtype:"datecolumn",format:"d-m-Y",flex:0.5},{text:"Waktu",dataIndex:"TANGGAL",xtype:"templatecolumn",flex:0.8,tpl:new Ext.XTemplate("{[this.jamFormat(values.MULAI)]} - {[this.jamFormat(values.SELESAI)]}",{jamFormat:function(c){var a=Ext.isDate(c)?c:Ext.Date.parse(c,"H:i:s");return Ext.Date.format(a,"H:i:s")}})},{text:"No. RM",dataIndex:"ID",xtype:"templatecolumn",flex:0.5,tpl:"{REFERENSI.REQUEST.REFERENSI.KUNJUNGAN.REFERENSI.PENDAFTARAN.REFERENSI.PASIEN.NORM}"},{text:"Nama",dataIndex:"ID",xtype:"templatecolumn",flex:1,tpl:"{REFERENSI.REQUEST.REFERENSI.KUNJUNGAN.REFERENSI.PENDAFTARAN.REFERENSI.PASIEN.NAMA}"},{text:"Ruangan Asal",dataIndex:"ID",xtype:"templatecolumn",flex:1,tpl:"{REFERENSI.REQUEST.REFERENSI.KUNJUNGAN.REFERENSI.RUANGAN.DESKRIPSI}"},{text:"Ruang Operasi",dataIndex:"ID",xtype:"templatecolumn",flex:0.5,tpl:"{REFERENSI.KAMAR.DESKRIPSI}"},{text:"Dokter",dataIndex:"DOKTER",xtype:"templatecolumn",flex:1,tpl:"{REFERENSI.REQUEST.REFERENSI.DOKTER.NAMA}"},{xtype:"widgetcolumn",text:"Status",align:"center",width:80,widget:{xtype:"fieldcontainer",defaults:{padding:2},layout:{type:"vbox",align:"stretch"},items:[{xtype:"button",text:"Batalkan",action:0,width:80,margin:"0 1 0 0",handler:"onBatal"}]},onWidgetAttach:function(c,f,g){var d=g.get("REFERENSI").DETAIL,e=f.down("[action=0]"),a=0;if(d!=undefined){a=1}e.setHidden(a==1)}}],listeners:{itemdblclick:"onPilihJadwal"}});Ext.define("jadwal-operasi.jadwal.info.GridController",{extend:"Ext.app.ViewController",alias:"controller.jadwal-operasi-jadwal-info-grid",onBatal:function(g){var f=this,d=f.getView(),e=f.getStore("store"),a=g.ownerCt.getWidgetRecord();a.showError=true;a.animateTarget=g;a.scope=f;Ext.Msg.show({title:"Pembatalan Jadwal",message:"Anda yakin ingin membatalkan Jadwal Ini ?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,animateTarget:g,fn:function(c){if(c==="yes"){a.set("STATUS",0);a.save({callback:function(m,n,j){if(j){d.notifyMessage("Pembatalan Jadwal Tindakan Berhasil ..");e.load()}else{d.notifyMessage("Gagal ..")}}})}}})},onDetail:function(d,e){var c=this,a=c.getView();a.fireEvent("detail",e)},onPilihJadwal:function(f,g,d){var e=this,c=e.getView();c.fireEvent("pilihjadwal",g)}});Ext.define("jadwal-operasi.jadwal.info.Workspace",{extend:"com.Form",xtype:"jadwal-operasi-jadwal-info-workspace",controller:"jadwal-operasi-jadwal-info-workspace",viewModel:{data:{kjgn:undefined,maxinput:"0"}},layout:"border",bodyPadding:1,initComponent:function(){var a=this;a.items=[{flex:1,region:"center",xtype:"jadwal-operasi-jadwal-info-grid",listeners:{pilihjadwal:"onDetail"}}];a.dockedItems=[{xtype:"toolbar",dock:"top",items:[{xtype:"datefield",fieldLabel:"Tanggal Jadwal",submitFormat:"Y-m-d",format:"d-m-Y",value:a.getSysdate(),reference:"tanggal"},"->",{xtype:"button",text:"Proses",ui:"soft-blue",handler:"onFilter"}]}];a.callParent(arguments)},load:function(){var d=this,e=d.down("jadwal-operasi-jadwal-info-grid"),c=e.getViewModel(),a=c.get("store");a.queryParams={TANGGAL:d.getSysdate(),STATUS:1};a.load()}});Ext.define("jadwaloperasi.jadwal.info.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.jadwal-operasi-jadwal-info-workspace",onFilter:function(e){var h=this,a=h.getView(),g=a.getReferences(),f=a.getViewModel(),j=a.down("jadwal-operasi-jadwal-info-grid"),d=j.getViewModel(),c=d.get("store");c.queryParams={TANGGAL:g.tanggal.getSubmitValue(),STATUS:1};c.load()},onDetail:function(f){var d=this,a=d.getView(),c=a.getViewModel();var e=a.openDialog("",true,450,400,{xtype:"jadwal-operasi-jadwal-info-detail-workspace",ui:"panel-gray",title:"Kegiatan",showCloseButton:true,iconCls:"x-fa fa-plus"},function(j,m){var h=m.down("jadwal-operasi-jadwal-info-detail-workspace"),g=h.getViewModel();g.set("jadwal",f);h.load(f);h.on("save",function(n){});m.on("close",function(){d.onFilter()})})}});Ext.define("jadwal-operasi.jadwal.info.acc.Detail",{extend:"com.Form",xtype:"jadwal-operasi-jadwal-info-acc-detail",viewModel:{stores:{store:{type:"jadwal-operasi-jadwal-store"}},data:{formConfig:{readOnly:true,baru:false,kirim:false,tanggal:new Date(),viewOnly:false},isNonAktif:true,maxDate:Ext.Date.add(new Date(),Ext.Date.DAY,7),minDate:Ext.Date.add(new Date(),Ext.Date.DAY,1),maxinput:"0",jadwallangsung:false,info_tersedia:"Tidak Tersedia"}},layout:{type:"hbox",align:"stretch"},initComponent:function(){var d=this,e=Ext.Date.format(d.getSysdate(),"Y-m-d"),a=e+" 08:00:00",c=e+" 16:00:00",a=new Date(a),c=new Date(c);d.items=[{layout:"hbox",flex:1,border:false,scrollable:"y",defaults:{margin:"2.2.2.2"},items:[{border:true,flex:1,layout:{type:"vbox",align:"stretch"},defaults:{margin:"2.2.2.2",labelWidth:150},bodyPadding:5,items:[{fieldLabel:"No. RM",name:"NORM",xtype:"textfield",readOnly:true},{fieldLabel:"Nama",name:"NAMA",xtype:"textfield",readOnly:true},{layout:{type:"hbox",align:"stretch"},xtype:"fieldcontainer",fieldLabel:"Rencana Operasi",items:[{xtype:"datefield",name:"TANGGAL",format:"d-m-Y",readOnly:true,submitFormat:"Y-m-d",flex:1,margin:"0 4 0 0",reference:"tanggal",emptyText:"[ TANGGAL  ]",allowBlank:false},{xtype:"timefield",format:"H:i:s",name:"JAM",flex:1,readOnly:true,allowBlank:false,minValue:a,maxValue:c}]},{fieldLabel:"Dokter",xtype:"dokter-combo",emptyText:"[Dokter]",params:{STATUS:1},bind:{readOnly:"{viewOnly}"},firstLoad:true,reference:"doktercombo",name:"DOKTER",allowBlank:false},{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},flex:1,fieldLabel:"Perkiraan Operasi",items:[{fieldLabel:"Durasi",name:"DURASI",xtype:"timefield",readOnly:true,format:"H:i:s",flex:1,allowBlank:false,maxValue:"10:00",reference:"durasi"},{xtype:"timefield",name:"SELESAI",fieldLabel:"Selesai",format:"H:i",margin:"0 0 0 10",flex:1,readOnly:true,allowBlank:false}]},{fieldLabel:"Rencana Tindakan",name:"TINDAKAN",xtype:"textareafield",reference:"tindakan",readOnly:true},{fieldLabel:"Diagnosa",name:"DIAGNOSA",xtype:"textfield",reference:"diagnosa",readOnly:true},{xtype:"referensi-combo",name:"KAMAR",readOnly:true,fieldLabel:"Ruangan Kamar"},{fieldLabel:"Unit Pengirim",name:"UNIT",xtype:"textfield",readOnly:true}]}]}],d.callParent(arguments)},load:function(){var d=this,c=d.getViewModel(),a=d.down("referensi-combo"),e=a.getStore();e.queryParams={JENIS:156,STATUS:1};e.load()}});Ext.define("jadwal-operasi.jadwal.info.acc.Grid",{extend:"com.Grid",xtype:"jadwal-operasi-jadwal-info-acc-grid",controller:"jadwal-operasi-jadwal-info-acc-grid",viewModel:{stores:{store:Ext.create("Ext.data.Store",{fields:["TANGGAL","JAM"]}),storeJadwal:{type:"jadwal-operasi-jadwal-store"},storeJadwalTemp:{type:"jadwal-operasi-jadwal-store"},storeKamar:{type:"ruang-kamar-store"}},data:{datesend:undefined,column:undefined,daftar:undefined,tanggal:undefined,viewOnly:true,jadwallangsung:false}},border:false,bodyStyle:"{border-bottom:0px}",ui:"panel-cyan",initComponent:function(){var a=this;a.columns=[{text:"Jam Mulai",sortable:false,dataIndex:"JAM",width:100}];a.listeners={celldblclick:function(n,o,j,f,p,m,g){var c=n.panel.headerCt.getHeaderAtIndex(j).dataIndex,h=n.panel.headerCt.getHeaderAtIndex(j).text,d=f.get(c);kd_book=d.split(" ");a.fireEvent("detailJadwal",kd_book[0])}};a.callParent(arguments)},insertDataGrid:function(p,f,B){var C=this,A=C.getViewModel(),g=A.get("store"),m=[],D=[],E=C.getPropertyConfig(90084),w=0,v=0,o=p.getData(),y=[],s=[],n=0;g.removeAll();console.log(o.length);while(E<=23){var d=""+E,e=""+w,x="00",c=x.substring(0,x.length-d.length)+d,a=x.substring(0,x.length-e.length)+e;if(w==0){w=30}else{E++;w=0}jam_mulai=c+":"+a;var u=[],h="";for(k=0;k<f.length;k++){u[k+1]="";if(o.length>0){for(i=0;i<o.length;i++){var q=Ext.Date.format(o.items[i].get("MULAI"),"H:i"),t=Ext.Date.format(o.items[i].get("SELESAI"),"H:i");if(o.items[i].get("KAMAR")==f[k].get("ID")&&t>jam_mulai&&q<=jam_mulai){var r=0;for(l=0;l<y.length;l++){if(y[l]==o.items[i].get("KODE")){r=1;h=s[l]}}if(r==0){h="#"+Math.floor(Math.random()*9)+""+Math.floor(Math.random()*9)+"99DD";y[n]=o.items[i].get("KODE");s[n]=h;n++;u[k+1]=o.items[i].get("KODE")+' <div style="background-color:'+h+'"><b>'+o.items[i].get("REFERENSI").REQUEST.REFERENSI.KUNJUNGAN.REFERENSI.PENDAFTARAN.REFERENSI.PASIEN.NAMA+"</b><br> "+o.items[i].get("REFERENSI").REQUEST.TINDAKAN+"</div>"}else{u[k+1]='<div style="background-color:'+h+'">&nbsp;<br>&nbsp</div>'}}}}}model=Ext.create("jadwal-operasi.jadwal.Model",{TANGGAL:B,JAM:jam_mulai});model.set(u);g.insert(v,model);v++}g.sync();u.splice(0,u.length);C.setLoading(false)},setColumns:function(g,j){var f=this,e=f.getViewModel(),h=e.get("storeKamar"),a=e.get("storeJadwal"),c=e.get("store"),d=[];a.removeAll();a.queryParams={TANGGAL:g,STATUS:1};c.removeAll();h.removeAll();f.setLoading("Load data");a.load({callback:function(n,p,m){h.queryParams={RUANGAN:j,STATUS:1};h.load({callback:function(r,o,q){if(q){if(r.length>0){r.forEach(function(t,s){d.push({xtype:"widgetcolumn",text:t.get("KAMAR"),dataIndex:s+1,width:250,align:"center",renderer:function(v,w,u){if(v!="undefined"){var x=v.search("#");w.style="background-color:"+v.substr(x,7);+";"}return v},widget:{xtype:"fieldcontainer",defaults:{padding:2},items:[{xtype:"button",text:"Pilih",action:t.get("ID"),flex:1,margin:"0 1 0 0",handler:"onPilih"}]},onWidgetAttach:function(u,y,A){var v=f.getViewModel(),z=v.get("viewOnly"),x=A.get(s+1),w=y.down("[action="+t.get("ID")+"]"),B=x.search("#");if(z==false){if(B>0){w.setHidden(true)}}else{w.setHidden(true)}}});f.getHeaderContainer().remove(s+1)})}column={text:"Ruang Kamar Operasi",flex:1,sortable:false,columns:d};f.getHeaderContainer().add(column);f.insertDataGrid(a,r,g);d.splice(0,d.length)}}});f.setLoading(false)}})},setWaktuSelesai:function(h,e){var d=this,g=h.split(":"),f=e.split(":"),c=parseInt(g[1])+parseInt(f[1]),a=parseInt(g[0])+parseInt(f[0]);if(c>=60){c=c-60;a=a+1}return Ext.String.leftPad(a,2,"0")+":"+Ext.String.leftPad(c,2,"0")}});Ext.define("jadwal-operasi.jadwal.info.acc.GridController",{extend:"Ext.app.ViewController",alias:"controller.jadwal-operasi-jadwal-info-acc-grid",onPilih:function(j){var g=this,d=g.getView(),f=d.getViewModel(),h=f.get("jadwallangsung"),e=g.getStore("store"),a=j.ownerCt.getWidgetRecord();a.showError=true;a.animateTarget=j;a.scope=g;a.set("KAMAR",j.action);if(h==true){d.fireEvent("pilihjadwal",a)}else{d.fireEvent("pilih",a)}}});Ext.define("jadwal-operasi.jadwal.info.acc.Workspace",{extend:"com.Form",xtype:"jadwal-operasi-jadwal-info-acc-workspace",controller:"jadwal-operasi-jadwal-info-acc-workspace",viewModel:{data:{req:undefined,maxinput:"0",detail:undefined,editjadwal:false,ruangan:0},stores:{storeJadwal:{type:"jadwal-operasi-jadwal-store"},storeRequest:{type:"jadwal-operasi-request-store"}}},layout:"fit",bodyPadding:1,initComponent:function(){var a=this;a.items=[{region:"center",flex:1,xtype:"jadwal-operasi-jadwal-info-acc-grid",listeners:{pilih:"onTerima",pilihjadwal:"onPilihJadwal",detailJadwal:"onDetailJadwal"}}];a.dockedItems=[{xtype:"toolbar",dock:"top",items:[{xtype:"datefield",fieldLabel:"Tanggal Jadwal",submitFormat:"Y-m-d",format:"d-m-Y",value:a.getSysdate(),reference:"tanggal"},{xtype:"ruangan-combo",fieldLabel:"Unit Operasi",name:"RUANGAN",bind:{readOnly:"{editjadwal}"},reference:"ruangan",flex:1},"->",{xtype:"button",text:"Proses",ui:"soft-blue",handler:"onChange"}]}];a.callParent(arguments)},load:function(e){console.log(e);var d=this,g=d.down("jadwal-operasi-jadwal-info-acc-grid"),f=d.down("datefield").getSubmitValue(),h=d.down("ruangan-combo"),c=h.getStore(),a=g.getViewModel();c.queryParams={JENIS_KUNJUNGAN:6,JENIS:5,STATUS:1};c.load({callback:function(j,n,m){h.setValue(e)}});if(h.getValue()>0){g.setColumns(f,h.getValue())}}});Ext.define("jadwaloperasi.jadwal.info.acc.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.jadwal-operasi-jadwal-info-acc-workspace",onChange:function(c){var f=this,a=f.getView(),e=a.getReferences(),d=a.getViewModel(),g=a.down("jadwal-operasi-jadwal-info-acc-grid");d.set("ruangan",e.ruangan.getValue());g.setColumns(e.tanggal.getSubmitValue(),e.ruangan.getValue())},onTerima:function(c,j){var f=this,a=f.getView(),d=f.getViewModel(),h=a.down("ruangan-combo").getValue(),e=d.get("req");var g=a.openDialog("",true,500,200,{xtype:"jadwal-operasi-jadwal-terima-form",ui:"panel-gray",title:"Form Terima Jadwal",showCloseButton:true,iconCls:"x-fa fa-plus"},function(p,q){var o=q.down("jadwal-operasi-jadwal-terima-form"),s=o.getViewModel(),n=c.get("JAM"),r=Ext.Date.format(e.get("DURASI"),"H:i"),m=f.setWaktuSelesai(n,r);s.set("durasi",r);o.load(h);o.createRecord({STATUS:1,KAMAR:c.get("KAMAR"),KODE:e.get("KODE"),TANGGAL:e.get("TANGGAL"),MULAI:n+":00",SELESAI:m+":00"});o.on("save",function(u){q.close()});q.on("close",function(){a.load()})},c)},setWaktuSelesai:function(h,e){var d=this,g=h.split(":"),f=e.split(":"),c=parseInt(g[1])+parseInt(f[1]),a=parseInt(g[0])+parseInt(f[0]);if(c>=60){c=c-60;a=a+1}return Ext.String.leftPad(a,2,"0")+":"+Ext.String.leftPad(c,2,"0")},onPilihJadwal:function(c,f){var e=this,a=e.getView(),d=e.getViewModel();a.fireEvent("pilihjadwal",c)},onDetailJadwal:function(j){var g=this,e=g.getView(),a=e.getPropertyConfig(90083),f=e.getViewModel(),d=f.get("storeJadwal"),c=f.get("storeRequest");if(j.length>5){var h=e.openDialog("",true,0,0,{xtype:"jadwal-operasi-request-workspace",ui:"panel-gray",title:"Form Edit Jadwal",showCloseButton:true,iconCls:"x-fa fa-tool"},function(q,r){var p=r.down("jadwal-operasi-request-workspace"),o=p.down("jadwal-operasi-request-form"),m=p.getViewModel(),n=o.getViewModel();c.queryParams={KODE:j};c.load({callback:function(s,u,t){p.load();o.loadRecord(s[0]);m.set("admin",true);n.set("viewOnly",true);if(a=="TRUE"){n.set("editadmin",true)}else{n.set("editadmin",false)}}});r.on("close",function(){console.log(f.get("ruangan"));e.load(f.get("ruangan"))});o.on("save",function(s){r.close()})})}}});Ext.define("jadwal-operasi.jadwal.info.detail.Form",{extend:"com.Form",xtype:"jadwal-operasi-jadwal-info-detail-form",controller:"jadwal-operasi-jadwal-info-detail-form",viewModel:{stores:{store:{type:"jadwal-operasi-jadwal-detail-store"}},data:{jadwal:undefined}},model:"jadwal-operasi.jadwal.detail.Model",layout:{type:"hbox",align:"stretch"},initComponent:function(){var a=this;a.items=[{layout:"hbox",flex:1,border:false,scrollable:"y",defaults:{margin:"2.2.2.2"},items:[{border:true,flex:1,layout:{type:"vbox",align:"stretch"},defaults:{margin:"2.2.2.2",labelWidth:150},bodyPadding:5,items:[{xtype:"referensi-combo",name:"KEGIATAN",allowBlank:false,listeners:{change:"onChangeKegiatan"},fieldLabel:"Kegiatan"},{layout:{type:"hbox",align:"stretch"},xtype:"fieldcontainer",fieldLabel:"Waktu Kegiatan",items:[{xtype:"datefield",name:"TANGGAL",format:"d-m-Y",submitFormat:"Y-m-d",readOnly:true,flex:1,margin:"0 4 0 0",reference:"tanggal",emptyText:"[ TANGGAL  ]",allowBlank:false},{xtype:"timefield",format:"H:i:s",name:"JAM",allowBlank:false,flex:1,allowBlank:false}]},{xtype:"textareafield",name:"KETERANGAN",allowBlank:true,fieldLabel:"Keterangan"}]}]}],a.dockedItems=[{xtype:"toolbar",dock:"bottom",items:[{text:"Simpan",iconCls:"x-fa fa-save",formBind:true,handler:"onSimpan",ui:"soft-green"}]}];a.callParent(arguments)},load:function(){var c=this,a=c.down("referensi-combo"),d=a.getStore();d.queryParams={JENIS:158,STATUS:1};d.load()}});Ext.define("jadwal-operasi.jadwal.info.detail.FormController",{extend:"Ext.app.ViewController",alias:"controller.jadwal-operasi-jadwal-info-detail-form",onSimpan:function(d){var f=this,e=f.getViewModel(),a=f.getView(),c=f.getReferences();a.save(d)},onChangeKegiatan:function(f,g){var d=this,a=d.getView(),c=a.getViewModel(),e=c.get("jadwal");if(g==1||g==3){a.down("[name=JAM]").setValue(e.get("MULAI"))}else{a.down("[name=JAM]").setValue(e.get("SELESAI"))}jam=console.log(g)}});Ext.define("jadwaloperasi.jadwal.info.detailGrid",{extend:"com.Grid",xtype:"jadwal-operasi-jadwal-info-detail-grid",controller:"jadwal-operasi-jadwal-info-detail-grid",viewModel:{stores:{store:{type:"jadwal-operasi-jadwal-detail-store"}}},columns:[{text:"Jam",dataIndex:"TANGGAL",xtype:"templatecolumn",flex:0.8,tpl:new Ext.XTemplate("{[this.jamFormat(values.JAM)]}",{jamFormat:function(c){var a=Ext.isDate(c)?c:Ext.Date.parse(c,"H:i:s");return Ext.Date.format(a,"H:i:s")}})},{text:"Kegiatan",dataIndex:"ID",xtype:"templatecolumn",flex:0.5,tpl:"{REFERENSI.KEGIATAN.DESKRIPSI}"},{text:"Keterangan",dataIndex:"KETERANGAN",flex:1},{xtype:"widgetcolumn",text:"Status",align:"center",width:80,widget:{xtype:"fieldcontainer",defaults:{padding:2},layout:{type:"vbox",align:"stretch"},items:[{xtype:"button",text:"Batalkan",action:0,width:80,margin:"0 1 0 0",handler:"onBatal"}]}}]});Ext.define("jadwal-operasi.jadwal.info.detail.GridController",{extend:"Ext.app.ViewController",alias:"controller.jadwal-operasi-jadwal-info-detail-grid",onBatal:function(g){var f=this,d=f.getView(),e=f.getStore("store"),a=g.ownerCt.getWidgetRecord();a.showError=true;a.animateTarget=g;a.scope=f;Ext.Msg.show({title:"Pembatalan Kegiatan",message:"Anda yakin ingin membatalkan Kegiatan Ini ?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,animateTarget:g,fn:function(c){if(c==="yes"){a.set("STATUS",0);a.save({callback:function(m,n,j){if(j){d.notifyMessage("Pembatalan Kegiatan Berhasil ..");e.load()}else{d.notifyMessage("Gagal ..")}}})}}})}});Ext.define("jadwal-operasi.jadwal.info.detail.Workspace",{extend:"com.Form",xtype:"jadwal-operasi-jadwal-info-detail-workspace",controller:"jadwal-operasi-jadwal-info-detail-workspace",viewModel:{data:{jadwal:undefined,maxinput:"0"}},layout:"border",bodyPadding:1,initComponent:function(){var a=this;a.items=[{xtype:"jadwal-operasi-jadwal-info-detail-form",listeners:{save:"onSave"},region:"north"},{flex:1,region:"center",xtype:"jadwal-operasi-jadwal-info-detail-grid"}];a.callParent(arguments)},load:function(h){var f=this,g=f.down("jadwal-operasi-jadwal-info-detail-grid"),e=f.down("jadwal-operasi-jadwal-info-detail-form"),d=e.getViewModel(),c=g.getViewModel(),a=c.get("store");d.set("jadwal",h);e.load();e.createRecord({STATUS:1,JADWAL:h.get("ID")});e.down("[name=TANGGAL]").setValue(h.get("TANGGAL"));a.queryParams={JADWAL:h.get("ID"),STATUS:1};a.load()}});Ext.define("jadwal-operasi.jadwal.info.detail.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.jadwal-operasi-jadwal-info-detail-workspace",onSave:function(d,h,c){var f=this,a=f.getView(),e=f.getViewModel(),g=e.get("jadwal");a.load(g)}});Ext.define("jadwaloperasi.jadwal.summary.Grid",{extend:"com.Grid",xtype:"jadwal-operasi-jadwal-summary-grid",viewModel:{stores:{store:{type:"jadwal-operasi-jadwal-store"},detail:{type:"jadwal-operasi-jadwal-detail-store"}}},columns:[{xtype:"rownumberer",text:"No",menuDisabled:true,sortable:false,align:"left",width:50},{text:"No. RM",dataIndex:"ID",xtype:"templatecolumn",width:100,tpl:"{REFERENSI.REQUEST.REFERENSI.KUNJUNGAN.REFERENSI.PENDAFTARAN.REFERENSI.PASIEN.NORM}"},{text:"Nama",dataIndex:"ID",xtype:"templatecolumn",width:250,tpl:"{REFERENSI.REQUEST.REFERENSI.KUNJUNGAN.REFERENSI.PENDAFTARAN.REFERENSI.PASIEN.NAMA}"},{text:"Tanggal",dataIndex:"TANGGAL",xtype:"datecolumn",format:"d-m-Y",width:100},{text:"Waktu",dataIndex:"TANGGAL",xtype:"templatecolumn",width:200,tpl:new Ext.XTemplate("{[this.jamFormat(values.MULAI)]} - {[this.jamFormat(values.SELESAI)]}",{jamFormat:function(c){var a=Ext.isDate(c)?c:Ext.Date.parse(c,"H:i:s");return Ext.Date.format(a,"H:i:s")}})},{text:"Diagnosa",dataIndex:"ID",xtype:"templatecolumn",tpl:"{REFERENSI.REQUEST.DIAGNOSA}",width:200},{text:"Tindakan",dataIndex:"ID",xtype:"templatecolumn",tpl:"{REFERENSI.REQUEST.TINDAKAN}",width:200},{text:"Ruangan Asal",dataIndex:"ID",xtype:"templatecolumn",width:200,tpl:"{REFERENSI.REQUEST.REFERENSI.KUNJUNGAN.REFERENSI.RUANGAN.DESKRIPSI}"},{text:"Ruang Operasi",dataIndex:"ID",xtype:"templatecolumn",width:100,tpl:"{REFERENSI.KAMAR.KAMAR}"},{text:"Dokter",dataIndex:"DOKTER",xtype:"templatecolumn",width:250,tpl:"{REFERENSI.REQUEST.REFERENSI.DOKTER.NAMA}"},{text:"SMF",dataIndex:"ID",xtype:"templatecolumn",width:100,tpl:"{REFERENSI.REQUEST.REFERENSI.KUNJUNGAN.REFERENSI.PENDAFTARAN.TUJUAN.REFERENSI.SMF.DESKRIPSI}"}],listeners:{itemdblclick:"onPilihJadwal"}});Ext.define("jadwal-operasi.jadwal.summary.Workspace",{extend:"com.Form",xtype:"jadwal-operasi-jadwal-summary-workspace",controller:"jadwal-operasi-jadwal-summary-workspace",viewModel:{data:{kjgn:undefined,maxinput:"0"}},layout:"border",bodyPadding:1,initComponent:function(){var a=this;a.items=[{flex:1,region:"center",xtype:"jadwal-operasi-jadwal-summary-grid",listeners:{pilihjadwal:"onDetail"}}];a.dockedItems=[{xtype:"toolbar",dock:"top",items:[{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},flex:1,fieldLabel:"Periode Jadwal",items:[{xtype:"datefield",submitFormat:"Y-m-d",format:"d-m-Y",value:a.getSysdate(),reference:"tanggal_awal"},{xtype:"displayfield",value:" sampai",margin:"0 10 0 10"},{xtype:"datefield",submitFormat:"Y-m-d",format:"d-m-Y",value:a.getSysdate(),reference:"tanggal_akhir"}]},"->",{xtype:"button",text:"Proses",ui:"soft-blue",handler:"onFilter"}]}];a.callParent(arguments)},load:function(){var d=this,e=d.down("jadwal-operasi-jadwal-summary-grid"),c=e.getViewModel(),a=c.get("store");a.queryParams={TANGGAL:d.getSysdate(),STATUS:1};a.load()}});Ext.define("jadwaloperasi.jadwal.summary.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.jadwal-operasi-jadwal-summary-workspace",onFilter:function(e){var h=this,a=h.getView(),g=a.getReferences(),f=a.getViewModel(),j=a.down("jadwal-operasi-jadwal-summary-grid"),d=j.getViewModel(),c=d.get("store");c.queryParams={TANGGAL_AWAL:g.tanggal_awal.getSubmitValue(),TANGGAL_AKHIR:g.tanggal_akhir.getSubmitValue(),STATUS:1};c.load()}});Ext.define("jadwal-operasi.jadwal.terima.Form",{extend:"com.Form",xtype:"jadwal-operasi-jadwal-terima-form",controller:"jadwal-operasi-jadwal-terima-form",viewModel:{stores:{store:{type:"jadwal-operasi-jadwal-store"}},data:{durasi:"00:00",info_tersedia:"Tidak Tersedia"}},model:"jadwal-operasi.jadwal.Model",layout:{type:"hbox",align:"stretch"},initComponent:function(){var a=this;a.items=[{layout:"hbox",flex:1,border:false,scrollable:"y",defaults:{margin:"2.2.2.2"},items:[{border:true,flex:1,layout:{type:"vbox",align:"stretch"},defaults:{margin:"2.2.2.2",labelWidth:150},bodyPadding:5,items:[{xtype:"textfield",name:"TERSEDIA",allowBlank:false,hidden:true},{xtype:"master-kamar-combo",name:"KAMAR",fieldLabel:"Ruangan Kamar",readOnly:true,listeners:{change:"onKamarChange"}},{layout:{type:"hbox",align:"stretch"},xtype:"fieldcontainer",fieldLabel:"Rencana Operasi",items:[{xtype:"datefield",name:"TANGGAL",format:"d-m-Y",submitFormat:"Y-m-d",readOnly:true,flex:1,margin:"0 4 0 0",reference:"tanggal",emptyText:"[ TANGGAL  ]",allowBlank:false},{xtype:"timefield",format:"H:i:s",name:"MULAI",flex:1,allowBlank:false,readOnly:true,listeners:{change:"onUbahJam"}},{xtype:"timefield",name:"SELESAI",format:"H:i:s",flex:1,readOnly:true,allowBlank:false}]}]}]}],a.dockedItems=[{xtype:"toolbar",dock:"bottom",items:[{xtype:"container",bind:{html:"{info_tersedia}"}},"->",{text:"Simpan",iconCls:"x-fa fa-save",formBind:true,handler:"onSimpan",ui:"soft-green"}]}];a.callParent(arguments)},load:function(e){var c=this,a=c.down("master-kamar-combo"),d=a.getStore();d.queryParams={RUANGAN:e,STATUS:1};d.load()}});Ext.define("jadwal-operasi.jadwal.terima.FormController",{extend:"Ext.app.ViewController",alias:"controller.jadwal-operasi-jadwal-terima-form",onSimpan:function(d){var f=this,e=f.getViewModel(),a=f.getView(),c=f.getReferences();a.save(d)},onUbahJam:function(e,j){var g=this,c=g.getView(),f=c.getViewModel(),h=f.get("durasi"),d=Ext.Date.format(j,"H:i"),a=g.setWaktuSelesai(d,h);c.down("[name=SELESAI]").setValue(a);g.cekKetersediaanRuangan()},onKamarChange:function(c,f){var e=this,a=e.getView(),d=a.getViewModel()},setWaktuSelesai:function(h,e){var d=this,g=h.split(":"),f=e.split(":"),c=parseInt(g[1])+parseInt(f[1]),a=parseInt(g[0])+parseInt(f[0]);if(c>=60){c=c-60;a=a+1}return Ext.String.leftPad(a,2,"0")+":"+Ext.String.leftPad(c,2,"0")},cekKetersediaanRuangan:function(){var h=this,c=h.getView(),g=c.getViewModel(),d=g.get("store"),f=c.down("master-kamar-combo").getValue(),j=c.down("[name=TANGGAL]").getSubmitValue(),e=c.down("[name=MULAI]").getValue(),a=c.down("[name=SELESAI]").getValue();if(f>0){d.queryParams={KAMAR:f,TANGGAL:j,CEK_MULAI:Ext.Date.format(e,"H:i:s"),CEK_SELESAI:Ext.Date.format(a,"H:i:s"),STATUS:1};d.load({callback:function(o,m,n){if(o.length>0){c.down("[name=TERSEDIA]").setValue("");g.set("info_tersedia",'<b><font color="red">Tidak Tersedia</font></b>')}else{c.down("[name=TERSEDIA]").setValue("1");g.set("info_tersedia",'<b><font color="green">Tersedia</font></b>')}}})}else{c.down("[name=TERSEDIA]").setValue("");g.set("info_tersedia",'<b><font color="red">Tidak Tersedia</font></b>')}}});Ext.define("jadwal-operasi.jadwal.terima.Grid",{extend:"com.Grid",xtype:"jadwal-operasi-jadwal-terima-grid",controller:"jadwal-operasi-jadwal-terima-grid",viewModel:{stores:{store:{type:"jadwal-operasi-request-store"}},data:{editadmin:false}},columns:[{xtype:"templatecolumn",flex:1,tpl:new Ext.XTemplate('<div style="font-weight: bold; font-size: 12px; white-space:normal !important;">{REFERENSI.KUNJUNGAN.REFERENSI.PENDAFTARAN.REFERENSI.PASIEN.NORM} -  {REFERENSI.KUNJUNGAN.REFERENSI.PENDAFTARAN.REFERENSI.PASIEN.NAMA}</div>','<div style="font-weight: bold; font-size: 10px; white-space:normal !important;">Kode Booking : {[values.KODE]}</div>','<div style="font-weight: bold; font-size: 10px; white-space:normal !important;">Tanggal : {[this.tanggalFormat(values.TANGGAL)]}</div>','<div style="font-weight: bold; font-size: 10px; white-space:normal !important;">Jam : {[this.jamFormat(values.JAM)]}</div>','<div style="font-weight: bold; font-size: 10px; white-space:normal !important;">Tindakan / Diagnosa : {TINDAKAN} / {DIAGNOSA}</div>','<div style="font-weight: bold; font-size: 10px; white-space:normal !important;">Dokter : {REFERENSI.DOKTER.NAMA}</div>',{tanggalFormat:function(c){var a=Ext.isDate(c)?c:Ext.Date.parse(c,"Y-m-d");return Ext.Date.format(a,"d-m-Y")},jamFormat:function(c){var a=Ext.isDate(c)?c:Ext.Date.parse(c,"H:i:s");return Ext.Date.format(a,"H:i:s")}})},{xtype:"widgetcolumn",text:"Action",align:"center",flex:0.3,bind:{hidden:"{!listConfig.view}"},widget:{xtype:"fieldcontainer",layout:"vbox",defaults:{padding:2},items:[{xtype:"button",text:"Terima",action:0,width:70,margin:"0 1 0 0",handler:"onTerima"},{xtype:"button",action:1,text:"Tolak",ui:"soft-red",width:70,handler:"onTolak"},{xtype:"button",action:2,text:"Edit",ui:"soft-green",width:70,bind:{hidden:"{!editadmin}"},handler:"onEdit"}]}}]});Ext.define("jadwal-operasi.jadwal.terima.GridController",{extend:"Ext.app.ViewController",alias:"controller.jadwal-operasi-jadwal-terima-grid",onTerima:function(g){var f=this,d=f.getView(),e=f.getStore("store"),a=g.ownerCt.getWidgetRecord();d.fireEvent("terima",a)},onTolak:function(g){var f=this,d=f.getView(),e=f.getStore("store"),a=g.ownerCt.getWidgetRecord();a.showError=true;a.animateTarget=g;a.scope=f;Ext.Msg.prompt("Alasan Tolak","Silahkan isi alasan penolakan:",function(c,h){if(c=="ok"){if(h!=""){a.set("ACC",2);a.set("KETERANGAN",h);a.save({callback:function(m,n,j){if(j){d.notifyMessage("Pembatalan Jadwal Tindakan Berhasil ..");e.load()}else{d.notifyMessage("Gagal ..")}}})}else{d.notifyMessage("Alasan harus diisi")}}})},onEdit:function(g){var f=this,d=f.getView(),e=f.getStore("store"),a=g.ownerCt.getWidgetRecord();d.fireEvent("edit",a)}});Ext.define("jadwal-operasi.jadwal.terima.Workspace",{extend:"com.Form",xtype:"jadwal-operasi-jadwal-terima-workspace",controller:"jadwal-operasi-jadwal-terima-workspace",viewModel:{data:{kjgn:undefined,maxinput:"0"}},layout:"fit",bodyPadding:1,items:[{region:"center",flex:1,xtype:"jadwal-operasi-jadwal-terima-grid",viewConfig:{loadMask:false},listeners:{terima:"onCariKamar",edit:"onEditRequest"}}],load:function(){var e=this,f=e.down("jadwal-operasi-jadwal-terima-grid"),a=e.getPropertyConfig(90083),d=f.getViewModel(),c=d.get("store");if(a=="TRUE"){d.set("editadmin",true)}else{d.set("editadmin",false)}c.queryParams={ACC:0,STATUS:1};c.load()}});Ext.define("jadwaloperasi.jadwal.terima.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.jadwal-operasi-jadwal-terima-workspace",onCariKamar:function(c,g){var e=this,a=e.getView(),d=e.getViewModel();var f=a.openDialog("",true,0,0,{xtype:"jadwal-operasi-jadwal-info-acc-workspace",ui:"panel-gray",title:"Form Terima Jadwal",showCloseButton:true,iconCls:"x-fa fa-plus"},function(m,o){var j=o.down("jadwal-operasi-jadwal-info-acc-workspace"),p=j.getViewModel(),h=j.down("jadwal-operasi-jadwal-info-acc-grid"),n=h.getViewModel();p.set("req",c);n.set("viewOnly",false);j.down("datefield").setValue(c.get("TANGGAL"));j.load(c.get("RUANGAN"));o.on("close",function(){a.load()})},c)},onsearch:function(h,g){var d=this,a=d.getReferences(),e=a.kegiatanppi;e.load({DESKRIPSI:g})},onClear:function(){var c=this,a=c.getReferences(),d=a.kegiatanppi;b=d.getStore("store");delete b.queryParams.DESKRIPSI;d.load({})},setWaktuSelesai:function(h,e){var d=this,g=h.split(":"),f=e.split(":"),c=parseInt(g[1])+parseInt(f[1]),a=parseInt(g[0])+parseInt(f[0]);if(c>=60){c=c-60;a=a+1}return Ext.String.leftPad(a,2,"0")+":"+Ext.String.leftPad(c,2,"0")},onEditRequest:function(f){var d=this,a=d.getView(),c=d.getViewModel();var e=a.openDialog("",true,0,0,{xtype:"jadwal-operasi-request-workspace",ui:"panel-gray",title:"Form Edit Request Jadwal",showCloseButton:true,iconCls:"x-fa fa-tool"},function(m,n){var j=n.down("jadwal-operasi-request-workspace"),h=j.down("jadwal-operasi-request-form"),g=j.getViewModel();j.load();h.loadRecord(f);g.set("admin",true);n.on("close",function(){a.load()})})}});Ext.define("jadwal-operasi.request.Form",{extend:"com.Form",xtype:"jadwal-operasi-request-form",viewModel:{stores:{store:{type:"jadwal-operasi-jadwal-store"}},data:{formConfig:{readOnly:true,baru:false,kirim:false,tanggal:new Date(),viewOnly:false},isNonAktif:true,maxDate:Ext.Date.add(new Date(),Ext.Date.DAY,7),minDate:Ext.Date.add(new Date(),Ext.Date.DAY,1),maxinput:"0",jadwallangsung:false,info_tersedia:"Tidak Tersedia",editadmin:false}},controller:"jadwal-operasi-request-form",model:"jadwal-operasi.request.Model",layout:{type:"hbox",align:"stretch"},initComponent:function(){var d=this,e=Ext.Date.format(d.getSysdate(),"Y-m-d"),a=e+" 08:00:00",c=e+" 16:00:00",a=new Date(a),c=new Date(c);d.items=[{layout:"hbox",flex:1,border:false,scrollable:"y",defaults:{margin:"2.2.2.2"},items:[{border:true,flex:1,layout:{type:"vbox",align:"stretch"},defaults:{margin:"2.2.2.2",labelWidth:150},bodyPadding:5,items:[{xtype:"ruangan-combo",fieldLabel:"Unit Operasi",name:"RUANGAN",listeners:{change:"onRuanganChange"},flex:1},{layout:{type:"hbox",align:"stretch"},xtype:"fieldcontainer",fieldLabel:"Rencana Operasi",items:[{xtype:"datefield",name:"TANGGAL",format:"d-m-Y",bind:{readOnly:"{jadwallangsung}"},submitFormat:"Y-m-d",flex:1,margin:"0 4 0 0",onTriggerClick:function(){var f=this;vm=d.getViewModel(),skrg=Ext.Date.format(new Date(),"H:i"),maxinput=vm.get("maxinput");if(maxinput<skrg){f.setMinValue(Ext.Date.add(new Date(),Ext.Date.DAY,2))}else{f.setMinValue(Ext.Date.add(new Date(),Ext.Date.DAY,1))}Ext.form.DateField.prototype.onTriggerClick.apply(f,arguments)},reference:"tanggal",emptyText:"[ TANGGAL  ]",allowBlank:false},{xtype:"timefield",format:"H:i:s",name:"JAM",flex:1,listeners:{change:"onUbahJam"},bind:{readOnly:"{jadwallangsung}"},allowBlank:false},{xtype:"button",text:"Pilih Kamar",bind:{hidden:"{!jadwallangsung}"},handler:"onCariKamar"}]},{fieldLabel:"Dokter",xtype:"dokter-combo",emptyText:"[Dokter]",params:{STATUS:1},bind:{readOnly:"{viewOnly}"},firstLoad:true,reference:"doktercombo",name:"DOKTER",allowBlank:false},{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},flex:1,fieldLabel:"Perkiraan Operasi",items:[{fieldLabel:"Durasi",name:"DURASI",xtype:"timefield",bind:{readOnly:"{viewOnly}"},format:"H:i:s",flex:1,listeners:{change:"onUbahJam"},allowBlank:false,maxValue:"10:00",reference:"durasi"},{xtype:"timefield",name:"SELESAI",fieldLabel:"Selesai",format:"H:i",margin:"0 0 0 10",flex:1,readOnly:true,allowBlank:false}]},{fieldLabel:"Rencana Tindakan",name:"TINDAKAN",xtype:"textareafield",reference:"tindakan",bind:{readOnly:"{viewOnly}"}},{fieldLabel:"Diagnosa",name:"DIAGNOSA",xtype:"textfield",reference:"diagnosa",bind:{readOnly:"{viewOnly}"}},{xtype:"master-kamar-combo",name:"KAMAR",bind:{hidden:"{!jadwallangsung}"},fieldLabel:"Ruangan Kamar",readOnly:true,listeners:{change:"onKamarChange"}},{xtype:"textfield",name:"TERSEDIA",allowBlank:false,hidden:true}]}]}],d.dockedItems=[{xtype:"toolbar",bind:{hidden:"{!formConfig.simpan}"},dock:"bottom",items:[{xtype:"container",bind:{html:"{info_tersedia}",hidden:"{!jadwallangsung}"}},"->",{text:"Simpan",iconCls:"x-fa fa-save",formBind:true,handler:"onSimpan",ui:"soft-green",bind:{hidden:"{viewOnly}"}},{text:"Edit",iconCls:"x-fa fa-pencil",handler:"onEdit",ui:"soft-blue",bind:{hidden:"{!viewOnly}",disabled:"{!editadmin}"}}]}];d.callParent(arguments)},load:function(){var c=this,a=c.getViewModel(),e=c.down("ruangan-combo"),d=e.getStore();d.queryParams={JENIS_KUNJUNGAN:6,JENIS:5,STATUS:1};d.load()}});Ext.define("jadwal-operasi.request.FormController",{extend:"Ext.app.ViewController",alias:"controller.jadwal-operasi-request-form",onSimpan:function(d){var f=this,e=f.getViewModel(),a=f.getView(),e=a.getViewModel(),c=f.getReferences();a.save(d)},onKamarChange:function(c,f){var e=this,a=e.getView(),d=a.getViewModel();e.cekKetersediaanRuangan()},setWaktuSelesai:function(h,e){var d=this,g=h.split(":"),f=e.split(":"),c=parseInt(g[1])+parseInt(f[1]),a=parseInt(g[0])+parseInt(f[0]);if(c>=60){c=c-60;a=a+1}return Ext.String.leftPad(a,2,"0")+":"+Ext.String.leftPad(c,2,"0")},cekKetersediaanRuangan:function(){var h=this,c=h.getView(),g=c.getViewModel(),d=g.get("store"),f=c.down("master-kamar-combo").getValue(),j=c.down("[name=TANGGAL]").getSubmitValue(),e=c.down("[name=JAM]").getValue(),a=c.down("[name=SELESAI]").getValue();if(f>0){d.queryParams={KAMAR:f,TANGGAL:j,CEK_MULAI:Ext.Date.format(e,"H:i:s"),CEK_SELESAI:Ext.Date.format(a,"H:i:s"),STATUS:1};d.load({callback:function(o,m,n){if(o.length>0){c.down("[name=TERSEDIA]").setValue("");g.set("info_tersedia",'<b><font color="red">Tidak Tersedia</font></b>')}else{c.down("[name=TERSEDIA]").setValue("1");g.set("info_tersedia",'<b><font color="green">Tersedia</font></b>')}}})}else{c.down("[name=TERSEDIA]").setValue("");g.set("info_tersedia",'<b><font color="red">Tidak Tersedia</font></b>')}},onUbahJam:function(c,f){var e=this,a=e.getView(),d=a.getViewModel(),g=d.get("jadwallangsung");if(a.down("[name=JAM]").getValue()==null){a.notifyMessage("Pilih Tanggal dan jam mulai terlebih dahulu");c.setValue("")}else{mulai=Ext.Date.format(a.down("[name=JAM]").getValue(),"H:i"),durasi=Ext.Date.format(a.down("[name=DURASI]").getValue(),"H:i"),selesai=e.setWaktuSelesai(mulai,durasi);a.down("[name=SELESAI]").setValue(selesai);if(g==true){e.cekKetersediaanRuangan()}}},onCariKamar:function(c,h){var e=this,a=e.getView(),g=a.down("ruangan-combo"),d=e.getViewModel();var f=a.openDialog("",true,0,0,{xtype:"jadwal-operasi-jadwal-info-acc-workspace",ui:"panel-gray",title:"Pilih Kamar",showCloseButton:true,iconCls:"x-fa fa-plus"},function(n,p){var m=p.down("jadwal-operasi-jadwal-info-acc-workspace"),q=m.getViewModel(),j=m.down("jadwal-operasi-jadwal-info-acc-grid"),o=j.getViewModel();o.set("viewOnly",false);o.set("jadwallangsung",true);m.load(g.getValue());q.set("editjadwal",true);m.on("pilihjadwal",function(r){a.down("[name=JAM]").setValue(r.get("JAM"));a.down("[name=TANGGAL]").setValue(r.get("TANGGAL"));a.down("[name=KAMAR]").setValue(r.get("KAMAR"));p.close()})},c)},onEdit:function(c){var e=this,a=e.getView(),d=a.getViewModel();d.set("jadwallangsung",true);d.set("viewOnly",false)},onRuanganChange:function(c,g){var e=this,a=e.getView(),d=a.down("master-kamar-combo"),f=d.getStore();f.queryParams={RUANGAN:g,STATUS:1};f.load()}});Ext.define("jadwal-operasi.request.List",{extend:"com.Grid",xtype:"jadwal-operasi-request-list",controller:"jadwal-operasi-request-list",viewModel:{stores:{store:{type:"jadwal-operasi-request-store"}}},title:"History",iconCls:"x-fa fa-file-text-o",hideHeaders:true,history:false,columns:[{xtype:"templatecolumn",flex:1,tpl:new Ext.XTemplate('<div style="font-weight: bold; font-size: 10px; white-space:normal !important;">Kode Booking : {[values.KODE]}</div>','<div style="font-weight: bold; font-size: 10px; white-space:normal !important;">Tanggal : {[this.tanggalFormat(values.TANGGAL)]}</div>','<div style="font-weight: bold; font-size: 10px; white-space:normal !important;">Jam : {[this.jamFormat(values.JAM)]}</div>','<div style="font-weight: bold; font-size: 10px; white-space:normal !important;">Tindakan / Diagnosa : {TINDAKAN} / {DIAGNOSA}</div>','<div style="font-weight: bold; font-size: 10px; white-space:normal !important;">Dokter : {REFERENSI.DOKTER.NAMA}</div>','<div style="font-weight: bold; font-size: 10px; white-space:normal !important;">Status : {[this.getStatus(values.ACC, values.KETERANGAN)]}</div>',{tanggalFormat:function(c){var a=Ext.isDate(c)?c:Ext.Date.parse(c,"Y-m-d");return Ext.Date.format(a,"d-m-Y")},jamFormat:function(c){var a=Ext.isDate(c)?c:Ext.Date.parse(c,"H:i:s");return Ext.Date.format(a,"H:i:s")},getStatus:function(c,a){if(c==1){return"JADWAL DITERIMA ("+a+")"}else{if(c==0){return"DALAM PROSES"}else{if(c==2){return"DIBATALKAN ("+a+")"}}}}})},{xtype:"widgetcolumn",text:"Status",align:"center",flex:0.3,bind:{hidden:"{!listConfig.view}"},widget:{xtype:"fieldcontainer",defaults:{padding:2},items:[{xtype:"button",text:"Batalkan",action:0,width:80,margin:"0 1 0 0",handler:"onBatal"}]},onWidgetAttach:function(a,e,f){var d=f.get("ACC"),c=e.down("[action=0]");c.setHidden(d=="1")}}]});Ext.define("jadwal-operasi.request.ListController",{extend:"Ext.app.ViewController",alias:"controller.jadwal-operasi-request-list",onBatal:function(g){var f=this,d=f.getView(),e=f.getStore("store"),a=g.ownerCt.getWidgetRecord();a.showError=true;a.animateTarget=g;a.scope=f;Ext.Msg.show({title:"Pembatalan Jadwal",message:"Anda yakin ingin membatalkan Jadwal Ini ?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,animateTarget:g,fn:function(c){if(c==="yes"){a.set("STATUS",0);a.save({callback:function(m,n,j){if(j){d.notifyMessage("Pembatalan Jadwal Tindakan Berhasil ..");e.load()}else{d.notifyMessage("Gagal ..")}}})}}})}});Ext.define("jadwal-operasi.request.Workspace",{extend:"com.Form",xtype:"jadwal-operasi-request-workspace",controller:"jadwal-operasi-request-workspace",viewModel:{stores:{store:{type:"kunjungan-store"},pendaftaran:{type:"pendaftaran-store"}},data:{kjgn:undefined,maxinput:"0",akses:true,admin:false}},layout:"border",bodyPadding:1,items:[{region:"center",xtype:"jadwal-operasi-request-form",layout:"fit",border:false,scrollable:true,bind:{hidden:"{!akses}"},listeners:{save:"onSuccess"}},{region:"east",flex:0.55,split:true,collapsible:true,xtype:"jadwal-operasi-request-list",ui:"panel-gray",bind:{hidden:"{admin}"},fullscreenEnabled:true}],load:function(d){var j=this,a=j.down("jadwal-operasi-request-form"),g=j.down("jadwal-operasi-request-list"),f=webservice.app.xpriv,c=j.getViewModel(),e=a.getViewModel(),m=j.getPropertyConfig(90082),o=j.getPropertyConfig(90081),n=c.get("store"),h=c.get("pendaftaran");c=j.getViewModel(),n=c.get("store");e.set("maxinput",m);if(o=="TRUE"){if(f("35",true)){e.set("jadwallangsung",true);c.set("akses",true)}else{c.set("akses",false)}a.down("[name=TERSEDIA]").setValue("")}else{a.down("[name=TERSEDIA]").setValue("1")}a.load();if(d){c.set("kjgn",d);n.queryParams={NOMOR:d.get("NOMOR")};n.load({callback:function(q,p,r){if(r){a.createRecord({KUNJUNGAN:d.get("NOMOR"),STATUS:1})}h.queryParams={NOMOR:q[0].get("NOPEN")};h.load({callback:function(s,u,t){if(t){g.load({NORM:s[0].get("NORM"),STATUS:1})}}})}})}}});Ext.define("jadwalo-perasi.request.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.jadwal-operasi-request-workspace",onSuccess:function(d,g,c){var f=this,a=f.getView(),e=f.getViewModel(),h=e.get("kjgn");a.load(h)}});Ext.define("jadwal-operasi.widget.Request",{extend:"com.Form",alias:"widget.jadwal-operasi-widget-request",layout:{type:"vbox",align:"stretch"},cls:"shadow-panel",scrollable:true,statusVerifikator:true,ui:"panel-blue",header:{title:"Request Jadwal Operasi",iconCls:"x-fa fa-clock",margin:0,padding:"5 10 5 10",cls:"x-color-w",layout:{type:"hbox",align:"middle"},items:[{xtype:"component",flex:1},{xtype:"button",iconCls:"x-fa fa-refresh",tooltip:"Refresh",ui:"soft-cyan",margin:"0 0 0 1",handler:"onRefresh"}]},bodyPadding:5,items:[{xtype:"jadwal-operasi-jadwal-terima-workspace",reference:"terimajadwal",flex:1,listeners:{terima:"onTerima"}}],loadStore:function(c){var e=this,d=e.getViewModel(),f=e.down("jadwal-operasi-jadwal-terima-workspace");f.load()},refresh:function(){this.loadStore()}});