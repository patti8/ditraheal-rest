Ext.define("pembayaran.kasir.Model",{extend:"data.model.Model",serviceName:"pembayaran/kasir",fields:[{name:"ID",type:"int"},{name:"NAMA",type:"string"},{name:"NIP",type:"string"}]});Ext.define("pembayaran.kasir.Store",{extend:"data.store.Store",model:"pembayaran.kasir.Model",alias:"store.kasir-store"});Ext.define("pembayaran.pembayarantagihan.Model",{extend:"data.model.Model",serviceName:"pembayaran/pembayarantagihan",fields:[{name:"NOMOR",type:"string"},{name:"TAGIHAN",type:"string"},{name:"JENIS",type:"int"},{name:"JENIS_LAYANAN_ID",type:"int",defaultValue:1},{name:"PENYEDIA_ID",type:"int",allowNull:true},{name:"TANGGAL",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"REKENING_ID",type:"int",allowNull:true},{name:"NO_ID",type:"string",allowNull:true},{name:"NAMA",type:"string",allowNull:true},{name:"REF",type:"string"},{name:"JENIS_KARTU_ID",type:"int",allowNull:true},{name:"BANK_ID",type:"int",allowNull:true},{name:"DESKRIPSI",type:"string"},{name:"TOTAL",type:"float"},{name:"BRIDGE",type:"int",defaultValue:0},{name:"TRANSAKSI_KASIR_NOMOR",type:"int"},{name:"TANGGAL_DIBUAT",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"BATAS_WAKTU",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"OLEH",type:"int"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"NOMOR"});Ext.define("pembayaran.pembayarantagihan.Store",{extend:"data.store.Store",model:"pembayaran.pembayarantagihan.Model",alias:"store.pembayaran-pembayarantagihan-store"});Ext.define("pembayaran.penyedia.Model",{extend:"data.model.Model",serviceName:"pembayaran/penyedia",fields:[{name:"ID",type:"int"},{name:"NAMA",type:"string"},{name:"JENIS_PENYEDIA_ID",type:"int"},{name:"REFERENSI_ID",type:"int"},{name:"STATUS_ID",type:"int"}],idProperty:"ID"});Ext.define("pembayaran.penyedia.Store",{extend:"data.store.Store",model:"pembayaran.penyedia.Model",alias:"store.pembayaran-penyedia-store"});Ext.define("pembayaran.penyedia.layanan.Model",{extend:"data.model.Model",serviceName:"pembayaran/layanan-penyedia",fields:[{name:"ID",type:"int"},{name:"PENYEDIA_ID",type:"int"},{name:"JENIS_LAYANAN_ID",type:"int"},{name:"DRIVER",type:"string"},{name:"KODE",type:"string"},{name:"STATUS_ID",type:"int"}],idProperty:"ID"});Ext.define("pembayaran.penyedia.layanan.Store",{extend:"data.store.Store",model:"pembayaran.penyedia.layanan.Model",alias:"store.pembayaran-penyedia-layanan-store"});Ext.define("pembayaran.piutang.pasien.Model",{extend:"data.model.Model",serviceName:"pembayaran/pelunasanpiutang/pasien",fields:[{name:"ID",type:"int"},{name:"TAGIHAN_PIUTANG",type:"string"},{name:"ANGSURAN_KE",type:"int"},{name:"JUMLAH_ANGSURAN_DIBAYAR",type:"int"},{name:"TOTAL_BAYAR",type:"float"},{name:"JENIS_PEMBAYARAN",type:"int"},{name:"OLEH",type:"int"},{name:"STATUS",type:"int"}],idProperty:"ID"});Ext.define("pembayaran.piutang.pasien.Store",{extend:"data.store.Store",model:"pembayaran.piutang.pasien.Model",alias:"store.pembayaran-piutang-pasien-store"});Ext.define("pembayaran.piutang.perusahaan.Model",{extend:"data.model.Model",serviceName:"pembayaran/pelunasanpiutang/perusahaan",fields:[{name:"ID",type:"int"},{name:"TAGIHAN_PIUTANG",type:"string"},{name:"PENJAMIN",type:"int"},{name:"TOTAL_PIUTANG",type:"float"},{name:"TOTAL_BAYAR",type:"float"},{name:"OLEH",type:"int"},{name:"STATUS",type:"int"}],idProperty:"ID"});Ext.define("pembayaran.piutang.perusahaan.Store",{extend:"data.store.Store",model:"pembayaran.piutang.perusahaan.Model",alias:"store.pembayaran-piutang-perusahaan-store"});Ext.define("pembayaran.tagihan.discount.tenagamedis.Model",{extend:"data.model.Model",serviceName:"pembayaran/diskon/tindakantenagamedis",fields:[{name:"ID",type:"string"},{},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("pembayaran.tagihan.discount.tenagamedis.Store",{extend:"data.store.Store",model:"pembayaran.tagihan.discount.tenagamedis.Model",alias:"store.discount-tenagamedis-store"});Ext.define("pembayaran.tagihan.nontunai.bank.Model",{extend:"data.model.Model",serviceName:"pembayaran/transfer",fields:[{name:"ID",type:"int"},{name:"TAGIHAN",type:"string"},{name:"BANK_ASAL",type:"int"},{name:"REKENING",type:"int"},{name:"NAMA_PENYETOR",type:"string"},{name:"REF",type:"string"},{name:"TANGGAL_TRANSFER",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"TOTAL",type:"float"},{name:"TANGGAL",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"OLEH",type:"int"},{name:"JENIS",type:"int"},{name:"STATUS",type:"int"}],idProperty:"ID"});Ext.define("pembayaran.tagihan.nontunai.bank.Store",{extend:"data.store.Store",model:"pembayaran.tagihan.nontunai.bank.Model",alias:"store.pembayaran-tagihan-nontunai-bank-store"});Ext.define("pembayaran.tagihan.pembatalan.Model",{extend:"data.model.Model",serviceName:"pembayaran/pembatalantagihan",fields:[{name:"ID",type:"int"},{name:"TAGIHAN",type:"string"},{name:"JENIS",type:"int"},{name:"TANGGAL",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"OLEH",type:"int"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("pembayaran.kasir.Combo",{extend:"com.Combo",alias:"widget.kasir-combo",viewModel:{stores:{store:{type:"kasir-store"}}},valueField:"ID",displayField:"NAMA",minChars:2,emptyText:"[Pilih Kasir]",queryMode:"remote",queryParam:"QUERY"});Ext.define("pembayaran.pembayarantagihan.List",{extend:"com.Grid",xtype:"pembayaran-pembayarantagihan-list",viewModel:{stores:{store:{type:"pembayaran-pembayarantagihan-store"}}},hideHeaders:true,initComponent:function(){var a=this;a.columns=[{xtype:"templatecolumn",flex:2,tpl:new Ext.XTemplate("{[this.getContent(values)]}",{getContent:function(m){var k=m.REFERENSI.JENIS_LAYANAN.CONFIG?Ext.JSON.decode(m.REFERENSI.JENIS_LAYANAN.CONFIG):null,g=k?k.content:"No. Content",i=a.getReferensi(m,"PENYEDIA"),c=a.getReferensi(m,"JENIS_KARTU"),h=a.getReferensi(m,"BANK"),n=a.getReferensi(m,"KASIR"),j=a.getReferensi(m,"REKENING"),f=a.getReferensi(m,"TAGIHAN"),l=a.getReferensi(f,"PASIEN"),e=["Dibatalkan","Belum Terbayarkan","Sudah Terbayarkan"],b=["silver","red","green"];g=a.replaceAll(g,"{[values.REF]}",a.ifNull(m.REF));g=a.replaceAll(g,"{[values.NO_ID]}",a.ifNull(m.NO_ID));g=a.replaceAll(g,"{[values.NAMA]}",a.ifNull(m.NAMA));g=a.replaceAll(g,"{[values.TANGGAL]}",a.tanggalFormat(m.TANGGAL));if(i){g=a.replaceAll(g,"{[values.REFERENSI.PENYEDIA.NAMA]}",a.ifNull(i.NAMA))}if(c){g=a.replaceAll(g,"{[values.REFERENSI.JENIS_KARTU.DESKRIPSI]}",a.ifNull(c.DESKRIPSI));g=a.replaceAll(g,"{[values.REFERENSI.JENIS_KARTU.DESKRIPSI]}",a.ifNull(c.DESKRIPSI))}if(h){g=a.replaceAll(g,"{[values.REFERENSI.BANK.DESKRIPSI]}",a.ifNull(h.DESKRIPSI));g=a.replaceAll(g,"{[values.REFERENSI.BANK.DESKRIPSI]}",a.ifNull(h.DESKRIPSI))}if(j){var d=a.getReferensi(j,"BANK");g=a.replaceAll(g,"{[values.REFERENSI.REKENING.NOMOR]}",a.ifNull(j.NOMOR));g=a.replaceAll(g,"{[values.REFERENSI.REKENING.PEMILIK]}",a.ifNull(j.PEMILIK));g=a.replaceAll(g,"{[values.REFERENSI.REKENING.REFERENSI.BANK.DESKRIPSI]}",a.ifNull(d.DESKRIPSI))}if(n){g=a.replaceAll(g,"{[values.REFERENSI.KASIR.NAMA]}",a.ifNull(n.NAMA))}g+=" <span style='font-weight: bold; font-size: 13px; color: "+b[m.STATUS]+"'>Status: "+e[m.STATUS]+"<span/>";return g}})},{xtype:"templatecolumn",flex:1,align:"right",tpl:new Ext.XTemplate('<div style="font-weight: bold; font-size: 18px; white-space:normal !important;">{[this.getTotal(values)]} </div>',{getTotal:function(c){var b=Number(c.TOTAL);return Ext.util.Format.number(b<0?0:b,"0,000")}})}];a.callParent()},ifNull:function(a,b){return a?a:b},tanggalFormat:function(b){var a=Ext.isDate(b)?b:Ext.Date.parse(b,"Y-m-d H:i:s");return Ext.Date.format(a,"d F Y H:i:s")}});Ext.define("pembayaran.pembayarantagihan.Workspace",{extend:"com.Form",xtype:"pembayaran-pembayarantagihan-workspace",model:"data.model.Tagihan",layout:"fit",bodyPadding:0,items:[{xtype:"pembayaran-pembayarantagihan-list"}],onLoadRecord:function(b,c){var a=b.down("pembayaran-pembayarantagihan-list");a.setParams({TAGIHAN:c.get("ID"),NOT:Ext.JSON.encode({STATUS:[0]})});a.load()}});Ext.define("pembayaran.penerimaan.detail",{extend:"com.Form",alias:"widget.pembayaran-penerimaan-detail",html:"2"});Ext.define("pembayaran.penerimaan.List",{extend:"com.Grid",alias:"widget.pembayaran-penerimaan-list",controller:"pembayaran-penerimaan-list",viewModel:{stores:{store:{type:"tagihan-store"}}},hideHeaders:true,waitRefresh:true,bind:{store:"{store}"},columns:[{xtype:"templatecolumn",flex:1,tpl:new Ext.XTemplate('<div style="font-weight: bold; font-size: 12px; white-space:normal !important;">Id Transaksi: {[values.ID]} </div>')},{xtype:"widgetcolumn",flex:1,align:"right",widget:{xtype:"panel",items:[{bind:{data:{items:"{store.data.items}"}},tpl:new Ext.XTemplate('<div style="text-align: left; font-size: 12px; white-space:normal !important;">Open : {[this.tanggalFormat(values.TANGGAL)]}</div>','<div style="font-size: 12px; text-align: left;  white-space:normal !important;">Close : {[this.tanggalFormat(values.TANGGAL)]}</div>',{getFormatNorm:function(f){var e=Ext.String.leftPad(f,8,"0"),d=Ext.String.insert(Ext.String.insert(Ext.String.insert(e,".",2),".",5),".",8);return d},tanggalFormat:function(c){var d=Ext.isDate(c)?c:Ext.Date.parse(c,"Y-m-d H:i:s");return Ext.Date.format(d,"d-m-Y H:i:s")}})},{xtype:"button",text:"Detail",handler:"onShowDetail"}]}}],loadStore:function(c){var b=this.getViewModel(),a=b.get("store");if(a){a.removeAll();a.queryParams=a.queryParams||{};if(c){a.queryParams=c}a.load({callback:function(d){if(d){if(d.length>0){b.set("status",d[0].get("STATUS"))}}}})}}});Ext.define("pembayaran.penerimaan.ListController",{extend:"Ext.app.ViewController",alias:"controller.pembayaran-penerimaan-list",init:function(){var c=this,d=c.getStore("store");if(d){d.on("load",function(b,a){if(a){if(a.length==0){d.removeAll()}}c.getView().waitRefresh=false})}},onView:function(a){var b=this,c=a.ownerCt.getWidgetRecord();b.getView().fireEvent("viewtagihan",c)},onShowDetail:function(){var a=this;a._onShowDetail=Ext.create("Ext.Window",{closable:true,modal:true,maximizable:true,constrain:this.getView(),header:{height:20,cls:"bgheaderTop"},layout:"fit",minWidth:900,minHeight:400,border:false,items:[{xtype:"pembayaran-penerimaan-detail"}]}).show()}});Ext.define("pembayaran.penerimaan.Workspace",{extend:"com.Form",alias:"widget.pembayaran-penerimaan-Workspace",cls:"shadow-panel",border:true,layout:"border",inRefresh:false,header:{iconCls:"x-fa fa-credit-card",title:"Penerimaan Kasir",margin:0,padding:"5 10 5 10",cls:"x-color-w",layout:{type:"hbox",align:"middle"},items:[{xtype:"component",flex:1},{xtype:"button",iconCls:"x-fa fa-refresh",tooltip:"Refresh",ui:"soft-cyan",margin:"0 0 0 1"}]},items:[{region:"center",reference:"listpenerimaankasir",xtype:"pembayaran-penerimaan-list"}],loadStore:function(b){var a=this.down("[reference=listpenerimaankasir]");a.loadStore({STATUS:1,JENIS:4})},refresh:function(){if(!this.inRefresh){this.getController().init()}}});Ext.define("pembayaran.penjualan.List",{extend:"com.Grid",alias:"widget.pembayaran-penjualan-list",controller:"pembayaran-penjualan-list",viewModel:{stores:{store:{type:"tagihan-store"}}},hideHeaders:true,waitRefresh:true,reference:"tagihanpenjualanlist",initComponent:function(){var a=this;a.columns=[{xtype:"templatecolumn",flex:2,tpl:new Ext.XTemplate('<div style="font-weight: bold; font-size: 12px; white-space:normal !important;">{[values.ID]} ~ {[this.getReferensi(values, "PENJUALAN", "PENGUNJUNG")]} </div>','<div style="font-size: 12px; white-space:normal !important;">{[this.tanggalFormat(values.TANGGAL)]}</div>',{getFormatNorm:function(f){var e=Ext.String.leftPad(f,8,"0"),d=Ext.String.insert(Ext.String.insert(Ext.String.insert(e,".",2),".",5),".",8);return d},tanggalFormat:function(c){var d=Ext.isDate(c)?c:Ext.Date.parse(c,"Y-m-d H:i:s");return Ext.Date.format(d,"d-m-Y H:i:s")},getReferensi:function(d,b,c){return a.getReferensi(d,b,c)}})},{xtype:"templatecolumn",flex:1,tpl:new Ext.XTemplate('<div style="font-weight: bold; font-size: 18px; white-space:normal !important;">{TOTAL} </div>')},{xtype:"widgetcolumn",text:"Status",align:"right",flex:1,widget:{xtype:"fieldcontainer",defaults:{padding:2},items:[{xtype:"button",text:"Batal",ui:"soft-red",action:2,hidden:true,margin:"0 1 0 0",handler:"onClickBatalTagihan"},{xtype:"button",text:"View",action:0,margin:"0 1 0 0",handler:"onViewTagihanPenjualan"},{xtype:"button",text:"Cetak Kwitansi",action:1,handler:"onCetakKwitansi",bind:{hidden:"{getStatusCetakKwitansi}"}}]},onWidgetAttach:"onWidgetAttach"}];a.callParent()}});Ext.define("pembayaran.penjualan.ListController",{extend:"Ext.app.ViewController",alias:"controller.pembayaran-penjualan-list",onViewTagihanPenjualan:function(a){var b=this,c=a.ownerCt.getWidgetRecord();b.getView().fireEvent("viewtagihanpenjualan",c)},onCetakKwitansi:function(a){var b=this,c=a.ownerCt.getWidgetRecord();b.getView().fireEvent("cetakkwitansi",c)},onClickBatalTagihan:function(b){var c=this,a=c.getView(),d=b.ownerCt.getWidgetRecord();a.showMessageBox({title:"Pembatalan tagihan penjualan",message:"Anda yakin ingin membatalkan tagihan ini ?",ui:"window-red",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,animateTarget:b,fn:function(e){if(e==="yes"){d.set("STATUS",0);d.showError=true;d.animateTarget=b;d.scope=c;d.save({callback:function(f,g,h){if(h){a.notifyMessage("Tagihan telah dibatalkan");a.reload()}else{a.reload()}}})}}})},onWidgetAttach:function(i,d,a){var f=this,g=f.getView(),c=g.app.xpriv("121402"),b=a.get("STATUS"),h=d.down("[action=1]"),e=d.down("[action=2]");h.setHidden(b!=2);if(c){e.setHidden(b!=1)}}});Ext.define("pembayaran.penjualan.Workspace",{extend:"com.Form",alias:"widget.pembayaran-penjualan-Workspace",controller:"pembayaran-penjualan-workspace",cls:"shadow-panel",border:true,waitRefresh:false,layout:"fit",header:{iconCls:"x-fa fa-credit-card",title:"Tagihan / Pembayaran",margin:0,padding:"5 10 5 10",cls:"x-color-w",layout:{type:"hbox",align:"middle"},items:[{xtype:"component",flex:1},{xtype:"search-field",emptyText:"[NO. TAGIHAN]",listeners:{search:"onSearch",clear:"onClear"}},{xtype:"button",iconCls:"x-fa fa-refresh",tooltip:"Refresh",ui:"soft-cyan",margin:"0 0 0 1",handler:"onRefreshTagihanPenjualan"},{xtype:"button",iconCls:"x-fa fa-history",tooltip:"History Tagihan / Pembayaran",ui:"soft-green",margin:"0 0 0 1",handler:"onViewHistoryTagihanPenjualan"}]},scrollable:true,bodyPadding:5,items:[{xtype:"pembayaran-penjualan-list",reference:"listpembayaranpenjualan",viewConfig:{loadMask:false},listeners:{viewtagihanpenjualan:"onViewTagihanPenjualan",cetakkwitansi:"onCetakKwitansiPenjualan"}}],loadStore:function(b){var a=this.down("[reference=listpembayaranpenjualan]");a.setGridConfig({paging:true});a.loadStore({STATUS:1,JENIS:4})},refresh:function(){if(!this.waitRefresh){this.down("pembayaran-penjualan-list").refresh()}}});Ext.define("pembayaran.penjualan.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.pembayaran-penjualan-workspace",onViewTagihanPenjualan:function(b){var c=this,a=c.getView();a.waitRefresh=true;a.openDialog("",true,0,0,{xtype:"tagihan-penjualan-Workspace",title:"Tagihan Penjualan",ui:"panel-cyan",showCloseButton:true},function(d,e){wrksp=e.down("tagihan-penjualan-Workspace");wrksp.on({close:function(){a.waitRefresh=false;a.refresh();e.close()}});wrksp.load(b)})},onViewHistoryTagihanPenjualan:function(b){var c=this,a=c.getView();a.waitRefresh=true;a.openDialog("",true,0,0,{xtype:"pembayaran-penjualan-list",title:"History Pembayaran Tagihan Penjualan",ui:"panel-cyan",showCloseButton:true},function(d,e){wrksp=e.down("pembayaran-penjualan-list");wrksp.on({close:function(){a.waitRefresh=false;a.refresh();e.close()},cetakkwitansi:function(f){c.onCetakKwitansiPenjualan(f)},viewtagihanpenjualan:function(f){c.onViewTagihanPenjualan(f)}});wrksp.setGridConfig({paging:true});wrksp.loadStore({STATUS:2,JENIS:4})})},onCetakKwitansiPenjualan:function(b){var d=this,a=d.getView(),c=b.get("ID");a.cetak({NAME:"pembayaran.CetakKwitansiPenjualan",TYPE:"Word",EXT:"docx",PARAMETER:{PTAGIHAN:c,PJENIS:4},REQUEST_FOR_PRINT:true,PRINT_NAME:"CetakKwitansiPenjualan"})},onRefreshTagihanPenjualan:function(a){var c=this,b=c.getView();b.waitRefresh=false;b.refresh()},onSearch:function(d,f){var e=this,c=e.getReferences(),a=c.listpembayaranpenjualan,b=a.down("pagingtoolbar");if(b){b.moveFirst()}a.load({ID:f,STATUS:1,JENIS:4})},onClear:function(c,e){var d=this,b=d.getReferences(),a=b.listpembayaranpenjualan,f=a.getParams();delete f.ID;a.load(f)}});Ext.define("pembayaran.penyedia.Combo",{extend:"com.Combo",alias:"widget.pembayaran-penyedia-combo",viewModel:{stores:{store:{type:"pembayaran-penyedia-store"}}},valueField:"ID",displayField:"NAMA",emptyText:"[Pilih Penyedia Pembayaran]"});Ext.define("pembayaran.penyedia.layanan.Combo",{extend:"com.Combo",alias:"widget.pembayaran-penyedia-layanan-combo",viewModel:{stores:{store:{type:"pembayaran-penyedia-layanan-store"}}},valueField:"ID",emptyText:"[Pilih Layanan Penyedia]",displayField:"NAMA",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">','<div"><strong>{REFERENSI.JENIS_LAYANAN.DESKRIPSI}</strong></div>',"</div>","</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{REFERENSI.JENIS_LAYANAN.DESKRIPSI}","</tpl>")});Ext.define("pembayaran.piutang.pasien.Form",{extend:"com.Form",xtype:"pembayaran-piutang-pasien-form",controller:"pembayaran-piutang-pasien-form",model:"pembayaran.piutang.pasien.Model",viewModel:{data:{identitas:{norm:0,nama:undefined,alamat:undefined,tgllahir:undefined,nomortagihan:undefined,besarangsuran:undefined}},formulas:{readOnlyBesarAnsuran:function(b){var c=b("record"),a=true;if(c.get("JENIS_PEMBAYARAN")==2){a=false}return a}}},defaults:{margin:"2 2 2 2"},items:[{xtype:"fieldset",title:"Identitas Pasien",layout:"vbox",defaults:{width:"100%",margin:"3 3 3 3"},defaultType:"label",items:[{bind:{text:"No. RM : {identitas.norm}"}},{bind:{text:"Nama & Tanggal Lahir : {identitas.nama} *{identitas.tgllahir}*"}},{bind:{text:"Alamat: {identitas.alamat}"}},{bind:{text:"Nomor Tagihan : {identitas.nomortagihan}"}},{bind:{text:"Besar angsuran : Rp.{identitas.besarangsuran}"}}]},{border:false,defaults:{width:"99%",margin:"3 3 3 3"},items:[{layout:"hbox",border:false,fieldLabel:"Jenis Pembayaran",defaults:{width:"50%",margin:"0 2 2 2",labelAlign:"top",readOnly:true},items:[{xtype:"combo",fieldLabel:"Jenis Pembayaran",store:Ext.create("data.store.Store",{fields:["ID","DESKRIPSI"],data:[{ID:1,DESKRIPSI:"Bayar Sekaligus"},{ID:2,DESKRIPSI:"Angsuran"}]}),name:"JENIS_PEMBAYARAN",displayField:"DESKRIPSI",valueField:"ID"},{xtype:"numberfield",fieldLabel:"Angsuran Ke",hideTrigger:true,emptyText:"Angsuran Ke",name:"ANGSURAN_KE"}]},{layout:"hbox",border:false,fieldLabel:"Jenis Pembayaran",defaults:{width:"100%",margin:"0 2 2 2",labelAlign:"top",readOnly:true},items:[{fieldLabel:"Total Bayar (Rp)",xtype:"numberfield",hideTrigger:true,labelAlign:"top",readOnly:true,name:"TOTAL_BAYAR",reference:"txttotalbayar"}]}]}],buttons:[{text:"Buat Tagihan",iconCls:"x-fa fa-plus",ui:"soft-black",handler:"onClickBtnSimpan"}],setIdentitasPasien:function(c){var b=this,a=b.getViewModel();_identitas=a.get("identitas");c=Ext.apply(_identitas,c);a.set("identitas",c)}});Ext.define("pembayaran.piutang.pasien.FormController",{extend:"Ext.app.ViewController",alias:"controller.pembayaran-piutang-pasien-form",onClickBtnSimpan:function(c){var f=this,e=f.getViewModel(),b=e.get("record"),a=f.getView(),d=[];if(a.getForm().isValid()){a.showMessageBox({title:"Konfirmasi",message:"Anda yakin ingin membuat tagihan untuk piutang ini ?",ui:"window-red",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,animateTarget:c,fn:function(g){if(g==="yes"){d.push({JENIS:2,TANGGAL:Ext.Date.format(a.getSysdate(),"Y-m-d H:i:s"),TOTAL:b.get("TOTAL_BAYAR"),STATUS:1});a.setLoading(true);b.set("TAGIHAN",d);a.save(c,{success:"Tagihan berhasil di buat",failed:"Gagal membuat tagihan"},function(j,h,i){a.setLoading(false)})}}})}},onChangeNumberJumlahAngsuran:function(b,f){var d=this,c=d.getViewModel(),a=d.getReferences(),e=c.get("identitas");if(f){a.txttotalbayar.setValue(f*e.besarangsuran)}}});Ext.define("pembayaran.piutang.pasien.Grid",{extend:"com.Grid",xtype:"pembayaran-piutang-pasien-grid",viewModel:{stores:{store:{type:"pembayaran-piutang-pasien-store"}}},columns:[{xtype:"rownumberer",text:"No",align:"left",width:60},{text:"Nomor Tagihan Piutang",flex:1,dataIndex:"TAGIHAN_PIUTANG"},{xtype:"templatecolumn",text:"Jenis Pembayaran",dataIndex:"JENIS_PEMBAYARAN",flex:1,xtype:"templatecolumn",tpl:Ext.create("Ext.XTemplate",'<div style="white-space:normal;">{[this.getDeskripsi(values.JENIS_PEMBAYARAN)]}</div>',{getDeskripsi:function(a){return(a==1)?"Bayar Sekaligus":(a==2)?"Angsuran":""}})},{text:"Angsurang Ke",flex:1,dataIndex:"ANGSURAN_KE"},{xtype:"templatecolumn",text:"Status",dataIndex:"JENIS_PEMBAYARAN",flex:1,xtype:"templatecolumn",tpl:Ext.create("Ext.XTemplate",'<div style="white-space:normal; color:{[this.getColor(values.STATUS)]}">{[this.getDeskripsi(values.STATUS)]}</div>',{getDeskripsi:function(a){return(a==1)?"Belum Bayar":(a==2)?"Telah Bayar":"Batal"},getColor:function(a){return(a==1)?"red":(a==2)?"#30d402":"black"}})},{xtype:"numbercolumn",format:"Rp 00,00",text:"Total Bayar",flex:1.5,align:"right",dataIndex:"TOTAL_BAYAR"}],doAfterLoad:function(c,b,d,a){c.fireEvent("afterLoad",c)},getAngsurangKe:function(){var e=this,c=e.getViewModel(),b=1,a=c.get("store");if(a.getCount()>0){var d=a.getCount();rec=a.getAt(d-1);b=rec.get("ANGSURAN_KE")+rec.get("JUMLAH_ANGSURAN_DIBAYAR")}return b}});Ext.define("pembayaran.piutang.pasien.Workspace",{extend:"com.Form",xtype:"pembayaran-piutang-pasien-workspace",controller:"pembayaran-piutang-pasien-workspace",viewModel:{stores:{storeTagihan:{type:"tagihan-store"}},data:{tagihan:undefined,piutang:undefined}},layout:{type:"border"},border:true,bodyPadding:0,defaults:{flex:1,margin:"1 0 1 0"},items:[{region:"north",title:"Piutang pasien",reference:"listpiutang",xtype:"piutangperorangan-list",listeners:{select:"onSelectPiutang"}},{region:"center",title:"Daftar pembayaran piutang nomor tagihan : ",xtype:"pembayaran-piutang-pasien-grid",reference:"gridpembayaranpiutan",listeners:{afterLoad:"onAfterLoadGrid"}}],initComponent:function(){var b=this,a=b.getController();b.callParent(arguments);var d=b.down("piutangperorangan-list"),c=b.down("pembayaran-piutang-pasien-grid");d.setGridConfig({paging:true});d.getHeaderContainer().remove(4);d.getHeaderContainer().remove(4);d.getHeaderContainer().add({text:"Nomor Tagihan",flex:1,dataIndex:"TAGIHAN"});c.header={items:[{xtype:"button",iconCls:"x-fa fa-money",text:"Buat Tagihan",action:0,reference:"btnbuattagihan",disabled:true,padding:4,ui:"soft-red",margin:"1 1 1 1",scope:a,handler:"onFormPembayaran"}]};c.getHeaderContainer().add({xtype:"widgetcolumn",text:"Action",align:"center",width:115,widget:{xtype:"fieldcontainer",defaults:{padding:2},items:[{xtype:"button",iconCls:"x-fa fa-money",text:"Pembayaran",ui:"soft-green",margin:"0 1 0 0",scope:a,handler:"onClikMethodPembayaran"}]}})},load:function(f){var d=this,b=d.getReferences(),c=d.getViewModel(),e=d.down("pembayaran-piutang-pasien-grid"),a=d.down("piutangperorangan-list");b.btnbuattagihan.setDisabled(true);c.set("pasien",f);c.set("piutang",undefined);e.getStore().removeAll();e.setTitle("Daftar pembayaran piutang nomor tagihan : ");a.load({NORM:f.get("NORM")})}});Ext.define("pembayaran.piutang.pasien.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.pembayaran-piutang-pasien-workspace",privates:{loadGridPembayaran:function(b){var c=this,a=c.getReferences();a.btnbuattagihan.setDisabled(true);a.gridpembayaranpiutan.setTitle("Daftar pembayaran piutang nomor tagihan : "+b);a.gridpembayaranpiutan.load({TAGIHAN_PIUTANG:b})}},onFormPembayaran:function(i){var e=this,g=e.getView(),f=e.getReferences(),a=e.getViewModel(),h=a.get("pasien"),d=false,c=f.gridpembayaranpiutan.getAngsurangKe(),b=a.get("piutang");if(b){if(b.get("JENIS_PEMBAYARAN")==1){d=c==1}else{d=c<=b.get("LAMA_ANGSURAN")}if(d){g.openDialog("",true,600,420,{xtype:"pembayaran-piutang-pasien-form",showCloseButton:true,iconCls:"x-fa fa-money",title:"Buat tagihan : "+b.get("TAGIHAN")},function(m,l){var j=l.down("pembayaran-piutang-pasien-form"),k={TAGIHAN_PIUTANG:b.get("TAGIHAN"),JENIS_PEMBAYARAN:b.get("JENIS_PEMBAYARAN"),JUMLAH_ANGSURAN_DIBAYAR:1,ANGSURAN_KE:c,STATUS:1};if(b.get("JENIS_PEMBAYARAN")==1){k.TOTAL_BAYAR=b.get("TOTAL")}else{if(b.get("JENIS_PEMBAYARAN")==2){k.TOTAL_BAYAR=b.get("BESAR_ANGSURAN")}}j.setIdentitasPasien({norm:h.get("NORM"),nama:h.get("NAMA"),tgllahir:Ext.Date.format(h.get("TANGGAL_LAHIR"),"Y-m-d H:m:i"),alamat:h.get("ALAMAT"),nomortagihan:b.get("TAGIHAN"),besarangsuran:(b.get("JENIS_PEMBAYARAN")==1)?b.get("TOTAL"):b.get("BESAR_ANGSURAN")});j.createRecord(k);j.on("save",function(n){l.close();e.loadGridPembayaran(b.get("TAGIHAN"))})},i)}else{g.notifyMessage("Pembuatan tagihan mencapai batas piutang pasien","danger-red")}}else{g.notifyMessage("Silahkan pilih piutang terlebih dahulu","danger-red")}},onSelectPiutang:function(a,d){var c=this,b=c.getViewModel();b.set("piutang",d);this.loadGridPembayaran(d.get("TAGIHAN"))},onClikMethodPembayaran:function(d){var f=this,c=f.getReferences(),g=d.ownerCt.getWidgetRecord(),e=f.getViewModel(),a=e.get("storeTagihan"),b=f.getView();b.openDialog("",true,0,0,{xtype:"pembayaran-piutang-pasien-tagihan-workspace",showCloseButton:true,ui:"panel-cyan",iconCls:"x-fa fa-money",title:"Pembayaran tagihan piutang pasien"},function(j,i){var h=i.down("pembayaran-piutang-pasien-tagihan-workspace");h.setLoading(true);a.setQueryParams({REF:g.get("ID"),JENIS:2});a.load({callback:function(l,k,m){if(m){h.setLoading(false);h.load(l[0])}else{h.setLoading(false);i.close()}}});i.on("close",function(){c.btnbuattagihan.setDisabled(true);c.gridpembayaranpiutan.reload()})})},onAfterLoadGrid:function(b){var c=this,a=c.getReferences();a.btnbuattagihan.setDisabled(false)}});Ext.define("pembayaran.piutang.pasien.tagihan.Info",{extend:"com.Form",xtype:"pembayaran-piutang-pasien-tagihan-info",controller:"pembayaran-piutang-pasien-tagihan-info",viewModel:{data:{tagihan:undefined,pembayaran:undefined,viewConfig:{tagihanFinal:false,tagihanHak:false,cetakKuitansi:false},total:0},formulas:{adaPembayaranTunai:function(a){var b=a("total");return b>0}}},width:300,bodyPadding:0,items:[{border:false,autoScroll:true,flex:1,layout:{type:"vbox",align:"stretch"},defaults:{fontSize:"15px",height:55},items:[{xtype:"headervalue",fontSize:"20px",paddingText:"7px 0 0 0",height:60,reference:"totaltagihan",title:"Total Tagihan"},{xtype:"headervalue",reference:"totalnon",title:"Total Pembayaran Non Tunai"},{xtype:"headervalue",fontSize:"25px",paddingText:"7px 0 0 0",height:65,reference:"totaltunai",title:"Total Harus Bayar / Tunai"}]},{height:260,layout:{type:"vbox",align:"stretch"},items:[{xtype:"kwitansi-form",title:"Kwitansi",bind:{hidden:"{!adaPembayaranTunai}"},reference:"kwitansi"},{xtype:"button",ui:"soft-cerulen",text:"Finalkan Tagihan",hidden:true,bind:{hidden:"{!viewConfig.tagihanFinal}"},handler:"onFinalTagihan"},{xtype:"button",iconCls:"x-fa fa-print",ui:"soft-cyan",text:"Cetak Kwitansi",bind:{hidden:"{!viewConfig.cetakKuitansi}"},handler:"onCetakKwitansi"}]}],load:function(g){var j=this,b=j.getViewModel(),e=webservice.app?webservice.app:false,f=e?e.xpriv:false,i=j.down("kwitansi-form"),c=j.down("[reference=totaltagihan]"),m=j.down("[reference=totalnon]"),h=j.down("[reference=totaltunai]");if(g){var l=j.getReferensi(g.data,"KWITANSI_PEMBAYARAN");if(l){Ext.Array.each(l,function(n){i.loadRecord(Ext.create("data.model.KwitansiPembayaran",n));i.setFormConfig({viewOnly:true,cetak:!f("121301",false)?false:true});i.setParamReport({name:"pembayaran.CetakKwitansi",params:{PTAGIHAN:g.get("ID"),PJENIS:g.get("JENIS")}})})}else{i.setFormConfig({cetak:f("121301",false)});i.createRecord({TAGIHAN:g.get("ID")})}var a=g.get("TOTAL"),d=j.hitungTotalNonTunai(g);k=k<0?0:k;b.set("tagihan",g);var k=a-d;k=k<0?0:k;c.setValue(a);m.setValue(d);h.setValue(k);b.set("total",k);if(f){b.set("viewConfig.cetakKuitansi",f("121301",false)&&g.get("STATUS")==1);if(!f("1201",false)){b.set("viewConfig.tagihanFinal",false);return}}b.set("viewConfig.tagihanFinal",g.get("STATUS")==1)}},hitungTotalNonTunai:function(b){var c=0,a=this.getReferensi(b.data,"NON_TUNAI");if(a){Ext.Array.each(a,function(d){c+=Number(d.TOTAL)})}return c}});Ext.define("pembayaran.piutang.pasien.tagihan.InfoController",{extend:"Ext.app.ViewController",alias:"controller.pembayaran-piutang-pasien-tagihan-info",onCetakKwitansi:function(){var e=this,a=e.getView(),d=e.getViewModel(),b=e.getReferences(),c=a.getPropertyConfig("34")=="TRUE";tghn=d.get("tagihan");a.openDialog("",true,100,50,{xtype:"kwitansi-form",title:"Kwitansi",ui:"panel-cyan",otomatisasinomor:c,showCloseButton:true},function(f,i){var g=i.down("kwitansi-form"),h={TAGIHAN:tghn.get("ID"),STATUS:1};if(c){h.JENIS_PEMBAYARAN=4;h.NUMAUTO=1}g.setFormConfig({viewOnly:false,cetak:true});g.setParamReport({name:"pembayaran.CetakKwitansi",params:{PTAGIHAN:tghn.get("ID"),PJENIS:tghn.get("JENIS")}});g.createRecord(h);g.on("cetak",function(j){b.kwitansi.loadRecord(j);i.close()})})},onFinalTagihan:function(b){var d=this,c=d.getViewModel(),a=d.getView(),g=a.app,f=g?g.xpriv:false,e=g?(g.trxksr?g.trxksr:false):false;if(!f("1201",false)){a.notifyMessage("Anda tidak memiliki hak akses untuk melakukan Tagihan Final","danger-blue");return}if(!e){a.notifyMessage("Anda belum membuka transaksi kasir / open cashier","danger-blue");return}d.finalTagihanPopup(d,a,b)},finalTagihanPopup:function(c,a,b){a.showMessageBox({title:"Finalkan Tagihan",message:"Anda yakin ingin memfinalkan tagihan ini ?",ui:"window-warning",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,defaultButton:"no",animateTarget:b,fn:function(d){if(d==="yes"){c.finalTagihan(b)}}})},finalTagihan:function(j){var g=this,b=g.getViewModel(),i=g.getView(),c=i.app,e=c?c.xpriv:false,f=c?(c.trxksr?c.trxksr:false):false,a=b.get("tagihan"),h=b.get("total"),d=Ext.create("pembayaran.pembayarantagihan.Model",{TAGIHAN:a.get("ID"),JENIS:1,TUNAI:1,REF:f,TRANSAKSI_KASIR_NOMOR:f,TOTAL:h,STATUS:2});j.setDisabled(true);d.animateTarget=j;d.scope=g;d.showError=true;d.save({callback:function(m,k,l){if(l){i.notifyMessage("Tagihan telah di finalkan","danger-blue");b.set("viewConfig.tagihanFinal",false);b.set("pembayaran",d);a.set("STATUS",2);if(h>0){if(e("121301",false)){i.showMessageBox({title:"Cetak Kwitansi",message:"Anda ingin mencetak kwitansi ?",ui:"window-cyan",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,defaultButton:"yes",animateTarget:j,fn:function(n){if(n==="yes"){g.onCetakKwitansi()}}})}}i.fireEvent("finalsuccess")}j.setDisabled(false)}})}});Ext.define("pembayaran.piutang.pasien.tagihan.Tab",{extend:"com.Tab",xtype:"pembayaran-piutang-pasien-tagihan-tab",controller:"pembayaran-piutang-pasien-tagihan-tab",viewModel:{data:{tagihan:undefined}},bodyPadding:0,activeTab:0,items:[{title:"Rincian",iconCls:"x-fa fa-list",xtype:"pembayaran-piutang-pasien-grid"},{title:"Non Tunai",jenis:5,notLoadLinks:true,iconCls:"x-fa fa-credit-card",xtype:"workspace-nontunai",listeners:{load:"onReload"}}],load:function(b){var c=this,a=c.getViewModel(),d=c.getActiveTab();a.set("tagihan",b);if(d){if(d.xtype=="pembayaran-piutang-pasien-grid"){d.load({ID:b.get("REF")})}else{d.load(b)}}else{if(c.items.getCount()>0){c.setActiveTab(0)}}},listeners:{tabchange:"onChangeTab"}});Ext.define("pembayaran.piutang.pasien.tagihan.TabController",{extend:"Ext.app.ViewController",alias:"controller.pembayaran-piutang-pasien-tagihan-tab",onChangeTab:function(b,a){var c=this.getViewModel().get("tagihan");if(a.load){if(a.xtype=="pembayaran-piutang-pasien-grid"){a.load({ID:c.get("REF")})}else{a.load(c)}}},onReload:function(){this.getView().fireEvent("load")}});Ext.define("pembayaran.piutang.pasien.tagihan.Workspace",{extend:"com.Form",xtype:"pembayaran-piutang-pasien-tagihan-workspace",controller:"pembayaran-piutang-pasien-tagihan-workspace",viewModel:{data:{tagihan:undefined,allowBatalFinal:false},formulas:{getFormatTagihan:function(e){var f=e("tagihan.ID")+"",d=f?f.substring(0,6)+"."+f.substring(6):"";return d},getInfoTanggal:function(c){var f=c("tagihan.TANGGAL"),e=f?Ext.Date.format(f,"d F Y H:i:s"):"";return e},isAllowBatalFinal:function(a){var c=a("tagihan.STATUS")==2,b=a("allowBatalFinal");if(!c){return false}return b}}},layout:{type:"border"},bodyPadding:0,defaults:{margin:"2 2 2 2",border:false},header:{itemPosition:1,items:[{xtype:"component",bind:{html:"<strong>No. Tagihan: {getFormatTagihan} / {getInfoTanggal}</strong>"},margin:"0 5 0 0"},{xtype:"button",iconCls:"x-fa fa-chain-broken",tooltip:"Batalkan Final",bind:{hidden:"{!isAllowBatalFinal}"},ui:"soft-red",handler:"onBatalFinal"},{xtype:"button",ui:"soft-asperages",iconCls:"x-fa fa-refresh",tooltip:"Perbarui Data",handler:"onReload"}]},items:[{region:"center",flax:1,xtype:"pembayaran-piutang-pasien-tagihan-tab",listeners:{load:"onReload"}},{region:"east",split:true,collapsible:true,title:"Info Pembayaran",xtype:"pembayaran-piutang-pasien-tagihan-info",listeners:{finalsuccess:"onReload"}}],load:function(d){var e=this,c=e.getViewModel(),g=e.app.xpriv("1208"),b=e.down("pembayaran-piutang-pasien-tagihan-tab"),a=b.getActiveTab(),f=e.down("pembayaran-piutang-pasien-tagihan-info");c.set("tagihan",d);f.load(d);if(a.notLoadLinks==undefined){b.load(d)}c.set("allowBatalFinal",g)}});Ext.define("pembayaran.piutang.pasien.tagihan.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.pembayaran-piutang-pasien-tagihan-workspace",onReload:function(){var d=this,a=this.getView(),c=d.getViewModel(),b=c.get("tagihan");a.setLoading(true);(new Ext.util.DelayedTask(function(){if(data.model){data.model.Tagihan.load(b.get("ID"),{callback:function(g,e,f){if(f){a.load(g)}a.setLoading(false)}})}})).delay(1500)},onBatalFinal:function(c){var f=this,a=f.getView(),e=f.getViewModel(),d=e.get("tagihan"),b=true;if(a.app){b=!a.app.xpriv("1208")}if(b){a.notifyMessage("Anda tidak memiliki Hak Akses untuk melakukan Pembatalan tagihan final!");return}a.showMessageBox({title:"Pembatalan Tagihan Final",message:"Anda yakin ingin membatalkan tagihan final?",buttons:Ext.Msg.YESNO,ui:"window-red",icon:Ext.Msg.QUESTION,animateTarget:c,fn:function(g){if(g==="yes"){a.openDialog("",true,100,50,{ui:"panel-red",showCloseButton:true,xtype:"pembatalan-tagihan-form",title:"Pembatalan Tagihan Final"},function(h,j){var i=j.down("pembatalan-tagihan-form");i.on("save",function(m,k,l){f.onReload();j.close()});i.createRecord({TAGIHAN:d.get("ID"),JENIS:1,TANGGAL:a.getSysdate()})})}}})}});Ext.define("pembayaran.piutang.perusahaan.Form",{extend:"com.Form",xtype:"pembayaran-piutang-perusahaan-form",controller:"pembayaran-piutang-perusahaan-form",model:"pembayaran.piutang.perusahaan.Model",viewModel:{data:{identitas:{norm:0,nama:undefined,alamat:undefined,tgllahir:undefined,nomortagihan:undefined,total:undefined}}},defaults:{margin:"2 2 2 2"},items:[{xtype:"fieldset",title:"Identitas Pasien",layout:"vbox",defaults:{width:"100%",margin:"3 3 3 3"},defaultType:"label",items:[{bind:{text:"No. RM : {identitas.norm}"}},{bind:{text:"Nama & Tanggal Lahir : {identitas.nama} *{identitas.tgllahir}*"}},{bind:{text:"Alamat: {identitas.alamat}"}}]},{layout:"hbox",border:false,defaults:{width:"50%",margin:"0 2 2 2",labelAlign:"top",readOnly:true},items:[{fieldLabel:"Nomor Tagihan",xtype:"textfield",labelAlign:"top",name:"TAGIHAN_PIUTANG"},{fieldLabel:"Penjamin",xtype:"referensi-combo",params:{JENIS:10,STATUS:1},firstLoad:true,emptyText:"[ PENJAMIN ]",name:"PENJAMIN",flex:1}]},{layout:"hbox",border:false,defaults:{width:"50%",margin:"0 2 2 2",labelAlign:"top",readOnly:true},items:[{fieldLabel:"Total Piutang (Rp)",xtype:"numberfield",hideTrigger:true,labelAlign:"top",name:"TOTAL_PIUTANG",reference:"txttotalpiutang"},{fieldLabel:"Total Bayar (Rp)",xtype:"numberfield",hideTrigger:true,labelAlign:"top",readOnly:false,name:"TOTAL_BAYAR",minValue:0,bind:{maxValue:"{identitas.total}"},reference:"txttotalbayar"}]}],buttons:[{text:"Buat Tagihan",iconCls:"x-fa fa-plus",ui:"soft-black",handler:"onClickBtnSimpan"}],setIdentitasPasien:function(c){var b=this,a=b.getViewModel();_identitas=a.get("identitas");c=Ext.apply(_identitas,c);a.set("identitas",c)}});Ext.define("pembayaran.piutang.perusahaan.FormController",{extend:"Ext.app.ViewController",alias:"controller.pembayaran-piutang-perusahaan-form",onClickBtnSimpan:function(c){var f=this,e=f.getViewModel(),b=e.get("record"),a=f.getView(),d=[];if(a.getForm().isValid()){a.showMessageBox({title:"Konfirmasi",message:"Anda yakin ingin membuat tagihan untuk piutang ini ?",ui:"window-red",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,animateTarget:c,fn:function(g){if(g==="yes"){d.push({JENIS:3,TANGGAL:Ext.Date.format(a.getSysdate(),"Y-m-d H:i:s"),TOTAL:b.get("TOTAL_BAYAR"),STATUS:1});a.setLoading(true);b.set("TAGIHAN",d);a.save(c,{success:"Tagihan berhasil di buat",failed:"Gagal membuat tagihan"},function(j,h,i){a.setLoading(false)})}}})}}});Ext.define("pembayaran.piutang.perusahaan.Grid",{extend:"com.Grid",xtype:"pembayaran-piutang-perusahaan-grid",viewModel:{stores:{store:{type:"pembayaran-piutang-perusahaan-store"}}},columns:[{xtype:"rownumberer",text:"No",align:"left",width:60},{text:"Nomor Tagihan Piutang",flex:1,dataIndex:"TAGIHAN_PIUTANG"},{xtype:"templatecolumn",text:"Jenis Pembayaran",dataIndex:"PENJAMIN",flex:1,xtype:"templatecolumn",tpl:Ext.create("Ext.XTemplate",'<div style="white-space:normal;">{[this.getDeskripsi(values)]}</div>',{getDeskripsi:function(b){var a=(b.REFERENSI)?(b.REFERENSI.PENJAMIN)?b.REFERENSI.PENJAMIN:false:false;desk=(a!=false)?a.DESKRIPSI:"";return desk}})},{xtype:"numbercolumn",format:"Rp 00,00",text:"Total Bayar",text:"Total Piutang",flex:1,dataIndex:"TOTAL_PIUTANG"},{xtype:"templatecolumn",text:"Status",dataIndex:"JENIS_PEMBAYARAN",flex:1,xtype:"templatecolumn",tpl:Ext.create("Ext.XTemplate",'<div style="white-space:normal; color:{[this.getColor(values.STATUS)]}">{[this.getDeskripsi(values.STATUS)]}</div>',{getDeskripsi:function(a){return(a==1)?"Belum Bayar":(a==2)?"Telah Bayar":"Batal"},getColor:function(a){return(a==1)?"red":(a==2)?"#30d402":"black"}})},{xtype:"numbercolumn",format:"Rp 00,00",text:"Total Bayar",flex:1.5,align:"right",dataIndex:"TOTAL_BAYAR"}],doAfterLoad:function(c,b,d,a){c.fireEvent("afterLoad",c)},getTotalTelahDibayar:function(){var d=this,c=d.getViewModel(),b=0,a=c.get("store");a.each(function(f,e){b=b+f.get("TOTAL_BAYAR")});return b}});Ext.define("pembayaran.piutang.perusahaan.Workspace",{extend:"com.Form",xtype:"pembayaran-piutang-perusahaan-workspace",controller:"pembayaran-piutang-perusahaan-workspace",viewModel:{stores:{storeTagihan:{type:"tagihan-store"}},data:{pasien:undefined,piutang:undefined}},layout:{type:"border"},border:true,bodyPadding:0,defaults:{flex:1,margin:"1 0 1 0"},items:[{region:"north",title:"Piutang perusahaan berdasarkan tagihan",reference:"listpiutang",xtype:"piutang-penjamin-list",listeners:{select:"onSelectGridPiutang"}},{region:"center",reference:"gridpembayaran",title:"Daftar pembayaran piutang nomor tagihan : ",xtype:"pembayaran-piutang-perusahaan-grid",listeners:{afterLoad:"onAfterLoadGrid"}}],initComponent:function(){var b=this,a=b.getController();b.callParent(arguments);var c=b.down("piutang-penjamin-list");lstbayar=b.down("pembayaran-piutang-perusahaan-grid");c.setGridConfig({paging:true});c.getHeaderContainer().remove(4);c.getHeaderContainer().remove(4);c.getHeaderContainer().add({text:"Total Rp.",flex:1,xtype:"numbercolumn",format:"Rp 00,00",align:"right",dataIndex:"TOTAL"},{text:"Nomor Tagihan",flex:1,dataIndex:"TAGIHAN"});lstbayar.header={items:[{xtype:"button",iconCls:"x-fa fa-money",text:"Buat Tagihan",action:0,reference:"btnbuattagihan",disabled:true,padding:4,ui:"soft-red",margin:"1 1 1 1",scope:a,handler:"onFormPembayaran"}]};lstbayar.getHeaderContainer().add({xtype:"widgetcolumn",text:"Action",align:"center",width:115,widget:{xtype:"fieldcontainer",defaults:{padding:2},items:[{xtype:"button",iconCls:"x-fa fa-money",text:"Pembayaran",ui:"soft-green",margin:"0 1 0 0",scope:a,handler:"onClikMethodPembayaran"}]}})},load:function(f){var d=this,b=d.getReferences(),c=d.getViewModel(),e=d.down("pembayaran-piutang-perusahaan-grid"),a=d.down("piutang-penjamin-list");b.btnbuattagihan.setDisabled(true);c.set("pasien",f);c.set("piutang",undefined);e.getStore().removeAll();e.setTitle("Daftar pembayaran piutang nomor tagihan : ");a.load({NORM:f.get("NORM")})}});Ext.define("pembayaran.piutang.perusahaan.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.pembayaran-piutang-perusahaan-workspace",privates:{loadGridPembayaran:function(c){var b=this,a=b.getReferences();a.btnbuattagihan.setDisabled(true);a.gridpembayaran.setTitle("Daftar pembayaran piutang nomor tagihan : "+c.TAGIHAN);a.gridpembayaran.load(c)}},onFormPembayaran:function(d){var f=this,a=f.getView(),e=f.getViewModel(),h=0,g=e.get("pasien"),b=f.getReferences(),c=false,h=b.gridpembayaran.getTotalTelahDibayar();rec=e.get("piutang");if(rec){c=h<rec.get("TOTAL");if(c){a.openDialog("",true,600,420,{xtype:"pembayaran-piutang-perusahaan-form",title:"Pembayaran piutang perusahaan",showCloseButton:true,iconCls:"x-fa fa-money"},function(j,k){var i=k.down("pembayaran-piutang-perusahaan-form");i.createRecord({TAGIHAN_PIUTANG:rec.get("TAGIHAN"),PENJAMIN:rec.get("PENJAMIN"),TOTAL_PIUTANG:rec.get("TOTAL"),TOTAL_BAYAR:rec.get("TOTAL")-h,STATUS:1});i.setIdentitasPasien({norm:g.get("NORM"),nama:g.get("NAMA"),tgllahir:Ext.Date.format(g.get("TANGGAL_LAHIR"),"Y-m-d H:m:i"),alamat:g.get("ALAMAT"),nomortagihan:rec.get("TAGIHAN"),total:rec.get("TOTAL")-h});i.on("save",function(){k.close();f.loadGridPembayaran({TAGIHAN:rec.get("TAGIHAN"),PENJAMIN:rec.get("PENJAMIN")})})})}else{a.notifyMessage("Pembuatan tagihan mencapai batas piutang pasien","danger-red")}}else{a.notifyMessage("Silahkan pilih piutang terlebih dahulu","danger-red")}},onSelectGridPiutang:function(a,d){var c=this,b=c.getViewModel();b.set("piutang",d);this.loadGridPembayaran({TAGIHAN:d.get("TAGIHAN"),PENJAMIN:d.get("PENJAMIN")})},onClikMethodPembayaran:function(d){var f=this,c=f.getReferences(),g=d.ownerCt.getWidgetRecord(),e=f.getViewModel(),a=e.get("storeTagihan"),b=f.getView();b.openDialog("",true,0,0,{xtype:"pembayaran-piutang-perusahaan-tagihan-workspace",showCloseButton:true,ui:"panel-cyan",iconCls:"x-fa fa-money",title:"Pembayaran tagihan piutang perusahaan"},function(j,i){var h=i.down("pembayaran-piutang-perusahaan-tagihan-workspace");h.setLoading(true);a.setQueryParams({REF:g.get("ID"),JENIS:3});a.load({callback:function(l,k,m){if(m){h.setLoading(false);h.load(l[0])}else{h.setLoading(false);i.close()}}});i.on("close",function(){c.btnbuattagihan.setDisabled(true);c.gridpembayaran.reload()})})},onAfterLoadGrid:function(b){var c=this,a=c.getReferences();a.btnbuattagihan.setDisabled(false)}});Ext.define("pembayaran.piutang.perusahaan.tagihan.Info",{extend:"com.Form",xtype:"pembayaran-piutang-perusahaan-tagihan-info",controller:"pembayaran-piutang-perusahaan-tagihan-info",viewModel:{data:{tagihan:undefined,pembayaran:undefined,viewConfig:{tagihanFinal:false,tagihanHak:false,cetakKuitansi:false},total:0},formulas:{adaPembayaranTunai:function(a){var b=a("total");return b>0}}},bodyPadding:0,items:[{border:false,autoScroll:true,flex:1,layout:{type:"vbox",align:"stretch"},defaults:{fontSize:"15px",height:55},items:[{xtype:"headervalue",fontSize:"20px",paddingText:"7px 0 0 0",height:60,reference:"totaltagihan",title:"Total Tagihan"},{xtype:"headervalue",reference:"transfer",title:"Total Transfer"},{xtype:"headervalue",fontSize:"25px",paddingText:"7px 0 0 0",height:65,reference:"totaltunai",title:"Total Harus Bayar / Tunai"}]},{height:160,layout:{type:"vbox",align:"stretch"},items:[{xtype:"kwitansi-form",title:"Kwitansi",bind:{hidden:"{!adaPembayaranTunai}"},reference:"kwitansi"},{xtype:"button",ui:"soft-cerulen",text:"Finalkan Tagihan",hidden:true,bind:{hidden:"{!viewConfig.tagihanFinal}"},handler:"onFinalTagihan"},{xtype:"button",iconCls:"x-fa fa-print",ui:"soft-cyan",text:"Cetak Kwitansi",bind:{hidden:"{!viewConfig.cetakKuitansi}"},handler:"onCetakKwitansi"}]}],load:function(h){var l=this,d=l.getViewModel(),f=webservice.app?webservice.app:false,g=f?f.xpriv:false,k=l.down("kwitansi-form"),e=l.down("[reference=totaltagihan]"),a=l.down("[reference=transfer]"),j=l.down("[reference=totaltunai]");if(h){var n=l.getReferensi(h.data,"KWITANSI_PEMBAYARAN");if(n){Ext.Array.each(n,function(o){k.loadRecord(Ext.create("data.model.KwitansiPembayaran",o));k.setFormConfig({viewOnly:true,cetak:!g("121301",false)?false:true})})}else{k.setFormConfig({cetak:g("121301",false)});k.createRecord({TAGIHAN:h.get("ID")})}var c=h.get("TOTAL"),i=l.hitungTotalTransfer(h),b=0;m=m<0?0:m;d.set("tagihan",h);var m=c-i;m=m<0?0:m;e.setValue(c);a.setValue(i);j.setValue(m);d.set("total",m);if(g){d.set("viewConfig.cetakKuitansi",g("121301",false)&&h.get("STATUS")==1);if(!g("1201",false)){d.set("viewConfig.tagihanFinal",false);return}}d.set("viewConfig.tagihanFinal",h.get("STATUS")==1)}},hitungTotalTransfer:function(a){var c=0,b=this.getReferensi(a.data,"TRANSFER");if(b){Ext.Array.each(b,function(d){c+=Number(d.TOTAL)})}return c}});Ext.define("pembayaran.piutang.perusahaan.tagihan.InfoController",{extend:"Ext.app.ViewController",alias:"controller.pembayaran-piutang-perusahaan-tagihan-info",onCetakKwitansi:function(){var e=this,a=e.getView(),d=e.getViewModel(),b=e.getReferences(),c=a.getPropertyConfig("34")=="TRUE";tghn=d.get("tagihan");a.openDialog("",true,100,50,{xtype:"kwitansi-form",title:"Kwitansi",ui:"panel-cyan",otomatisasinomor:c,showCloseButton:true},function(f,i){var g=i.down("kwitansi-form"),h={TAGIHAN:tghn.get("ID"),STATUS:1};if(c){h.JENIS_PEMBAYARAN=4;h.NUMAUTO=1}g.setFormConfig({viewOnly:false,cetak:true});g.setParamReport({name:"pembayaran.CetakKwitansiPiutangPasien",params:{PTAGIHAN:tghn.get("ID"),PJENIS:tghn.get("JENIS")}});g.createRecord(h);g.on("cetak",function(j){b.kwitansi.loadRecord(j);i.close()})})},onFinalTagihan:function(b){var d=this,c=d.getViewModel(),a=d.getView(),g=c.get("tagihan"),h=a.app,f=h?h.xpriv:false,e=h?(h.trxksr?h.trxksr:false):false;if(!f("1201",false)){a.notifyMessage("Anda tidak memiliki hak akses untuk melakukan Tagihan Final","danger-blue");return}if(!e){a.notifyMessage("Anda belum membuka transaksi kasir / open cashier","danger-blue");return}d.finalTagihanPopup(d,a,b)},finalTagihanPopup:function(c,a,b){a.showMessageBox({title:"Finalkan Tagihan",message:"Anda yakin ingin memfinalkan tagihan ini ?",ui:"window-warning",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,defaultButton:"no",animateTarget:b,fn:function(d){if(d==="yes"){c.finalTagihan(b)}}})},finalTagihan:function(j){var g=this,b=g.getViewModel(),i=g.getView(),c=i.app,e=c?c.xpriv:false,f=c?(c.trxksr?c.trxksr:false):false,a=b.get("tagihan"),h=b.get("total"),d=Ext.create("pembayaran.pembayarantagihan.Model",{TAGIHAN:a.get("ID"),JENIS:1,TUNAI:1,REF:f,TOTAL:h,STATUS:1});j.setDisabled(true);d.animateTarget=j;d.scope=g;d.showError=true;d.save({callback:function(m,k,l){if(l){i.notifyMessage("Tagihan telah di finalkan","danger-blue");b.set("viewConfig.tagihanFinal",false);b.set("pembayaran",d);a.set("STATUS",2);if(h>0){if(e("121301",false)){i.showMessageBox({title:"Cetak Kwitansi",message:"Anda ingin mencetak kwitansi ?",ui:"window-cyan",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,defaultButton:"yes",animateTarget:j,fn:function(n){if(n==="yes"){g.onCetakKwitansi()}}})}}i.fireEvent("finalsuccess")}j.setDisabled(false)}})}});Ext.define("pembayaran.piutang.perusahaan.tagihan.Tab",{extend:"com.Tab",xtype:"pembayaran-piutang-perusahaan-tagihan-tab",controller:"pembayaran-piutang-perusahaan-tagihan-tab",viewModel:{data:{tagihan:undefined}},bodyPadding:0,activeTab:0,items:[{title:"Rincian",iconCls:"x-fa fa-list",xtype:"pembayaran-piutang-perusahaan-grid"},{title:"Bank",iconCls:"x-fa fa-money",jenispembayaran:7,xtype:"pembayaran-tagihan-nontunai-bank-workspace",listeners:{load:"onReload"}}],load:function(b){var c=this,a=c.getViewModel(),d=c.getActiveTab();a.set("tagihan",b);if(d){if(d.xtype=="pembayaran-piutang-perusahaan-grid"){d.load({ID:b.get("REF")})}else{d.load(b)}}else{if(c.items.getCount()>0){c.setActiveTab(0)}}},listeners:{tabchange:"onChangeTab"}});Ext.define("pembayaran.piutang.perusahaan.tagihan.TabController",{extend:"Ext.app.ViewController",alias:"controller.pembayaran-piutang-perusahaan-tagihan-tab",onChangeTab:function(b,a){var c=this.getViewModel().get("tagihan");if(a.load){if(a.xtype=="pembayaran-piutang-perusahaan-grid"){a.load({ID:c.get("REF")})}else{a.load(c)}}},onReload:function(){this.getView().fireEvent("load")}});Ext.define("pembayaran.piutang.perusahaan.tagihan.Workspace",{extend:"com.Form",xtype:"pembayaran-piutang-perusahaan-tagihan-workspace",controller:"pembayaran-piutang-perusahaan-tagihan-workspace",viewModel:{data:{tagihan:undefined},formulas:{isAllowBatalFinal:function(a){var c=a("tagihan.STATUS")==2,b=a("allowBatalFinal");if(!c){return false}return b}}},layout:{type:"border"},bodyPadding:0,defaults:{margin:"2 2 2 2",border:false},header:{itemPosition:1,items:[{xtype:"button",iconCls:"x-fa fa-chain-broken",tooltip:"Batalkan Final",bind:{hidden:"{!isAllowBatalFinal}"},ui:"soft-red",handler:"onBatalFinal"},{xtype:"button",ui:"soft-asperages",iconCls:"x-fa fa-refresh",tooltip:"Perbarui Data",handler:"onReload"}]},items:[{region:"center",flax:1,xtype:"pembayaran-piutang-perusahaan-tagihan-tab",listeners:{load:"onReload"}},{region:"east",flex:0.4,title:"Info Pembayaran",xtype:"pembayaran-piutang-perusahaan-tagihan-info",listeners:{finalsuccess:"onReload"}}],load:function(b){var a=this.getViewModel(),c=this.down("pembayaran-piutang-perusahaan-tagihan-tab"),d=this.down("pembayaran-piutang-perusahaan-tagihan-info");a.set("tagihan",b);d.load(b);c.load(b)}});Ext.define("pembayaran.piutang.perusahaan.tagihan.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.pembayaran-piutang-perusahaan-tagihan-workspace",onReload:function(){var d=this,a=this.getView(),c=d.getViewModel(),b=c.get("tagihan");a.setLoading(true);(new Ext.util.DelayedTask(function(){if(data.model){data.model.Tagihan.load(b.get("ID"),{callback:function(g,e,f){if(f){a.load(g)}a.setLoading(false)}})}})).delay(1500)},onBatalFinal:function(c){var f=this,a=f.getView(),e=f.getViewModel(),d=e.get("tagihan"),b=true;if(a.app){b=!a.app.xpriv("1208")}if(b){a.notifyMessage("Anda tidak memiliki Hak Akses untuk melakukan Pembatalan tagihan final!");return}a.showMessageBox({title:"Pembatalan Tagihan Final",message:"Anda yakin ingin membatalkan tagihan final?",buttons:Ext.Msg.YESNO,ui:"window-red",icon:Ext.Msg.QUESTION,animateTarget:c,fn:function(g){if(g==="yes"){a.openDialog("",true,100,50,{ui:"panel-red",showCloseButton:true,xtype:"pembatalan-tagihan-form",title:"Pembatalan Tagihan Final"},function(h,j){var i=j.down("pembatalan-tagihan-form");i.on("save",function(m,k,l){f.onReload();j.close()});i.createRecord({TAGIHAN:d.get("ID"),JENIS:1,TANGGAL:a.getSysdate()})})}}})}});Ext.define("pembayaran.tagihan.HeaderValue",{extend:"Ext.form.Panel",xtype:"headervalue",viewModel:{data:{value:0},formulas:{getValueNumber:function(a){var b=a("value");b=b?b:0;return Ext.util.Format.number(b,"0,00")}}},border:false,fontWeight:"bold",fontSize:"17px",paddingText:"4 0 0 0",layout:{type:"hbox",align:"stretch"},bodyPadding:5,initComponent:function(){var a=this;a.items=[{xtype:"component",html:"Rp.",margin:"0 5 0 0"},{xtype:"component",flex:1,style:{fontWeight:a.fontWeight,fontSize:a.fontSize,textAlign:"right",padding:a.paddingText},bind:{html:"{getValueNumber}"}}];a.callParent(arguments)},setValue:function(a){this.getViewModel().set("value",a)}});Ext.define("pembayaran.tagihan.Info",{extend:"com.Form",xtype:"tagihan-info",controller:"tagihan-info",viewModel:{data:{tagihan:undefined,pembayaran:undefined,viewConfig:{tagihanFinal:false,tagihanHak:false,cetakKuitansi:false},total:0,info:""},formulas:{adaPembayaranTunai:function(a){var b=a("total");return b>0}}},layout:{type:"vbox",align:"stretch"},width:300,bodyPadding:0,header:{itemPosition:1,items:[{xtype:"button",ui:"soft-red",iconCls:"x-fa fa-calculator",tooltip:"Hitung Ulang Tagihan",bind:{hidden:"{!viewConfig.tagihanFinal}"},handler:"onHitungUlang",margin:"0 1 0 0"},{xtype:"button",ui:"soft-cyan",iconCls:"x-fa fa-info",tooltip:"Informasi",handler:"onInfo"}]},initComponent:function(){var a=this;a.callParent();a.suspendLayouts();a.add(a.lCetakan());a.add(a.lInfoTagihan());a.add(a.lBtnTagihan());a.resumeLayouts()},lCetakan:function(){var a=this;return{height:30,layout:{type:"hbox",align:"stretch"},reference:"cetakrekapdanrincian",hidden:true,defaultType:"button",items:[{text:"Cetak Rekap",iconCls:"x-fa fa-print",ui:"soft-cyan",rptName:"CetakRekapRincianPasien",flex:1,handler:"onCetak"},{text:"Cetak Rincian",iconCls:"x-fa fa-print",ui:"soft-cerulen",flex:1,menu:[{text:"Format 1",rptName:a.kode+"CetakRincianPasien",handler:"onCetak"},{text:"Format 2",rptName:"CetakRincianPasien",handler:"onCetak"},{text:"Format 3",rptName:a.kode+"CetakRincianPasienPerGroup",handler:"onCetak"},{text:"Format 4",rptName:"CetakRincianKegiatanPasien",handler:"onCetak"}]}]}},lInfoTagihan:function(){return{autoScroll:true,flex:1,layout:{type:"vbox",align:"stretch"},defaults:{fontSize:"15px",height:55},items:[{xtype:"headervalue",fontSize:"20px",paddingText:"7px 0 0 0",height:60,reference:"totaltagihan",title:"Total Tagihan"},{xtype:"headervalue",reference:"totaltagihanhak",title:"Total Tagihan Hak",hidden:true,bind:{hidden:"{!viewConfig.tagihanHak}"}},{xtype:"headervalue",reference:"totaljaminan",title:"Total Jaminan"},{xtype:"headervalue",reference:"totalsubsidi",title:"Total Subsidi"},{xtype:"headervalue",reference:"totalpiutang",title:"Total Piutang"},{xtype:"headervalue",reference:"totaldiskon",title:"Total Diskon"},{xtype:"headervalue",reference:"totalnon",title:"Total Pembayaran Non Tunai"},{xtype:"headervalue",fontSize:"25px",paddingText:"7px 0 0 0",height:65,reference:"totaltunai",title:"Total Harus Bayar / Tunai"},{xtype:"headervalue",reference:"totaluangmuka",title:"Total Deposit"},{xtype:"headervalue",reference:"sisapembayaran",title:"Sisa Pembayaran"}]}},lBtnTagihan:function(){return{height:160,layout:{type:"vbox",align:"stretch"},items:[{xtype:"kwitansi-form",title:"Kwitansi",bind:{hidden:"{!adaPembayaranTunai}"},reference:"kwitansi"},{xtype:"button",ui:"soft-cerulen",text:"Finalkan Tagihan",hidden:true,bind:{hidden:"{!viewConfig.tagihanFinal}"},handler:"onFinalTagihan"},{xtype:"button",iconCls:"x-fa fa-print",ui:"soft-cyan",text:"Cetak Kwitansi",bind:{hidden:"{!viewConfig.cetakKuitansi}"},handler:"onCetakKwitansi"}]}},load:function(y){var B=this,z=B.getViewModel(),n=webservice.app?webservice.app:false,a=n?n.xpriv:false,s=B.down("kwitansi-form"),E=B.down("[reference=totaltagihan]"),G=B.down("[reference=totaltagihanhak]"),t=B.down("[reference=totaljaminan]"),u=B.down("[reference=totalsubsidi]"),w=B.down("[reference=totalpiutang]"),e=B.down("[reference=totaldiskon]"),j=B.down("[reference=totalnon]"),A=B.down("[reference=totaltunai]"),o=B.down("[reference=totaluangmuka]"),D=B.down("[reference=sisapembayaran]");z.set("viewConfig.tagihanHak",false);B.down("[reference=cetakrekapdanrincian]").setHidden(!a("1213",false));if(y){var k=B.getReferensi(y.data,"KWITANSI_PEMBAYARAN");if(k){Ext.Array.each(k,function(H){s.loadRecord(Ext.create("data.model.KwitansiPembayaran",H));s.setFormConfig({viewOnly:true,cetak:!a("121301",false)?false:true})})}else{s.setFormConfig({cetak:a("121301",false)});s.createRecord({TAGIHAN:y.get("ID")})}var l=y.get("TOTAL"),d=l,h=0,g=B.hitungTotalJaminan(y),b=B.hitungTotalSubsidi(y),c=B.hitungTotalPiutang(y),m=B.hitungTotalDiskon(y),q=B.hitungTotalNonTunai(y),v=B.hitungTotalUangMuka(y),f=B.getPenjamin(y,2),C=0;F=F<0?0:F;z.set("tagihan",y);var i=l-g;if(f){if(f.NAIK_KELAS==1){l=Number(f.TOTAL_NAIK_KELAS);z.set("info","<span style='color: maroon'>Tagihan ini menggunakan perhitungan <br/>Selisih (tarif INACBG Naik Kelas - Tarif INACBG Hak Kelas)</span>")}if(f.NAIK_KELAS_VIP==1){l=Number(f.TOTAL_NAIK_KELAS);var r=Number(B.getPropertyConfig("16")),x=B.getPropertyConfig("20")=="TRUE",C=Number(f.SELISIH_MINIMAL),p=Number(f.PERSENTASE_TARIF_INACBG_KELAS1);l+=C;z.set("info","<span style='color: maroon'>Tagihan ini menggunakan perhitungan <br/>Selisih (tarif INACBG Kelas 1 - Tarif INACBG Hak Kelas) + <br/>"+(r==0||x?"(Tarif INACBG Kelas 1 x "+p+"%)</span>":"((Tarif INACBG Kelas 1 x "+r+"%) >= (Tarif RS - Tarif INACBG Kelas 1) = (Tarif INACBG Kelas 1 x "+r+"%)) </br>((Tarif RS - Tarif INACBG Kelas 1) >= (Tarif INACBG Kelas 1 x 75%) = (Tarif INACBG Kelas 1 x 75%))</br>((Tarif RS - Tarif INACBG Kelas 1) > (Tarif INACBG Kelas 1 x "+r+"%) & <= (Tarif INACBG Kelas 1 x 75%) = (Tarif RS - Tarif INACBG Kelas 1))</span>"))}if(f.NAIK_DIATAS_VIP==1){if(f.TOTAL_TAGIHAN_HAK>0){z.set("viewConfig.tagihanHak",true);h=Number(f.TOTAL_TAGIHAN_HAK)}z.set("info","<span style='color: maroon'>Tagihan ini menggunakan perhitungan<br/>(tarifrs - jaminan inacbg hak kelas) = selisih bayar<br/>jika ada selisih bayar maka (jaminan inacbg hak kelas > tagihan hak maka (tarifrs - jaminan inacbg hak kelas))<br/>atau (jaminan inacbg hak kelas < tagihan hak maka (tarifrs - tagihan hak))<br/>subsidi = tagihan hak - jaminan inacbg hak kelas</span>")}if(B.getPropertyConfig("9")=="TRUE"){if(f.NAIK_KELAS==1||f.NAIK_KELAS_VIP==1||f.NAIK_DIATAS_VIP==1){l=Number(f.TOTAL_NAIK_KELAS);b=0;h=0;z.set("info","<span style='color: maroon'>KEBIJAKAN RS:<br/>Tagihan ini menggunakan perhitungan <br/>Selisih (Total Akomodasi Naik Kelas - Total Akomodasi Hak Kelas)</span>")}}}var F=l-g-b-c-m-q;F=F<0?0:F;E.setValue(l);G.setValue(h);t.setValue(g);u.setValue(b);w.setValue(c);e.setValue(m);j.setValue(q);A.setValue(F);o.setValue(v);D.setValue(F-v);z.set("total",F);y.set("TOTAL_TUNAI",F);if(a){z.set("viewConfig.cetakKuitansi",a("121301",false));if(!a("1201",false)){z.set("viewConfig.tagihanFinal",false);return}}z.set("viewConfig.tagihanFinal",y.get("STATUS")==1)}},hitungTotalJaminan:function(b){var c=0,a=this.getReferensi(b.data,"PENJAMIN_TAGIHAN");if(a){Ext.Array.each(a,function(d){c+=Number(d.TOTAL)})}return c},getPenjamin:function(b,c){var a=this.getReferensi(b.data,"PENJAMIN_TAGIHAN");_penjamin=undefined;if(a){Ext.Array.each(a,function(d){if(d.PENJAMIN==c){_penjamin=d}})}return _penjamin},hitungTotalUangMuka:function(b){var c=0,a=this.getReferensi(b.data,"DEPOSIT"),d=this.getReferensi(b.data,"PENGEMBALIAN_DEPOSIT");if(a){Ext.Array.each(a,function(e){if(e.JENIS==1){c+=Number(e.TOTAL)}else{c-=Number(e.TOTAL)}})}if(d){Ext.Array.each(d,function(e){c-=Number(e.TOTAL)})}return c},hitungTotalPiutang:function(b){var d=0,c=this.getReferensi(b.data,"PIUTANG_PASIEN"),a=this.getReferensi(b.data,"PIUTANG_PERUSAHAAN");if(c){Ext.Array.each(c,function(e){d+=Number(e.TOTAL)})}if(a){Ext.Array.each(a,function(e){d+=Number(e.TOTAL)})}return d},hitungTotalDiskon:function(b){var c=0,d=this.getReferensi(b.data,"DISKON"),a=this.getReferensi(b.data,"DISKON_DOKTER");if(d){Ext.Array.each(d,function(e){c+=(Number(e.ADMINISTRASI)+Number(e.AKOMODASI)+Number(e.SARANA_NON_AKOMODASI)+Number(e.PARAMEDIS))})}if(a){Ext.Array.each(a,function(e){c+=Number(e.TOTAL)})}return c},hitungTotalNonTunai:function(b){var c=0,a=this.getReferensi(b.data,"NON_TUNAI");if(a){Ext.Array.each(a,function(d){c+=Number(d.TOTAL)})}return c},hitungTotalSubsidi:function(a){var b=0,c=this.getReferensi(a.data,"SUBSIDI_TAGIHAN");if(c){Ext.Array.each(c,function(d){if(d.STATUS==1){b+=Number(d.TOTAL)}})}return b}});Ext.define("pembayaran.tagihan.InfoController",{extend:"Ext.app.ViewController",alias:"controller.tagihan-info",onHitungUlang:function(c){var f=this,a=f.getView(),d=f.getViewModel(),g=d.get("tagihan"),e=d.get("total"),b=Ext.create("data.model.Tagihan",{ID:g.get("ID")});b.set("HITUNGULANG",1);a.ownerCt.setLoading(true);b.animateTarget=c;b.scope=f;b.showError=true;b.timeout=600000;b.save({callback:function(j,h,i){if(i){a.fireEvent("hitungtagihan")}a.ownerCt.setLoading(false)}})},onFinalTagihan:function(k){var i=this,b=i.getViewModel(),j=i.getView(),a=b.get("tagihan"),f=j.getReferensi(a.data,"PASIEN"),c=j.app,e=c?c.xpriv:false,h=c?(c.trxksr?c.trxksr:false):false;if(!e("1201",false)){j.notifyMessage("Anda tidak memiliki hak akses untuk melakukan Tagihan Final","danger-blue");return}if(!h){j.notifyMessage("Anda belum membuka transaksi kasir / open cashier","danger-blue");return}var d=Ext.create("kunjungan.List",{ui:"panel-cyan",showCloseButton:true,title:"History Kunjungan Pasien "+f.get("NAMA")+"("+f.get("NORM")+")"}),g=true;d.setListConfig({paging:false,hiddenPencarian:true,hiddenLihatAction:true,hiddenFinalAction:false});d.load({TAGIHAN:a.get("ID"),JENIS_KUNJUNGAN:"!3",STATUS:1});d.doAfterLoad=function(l,n,o,m){if(o){if(n.length>0){if(g){g=false;j.openDialog("",true,"90%","70%",d,function(p,q){i.windowDlg=q})}}else{if(i.windowDlg){i.windowDlg.close()}i.finalTagihanPopup(i,j,k)}}else{if(i.windowDlg){i.windowDlg.close()}i.finalTagihanPopup(i,j,k)}}},finalTagihanPopup:function(c,a,b){a.showMessageBox({title:"Finalkan Tagihan",message:"Anda yakin ingin memfinalkan tagihan ini ?",ui:"window-warning",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,defaultButton:"no",animateTarget:b,fn:function(d){if(d==="yes"){c.finalTagihan(b)}}})},finalTagihan:function(j){var g=this,b=g.getViewModel(),i=g.getView(),c=i.app,e=c?c.xpriv:false,f=c?(c.trxksr?c.trxksr:false):false,a=b.get("tagihan"),h=b.get("total"),d=Ext.create("pembayaran.pembayarantagihan.Model",{TAGIHAN:a.get("ID"),JENIS:1,TUNAI:1,REF:f,TRANSAKSI_KASIR_NOMOR:f,TOTAL:h,STATUS:2});i.ownerCt.setLoading(true);j.setDisabled(true);d.animateTarget=j;d.scope=g;d.showError=true;d.save({callback:function(m,k,l){if(l){i.notifyMessage("Tagihan telah di finalkan","danger-blue");b.set("viewConfig.tagihanFinal",false);b.set("pembayaran",d);a.set("STATUS",2);if(h>0){if(e("121301",false)){i.showMessageBox({title:"Cetak Kwitansi",message:"Anda ingin mencetak kwitansi ?",ui:"window-cyan",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,defaultButton:"yes",animateTarget:j,fn:function(n){if(n==="yes"){g.onCetakKwitansi()}}})}}}i.ownerCt.setLoading(false);j.setDisabled(false)}})},onCetakKwitansi:function(){var d=this,a=d.getView(),c=d.getViewModel(),b=d.getReferences(),e=c.get("tagihan");a.openDialog("",true,100,50,{xtype:"kwitansi-form",title:"Kwitansi",ui:"panel-cyan",showCloseButton:true},function(f,g){kw=g.down("kwitansi-form");kw.setFormConfig({viewOnly:false,cetak:true});kw.createRecord({TAGIHAN:e.get("ID"),STATUS:1});kw.on("cetak",function(h){b.kwitansi.loadRecord(h);g.close()})})},onCetak:function(a){this.cetakRincian(a.rptName)},privates:{cetakRincian:function(f){var e=this,a=e.getView(),h=e.getViewModel().get("tagihan"),b="Word",d="docx",g=true,c="Cetak Rincian";a.showMessageBox({title:c,message:"Tekan tombol Yes/Ya utk cetak langsung<br/>Tekan tombol No/Tidak untuk Preview",ui:"window-cyan",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,defaultButton:"yes",animateTarget:e,fn:function(i){if(i!="yes"){b="Pdf";d="pdf";g=false}a.cetak({NAME:"pembayaran."+f,TYPE:b,EXT:d,PARAMETER:{PTAGIHAN:h.get("ID"),PSTATUS:1},REQUEST_FOR_PRINT:g,PRINT_NAME:"CetakRincian"},function(j){a.printPreview(c,j)})}})}},onInfo:function(b){var d=this,a=d.getView(),c=d.getViewModel();if(c.get("info")==""){a.notifyMessage("Tagihan ini tidak memiliki informasi")}else{a.openWindow({modal:true,title:"Informasi Tagihan",closable:true,maximized:false,width:500,height:250,animateTarget:b,border:false,constrain:d,layout:"fit",header:{iconCls:"x-fa fa-info",margin:0,padding:"10 15 10 15"},items:{xtype:"component",padding:20,html:c.get("info")}})}}});Ext.define("pembayaran.tagihan.Links",{extend:"com.Tab",alias:"widget.tagihan-links",cls:"x-br-top",ui:"header-tab",items:[{title:"Rincian",xtype:"workspace-rincian",iconCls:"x-fa fa-list-alt"},{title:"Deposit",xtype:"workspace-deposit",listeners:{load:"onReload"},iconCls:"x-fa fa-dollar"},{title:"Penjamin",xtype:"workspace-penjamintagihan",iconCls:"x-fa fa-user-secret",listeners:{load:"onReload"}},{title:"Piutang",xtype:"workspace-piutang",iconCls:"x-fa fa-money",listeners:{load:"onReload"}},{title:"Non Tunai",xtype:"workspace-nontunai",jenis:2,notLoadLinks:true,listeners:{load:"onReload"},iconCls:"x-fa fa-credit-card"},{title:"Discount",xtype:"workspace-discount",listeners:{load:"onReload"},iconCls:"x-fa fa-unlink"},{title:"Info Pembayaran",xtype:"pembayaran-pembayarantagihan-workspace",listeners:{load:"onReload"},iconCls:"x-fa fa-info"}],load:function(b){var c=this;var a=c.getActiveTab();if(a){if(a.loadRecord){a.loadRecord(b)}else{if(a.load){a.load(b)}}}}});Ext.define("pembayaran.tagihan.List",{extend:"com.Grid",alias:"widget.tagihan-list",controller:"tagihan-list",viewModel:{stores:{store:{type:"tagihan-store"}}},hideHeaders:true,initComponent:function(){var a=this;a.columns=[{xtype:"templatecolumn",flex:2,tpl:new Ext.XTemplate('<div style="font-weight: bold; font-size: 12px; white-space:normal !important;">{[values.ID]} - {[this.tanggalFormat(values.TANGGAL)]}</div>{[this.infoPendaftaranTagihan(values)]} {[this.infoPenjamin(values)]}',{infoPendaftaranTagihan:function(d){var e=a.getReferensi(d,"TAGIHAN_PENDAFTARAN"),c=e?e:[],b='<div style="font-size: 12px; white-space:normal !important;">[FIELD]</div>',f="";Ext.Array.each(c,function(j){var h=a.getReferensi(j,"PENDAFTARAN"),g=h?(h.TUJUAN?h.TUJUAN:null):null,i=g?a.getReferensi(g,"RUANGAN","DESKRIPSI"):"";if(h){i+=" / "+h.NOMOR+" - "+Ext.Date.format(Ext.Date.parse(h.TANGGAL,"Y-m-d H:i:s"),"d-m-Y H:i:s");f+=b.replace("[FIELD]",i)}});return f},infoPenjamin:function(f){var g=a.getReferensi(f,"PENJAMIN_TAGIHAN"),d=a.getReferensi(f,"TAGIHAN_PENDAFTARAN"),e=g?g:[],b=d?d:[],c='<div style="font-size: 12px; white-space:normal !important;">[FIELD]</div>',h="";Ext.Array.each(e,function(n){var l=a.getReferensi(n,"PENJAMIN"),m=a.getReferensi(n,"KELAS_KLAIM"),j=l?(l.DESKRIPSI?l.DESKRIPSI:null):null,k=m?(m.DESKRIPSI?m.DESKRIPSI:null):null,i=j?j+" - ":"";Ext.Array.each(b,function(r){var p=null;if(r.UTAMA==1){var o=a.getReferensi(r,"PENDAFTARAN"),q=(o.PENJAMIN)?o.PENJAMIN:null;m=(q.REFERENSI)?q.REFERENSI.KELAS:null,k=(m.DESKRIPSI)?m.DESKRIPSI:null,infoklas=k?k:"";p=i+""+infoklas}h+=c.replace("[FIELD]",(p)?p:i)})});return h==""?"Tanpa Asuransi / Umum":h}})},{xtype:"templatecolumn",flex:1,bind:{hidden:"{!listConfig.pasienInfo}"},tpl:new Ext.XTemplate('<div style="font-weight: bold; font-size: 12px; white-space:normal !important;">{[this.getFormatNorm(values.REFERENSI.PASIEN.NORM)]} </div>','<div style="font-size: 12px; white-space:normal !important;">{[values.REFERENSI.PASIEN.NAMA]}</div>')},{xtype:"templatecolumn",flex:1,align:"right",tpl:new Ext.XTemplate('<div style="font-weight: bold; font-size: 18px; white-space:normal !important;">{[this.getTotal(values)]} </div>',{getTotal:function(g){var p=Number(g.TOTAL),i=p,m=a.getReferensi(g,"PENJAMIN_TAGIHAN"),b=a.getReferensi(g,"DEPOSIT"),o=a.getReferensi(g,"PENGEMBALIAN_DEPOSIT"),d=a.getReferensi(g,"PIUTANG_PASIEN"),h=a.getReferensi(g,"PIUTANG_PERUSAHAAN"),f=a.getReferensi(g,"DISKON"),j=a.getReferensi(g,"DISKON_DOKTER"),c=a.getReferensi(g,"NON_TUNAI"),k=a.getReferensi(g,"SUBSIDI_TAGIHAN"),n=null,l=0,e=0;if(m){Ext.Array.each(m,function(q){l+=Number(q.TOTAL);if(q.PENJAMIN==2){n=q}})}if(n){if(n.NAIK_KELAS==1){i=Number(n.TOTAL_NAIK_KELAS)}if(n.NAIK_KELAS_VIP==1){i=Number(n.TOTAL_NAIK_KELAS);i+=Number(n.SELISIH_MINIMAL)}if(a.getPropertyConfig("9")=="TRUE"){if(n.NAIK_KELAS==1||n.NAIK_KELAS_VIP==1||n.NAIK_DIATAS_VIP==1){i=Number(n.TOTAL_NAIK_KELAS);e=0}}}i-=l;if(k){Ext.Array.each(k,function(q){i-=Number(q.TOTAL)})}if(b){Ext.Array.each(b,function(q){if(q.JENIS==1){i-=Number(q.TOTAL)}else{i+=Number(q.TOTAL)}})}if(o){Ext.Array.each(o,function(q){i+=Number(q.TOTAL)})}if(d){Ext.Array.each(d,function(q){i-=Number(q.TOTAL)})}if(h){Ext.Array.each(h,function(q){i-=Number(q.TOTAL)})}if(f){Ext.Array.each(f,function(q){i-=(Number(q.ADMINISTRASI)+Number(q.AKOMODASI)+Number(q.SARANA_NON_AKOMODASI)+Number(q.PARAMEDIS))})}if(j){Ext.Array.each(j,function(q){i-=Number(q.TOTAL)})}if(c){Ext.Array.each(c,function(q){i-=Number(q.TOTAL)})}return Ext.util.Format.number(i<0?0:i,"0,000")}})},{xtype:"widgetcolumn",text:"Status",align:"center",width:60,bind:{hidden:"{!listConfig.view}"},widget:{xtype:"fieldcontainer",defaults:{padding:2},items:[{xtype:"button",text:"View",action:0,margin:"0 1 0 0",handler:"onView"}]}}];a.callParent()},loadStore:function(a){if(a){if(a.NORM){a.REF=a.NORM;a.JENIS=1;a.STATUS=1;delete a.NORM}this.load(a)}},onBeforeLoad:function(c,b,a){c.setParams({REFERENSI:Ext.JSON.encode({Diskon:true,DiskonDokter:true,NonTunai:true,PenjaminTagihan:true,PiutangPasien:true,PiutangPerusahaan:true,Deposit:true,PengembalianDeposit:true,KwitansiPembayaran:true,SubsidiTagihan:true,TagihanPendaftaran:{REFERENSI:{Pendaftaran:{REFERENSI:{TujuanPasien:{REFERENSI:{Ruangan:true}},Penjamin:true}}}}})})}});Ext.define("pembayaran.tagihan.ListController",{extend:"Ext.app.ViewController",alias:"controller.tagihan-list",onView:function(a){var b=this,c=a.ownerCt.getWidgetRecord();b.getView().fireEvent("viewtagihan",c)},onSearch:function(){var b=this,a=b.getView();a.openDialog("Pencarian Tagihan",true,300,50,{xtype:"form",title:"Pencarian Nomor Tagihan",bodyPadding:5,items:[{xtype:"search-field",anchor:"100%"}]},function(e,d){var c=d.down("search-field");c.on("search",function(f,g){if(g.trim()!=""){a.setLoading(true);a.loadStore({ID:g});a.onAfterLoad=function(j,i,k,h){if(Ext.isArray(i)){if(i.length>0){d.close()}}}}});c.focus(false,100)})}});Ext.define("pembayaran.tagihan.Workspace",{extend:"com.Form",xtype:"workspace-tagihan",controller:"workspace-tagihan",viewModel:{data:{pasien:undefined,tagihan:undefined,allowBatalFinal:false},formulas:{getNamaLengkap:function(e){var d=e("pasien.GELAR_DEPAN")||"",f=e("pasien.GELAR_BELAKANG")||"";d=d==""?"":d+". ";f=f==""?"":", "+f;return d+e("pasien.NAMA")+f},getFormatNorm:function(d){var c=d("pasien.NORM")||0;if(c>0){return this.toFormatNorm(c)}return""},getFormatTagihan:function(e){var f=e("tagihan.ID")+"",d=f?f.substring(0,6)+"."+f.substring(6):"";return d},getInfoTanggal:function(c){var f=c("tagihan.TANGGAL"),e=f?Ext.Date.format(f,"d F Y H:i:s"):"";return e},isAllowBatalFinal:function(a){var c=a("tagihan.STATUS")==2,b=a("allowBatalFinal");if(!c){return false}return b}},toFormatNorm:function(d){var e=Ext.String.leftPad(d,8,"0"),f=Ext.String.insert(Ext.String.insert(Ext.String.insert(e,".",2),".",5),".",8);return f}},layout:"border",border:false,bind:{title:"Tagihan Pasien An. <b>{getNamaLengkap} - {getFormatNorm}</b>"},header:{itemPosition:1,items:[{xtype:"component",bind:{html:"<strong>No. Tagihan: {getFormatTagihan} / {getInfoTanggal}</strong>"},margin:"0 5 0 0"},{xtype:"button",iconCls:"x-fa fa-chain-broken",tooltip:"Batalkan Final",bind:{hidden:"{!isAllowBatalFinal}"},ui:"soft-red",handler:"onBatalFinal"},{xtype:"button",ui:"soft-asperages",iconCls:"x-fa fa-refresh",tooltip:"Perbarui Data",handler:"onReload"}]},bodyPadding:0,items:[{region:"center",xtype:"tagihan-links",reference:"listtagihanlinks",listeners:{tabchange:"onTabChange"}},{region:"east",title:"Info Tagihan",iconCls:"x-fa fa-list",split:true,collapsible:true,xtype:"tagihan-info",reference:"tagihandetail",listeners:{hitungtagihan:"onHitungTagihan"}}],load:function(d,g){var f=this,c=f.getViewModel(),b=f.down("tagihan-links"),a=b.getActiveTab(),h=f.app.xpriv("1208"),e=d.get("REFERENSI");c.set("pasien",g);c.set("tagihan",d);if(e){e.PASIEN=g}else{d.set("REFERENSI",{PASIEN:g})}if(a.notLoadLinks==undefined){b.load(d)}f.down("tagihan-info").load(d);c.set("allowBatalFinal",h)}});Ext.define("pembayaran.tagihan.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.workspace-tagihan",onReload:function(){var d=this,a=this.getView(),c=d.getViewModel(),b=c.get("tagihan"),e=c.get("pasien");a.setLoading(true);(new Ext.util.DelayedTask(function(){if(data.model){data.model.Tagihan.load(b.get("ID"),{callback:function(h,f,g){if(g){a.load(h,e)}a.setLoading(false)}})}})).delay(1500)},onTabChange:function(d,a){var c=this.getViewModel(),b=c.get("tagihan");if(a.loadRecord){a.loadRecord(b)}else{if(a.load){a.load(b)}}},onHitungTagihan:function(){this.onReload()},onBatalFinal:function(c){var f=this,a=f.getView(),e=f.getViewModel(),d=e.get("tagihan"),b=true;if(a.app){b=!a.app.xpriv("1208")}if(b){a.notifyMessage("Anda tidak memiliki Hak Akses untuk melakukan Pembatalan tagihan final!");return}Ext.Msg.show({title:"Pembatalan Tagihan Final",message:"Anda yakin ingin membatalkan tagihan final?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,animateTarget:c,fn:function(g){if(g==="yes"){a.openDialog("",true,100,50,{xtype:"pembatalan-tagihan-form",title:"Pembatalan Tagihan Final"},function(h,j){var i=j.down("pembatalan-tagihan-form");i.on("save",function(m,k,l){f.onReload();j.close()});i.createRecord({TAGIHAN:d.get("ID"),JENIS:1,TANGGAL:a.getSysdate()})})}}})}});Ext.define("pembayaran.tagihan.deposit.Form",{extend:"com.Form",xtype:"deposit-form",controller:"deposit-form",model:"data.model.Deposit",defaults:{allowBlank:false},items:[{xtype:"fieldcontainer",fieldLabel:"Tanggal",layout:{type:"hbox"},defaults:{allowBlank:false},items:[{name:"TANGGAL",reference:"tanggal",flex:1,xtype:"datefield",emptyText:"[Tanggal]",format:"d/m/Y",margin:"0 1 0 0",bind:{readOnly:"{formConfig.viewOnly}",minValue:"{formConfig.minDate}",minValue:"{formConfig.maxDate}"}},{name:"WAKTU",reference:"waktu",width:105,xtype:"timefield",emptyText:"[Jam:Mnt:Dtk]",format:"H:i:s",hideTrigger:true,bind:{readOnly:"{formConfig.viewOnly}"}}]},{xtype:"textfield",anchor:"100%",fieldLabel:"Nama",name:"NAMA",enforceMaxLength:true,maxLength:75,bind:{readOnly:"{formConfig.viewOnly}"},emptyText:"[ Nama ]"},{xtype:"numberfield",textAlign:"right",fieldLabel:"Jumlah",name:"TOTAL",emptyText:"[ Rp. ]",minValue:0,bind:{readOnly:"{formConfig.viewOnly}"},hideTrigger:true}],buttons:[{text:"Simpan",ui:"soft-blue",iconCls:"x-fa fa-save",handler:"onSimpan",bind:{hidden:"{!formConfig.simpan}"},tooltip:{text:"Simpan",mouseOffset:[0,-75]}},{text:"Reset",ui:"soft-red",iconCls:"x-fa fa-refresh",handler:"onReset",bind:{hidden:"{!formConfig.reset}"},tooltip:{text:"Reset",mouseOffset:[0,-75]}}],onLoadRecord:function(b,c){var a=b.down("[name=WAKTU]");a.setValue(c.get("TANGGAL"))},onBeforeGetRecord:function(b,d){var c=Ext.Date.clone(b.down("[reference=tanggal]").getValue()),a=b.down("[reference=waktu]").getValue();c.setHours(a.getHours());c.setMinutes(a.getMinutes());c.setSeconds(a.getSeconds());d.TANGGAL=c}});Ext.define("pembayaran.tagihan.deposit.FormController",{extend:"Ext.app.ViewController",alias:"controller.deposit-form",onSimpan:function(b){var c=this,a=c.getView();a.save(b,{},function(g,e,f){if(f){var d="Cetak Kwitansi";a.showMessageBox({title:d,message:"Anda ingin mencetak kwitansi ?",ui:"window-blue",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,defaultButton:"yes",animateTarget:b,fn:function(i){if(i==="yes"){var h="Word",j="docx",k=true,l=g.get("ID");a.showMessageBox({title:d,message:"Tekan tombol Yes/Ya utk cetak langsung<br/>Tekan tombol No/Tidak untuk Preview",ui:"window-cyan",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,defaultButton:"yes",animateTarget:b,fn:function(m){if(m!="yes"){h="Pdf";j="pdf";k=false}a.cetak({NAME:"pembayaran.CetakDeposit",TYPE:h,EXT:j,PARAMETER:{PID:l},REQUEST_FOR_PRINT:k,PRINT_NAME:"CetakKwitansi"},function(n){a.printPreview(d,n)})}})}c.onReset()}})}})},onReset:function(){var b=this,a=this.getView(),c=b.getViewModel().get("record");a.createRecord({TAGIHAN:c.get("TAGIHAN"),JENIS:c.get("JENIS"),TANGGAL:a.getSysdate(),TOTAL:0,STATUS:1});a.focus("NAMA")}});Ext.define("pembayaran.tagihan.deposit.List",{extend:"com.Grid",alias:"widget.deposit-list",controller:"deposit-list",viewModel:{data:{listConfig:{batal:true}},stores:{store:{type:"deposit-store"}}},border:false,columns:[{xtype:"rownumberer",text:"No",align:"left",width:60},{text:"Jenis Transaksi",dataIndex:"JENIS",width:120,renderer:"onRendererJenis"},{xtype:"datecolumn",text:"Tanggal",dataIndex:"TANGGAL",format:"d/m/Y H:i:s",width:140},{text:"Kasir",dataIndex:"OLEH",flex:1,renderer:"onRendererKasir"},{text:"Pembayar / Penerima",dataIndex:"NAMA",flex:1},{xtype:"numbercolumn",text:"Jumlah",dataIndex:"TOTAL",format:"0,00",align:"right",width:120},{xtype:"numbercolumn",text:"Saldo",format:"0,00",align:"right",width:120,renderer:"onRendererSaldo"},{xtype:"widgetcolumn",align:"center",text:"Status",width:110,hideable:false,hidden:true,widget:{xtype:"fieldcontainer",flex:1,defaults:{padding:2},layout:"fit",items:[{xtype:"button",text:"Batalkan",action:0,handler:"onBatal"},{xtype:"button",text:"Dibatalkan",action:1,ui:"soft-red"}]},onWidgetAttach:"onWidgetAttach"}]});Ext.define("pembayaran.tagihan.deposit.ListController",{extend:"Ext.app.ViewController",alias:"controller.deposit-list",onRendererJenis:function(d,b,c){var a=c.get("REFERENSI"),e=a?(a.JENIS?a.JENIS.DESKRIPSI:d):d;return e},onRendererKasir:function(e,c,d){var b=d.get("REFERENSI"),a=b?(b.PENGGUNA?b.PENGGUNA.NAMA:e):e;return a},onRendererSaldo:function(a,g,b,e,j,f){var d=0;for(var c=0;c<=e;c++){var h=f.getAt(c);if(h.get("JENIS")==1&&h.get("STATUS")==1){d+=h.get("TOTAL")}else{if(h.get("STATUS")==1){d-=h.get("TOTAL")}}}return Ext.util.Format.number(d,"0,00")},onWidgetAttach:function(f,a,e){var c=this,b=c.getViewModel().get("listConfig.batal");status=e.get("STATUS"),action0=a.down("[action=0]"),action1=a.down("[action=1]");action0.setHidden(status!=1);action1.setHidden(!(status==0));if(!b){action0.setHidden(true)}},onBatal:function(b){var d=this,a=d.getView(),e=b.ownerCt.getWidgetRecord();if(e){var c=e.get("REFERENSI"),f=c?(c.JENIS?c.JENIS.DESKRIPSI:""):"";e.showError=true;e.animateTarget=b;e.scope=d;a.showMessageBox({title:"Pembatalan "+f+" Deposit",message:"Anda yakin ingin membatalkan "+f+" Deposit ?",ui:"window-warning",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,defaultButton:"yes",animateTarget:b,fn:function(g){if(g==="yes"){e.set("STATUS",0);e.save({callback:function(j,h,i){if(i){a.notifyMessage("Pembatalan "+f+" Deposit berhasil")}else{j.set("STATUS",1)}d.getView().fireEvent("batal")}})}else{e.set("STATUS",1)}}})}}});Ext.define("pembayaran.tagihan.deposit.Workspace",{extend:"com.Form",xtype:"workspace-deposit",controller:"workspace-deposit",layout:"border",items:[{region:"north",layout:{type:"hbox",align:"stretch"},items:[{xtype:"deposit-form",title:"Penerimaan",flex:1,reference:"penerimaan",listeners:{save:"onReload"},margin:"0 5 0 0"},{xtype:"deposit-form",title:"Pengembalian",flex:1,reference:"pengembalian",listeners:{save:"onReload"}}]},{region:"center",xtype:"deposit-list",reference:"depositlist",listeners:{batal:"onReload"}}],onLoadRecord:function(c,g){var h=c.down("[reference=penerimaan]"),f=c.down("[reference=pengembalian]"),a=c.down("[reference=depositlist]"),b=g.get("STATUS")==1,e=c.app.xpriv("1202")?b:false,d=c.app.xpriv("1203")?b:false;h.setFormConfig({viewOnly:!e,simpan:e,reset:e,minDate:g.get("TANGGAL"),maxDate:c.getSysdate()});h.createRecord({TAGIHAN:g.get("ID"),JENIS:1,TANGGAL:c.getSysdate(),TOTAL:0,STATUS:1});f.setFormConfig({iewOnly:!d,simpan:d,reset:d,minDate:g.get("TANGGAL"),maxDate:c.getSysdate()});f.createRecord({TAGIHAN:g.get("ID"),JENIS:2,TANGGAL:c.getSysdate(),TOTAL:0,STATUS:1});h.focus("TANGGAL");a.setListConfig({paging:true,batal:b});a.load({TAGIHAN:g.get("ID")})}});Ext.define("pembayaran.tagihan.deposit.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.workspace-deposit",onReload:function(){var a=this.getReferences();a.depositlist.load();this.getView().fireEvent("load")}});Ext.define("pembayaran.tagihan.discount.Workspace",{extend:"com.Tab",xtype:"workspace-discount",controller:"workspace-discount",viewModel:{data:{tagihan:undefined}},defaults:{border:false,listeners:{save:"onSimpan"}},items:[{title:"Sarana",xtype:"discountsaranan-form",reference:"discountsarana"},{title:"Dokter",xtype:"workspace-discountdokter",reference:"discountdokter"}],load:function(c){var d=this,b=d.getViewModel(),a=d.getActiveTab();if(a){b.set("tagihan",c);if(a.load){a.load(c)}}},listeners:{tabchange:"onTabChange"}});Ext.define("pembayaran.tagihan.discount.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.workspace-discount",onTabChange:function(d,a){var c=this.getViewModel(),b=c.get("tagihan");if(a.load){a.load(b)}},onSimpan:function(a){this.getView().fireEvent("load")}});Ext.define("pembayaran.tagihan.discount.dokter.Form",{extend:"com.Form",xtype:"discountdokter-form",controller:"discountdokter-form",model:"data.model.DiskonDokter",defaults:{border:false,hideLabel:true,allowBlank:false,bind:{readOnly:"{formConfig.viewOnly}"}},header:{items:[{xtype:"button",ui:"soft-red",iconCls:"x-fa fa-file",bind:{hidden:"{!formConfig.simpan}"},margin:"0 1 0 0",handler:"onBaru",tooltip:{text:"Baru",mouseOffset:[0,-75]}},{xtype:"button",ui:"soft-blue",iconCls:"x-fa fa-save",bind:{hidden:"{!formConfig.simpan}"},handler:"onSimpan",tooltip:{text:"Simpan",mouseOffset:[0,-75]}}]},items:[{xtype:"dokter-combo",name:"DOKTER",anchor:"100%"},{xtype:"numberfield",anchor:"100%",hideTrigger:true,emptyText:"TOTAL",name:"TOTAL"}],onLoadRecord:function(c,d){var e=c.down("dokter-combo"),b=d.get("REFERENSI"),a=b?(b.DOKTER?Ext.create("data.model.Dokter",b.DOKTER):null):null;if(a){e.select(a);e.params.ID=a.get("ID");e.load()}}});Ext.define("pembayaran.tagihan.discount.dokter.FormController",{extend:"Ext.app.ViewController",alias:"controller.discountdokter-form",onBaru:function(){var b=this,a=b.getView(),c=a.getRecord();a.createRecord({TANGGAL:a.getSysdate(),TAGIHAN:c.get("ID"),STATUS:1});a.focus("DOKTER");a.fireEvent("baru")},onSimpan:function(b){var c=this,a=c.getView();a.setLoading(true);a.save(b,{},function(f,d,e){if(e){a.fireEvent("success",e);c.onBaru()}})}});Ext.define("pembayaran.tagihan.discount.dokter.List",{extend:"com.Grid",alias:"widget.discount-dokter-list",controller:"discount-dokter-list",viewModel:{stores:{store:{type:"diskon-dokter-store"}}},cls:"x-br-top",border:false,reference:"discountList",columns:[{xtype:"rownumberer",text:"No",align:"left",width:60},{text:"Nama Dokter",dataIndex:"DOKTER",flex:1,renderer:"onRendereNama"},{xtype:"numbercolumn",text:"Total",dataIndex:"TOTAL",flex:1,format:"0,00",align:"right"},{xtype:"datecolumn",text:"Tanggal",dataIndex:"TANGGAL",flex:1,format:"d-m-Y H:i:s",align:"center"}]});Ext.define("pembayaran.tagihan.discount.dokter.ListController",{extend:"Ext.app.ViewController",alias:"controller.discount-dokter-list",onRendereNama:function(e,c,d){var a=d.get("REFERENSI"),b=a?(a.DOKTER?a.DOKTER.NAMA:""):"";return b}});Ext.define("pembayaran.tagihan.discount.dokter.Workspace",{extend:"com.Form",xtype:"workspace-discountdokter",controller:"workspace-discountdokter",layout:"border",items:[{region:"east",title:"Form",width:300,split:true,collapsible:true,iconCls:"x-fa fa-file-o",xtype:"discountdokter-form",border:false,reference:"discountform",listeners:{save:"onSuccess",baru:"onBaru"}},{region:"center",title:"List",iconCls:"x-fa fa-server",xtype:"discount-dokter-list",border:false,reference:"discountlist",listeners:{select:"onSelect"}}],load:function(f){var d=this,e=this.down("discount-dokter-list"),c=this.down("discountdokter-form");if(f){var a=f.get("STATUS")==1,b=d.app.xpriv("1207")?a:false;c.setFormConfig({viewOnly:!b,simpan:b});e.loadStore({TAGIHAN:f.get("ID")});c.createRecord({TANGGAL:d.getSysdate(),TAGIHAN:f.get("ID"),STATUS:1})}}});Ext.define("pembayaran.tagihan.discount.dokter.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.workspace-discountdokter",onSuccess:function(e){var c=this,a=c.getView(),b=c.getReferences(),d=b.discountlist;d.reload();a.fireEvent("save",e)},onBaru:function(){var b=this,a=b.getReferences();a.discountlist.getSelectionModel().deselect(a.discountlist.getSelection())},onSelect:function(b,d){var c=this,a=c.getReferences();if(d){a.discountform.loadRecord(d)}}});Ext.define("pembayaran.tagihan.discount.sarana.Form",{extend:"com.Form",xtype:"discountsaranan-form",controller:"discountsaranan-form",viewModel:{stores:{store:{type:"diskon-store"}},formulas:{getTotal:function(b){var f=b("record.ADMINISTRASI"),a=b("record.AKOMODASI"),c=b("record.SARANA_NON_AKOMODASI"),d=b("record.PARAMEDIS"),e=f+a+c+d;return e}}},model:"data.model.Diskon",border:false,fieldDefaults:{labelAlign:"top"},layout:{type:"vbox",align:"stretch"},title:"Form",iconCls:"x-fa fa-file-o",border:false,items:[{layout:"hbox",defaults:{flex:1,margin:"2 2 2 2",bind:{readOnly:"{formConfig.viewOnly}"},border:false},bodyPadding:10,border:false,items:[{xtype:"numberfield",hideTrigger:true,reference:"administrasi",fieldLabel:"ADMINISTRASI",name:"ADMINISTRASI",bind:{value:"{record.ADMINISTRASI}"}},{xtype:"numberfield",hideTrigger:true,reference:"akomodasi",fieldLabel:"AKOMODASI",name:"AKOMODASI",bind:{value:"{record.AKOMODASI}"}}]},{layout:"hbox",defaults:{flex:1,margin:"2 2 2 2",border:false,bind:{readOnly:"{formConfig.viewOnly}"}},bodyPadding:10,border:false,items:[{xtype:"numberfield",hideTrigger:true,reference:"sarana",fieldLabel:"SARANA NON AKOMODASI",name:"SARANA_NON_AKOMODASI",bind:{value:"{record.SARANA_NON_AKOMODASI}"}},{xtype:"numberfield",hideTrigger:true,reference:"paramedis",fieldLabel:"PARAMEDIS",name:"PARAMEDIS",bind:{value:"{record.PARAMEDIS}"}}]},{xtype:"headervalue",fontSize:"25px",title:"Total Diskon:",paddingText:"7px 0 0 0",height:65,reference:"total",bind:{value:"{getTotal}"}}],buttons:[{text:"Simpan",ui:"soft-blue",iconCls:"x-fa fa-save",handler:"onSimpan",bind:{hidden:"{!formConfig.simpan}"},tooltip:{text:"Simpan",mouseOffset:[0,-75]}}],load:function(e){var f=this,d=f.getViewModel(),b=d.get("store");if(e){var a=e.get("STATUS")==1,c=f.app.xpriv("1207")?a:false;f.setFormConfig({viewOnly:!c,simpan:c});b.queryParams={TAGIHAN:e.get("ID")},b.load({callback:function(j,g,i){if(i){f.loadRecord(j[0])}else{var h={TAGIHAN:e.get("ID"),TANGGAL:f.getSysdate(),STATUS:1};f.createRecord(h)}}})}}});Ext.define("pembayaran.tagihan.discount.sarana.FormController",{extend:"Ext.app.ViewController",alias:"controller.discountsaranan-form",onSimpan:function(b){var c=this,a=c.getView();a.save(b)}});Ext.define("pembayaran.tagihan.discount.tenagamedis.List",{extend:"com.Grid",xtype:"discount-tenagamedis-list",controller:"discount-tenagamedis-list",viewModel:{data:{listConfig:{add:false}},stores:{store:{type:"discount-tenagamedis-store"}}},header:{items:[{xtype:"search-field",emptyText:"[Cari Tenaga Medis]",flex:1,listeners:{search:"onSearch",clear:"onClear"}},{xtype:"button",iconCls:"x-fa fa-plus",tooltip:"Tambah Baru",margin:"0 0 0 1",handler:"onAdd",bind:{hidden:"{!listConfig.add}"}}]},actions:{edit:{iconCls:"x-fa fa-pencil-square-o",tooltip:"Edit",handler:"onEdit"}},columns:[{xtype:"rownumberer",text:"No",width:60},{xtype:"templatecolumn",text:"Tindakan",align:"left",menuDisabled:true,sortable:false,flex:1,tpl:'<div style="white-space:normal !important;">{REFERENSI.TINDAKAN_MEDIS.REFERENSI.TINDAKAN.NAMA}</div>'},{xtype:"templatecolumn",text:"Jenis",align:"left",menuDisabled:true,sortable:false,flex:1,tpl:'<div style="white-space:normal !important;">{REFERENSI.JENIS.DESKRIPSI}</div>'},{xtype:"templatecolumn",text:"Nama",align:"left",menuDisabled:true,sortable:false,bind:{hidden:"{listConfig.phoneMode}"},flex:1,tpl:'<div style="white-space:normal !important;">{REFERENSI.TENAGA_MEDIS.NAMA}</div>'},{xtype:"datecolumn",text:"Tanggal",dataIndex:"TANGGAL",format:"d-m-Y H:i:s",menuDisabled:true,sortable:false,align:"center",width:140},{xtype:"templatecolumn",text:"Status",align:"left",menuDisabled:true,sortable:false,width:150,tpl:'<div style="white-space:normal !important;">{REFERENSI.STATUS.DESKRIPSI}</div>'},{text:"#",xtype:"actioncolumn",align:"center",menuDisabled:true,sortable:false,width:50,items:["@edit"]}]});Ext.define("pembayaran.tagihan.discount.tenagamedis.ListController",{extend:"Ext.app.ViewController",alias:"controller.discount-tenagamedis-list"});Ext.define("pembayaran.tagihan.discount.tenagamedis.Workspace",{extend:"com.Form",xtype:"workspace-discountenagamedis",controller:"workspace-discountenagamedis",layout:"fit",items:[{title:"Daftar Diskon",iconCls:"x-fa fa-list",xtype:"discount-tenagamedis-list"}],load:function(d){var b=this,c=this.down("discount-tenagamedis-list");if(d){var a=d.get("STATUS")==1;c.loadStore({TAGIHAN:d.get("ID")})}}});Ext.define("pembayaran.tagihan.discount.tenagamedis.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.workspace-discountenagamedis"});Ext.define("pembayaran.tagihan.gabung.Workspace",{extend:"com.Form",alias:"widget.workspace-gabung-tagihan",controller:"workspace-gabung-tagihan",model:"data.model.GabungTagihan",layout:{type:"hbox",align:"stretch"},items:[{title:"Sumber",xtype:"tagihan-list",reference:"sumber",flex:1},{xtype:"title",iconCls:"x-fa fa-arrow-right",style:"font-size: 30px",textAlign:"center",padding:"0 0 0 13",width:50},{title:"Tujuan",xtype:"tagihan-list",reference:"tujuan",flex:1}],buttons:[{text:"Gabungkan",handler:"onGabungkan"}],onLoadRecord:function(h,c){var i=h.down("[reference=sumber]"),f=h.down("[reference=tujuan]"),a=c.get("REFERENSI")?c.get("REFERENSI"):null,d=a?(a.DARI?a.DARI:null):null,g=a?(a.KE?a.KE:null):null,b={view:false,pasienInfo:true};if(d){i.setListConfig(b);i.getStore().loadData([d])}if(g){f.setListConfig(b);f.getStore().loadData([g])}else{var e=f.getHeader();e.addTool({type:"search",callback:"onSearch"});f.setListConfig(b)}}});Ext.define("pembayaran.tagihan.gabung.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.workspace-gabung-tagihan",onGabungkan:function(d){var e=this,a=e.getView(),b=e.getReferences(),f=a.getRecord();if(b.tujuan.getStore().getCount()==0){a.notifyMessage("Anda memilih tujuan tagihan","danger-blue");return}if(b.sumber.getStore().getCount()>0&&b.tujuan.getStore().getCount()>0){var g=b.sumber.getStore().getAt(0),c=b.tujuan.getStore().getAt(0);if(g.get("ID")==c.get("ID")){a.notifyMessage("ID Tagihan sumber & tujuan tidak boleh sama","danger-blue");return}f.set("KE",c.get("ID"))}Ext.Msg.show({title:"Penggabungan Tagihan",message:"Anda yakin ingin melakukan penggabungan tagihan?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,animateTarget:d,fn:function(h){if(h==="yes"){delete f.data.REFERENSI;a.setLoading(true);a.save({success:"Tagihan telah digabungkan"})}}})}});Ext.define("pembayaran.tagihan.kwitansi.Form",{extend:"com.Form",xtype:"kwitansi-form",controller:"kwitansi-form",title:"Form Kwitansi",model:"data.model.KwitansiPembayaran",defaultType:"textfield",border:false,viewModel:{data:{params:undefined}},defaults:{enforceMaxLength:true,readOnly:true,anchor:"100%",allowBlank:false,bind:{readOnly:"{formConfig.viewOnly}"},margin:"0 0 1 0"},header:{items:[{xtype:"button",iconCls:"x-fa fa-print",hidden:true,bind:{hidden:"{!formConfig.cetak}"},ui:"soft-cyan",handler:"onCetak"}]},items:[{emptyText:"[ No. Kwitansi ]",name:"NOMOR",maxLength:15},{emptyText:"[ Nama Pembayar ]",name:"NAMA",maxLength:75}],setParamReport:function(c){var b=this,a=b.getViewModel();if(c){a.set("params",c)}}});Ext.define("pembayaran.tagihan.kwitansi.FormController",{extend:"Ext.app.ViewController",alias:"controller.kwitansi-form",onCetak:function(b){var d=this,a=d.getView(),c=d.getViewModel();a.save(b,{},function(k,h,j){if(j){var e="Word",g="docx",i=true,f="Cetak Kwitansi";a.showMessageBox({title:f,message:"Tekan tombol Yes/Ya utk cetak langsung<br/>Tekan tombol No/Tidak untuk Preview",ui:"window-warning",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,defaultButton:"yes",animateTarget:b,fn:function(m){if(m!="yes"){e="Pdf";g="pdf";i=false}var o={PTAGIHAN:k.get("TAGIHAN"),PJENIS:1},l=c.get("params"),n="pembayaran.CetakKwitansi";if(l){n=l.name;o=l.params}a.cetak({NAME:n,TYPE:e,EXT:g,PARAMETER:o,REQUEST_FOR_PRINT:i,PRINT_NAME:"CetakKwitansi"},function(p){a.printPreview(f,p)});a.fireEvent("cetak",k)}})}})}});Ext.define("pembayaran.tagihan.monitoring.Grid",{extend:"com.Grid",xtype:"pembayaran-tagihan-monitoring-grid",controller:"pembayaran-tagihan-monitoring-grid",viewModel:{stores:{store:{type:"tagihan-store"}},data:{listConfig:{paging:true}}},title:"Daftar Tagihan",ui:"panel-purple",iconCls:"fas fa-money",header:{height:40,items:[{xtype:"search-field",emptyText:"[NO RM]",listeners:{search:"onSearch",clear:"onClear"}}]},hideHeaders:true,initComponent:function(){var a=this;a.columns=[{xtype:"templatecolumn",text:"Daftar Tagihan",flex:1,tpl:new Ext.XTemplate('<div style="font-weight: bold; font-size: 12px; white-space:normal !important;">{ID} - {[this.tanggalFormat(values.TANGGAL)]}</div>','<div style="font-weight: bold; font-size: 12px; white-space:normal !important;">No.RM: {REF}</div>',"{[this.infoPendaftaranTagihan(values)]}","{[this.infoPenjamin(values)]}",{infoPendaftaranTagihan:function(d){var e=a.getReferensi(d,"TAGIHAN_PENDAFTARAN"),c=e?e:[],b='<div style="font-size: 12px; white-space:normal !important;">[FIELD]</div>',f="";Ext.Array.each(c,function(k){var i=a.getReferensi(k,"PENDAFTARAN"),g=i?(i.TUJUAN?i.TUJUAN:null):null,h=i?(i.REFERENSI?a.getReferensi(i,"PASIEN"):null):null,j=g?"<b>"+a.getReferensi(g,"RUANGAN","DESKRIPSI")+"</b>":"";if(i){j+=" / "+(h?h.NAMA+" ("+h.NORM+")":"");f+=b.replace("[FIELD]",j)}});return f},infoPenjamin:function(f){var g=a.getReferensi(f,"PENJAMIN_TAGIHAN"),d=a.getReferensi(f,"TAGIHAN_PENDAFTARAN"),e=g?g:[],b=d?d:[],c='<div style="font-size: 12px; white-space:normal !important;">[FIELD]</div>',h="";Ext.Array.each(e,function(n){var l=a.getReferensi(n,"PENJAMIN"),m=a.getReferensi(n,"KELAS_KLAIM"),j=l?(l.DESKRIPSI?l.DESKRIPSI:null):null,k=m?(m.DESKRIPSI?m.DESKRIPSI:null):null,i=j?j+" - ":"";Ext.Array.each(b,function(r){var p=null;if(r.UTAMA==1){var o=a.getReferensi(r,"PENDAFTARAN"),q=(o.PENJAMIN)?o.PENJAMIN:null;m=(q.REFERENSI)?q.REFERENSI.KELAS:null,k=(m.DESKRIPSI)?m.DESKRIPSI:null,infoklas=k?k:"";p=i+""+infoklas}h+=c.replace("[FIELD]",(p)?p:i)})});return h==""?"Tanpa Asuransi / Umum":h}})},{xtype:"templatecolumn",flex:1,text:"Total",align:"right",tpl:new Ext.XTemplate('<div style="font-weight: bold; font-size: 18px; white-space:normal !important;">Rp. {[this.getTotal(values)]} </div>',{getTotal:function(g){var p=Number(g.TOTAL),i=p,m=a.getReferensi(g,"PENJAMIN_TAGIHAN"),b=a.getReferensi(g,"DEPOSIT"),o=a.getReferensi(g,"PENGEMBALIAN_DEPOSIT"),d=a.getReferensi(g,"PIUTANG_PASIEN"),h=a.getReferensi(g,"PIUTANG_PERUSAHAAN"),f=a.getReferensi(g,"DISKON"),j=a.getReferensi(g,"DISKON_DOKTER"),c=a.getReferensi(g,"NON_TUNAI"),k=a.getReferensi(g,"SUBSIDI_TAGIHAN"),n=null,l=0,e=0;if(m){Ext.Array.each(m,function(q){l+=Number(q.TOTAL);if(q.PENJAMIN==2){n=q}})}if(n){if(n.NAIK_KELAS==1){i=Number(n.TOTAL_NAIK_KELAS)}if(n.NAIK_KELAS_VIP==1){i=Number(n.TOTAL_NAIK_KELAS);i+=Number(n.SELISIH_MINIMAL)}if(a.getPropertyConfig("9")=="TRUE"){if(n.NAIK_KELAS==1||n.NAIK_KELAS_VIP==1||n.NAIK_DIATAS_VIP==1){i=Number(n.TOTAL_NAIK_KELAS);e=0}}}i-=l;if(k){Ext.Array.each(k,function(q){i-=Number(q.TOTAL)})}if(b){Ext.Array.each(b,function(q){if(q.JENIS==1){i-=Number(q.TOTAL)}else{i+=Number(q.TOTAL)}})}if(o){Ext.Array.each(o,function(q){i+=Number(q.TOTAL)})}if(d){Ext.Array.each(d,function(q){i-=Number(q.TOTAL)})}if(h){Ext.Array.each(h,function(q){i-=Number(q.TOTAL)})}if(f){Ext.Array.each(f,function(q){i-=(Number(q.ADMINISTRASI)+Number(q.AKOMODASI)+Number(q.SARANA_NON_AKOMODASI)+Number(q.PARAMEDIS))})}if(j){Ext.Array.each(j,function(q){i-=Number(q.TOTAL)})}if(c){Ext.Array.each(c,function(q){i-=Number(q.TOTAL)})}return Ext.util.Format.number(i<0?0:i,"0,000")}})},{xtype:"widgetcolumn",align:"center",width:60,widget:{xtype:"fieldcontainer",defaults:{padding:2},items:[{xtype:"button",text:"View",ui:"soft-red",action:0,margin:"0 1 0 0",handler:"onViewTagihan"}]}}];a.callParent(arguments)},loadStore:function(){var a=this.getParams();if(!a.JENIS){this.setParams({STATUS:1,JENIS:1,TOTAL:1})}this.load()},onBeforeLoad:function(c,b,a){c.setParams({REFERENSI:Ext.JSON.encode({Diskon:true,DiskonDokter:true,NonTunai:true,PenjaminTagihan:true,PiutangPasien:true,PiutangPerusahaan:true,Deposit:true,PengembalianDeposit:true,KwitansiPembayaran:true,SubsidiTagihan:true,TagihanPendaftaran:{REFERENSI:{Pendaftaran:{REFERENSI:{TujuanPasien:{REFERENSI:{Ruangan:true}},Penjamin:true,Pasien:{KeluargaPasien:false,KIP:false,KAP:false,KontakPasien:false,TempatLahir:false,Referensi:false}}}}}})})}});Ext.define("pembayaran.tagihan.monitoring.GridController",{extend:"Ext.app.ViewController",alias:"controller.pembayaran-tagihan-monitoring-grid",query:"",privates:{cari:function(){var d=this,a=d.getView(),c=a.getStore(),b=a.down("pagingtoolbar");if(d.query==""){delete c.queryParams.REF}else{a.setParams({REF:d.query})}if(b){b.moveFirst()}else{a.load()}}},onSearch:function(a,b){this.query=b;this.cari()},onClear:function(a){this.query="";this.cari()},onViewTagihan:function(b){var d=this,c=d.getViewModel(),e=b.ownerCt.getWidgetRecord(),a=d.getView();a.openDialog("",true,0,0,{xtype:"workspace-tagihan",ui:"panel-cyan",showCloseButton:true},function(f,g){wrksp=g.down("workspace-tagihan");a.setLoading(true);data.model.Pasien.load(e.get("REF"),{success:function(h,i){a.setLoading(false);wrksp.load(e,h)}})})}});Ext.define("pembayaran.tagihan.nontunai.Form",{extend:"com.Form",xtype:"pembayaran-tagihan-nontunai-form",controller:"pembayaran-tagihan-nontunai-form",model:"data.model.Tagihan",viewModel:{stores:{layananstore:{type:"referensi-store"}}},ui:"panel-black",jenis:0,title:"Transaksi Non Tunai",titleFieldConfig:{},fullscreenEnabled:true,menuConfig:{enabled:true,width:230,buttonConfig:{}},fullscreenConfig:{},header:{items:[{}]},onBeforeCallParentInitComponent:function(b){var a=null;b.items.forEach(function(c){if(c.reference){if(c.reference=="contentitem"){a=c}}});if(a){a.items={xtype:"fieldcontainer",layout:"border",defaultType:"fieldcontainer",items:[{region:"center",layout:{type:"vbox",align:"stretch"},defaultType:"fieldcontainer",items:[{layout:{type:"hbox",align:"stretch"},defaults:{padding:0,labelAlign:"top",enterFocus:true},items:[{xtype:"pembayaran-penyedia-layanan-combo",fieldLabel:"Penyedia",params:{STATUS_ID:1},flex:1,forceSelection:false,reference:"layananpenyediacombo",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">','<div"><strong>{REFERENSI.PENYEDIA.NAMA}</strong></div>',"</div>","</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{REFERENSI.PENYEDIA.NAMA}","</tpl>"),listeners:{select:"onSelectPenyedia"}}]},{layout:"fit",flex:1,reference:"container-penyedia"}]},{xtype:"pembayaran-pembayarantagihan-list",region:"east",title:"Daftar Non Tunai",ui:"panel-cyan",collapsible:true,split:true,width:250}]}}},onNavSelectionChange:function(k,e){var j=this,d=j.getViewModel(),c=j.down("[reference=layananpenyediacombo]"),b=j.down("pembayaran-pembayarantagihan-list"),a=j.getController(),g=e.get("text"),f=j.titleField.getText(),i=d.get("record"),h=e.get("record")||{};if(e){f=f.indexOf("-")<0?f:f.substring(0,f.indexOf("-")).trim();j.titleField.setText(f+" - "+g);c.setFieldLabel(h.get("TEKS"));c.setEmptyText("Pilih "+h.get("TEKS"));c.removeDataStore();c.setQueryParams({JENIS_LAYANAN_ID:h.get("ID")});c.load();c.select(null);a.onSelectPenyedia(c,null);c.focus();b.setParams({TAGIHAN:i.get("ID"),JENIS_LAYANAN_ID:h.get("ID"),NOT:Ext.JSON.encode({STATUS:[0]})});b.load()}},onLoadRecord:function(b,e){var a=b.getViewModel(),d=a.get("layananstore"),c=[];d.setQueryParams({JENIS:172,STATUS:1});d.load(function(g,f,h){if(h){g.forEach(function(j,i){c.push({text:j.get("DESKRIPSI"),record:j,leaf:true})});b.setMenus(c)}})}});Ext.define("pembayaran.tagihan.nontunai.FormController",{extend:"Ext.app.ViewController",alias:"controller.pembayaran-tagihan-nontunai-form",onSelectPenyedia:function(b,h){var d=this,a=d.getView(),c=d.getViewModel(),g=a.down("[reference=container-penyedia]");g.suspendLayouts();g.removeAll();if(h){if(h.get("DRIVER")){try{var i=g.add(Ext.create(h.get("DRIVER"),{}));i.setJenis(a.jenis);i.setLayananPenyedia(h);i.loadRecord(c.get("record"));i.on("load",function(){a.fireEvent("load")})}catch(f){a.notifyMessage("Driver layanan tidak ditemukan / belum terdaftar / belum diberikan hak akses")}}}g.resumeLayouts();g.updateLayout()}});Ext.define("pembayaran.tagihan.nontunai.Workspace",{extend:"com.Form",xtype:"workspace-nontunai",controller:"workspace-nontunai",model:"data.model.Tagihan",layout:"fit",bodyPadding:0,items:[{xtype:"pembayaran-tagihan-nontunai-form",listeners:{load:"onLoad"}}],onLoadRecord:function(b,c){var a=b.down("pembayaran-tagihan-nontunai-form");a.jenis=b.jenis;a.loadRecord(c)}});Ext.define("pembayaran.tagihan.nontunai.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.workspace-nontunai",onLoad:function(){this.getView().fireEvent("load")}});Ext.define("pembayaran.tagihan.nontunai.bank.transfer.Form",{extend:"com.Form",xtype:"pembayaran-tagihan-nontunai-bank-transfer-form",controller:"pembayaran-tagihan-nontunai-bank-transfer-form",model:"pembayaran.pembayarantagihan.Model",layout:{type:"hbox",align:"stretch"},defaultType:"fieldcontainer",items:[{flex:1,layout:{type:"vbox",align:"stretch"},defaults:{bind:{readOnly:"{formConfig.viewOnly}"}},items:[{xtype:"master-rekening-combo",params:{STATUS:1},name:"REKENING_ID",selectOnTab:true,editable:true,allowBlank:false,margin:"2 2 1 1",fieldLabel:"Rekening RS",typeAhead:true,emptyText:"[Rekening RS]"},{xtype:"textfield",fieldLabel:"Rekening Penyetor",name:"NO_ID",emptyText:"[ Rekening Penyetor ]",enforceMaxLength:true,maxLength:25},{xtype:"textfield",fieldLabel:"Nama Penyetor",name:"NAMA",emptyText:"[ Nama Penyetor ]",stripCharsRe:new RegExp("[^a-zA-Z0-9.\\s]"),allowBlank:false,enforceMaxLength:true,maxLength:135},{xtype:"referensi-combo",params:{JENIS:16,STATUS:1},name:"BANK_ID",selectOnTab:true,editable:true,allowBlank:false,margin:"2 2 1 1",fieldLabel:"Bank Penyetor",typeAhead:true,emptyText:"[ Bank Penyetor ]"}]},{flex:1,layout:{type:"vbox",align:"stretch"},margin:"0 0 0 20",items:[{xtype:"textfield",fieldLabel:"Nomor Referensi",name:"REF",bind:{readOnly:"{formConfig.viewOnly}"},emptyText:"[ Nomor Referensi ]",allowBlank:false},{xtype:"numberfield",textAlign:"right",fieldLabel:"Total",name:"TOTAL",emptyText:"[ Rp. ]",minValue:0,hideTrigger:true,bind:{readOnly:"{formConfig.viewOnly}"},allowBlank:false},{xtype:"fieldcontainer",fieldLabel:"Tanggal",layout:{type:"hbox"},defaults:{allowBlank:false},items:[{name:"TANGGAL",reference:"tanggal",flex:1,xtype:"datefield",emptyText:"[Tanggal]",format:"d/m/Y",margin:"0 1 0 0",bind:{readOnly:"{formConfig.viewOnly}",minValue:"{formConfig.minDate}",maxValue:"{formConfig.maxDate}"}},{name:"WAKTU",reference:"waktu",width:105,xtype:"timefield",emptyText:"[Jam:Mnt:Dtk]",format:"H:i:s",hideTrigger:true,bind:{readOnly:"{formConfig.viewOnly}"}}]}]}],buttons:[{text:"Simpan",ui:"soft-blue",iconCls:"x-fa fa-save",handler:"onSimpan",bind:{hidden:"{!formConfig.simpan}"},tooltip:{text:"Simpan",mouseOffset:[0,-75]}},{text:"Reset",ui:"soft-red",iconCls:"x-fa fa-refresh",handler:"onReset",bind:{hidden:"{!formConfig.reset}"},tooltip:{text:"Reset",mouseOffset:[0,-75]}}],onLoadRecord:function(c,g){var e=c.down("master-rekening-combo"),d=c.down("referensi-combo"),b=c.down("[name=WAKTU]"),a=c.getViewModel(),f=a.get("formConfig");b.setValue(g.get("TANGGAL"));d.load();e.setQueryParams({BANK:f.penyedia.REFERENSI_ID,JENIS:1,STATUS:1});e.load()},onBeforeGetRecord:function(b,e){var d=Ext.Date.clone(b.down("[reference=tanggal]").getValue()),a=b.down("[reference=waktu]").getValue(),f=b.app,c=f?(f.trxksr?f.trxksr:0):0;d.setHours(a.getHours());d.setMinutes(a.getMinutes());d.setSeconds(a.getSeconds());e.TANGGAL=d;e.TRANSAKSI_KASIR_NOMOR=c}});Ext.define("pembayaran.tagihan.nontunai.bank.transfer.FormController",{extend:"Ext.app.ViewController",alias:"controller.pembayaran-tagihan-nontunai-bank-transfer-form",onReset:function(){var a=this;view=a.getView(),rec=a.getViewModel().get("record");view.createRecord({TAGIHAN:rec.get("TAGIHAN"),JENIS:rec.get("JENIS"),PENYEDIA_ID:rec.get("PENYEDIA_ID"),JENIS_LAYANAN_ID:rec.get("JENIS_LAYANAN_ID"),TOTAL:0,TANGGAL:view.getSysdate(),STATUS:2});view.focus("NO_ID")},onSimpan:function(c){var b=this,a=b.getView(),e=a.app,d=e?(e.trxksr?e.trxksr:false):false;if(!d){a.notifyMessage("Anda belum membuka transaksi kasir / open cashier","danger-blue");return}a.save(c,{},function(h,f,g){b.onReset()})}});Ext.define("pembayaran.tagihan.nontunai.bank.transfer.Grid",{extend:"com.Grid",xtype:"pembayaran-tagihan-nontunai-bank-transfer-grid",controller:"pembayaran-tagihan-nontunai-bank-transfer-grid",viewModel:{stores:{store:{type:"pembayaran-pembayarantagihan-store"}},data:{listConfig:{batal:true}}},border:false,cls:"x-br-top",columns:[{xtype:"rownumberer",text:"No",align:"left",width:60},{text:"Nomor",width:90,dataIndex:"NOMOR"},{text:"Bank RS",width:200,dataIndex:"PENYEDIA_ID",renderer:"onRendererPenyedia"},{text:"Rekening RS",width:200,dataIndex:"REKENING_ID",renderer:"onRendererRekening"},{text:"Penyetor",flex:2,columns:[{text:"Nama",dataIndex:"NAMA",flex:1},{text:"No. Rekening",width:150,dataIndex:"NO_ID"},{text:"Bank",width:200,dataIndex:"BANK_ID",renderer:"onRendererBank"}]},{text:"Nomor Referensi",width:150,dataIndex:"REF"},{xtype:"numbercolumn",text:"Total",format:"0,00",align:"right",width:120,dataIndex:"TOTAL"},{xtype:"widgetcolumn",align:"center",text:"Action",width:110,bind:{hidden:"{!listConfig.status}"},widget:{xtype:"fieldcontainer",flex:1,defaults:{padding:2},layout:"fit",items:[{xtype:"button",text:"Batalkan",action:0,handler:"onBatal"},{xtype:"button",text:"Dibatalkan",action:1,ui:"soft-red"}]},onWidgetAttach:"onWidgetAttach"},{text:"Kwitansi",width:110,xtype:"widgetcolumn",widget:{xtype:"button",text:"Cetak",listeners:{click:"onCetakKwitansi"}}}]});Ext.define("pembayaran.tagihan.nontunai.bank.transfer.GridController",{extend:"Ext.app.ViewController",alias:"controller.pembayaran-tagihan-nontunai-bank-transfer-grid",onRendererPenyedia:function(e,c,d){var b=d.get("REFERENSI"),a=b?(b.PENYEDIA?b.PENYEDIA.NAMA:""):"";return a},onRendererRekening:function(e,c,d){var b=d.get("REFERENSI"),a=b?(b.REKENING?b.REKENING.NOMOR+"<br/>"+b.REKENING.PEMILIK:""):"";return a},onRendererBank:function(e,c,d){var b=d.get("REFERENSI"),a=b?(b.BANK?b.BANK.DESKRIPSI:""):"";return a},onWidgetAttach:function(f,a,e){var c=this,b=c.getViewModel().get("listConfig.batal");status=e.get("STATUS"),action0=a.down("[action=0]"),action1=a.down("[action=1]");action0.setHidden(status==0);action1.setHidden(!(status==0));if(!b){action0.setHidden(true)}},onBatal:function(c){var e=this,b=e.getView(),f=c.ownerCt.getWidgetRecord();if(f){var d=f.get("REFERENSI"),g=d?(d.JENIS?d.JENIS.DESKRIPSI:""):"",a=f.get("STATUS");f.showError=true;f.animateTarget=c;f.scope=e;b.showMessageBox({title:"Pembatalan Transfer",message:"Anda yakin ingin membatalkan Transaksi Transfer ?",ui:"window-warning",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,defaultButton:"no",animateTarget:c,fn:function(h){if(h==="yes"){f.set("STATUS",0);f.save({callback:function(k,i,j){if(j){b.notifyMessage("Pembatalan Transfer berhasil")}else{k.set("STATUS",a)}e.getView().fireEvent("batal")}})}else{f.set("STATUS",a)}}})}},onCetakKwitansi:function(f){var e=this,b=e.getView(),c=e.getReferences(),d=b.getPropertyConfig("37")=="TRUE",a=f.getWidgetRecord();b.openDialog("",true,100,50,{xtype:"kwitansi-form",title:"Kwitansi",ui:"panel-cyan",showCloseButton:true},function(g,h){kw=h.down("kwitansi-form");kw.setFormConfig({hidden:true,cetak:true});kw.createRecord({TAGIHAN:a.get("TAGIHAN"),TUNAI:0,STATUS:1});kw.setParamReport({name:"pembayaran.CetakKwitansiTransfer",params:{PNOMOR:a.get("NOMOR")}});kw.on("cetak",function(i){h.close()})})}});Ext.define("pembayaran.tagihan.nontunai.bank.transfer.Workspace",{extend:"com.Form",xtype:"pembayaran-tagihan-nontunai-bank-transfer-workspace",controller:"pembayaran-tagihan-nontunai-bank-transfer-workspace",viewModel:{data:{tagihan:undefined}},viewModel:{data:{layananPenyedia:undefined,jenis:undefined}},layout:{type:"vbox",align:"stretch"},items:[{xtype:"pembayaran-tagihan-nontunai-bank-transfer-form",reference:"transferform",listeners:{save:"onReload"}},{title:"Daftar Transfer",xtype:"pembayaran-tagihan-nontunai-bank-transfer-grid",flex:1,reference:"transferlist",listeners:{select:"onSelect",batal:"onReload"}}],setJenis:function(b){var a=this.getViewModel();a.set("jenis",b)},setLayananPenyedia:function(b){var a=this.getViewModel();a.set("layananPenyedia",b)},onLoadRecord:function(g,d){var b=g.getViewModel(),h=b.get("jenis"),f=b.get("layananPenyedia"),c=g.down("[reference=transferform]"),i=g.down("[reference=transferlist]"),e=d.get("STATUS")==1,a=g.app.xpriv("1206")?e:false;c.setFormConfig({viewOnly:!a,simpan:a,reset:a,minDate:d.get("TANGGAL"),maxDate:g.getSysdate()});i.setListConfig({batal:a});new Ext.util.DelayedTask(function(){i.load({TAGIHAN:d.get("ID"),PENYEDIA_ID:f.get("PENYEDIA_ID"),JENIS_LAYANAN_ID:f.get("JENIS_LAYANAN_ID"),NOT:Ext.JSON.encode({STATUS:[0]})});c.setFormConfig({penyedia:f.get("REFERENSI").PENYEDIA});c.createRecord({TAGIHAN:d.get("ID"),JENIS:h,PENYEDIA_ID:f.get("PENYEDIA_ID"),JENIS_LAYANAN_ID:f.get("JENIS_LAYANAN_ID"),TOTAL:0,TANGGAL:g.getSysdate(),STATUS:2});c.focus("REKENING_ID")}).delay(1000)}});Ext.define("pembayaran.tagihan.nontunai.bank.transfer.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.pembayaran-tagihan-nontunai-bank-transfer-workspace",onSelect:function(b,e){var d=this,c=d.getViewModel(),f=c.get("jenis"),a=d.getReferences();e.set("JENIS",f);a.transferform.loadRecord(e)},onReload:function(){var a=this.getReferences();a.transferlist.load();this.getView().fireEvent("load")}});Ext.define("pembayaran.tagihan.nontunai.edc.Form",{extend:"com.Form",xtype:"pembayaran-tagihan-nontunai-edc-form",controller:"pembayaran-tagihan-nontunai-edc-form",model:"pembayaran.pembayarantagihan.Model",layout:{type:"hbox",align:"stretch"},defaultType:"fieldcontainer",items:[{flex:1,layout:{type:"vbox",align:"stretch"},defaults:{bind:{readOnly:"{formConfig.viewOnly}"}},items:[{xtype:"radiogroup",fieldLabel:"Jenis Kartu",columns:2,defaults:{allowBlank:false},name:"JENIS_KARTU_ID",layout:{autoFlex:false},defaults:{margin:"0 15 0 0"},items:[{boxLabel:"Master Card",checked:true,inputValue:"1"},{boxLabel:"Visa",inputValue:"2"}]},{xtype:"textfield",fieldLabel:"No. Kartu",name:"NO_ID",emptyText:"[ Nomor Kartu ]",allowBlank:false,stripCharsRe:new RegExp("[^0-9]"),enforceMaxLength:true,maxLength:25},{xtype:"textfield",fieldLabel:"Nama Pemilik Kartu",name:"NAMA",emptyText:"[ Nama Pemilik Kartu ]",stripCharsRe:new RegExp("[^a-zA-Z0-9.\\s]"),allowBlank:false,enforceMaxLength:true,maxLength:135},{xtype:"referensi-combo",params:{JENIS:16,STATUS:1},name:"BANK_ID",selectOnTab:true,editable:true,allowBlank:false,margin:"2 2 1 1",fieldLabel:"Bank Penerbit",typeAhead:true,emptyText:"[Bank]"}]},{flex:1,layout:{type:"vbox",align:"stretch"},margin:"0 0 0 20",items:[{xtype:"textfield",fieldLabel:"Kode Aprove",name:"REF",bind:{readOnly:"{formConfig.viewOnly}"},emptyText:"[ Kode Aprove ]",stripCharsRe:new RegExp("[^a-zA-Z0-9]"),allowBlank:false},{xtype:"numberfield",textAlign:"right",fieldLabel:"Total",name:"TOTAL",emptyText:"[ Rp. ]",minValue:0,hideTrigger:true,bind:{readOnly:"{formConfig.viewOnly}"},allowBlank:false},{xtype:"fieldcontainer",fieldLabel:"Tanggal",layout:{type:"hbox"},defaults:{allowBlank:false},items:[{name:"TANGGAL",reference:"tanggal",flex:1,xtype:"datefield",emptyText:"[Tanggal]",format:"d/m/Y",margin:"0 1 0 0",bind:{readOnly:"{formConfig.viewOnly}",minValue:"{formConfig.minDate}",maxValue:"{formConfig.maxDate}"}},{name:"WAKTU",reference:"waktu",width:105,xtype:"timefield",emptyText:"[Jam:Mnt:Dtk]",format:"H:i:s",hideTrigger:true,bind:{readOnly:"{formConfig.viewOnly}"}}]}]}],buttons:[{text:"Simpan",ui:"soft-blue",iconCls:"x-fa fa-save",handler:"onSimpan",bind:{hidden:"{!formConfig.simpan}"},tooltip:{text:"Simpan",mouseOffset:[0,-75]}},{text:"Reset",ui:"soft-red",iconCls:"x-fa fa-refresh",handler:"onReset",bind:{hidden:"{!formConfig.reset}"},tooltip:{text:"Reset",mouseOffset:[0,-75]}}],onLoadRecord:function(b,d){var c=b.down("referensi-combo"),a=b.down("[name=WAKTU]");a.setValue(d.get("TANGGAL"));c.load()},onBeforeGetRecord:function(b,e){var d=Ext.Date.clone(b.down("[reference=tanggal]").getValue()),a=b.down("[reference=waktu]").getValue(),f=b.app,c=f?(f.trxksr?f.trxksr:0):0;d.setHours(a.getHours());d.setMinutes(a.getMinutes());d.setSeconds(a.getSeconds());e.TANGGAL=d;e.TRANSAKSI_KASIR_NOMOR=c}});Ext.define("pembayaran.tagihan.nontunai.edc.FormController",{extend:"Ext.app.ViewController",alias:"controller.pembayaran-tagihan-nontunai-edc-form",onReset:function(){var a=this;view=a.getView(),rec=a.getViewModel().get("record");view.createRecord({TAGIHAN:rec.get("TAGIHAN"),JENIS:rec.get("JENIS"),PENYEDIA_ID:rec.get("PENYEDIA_ID"),JENIS_LAYANAN_ID:rec.get("JENIS_LAYANAN_ID"),TOTAL:0,TANGGAL:view.getSysdate(),STATUS:2});view.focus("NO_ID")},onSimpan:function(c){var b=this,a=b.getView(),e=a.app,d=e?(e.trxksr?e.trxksr:false):false;if(!d){a.notifyMessage("Anda belum membuka transaksi kasir / open cashier","danger-blue");return}a.save(c,{},function(h,f,g){b.onReset()})}});Ext.define("pembayaran.tagihan.nontunai.edc.Grid",{extend:"com.Grid",xtype:"pembayaran-tagihan-nontunai-edc-grid",controller:"pembayaran-tagihan-nontunai-edc-grid",viewModel:{stores:{store:{type:"pembayaran-pembayarantagihan-store"}},data:{listConfig:{batal:true}}},border:false,cls:"x-br-top",columns:[{xtype:"rownumberer",text:"No",align:"left",width:60},{text:"Nomor",width:90,dataIndex:"NOMOR"},{text:"Jenis Kartu",width:100,dataIndex:"JENIS_KARTU_ID",renderer:"onRendererJenisKartu"},{text:"Nama Pemilik Kartu",flex:2,dataIndex:"NAMA"},{text:"No. Kartu",width:200,dataIndex:"NO_ID"},{text:"Bank Penerbit",flex:2,dataIndex:"BANK_ID",renderer:"onRendererBank"},{text:"Kode Aprove",flex:1,dataIndex:"REF"},{xtype:"numbercolumn",text:"Total",format:"0,00",align:"right",width:120,dataIndex:"TOTAL"},{xtype:"widgetcolumn",align:"center",text:"Action",width:110,bind:{hidden:"{!listConfig.status}"},widget:{xtype:"fieldcontainer",flex:1,defaults:{padding:2},layout:"fit",items:[{xtype:"button",text:"Batalkan",action:0,handler:"onBatal"},{xtype:"button",text:"Dibatalkan",action:1,ui:"soft-red"}]},onWidgetAttach:"onWidgetAttach"},{text:"Kwitansi",width:110,xtype:"widgetcolumn",widget:{xtype:"button",text:"Cetak",listeners:{click:"onCetakKwitansi"}}}]});Ext.define("pembayaran.tagihan.nontunai.edc.GridController",{extend:"Ext.app.ViewController",alias:"controller.pembayaran-tagihan-nontunai-edc-grid",onRendererBank:function(e,c,d){var b=d.get("REFERENSI"),a=b?(b.BANK?b.BANK.DESKRIPSI:""):"";return a},onRendererJenisKartu:function(e,c,d){var b=d.get("REFERENSI"),a=b?(b.JENIS_KARTU?b.JENIS_KARTU.DESKRIPSI:""):"";return a},onWidgetAttach:function(f,a,e){var c=this,b=c.getViewModel().get("listConfig.batal");status=e.get("STATUS"),action0=a.down("[action=0]"),action1=a.down("[action=1]");action0.setHidden(status==0);action1.setHidden(!(status==0));if(!b){action0.setHidden(true)}},onBatal:function(c){var e=this,b=e.getView(),f=c.ownerCt.getWidgetRecord();if(f){var d=f.get("REFERENSI"),g=d?(d.JENIS?d.JENIS.DESKRIPSI:""):"",a=f.get("STATUS");f.showError=true;f.animateTarget=c;f.scope=e;b.showMessageBox({title:"Pembatalan EDC",message:"Anda yakin ingin membatalkan EDC ?",ui:"window-warning",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,defaultButton:"no",animateTarget:c,fn:function(h){if(h==="yes"){f.set("STATUS",0);f.save({callback:function(k,i,j){if(j){b.notifyMessage("Pembatalan EDC berhasil")}else{k.set("STATUS",a)}e.getView().fireEvent("batal")}})}else{f.set("STATUS",a)}}})}},onCetakKwitansi:function(e){var d=this,b=d.getView(),c=d.getReferences(),a=e.getWidgetRecord();b.openDialog("",true,100,50,{xtype:"kwitansi-form",title:"Kwitansi",ui:"panel-cyan",showCloseButton:true},function(f,g){kw=g.down("kwitansi-form");kw.setFormConfig({hidden:true,cetak:true});kw.createRecord({TAGIHAN:a.get("TAGIHAN"),TUNAI:0,STATUS:1});kw.setParamReport({name:"pembayaran.CetakKwitansiEdc",params:{PNOMOR:a.get("NOMOR")}});kw.on("cetak",function(h){g.close()})})}});Ext.define("pembayaran.tagihan.nontunai.edc.Workspace",{extend:"com.Form",xtype:"pembayaran-tagihan-nontunai-edc-workspace",controller:"pembayaran-tagihan-nontunai-edc-workspace",viewModel:{data:{layananPenyedia:undefined,jenis:undefined}},layout:{type:"vbox",align:"stretch"},items:[{xtype:"pembayaran-tagihan-nontunai-edc-form",reference:"nontunaiedcform",listeners:{save:"onReload"}},{xtype:"pembayaran-tagihan-nontunai-edc-grid",flex:1,reference:"nontunaiedclist",listeners:{select:"onSelect",batal:"onReload"}}],setJenis:function(b){var a=this.getViewModel();a.set("jenis",b)},setLayananPenyedia:function(b){var a=this.getViewModel();a.set("layananPenyedia",b)},onLoadRecord:function(g,d){var b=g.getViewModel(),h=b.get("jenis"),f=b.get("layananPenyedia"),c=g.down("[reference=nontunaiedcform]"),i=g.down("[reference=nontunaiedclist]"),e=d.get("STATUS")==1,a=g.app.xpriv("1206")?e:false;c.setFormConfig({viewOnly:!a,simpan:a,reset:a,minDate:d.get("TANGGAL"),maxDate:g.getSysdate()});i.setListConfig({batal:a});new Ext.util.DelayedTask(function(){i.load({TAGIHAN:d.get("ID"),PENYEDIA_ID:f.get("PENYEDIA_ID"),JENIS_LAYANAN_ID:f.get("JENIS_LAYANAN_ID"),NOT:Ext.JSON.encode({STATUS:[0]})});c.createRecord({TAGIHAN:d.get("ID"),JENIS:h,PENYEDIA_ID:f.get("PENYEDIA_ID"),JENIS_LAYANAN_ID:f.get("JENIS_LAYANAN_ID"),TOTAL:0,TANGGAL:g.getSysdate(),STATUS:2});c.focus("NO_ID")}).delay(1000)}});Ext.define("pembayaran.tagihan.nontunai.edc.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.pembayaran-tagihan-nontunai-edc-workspace",onSelect:function(b,e){var d=this,c=d.getViewModel(),f=c.get("jenis"),a=d.getReferences();e.set("JENIS",f);a.nontunaiedcform.loadRecord(e)},onReload:function(){var a=this.getReferences();a.nontunaiedclist.load();this.getView().fireEvent("load")}});Ext.define("pembayaran.tagihan.pembatalan.Form",{extend:"com.Form",xtype:"pembatalan-tagihan-form",controller:"pembatalan-tagihan-form",model:"pembayaran.tagihan.pembatalan.Model",bodyPadding:5,layout:"fit",items:[{xtype:"referensi-combo",name:"JENIS",params:{JENIS:57},firstLoad:true,allowBlank:false,editable:false,emptyText:"[Jenis Pembatalan]"}],buttons:[{text:"Batalkan",ui:"soft-blue",iconCls:"x-fa fa-minus-circle",handler:"onBatalkan"}]});Ext.define("pembayaran.tagihan.pembatalan.FormController",{extend:"Ext.app.ViewController",alias:"controller.pembatalan-tagihan-form",onBatalkan:function(c){var b=this,a=b.getView();a.save(c,{success:"Tagihan Final telah dibatalkan"})}});Ext.define("pembayaran.tagihan.penjamin.List",{extend:"com.Grid",alias:"widget.penjamintagihan-list",controller:"penjamintagihan-list",viewModel:{stores:{store:{type:"penjamin-tagihan-store"}}},tagihan:undefined,border:false,columns:[{text:"Penjamin",dataIndex:"PENJAMIN",flex:1,editor:{xtype:"referensi-combo",params:{JENIS:10,STATUS:1},firstLoad:true,allowBlank:false,listeners:{select:"onPenjaminCombo"}},renderer:"onRendererPenjamin"},{text:"Ke",dataIndex:"KE",flex:1,hidden:true},{xtype:"numbercolumn",text:"Total",dataIndex:"TOTAL",width:100,align:"right",format:"0,000",editor:{xtype:"numberfield",listeners:{change:"onChange"}}},{menuDisabled:true,sortable:false,align:"center",xtype:"actioncolumn",width:50,items:["@hapus"],bind:{hidden:"{isFinal}"}}],plugins:{ptype:"cellediting",clicksToEdit:1,listeners:{beforeedit:"onBeforeEdit"}},actions:{hapus:{iconCls:"x-fa fa-remove",tooltip:"Hapus Penjamin",handler:"onHapus"}},dockedItems:[{xtype:"toolbar",dock:"top",items:["->",{xtype:"button",iconCls:"x-fa fa-retweet",tooltip:"Refresh",margin:"2.2.2.2",ui:"soft-purple",handler:"onRefresh"},{xtype:"button",margin:"2.2.2.2",tooltip:"Tambah / Add",iconCls:"x-fa fa-plus-circle",ui:"soft-green",handler:"onAdd",hidden:true,bind:{hidden:"{isFinal}"}},{xtype:"button",margin:"2.2.2.2",tooltip:"Tambah / Add",iconCls:"x-fa fa-save",ui:"soft-blue",handler:"onSave",hidden:true,bind:{hidden:"{isFinal}"}}]}],setTagihan:function(b){var a=this.getViewModel();this.tagihan=b;a.set("isFinal",this.app.xpriv("1212")?b.get("STATUS")==2:true)}});Ext.define("pembayaran.tagihan.penjamin.ListController",{extend:"Ext.app.ViewController",alias:"controller.penjamintagihan-list",recordSelected:undefined,onRendererPenjamin:function(e,c,d){var b=d.get("REFERENSI"),a=b?b.PENJAMIN:null;if(a){return a.DESKRIPSI}return e},onBeforeEdit:function(d,c){var b=this.getView(),g=b.tagihan,h=c.record,a=b.getReferensi(h.data,"PENJAMIN"),e=false;if(h.get("KE")==1){e=true;if(a){var f=a.REF_ID.split(".");if(f.length>1){if(f[1]=="1"){e=false}}}}if(g){if(g.get("STATUS")==2){e=true}}if(e){c.cancel=true;return}this.recordSelected=h},onChange:function(a,c,b){if(c!=b){if(this.recordSelected){this.recordSelected.set("MANUAL",1)}}},onPenjaminCombo:function(a,d){var c=this.getView().getSelection();if(d){if(Ext.isArray(c)){if(c.length>0){var b=c[0].get("REFERENSI")||{};b.PENJAMIN=d.data;c[0].set("REFERENSI",b)}}}},onRefresh:function(a){this.getView().refresh()},onAdd:function(d){var e=this,a=e.getView(),f=a.tagihan,b=e.getStore("store"),c=Ext.create("data.model.PenjaminTagihan");c.set("TAGIHAN",f.get("ID"));b.insert(b.getCount(),c)},onHapus:function(c,h,b,i,d,f){var a=this.getView(),e=a.tagihan;if(f.get("KE")==1){a.notifyMessage("Penjamin ini tidak dapat di hapus","danger-red");return}a.showMessageBox({title:"Hapus Penjamin",message:"Anda yakin ingin menghapus penjamin ini ?",ui:"window-warning",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,defaultButton:"no",animateTarget:c,fn:function(g){if(g==="yes"){f.drop();f.set("id",e.get("ID")+"-"+f.get("PENJAMIN"));f.save({callback:function(j,k,l){if(l){a.notifyMessage("Data telah dihapus","danger-red");a.reload();a.fireEvent("changed")}}})}}})},onSave:function(d){var e=this,b=e.getView(),g=b.tagihan,c=e.getStore("store"),f=c.getModifiedRecords(),a=0;Ext.Array.each(f,function(h){h.set("id",g.get("ID")+"-"+h.get("PENJAMIN"));h.save({callback:function(i,j,k){if(k){if(a===(f.length-1)){e.getView().notifyMessage("Data telah disimpan")}}a++}})});b.reload();b.fireEvent("changed")}});Ext.define("pembayaran.tagihan.penjamin.Workspace",{extend:"com.Form",xtype:"workspace-penjamintagihan",controller:"workspace-penjamintagihan",layout:"border",items:[{region:"center",xtype:"penjamintagihan-list",reference:"penjamintagihanlist",listeners:{changed:"onChanged"}}],onLoadRecord:function(b,c){var a=b.down("penjamintagihan-list");a.load({TAGIHAN:c.get("ID")});a.setTagihan(c)}});Ext.define("pembayaran.tagihan.penjamin.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.workspace-penjamintagihan",onChanged:function(){this.getView().fireEvent("load")}});Ext.define("pembayaran.tagihan.penjualan.Info",{extend:"com.Form",xtype:"tagihan-penjualan-info",controller:"tagihan-penjualan-info",viewModel:{stores:{PNonTunai:{type:"pembayaran-pembayarantagihan-store"},pengunjung:{type:"penjualan-store"}},data:{tagihan:undefined,id_tagihan:undefined,total:0,nama:undefined,totaledc:0,viewConfig:{tagihanFinal:false}},formulas:{getSisaBayar:function(b){var d=b("total"),a=b("totaledc"),c=d-a;return c}}},layout:{type:"vbox",align:"stretch"},bodyPadding:5,defaults:{margin:5},fieldDefaults:{labelAlign:"top"},border:true,items:[{xtype:"button",text:"Cetak Rincian",reference:"btnprintrincian",tooltip:"Cetak Rincian",iconCls:"x-fa fa-print",handler:"onCetakRincianPenjualan"},{fieldLabel:"No.Tagihan",name:"TAGIHAN",xtype:"textfield",readOnly:true,bind:"{id_tagihan}"},{fieldLabel:"Nama",xtype:"textfield",readOnly:true,bind:"{nama}"},{fieldLabel:"Total Tagihan",name:"TOTAL",xtype:"textfield",readOnly:true,bind:"{total}"},{fieldLabel:"Total Pembayaran Non Tunai",xtype:"textfield",readOnly:true,bind:"{totaledc}"},{fieldLabel:"Sisa Pembayaran",name:"SISA_PEMBAYARAN",xtype:"textfield",readOnly:true,bind:{value:"{getSisaBayar}"}},{fieldLabel:"Kwitansi",name:"KWITANSI",xtype:"textfield",emptyText:"No.Kwitansi"},{name:"NAMA_PEMBAYAR",xtype:"textfield",emptyText:"Nama Pembayar"}],buttons:[{text:"Final Tagihan",reference:"btnfinaltagihanpenjualan",tooltip:"Selesai",flex:1,iconCls:"x-fa fa-save",handler:"onFinalTagihanPenjualan",hidden:true,bind:{hidden:"{!viewConfig.tagihanFinal}"}}],load:function(e){var d=this,c=d.getViewModel(),a=c.get("PNonTunai"),b=c.get("pengunjung");if(e){c.set("tagihan",e);c.set("total",e.get("TOTAL"));c.set("id_tagihan",e.get("ID"));c.set("viewConfig.tagihanFinal",e.get("STATUS")==1&&d.app.xpriv("121401",false));b.removeAll();b.setQueryParams({NOMOR:e.get("ID")});b.load({callback:function(f){if(f.length>0){c.set("nama",f[0].get("PENGUNJUNG"))}}});a.removeAll();a.setQueryParams({TAGIHAN:e.get("ID")});a.load({callback:function(f){if(f.length>0){c.set("totaledc",f[0].get("TOTAL"))}}})}}});Ext.define("pembayaran.tagihan.penjualan.InfoController",{extend:"Ext.app.ViewController",alias:"controller.tagihan-penjualan-info",onFinalTagihanPenjualan:function(b){var c=this,a=c.getView(),f=a.app,e=f?f.xpriv:false,d=f?(f.trxksr?f.trxksr:false):false;if(!e("1201",false)){a.notifyMessage("Anda tidak memiliki hak akses untuk melakukan Tagihan Final","danger-blue");return}if(!d){a.notifyMessage("Anda belum membuka transaksi kasir / open cashier","danger-blue");return}a.showMessageBox({title:"Finalkan Tagihan",message:"Anda yakin ingin memfinalkan tagihan ini ?",ui:"window-warning",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,defaultButton:"no",animateTarget:b,fn:function(g){if(g==="yes"){c.finalTagihanPenjualan(b)}}})},finalTagihanPenjualan:function(m){var i=this,k=i.getView(),d=i.getViewModel(),c=d.get("tagihan"),e=k.app,h=e?(e.trxksr?e.trxksr:false):false,b=k.getForm().getValues(),j=b.TOTAL,g=b.TAGIHAN,a=b.NAMA_PEMBAYAR,l=Ext.create("data.model.KwitansiPembayaran",{TAGIHAN:b.TAGIHAN,NOMOR:b.KWITANSI,NAMA:b.NAMA_PEMBAYAR}),f=Ext.create("pembayaran.pembayarantagihan.Model",{TAGIHAN:b.TAGIHAN,JENIS:8,REF:h,TOTAL:b.SISA_PEMBAYARAN,STATUS:2});m.setDisabled(true);l.animateTarget=m;l.scope=i;l.showError=true;l.save({callback:function(p,n,o){if(o){f.animateTarget=m;f.scope=i;f.showError=true;f.save({callback:function(s,q,r){if(r){k.setLoading(false);d.set("viewConfig.tagihanFinal",false);c.set("STATUS",2);k.notifyMessage("Tagihan telah di finalkan");if(j){k.showMessageBox({title:"Cetak Kwitansi",message:"Anda ingin mencetak kwitansi ?",ui:"window-cyan",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,defaultButton:"yes",animateTarget:m,fn:function(t){if(t==="yes"){i.onCetakKwitansi(g)}}})}k.fireEvent("suksesfinaltagihan",c)}m.setDisabled(false)}})}else{m.setDisabled(false)}}})},onCetakKwitansi:function(b){var c=this,a=c.getView();a.cetak({NAME:"pembayaran.CetakKwitansiPenjualan",TYPE:"Word",EXT:"docx",PARAMETER:{PTAGIHAN:b,PJENIS:4},REQUEST_FOR_PRINT:true,PRINT_NAME:"CetakKwitansiPenjualan"})},onCetakRekapPenjualan:function(){this.cetakRincian(2)},onCetakRincianPenjualan:function(){this.cetakRincian(1)},privates:{cetakRincian:function(c){var f=this,a=f.getView(),h=f.getViewModel().get("tagihan"),b="Word",e="docx",g=true,d="Cetak Rincian";a.showMessageBox({title:d,message:"Tekan tombol Yes/Ya utk cetak langsung<br/>Tekan tombol No/Tidak untuk Preview",ui:"window-cyan",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,defaultButton:"yes",animateTarget:f,fn:function(i){if(i!="yes"){b="Pdf";e="pdf";g=false}a.cetak({NAME:"pembayaran."+(c==1?"CetakRincianPenjualan":"CetakRekapRincianPenjualan"),TYPE:b,EXT:e,PARAMETER:{PTAGIHAN:h.get("ID"),PSTATUS:1},REQUEST_FOR_PRINT:g,PRINT_NAME:"CetakRincian"},function(j){a.printPreview(d,j)})}})}}});Ext.define("pembayaran.tagihan.penjualan.Links",{extend:"com.Tab",alias:"widget.tagihan-penjualan-links",cls:"x-br-top",border:false,ui:"header-tab",defaults:{flex:1,border:false},items:[{title:"Rincian",xtype:"rincian-tagihan-penjualan-Workspace",iconCls:"x-fa fa-list-alt",reference:"workspacerinciantagihanpenjualan"}],load:function(b){var c=this,a=c.getActiveTab();if(a){if(a.loadRecord){a.loadRecord(b)}else{if(a.load){a.load(b)}}}}});Ext.define("pembayaran.tagihan.penjualan.Workspace",{extend:"com.Form",alias:"widget.tagihan-penjualan-Workspace",controller:"tagihan-penjualan-WorkspaceController",viewModel:{data:{tagihan:undefined}},layout:"border",bodyPadding:0,items:[{region:"center",xtype:"tagihan-penjualan-links",reference:"tagihanpenjualanlink",flex:3,listeners:{tabchange:"onTabChange"}},{region:"east",xtype:"tagihan-penjualan-info",reference:"tagihanpenjualaninfo",flex:1,collapsible:true,split:true,title:"Info tagihan",listeners:{suksesfinaltagihan:"onSuksesFinal"}}],load:function(d){var a=this.getViewModel(),b=this.down("[reference=tagihanpenjualanlink]"),c=this.down("[reference=tagihanpenjualaninfo]");a.set("tagihan",d);b.load(d);c.load(d)}});Ext.define("pembayaran.tagihan.penjualan.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.tagihan-penjualan-WorkspaceController",onSelectedTagihanPenjualan:function(j,h){var i=this,f=i.getReferences(),g=h.get("ID");f.tagihanpenjualandetil.loadStore(g)},onSuksesFinal:function(b){var a=this;a.getView().load(b)},onTabChange:function(d,a){var c=this.getViewModel(),b=c.get("tagihan");if(a.loadRecord){a.loadRecord(b)}else{if(a.load){a.load(b)}}}});Ext.define("pembayaran.tagihan.penjualan.rincian.List",{extend:"com.Grid",alias:"widget.rincian-tagihan-penjualan-list",controller:"rincian-tagihan-penjualan-list",viewModel:{stores:{store:{type:"penjualan-detil-store"}}},columns:[{xtype:"rownumberer",text:"No",align:"left",width:50},{xtype:"templatecolumn",text:"Nama Obat",flex:1,sortable:false,tpl:'<div style="white-space:normal !important;">{REFERENSI.FARMASI.NAMA}</div>'},{text:"Jumlah",dataIndex:"JUMLAH",hideTrigger:true,width:75,editor:{xtype:"numberfield",hideTrigger:true,reference:"jumlah",name:"JUMLAH"}},{text:"Harga (Rp)",format:"0,00",renderer:"Renderhargasatuan",align:"right",width:100,summaryRenderer:"onSummaryInfoRenderer"},{xtype:"numbercolumn",text:"Jumlah (Rp)",align:"right",format:"0,00",width:120,renderer:"onTotalRenderer",summaryRenderer:"onSummaryRenderer"}],features:[{ftype:"summary",dock:"bottom"}]});Ext.define("pembayaran.tagihan.penjualan.rincian.ListController",{extend:"Ext.app.ViewController",alias:"controller.rincian-tagihan-penjualan-list",initViewModel:function(){var c=this,a=c.getView(),b=c.getStore("store");b.doAfterLoad=function(e){var d=0;e.each(function(l){var i=l.get("REFERENSI"),f=Number(i?(i.MARGIN_PENJAMIN?i.MARGIN_PENJAMIN.MARGIN:0):0),j=Number(i?(i.HARGA_BARANG?i.HARGA_BARANG.HARGA_JUAL:0):0),g=j*(f/100),k=parseFloat(j)+parseFloat(g),h=l.get("JUMLAH")*k;d=d+h});a.total=d}},onTotalRenderer:function(a,j,d){var g=this,i=g.getView(),b=d.get("REFERENSI"),k=Number(b?(b.MARGIN_PENJAMIN?b.MARGIN_PENJAMIN.MARGIN:0):0),e=Number(b?(b.HARGA_BARANG?b.HARGA_BARANG.HARGA_JUAL:0):0),c=e*(k/100),f=parseFloat(e)+parseFloat(c),h=d.get("JUMLAH")*f;this.initViewModel();return Ext.util.Format.number(h,"0,00")},onSummaryRenderer:function(d,b,c){var a='<span style="font-size: 12px; font-weight: bold">'+Ext.util.Format.number(this.getView().total,"0,00")+"</span>";return a},Renderhargasatuan:function(h,f,g){var c=g.get("REFERENSI"),a=Number(c?(c.MARGIN_PENJAMIN?c.MARGIN_PENJAMIN.MARGIN:0):0),d=Number(c?(c.HARGA_BARANG?c.HARGA_BARANG.HARGA_JUAL:0):0),b=d*(a/100),e=parseFloat(d)+parseFloat(b);return'<span style="color:black;"> Rp. '+e+"</span>"},onSummaryInfoRenderer:function(){return'<span style="font-size: 12px; font-weight: bold">Total (Rp.): </span>'}});Ext.define("pembayaran.tagihan.penjualan.rincian.Workspace",{extend:"com.Form",alias:"widget.rincian-tagihan-penjualan-Workspace",layout:"fit",items:[{xtype:"rincian-tagihan-penjualan-list",reference:"rinciantagihanpenjualan",flex:1}],onLoadRecord:function(a,b){a.down("rincian-tagihan-penjualan-list").load({PENJUALAN_ID:b.get("ID")})}});Ext.define("pembayaran.tagihan.piutang.Workspace",{extend:"com.Tab",xtype:"workspace-piutang",controller:"workspace-piutang",viewModel:{data:{tagihan:undefined}},items:[{title:"Perorangan",xtype:"workspace-piutangperorangan",reference:"piutangperorangan",listeners:{save:"onSimpan"}},{title:"Perusahaan",xtype:"workspace-piutang-penjamin",reference:"piutangpenjaminform",listeners:{save:"onSimpan"}}],load:function(c){var b=this;vm=b.getViewModel();vm.set("tagihan",c);var a=b.getActiveTab();if(a){if(a.loadRecord){a.loadRecord(c)}else{if(a.load){a.load(c)}}}},listeners:{tabchange:"onTabChange",save:"onSimpan"}});Ext.define("pembayaran.tagihan.piutang.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.workspace-piutang",onTabChange:function(d,a){var c=this.getViewModel(),b=c.get("tagihan");if(a.loadRecord){a.loadRecord(b)}else{if(a.load){a.load(b)}}},onSimpan:function(){this.getView().fireEvent("load")}});Ext.define("pembayaran.tagihan.piutang.penjamin.Form",{extend:"com.Form",xtype:"piutangpenjamin-form",controller:"piutangpenjamin-form",model:"data.model.PiutangPerusahaan",layout:{type:"vbox",align:"stretch"},defaults:{border:false,margin:" 5 5 5 5 "},items:[{flex:1,layout:{type:"hbox",align:"stretch"},defaults:{border:false,flex:1,margin:" 2 5 2 5 ",allowBlank:false,bind:{readOnly:"{formConfig.viewOnly}"}},items:[{xtype:"referensi-combo",params:{JENIS:10},emptyText:"[ PENJAMIN ]",name:"PENJAMIN",flex:1,monitorTab:true,selectOnTab:true,editable:true,firstLoad:true},{xtype:"textfield",flex:1,name:"TELEPON",emptyText:"[ NO. TELPON ]"}]},{flex:1,layout:{type:"hbox",align:"stretch"},defaults:{border:false,allowBlank:false,flex:1,margin:" 2 5 2 5 ",bind:{readOnly:"{formConfig.viewOnly}"}},items:[{xtype:"textfield",name:"TOTAL",emptyText:"[ TOTAL ]"},{flex:1,name:"ALAMAT",emptyText:"[ ALAMAT ]",xtype:"textfield"}]}],buttons:[{text:"Simpan",ui:"soft-blue",iconCls:"x-fa fa-save",handler:"onSimpan",bind:{hidden:"{!formConfig.simpan}"},tooltip:{text:"Simpan",mouseOffset:[0,-75]}},{text:"Cetak Surat Piutang",ui:"soft-green",iconCls:"x-fa fa-print",handler:"onCetak",tooltip:{text:"Cetak",mouseOffset:[0,-75]}},{text:"Reset",ui:"soft-red",iconCls:"x-fa fa-refresh",handler:"onReset",bind:{hidden:"{!formConfig.simpan}"},tooltip:{text:"Reset",mouseOffset:[0,-75]}}]});Ext.define("pembayaran.tagihan.piutang.penjamin.FormController",{extend:"Ext.app.ViewController",alias:"controller.piutangpenjamin-form",onReset:function(){var b=this,a=b.getView(),c=b.getViewModel().get("record");a.createRecord({TAGIHAN:c.get("TAGIHAN"),STATUS:1,TANGGAL:a.getSysdate()})},onSimpan:function(b){var c=this,a=c.getView();a.save(b,{},function(f,d,e){if(e){c.onReset();a.fireEvent("success",e)}})}});Ext.define("pembayaran.tagihan.piutang.penjamin.List",{extend:"com.Grid",alias:"widget.piutang-penjamin-list",controller:"piutang-penjamin-list",viewModel:{stores:{store:{type:"piutang-perusahaan-store"}}},cls:"x-br-top",border:false,columns:[{xtype:"rownumberer",text:"No",align:"left",width:60},{text:"Penjamin",dataIndex:"PENJAMIN",flex:2,renderer:"onRendererPenjamin"},{text:"No. Telpon",dataIndex:"TELEPON",flex:1},{text:"Alamat",dataIndex:"ALAMAT",flex:2},{xtype:"numbercolumn",text:"Total",dataIndex:"TOTAL",flex:1,format:"0,00",align:"right"},{xtype:"datecolumn",text:"Tanggal",dataIndex:"TANGGAL",flex:1,format:"d-m-Y H:i:s",align:"center"}]});Ext.define("pembayaran.tagihan.piutang.penjamin.ListController",{extend:"Ext.app.ViewController",alias:"controller.piutang-penjamin-list",onRendererPenjamin:function(e,b,d){var c=d.get("REFERENSI"),a=c?(c.PENJAMIN?c.PENJAMIN.DESKRIPSI:""):"";return a}});Ext.define("pembayaran.tagihan.piutang.penjamin.Workspace",{extend:"com.Form",xtype:"workspace-piutang-penjamin",controller:"workspace-piutang-penjamin",layout:"border",items:[{region:"north",title:"Form",iconCls:"x-fa fa-file-o",xtype:"piutangpenjamin-form",border:false,reference:"piutangpenjaminform",listeners:{save:"onSuccess"}},{region:"center",title:"List",iconCls:"x-fa fa-server",xtype:"piutang-penjamin-list",flex:1,border:false,reference:"piutangpenjaminlist"}],onLoadRecord:function(d,g){var e=d.down("piutang-penjamin-list"),c=d.down("piutangpenjamin-form");if(g){var a=g.get("STATUS")==1,b=d.app.xpriv("1204")?a:false,f={TAGIHAN:g.get("ID"),TANGGAL:c.getSysdate(),STATUS:1};c.setFormConfig({viewOnly:!b,simpan:b});c.createRecord(f);e.load({TAGIHAN:g.get("ID")})}}});Ext.define("pembayaran.tagihan.piutang.penjamin.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.workspace-piutang-penjamin",onSuccess:function(e){var c=this,a=c.getView(),b=c.getReferences(),d=b.piutangpenjaminlist;d.reload();a.fireEvent("save",e)}});Ext.define("pembayaran.tagihan.piutang.perorangan.Form",{extend:"com.Form",xtype:"piutangperorangan-form",controller:"piutangperorangan-form",model:"data.model.PiutangPasien",layout:{type:"hbox",align:"stretch"},defaultType:"fieldcontainer",defaults:{margin:"0 5 0 5"},items:[{layout:{type:"vbox",align:"stretch"},flex:1,defaults:{allowBlank:false,margin:"0 0 1 0",labelWidth:150,bind:{readOnly:"{formConfig.viewOnly}"}},items:[{xtype:"textfield",fieldLabel:"Nama",name:"NAMA",enforceMaxLength:true,maxLength:75},{xtype:"referensi-combo",fieldLabel:"Hubungan dgn Pasien",params:{JENIS:7},name:"SHDK",editable:false,firstLoad:true,emptyText:"[Hubungan Dengan Pasien]"},{xtype:"referensi-combo",fieldLabel:"Kartu Tanda Pengenal",params:{JENIS:9},name:"JENIS_KARTU",editable:false,firstLoad:true,emptyText:"[Kartu Tanda Pengenal]"},{xtype:"textfield",fieldLabel:"No. Kartu Pengenal",name:"NO_KARTU_IDENTITAS",enforceMaxLength:true,maxLength:16},{xtype:"textfield",fieldLabel:"Alamat KTP",name:"ALAMAT_KARTU",enforceMaxLength:true,maxLength:150},{xtype:"textfield",fieldLabel:"Alamat Tempat Tinggal",name:"ALAMAT_TEMPAT_TINGGAL",enforceMaxLength:true,maxLength:150}]},{layout:{type:"vbox",align:"stretch"},flex:1,defaults:{margin:"0 0 1 0",labelWidth:150},items:[{xtype:"textfield",fieldLabel:"No. Telepon",name:"TELEPON",enforceMaxLength:true,maxLength:35,bind:{readOnly:"{formConfig.viewOnly}"}},{xtype:"textfield",fieldLabel:"Alasan",name:"ALASAN",enforceMaxLength:true,maxLength:35,bind:{readOnly:"{formConfig.viewOnly}"}},{xtype:"fieldcontainer",fieldLabel:"Tgl. Piutang",layout:{type:"hbox"},defaults:{allowBlank:false},items:[{name:"TANGGAL",reference:"tanggal",flex:1,xtype:"datefield",emptyText:"[Tanggal]",format:"d/m/Y",margin:"0 1 0 0",bind:{readOnly:"{formConfig.viewOnly}",minValue:"{formConfig.minDate}",maxValue:"{formConfig.maxDate}"}},{name:"WAKTU",reference:"waktu",width:105,xtype:"timefield",emptyText:"[Jam:Mnt:Dtk]",format:"H:i:s",hideTrigger:true,bind:{readOnly:"{formConfig.viewOnly}"}}]},{xtype:"numberfield",textAlign:"right",fieldLabel:"Jumlah Piutang",reference:"jumlahpiutang",name:"TOTAL",emptyText:"[ Rp. ]",minValue:0,hideTrigger:true,bind:{readOnly:"{formConfig.viewOnly}"},allowBlank:false,listeners:{change:"onChange"}},{xtype:"radiogroup",fieldLabel:"Jenis Pembayaran",reference:"jenispembayaran",columns:2,defaults:{allowBlank:false},bind:{readOnly:"{formConfig.viewOnly}"},name:"JENIS_PEMBAYARAN",layout:{autoFlex:false},defaults:{margin:"0 15 0 0"},items:[{boxLabel:"Bayar Sekaligus",checked:true,inputValue:"1"},{boxLabel:"Angsuran",inputValue:"2"}],listeners:{change:"onChange"}},{xtype:"numberfield",fieldLabel:"Lama Angsuran",name:"LAMA_ANGSURAN",reference:"lamaangsuran",value:0,minValue:0,allowBlank:false,bind:{readOnly:"{formConfig.viewOnly}"},listeners:{change:"onChange"}},{xtype:"numberfield",textAlign:"right",fieldLabel:"Besar Angsuran",name:"BESAR_ANGSURAN",emptyText:"[ Rp. ]",minValue:0,hideTrigger:true,bind:{readOnly:"{formConfig.viewOnly}",value:"{record.BESAR_ANGSURAN}"},allowBlank:false}]}],buttons:[{text:"Simpan",ui:"soft-blue",iconCls:"x-fa fa-save",handler:"onSimpan",bind:{hidden:"{!formConfig.simpan}"},tooltip:{text:"Simpan",mouseOffset:[0,-75]}},{text:"Reset",ui:"soft-red",iconCls:"x-fa fa-refresh",handler:"onReset",bind:{hidden:"{!formConfig.simpan}"},tooltip:{text:"Reset",mouseOffset:[0,-75]}}],onLoadRecord:function(b,c){var a=b.down("[name=WAKTU]");a.setValue(c.get("TANGGAL"))},onBeforeGetRecord:function(b,d){var c=Ext.Date.clone(b.down("[reference=tanggal]").getValue()),a=b.down("[reference=waktu]").getValue();c.setHours(a.getHours());c.setMinutes(a.getMinutes());c.setSeconds(a.getSeconds());d.TANGGAL=c}});Ext.define("pembayaran.tagihan.piutang.perorangan.FormController",{extend:"Ext.app.ViewController",alias:"controller.piutangperorangan-form",onFocusEnter:function(d,a){},onReset:function(){var b=this,a=b.getView(),c=b.getViewModel().get("record");a.createRecord({TAGIHAN:c.get("TAGIHAN"),NAMA:"",SHDK:"",JENIS_KARTU:"",TANGGAL:a.getSysdate(),TOTAL:0,LAMA_ANGSURAN:0,BESAR_ANGSURAN:0,STATUS:1});a.focus("NAMA")},onSimpan:function(c){var b=this,a=b.getView();a.save(c,{},function(f,d,e){b.onReset()})},onChange:function(c,a,b){this.hitungBesarAngsuran()},privates:{hitungBesarAngsuran:function(){try{var b=this,a=b.getReferences();rec=b.getViewModel().get("record"),tp=a.jumlahpiutang.getValue(),jp=a.jenispembayaran.getValue(),la=a.lamaangsuran.getValue();if(rec){if(jp.JENIS_PEMBAYARAN==2){var d=la>0?tp/la:0;rec.set("JENIS_PEMBAYARAN",jp.JENIS_PEMBAYARAN);rec.set("BESAR_ANGSURAN",d)}else{rec.set("BESAR_ANGSURAN",tp)}}}catch(c){}}}});Ext.define("pembayaran.tagihan.piutang.perorangan.List",{extend:"com.Grid",alias:"widget.piutangperorangan-list",controller:"piutangperorangan-list",viewModel:{stores:{store:{type:"piutang-pasien-store"}}},columns:[{xtype:"rownumberer",text:"No",align:"left",width:60},{text:"Nama",dataIndex:"NAMA",width:300},{text:"No. Kartu Identitas",dataIndex:"NO_KARTU_IDENTITAS",width:150},{text:"Jenis Kartu",dataIndex:"JENIS_KARTU",width:120,renderer:"onRendererJenisKartu"},{text:"Alamat",dataIndex:"ALAMAT_TEMPAT_TINGGAL",flex:1},{xtype:"datecolumn",text:"Tanggal",dataIndex:"TANGGAL",format:"d/m/Y H:i:s",width:140},{xtype:"numbercolumn",text:"Total",dataIndex:"TOTAL",format:"0,00",align:"right",width:120},{xtype:"templatecolumn",text:"Jenis Pembayaran",dataIndex:"JENIS_PEMBAYARAN",width:120,xtype:"templatecolumn",tpl:Ext.create("Ext.XTemplate",'<div style="white-space:normal;">{[this.getDeskripsi(values.JENIS_PEMBAYARAN)]}</div>',{getDeskripsi:function(a){return(a==1)?"Bayar Sekaligus":(a==2)?"Angsuran":""}})},{text:"Lama Angsuran",dataIndex:"LAMA_ANGSURAN",align:"right",width:120},{xtype:"numbercolumn",text:"Besar Angsuran",dataIndex:"BESAR_ANGSURAN",format:"0,00",align:"right",width:120}]});Ext.define("pembayaran.tagihan.piutang.perorangan.ListController",{extend:"Ext.app.ViewController",alias:"controller.piutangperorangan-list",onRendererJenisKartu:function(e,c,d){var b=d.get("REFERENSI"),a=b?(b.JENIS_KARTU?b.JENIS_KARTU.DESKRIPSI:e):e;return a},onRendererJenisPembayaran:function(e,c,d){var b=d.get("REFERENSI"),a=b?(b.JENIS_PEMBAYARAN?b.JENIS_PEMBAYARAN.DESKRIPSI:e):e;return a}});Ext.define("pembayaran.tagihan.piutang.perorangan.Workspace",{extend:"com.Form",xtype:"workspace-piutangperorangan",controller:"workspace-piutangperorangan",layout:"border",items:[{region:"north",xtype:"piutangperorangan-form",title:"Form",reference:"piutangperoranganform",listeners:{save:"onSuccess"}},{region:"center",xtype:"piutangperorangan-list",title:"List",reference:"piutangperoranganlist"}],onLoadRecord:function(d,g){var e=d.down("piutangperorangan-list"),c=d.down("piutangperorangan-form");if(g){var a=g.get("STATUS")==1,b=d.app.xpriv("1204")?a:false,f={TAGIHAN:g.get("ID"),NAMA:"",SHDK:"",JENIS_KARTU:"",TANGGAL:c.getSysdate(),TOTAL:0,LAMA_ANGSURAN:0,BESAR_ANGSURAN:0,STATUS:1};c.setFormConfig({viewOnly:!b,simpan:b,minDate:g.get("TANGGAL"),maxDate:c.getSysdate()});c.createRecord(f);e.load({TAGIHAN:g.get("ID")})}}});Ext.define("pembayaran.tagihan.piutang.perorangan.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.workspace-piutangperorangan",onSuccess:function(e){var c=this,a=c.getView(),b=c.getReferences(),d=b.piutangperoranganlist;d.reload();a.fireEvent("save",e)}});Ext.define("pembayaran.tagihan.piutang.widget.Info",{extend:"com.Form",xtype:"pembayaran-tagihan-piutang-widget-info",controller:"pembayaran-tagihan-piutang-widget-info",viewModel:{stores:{piutangPasienStore:{type:"piutang-pasien-store"},piutangPenjaminStore:{type:"piutang-perusahaan-store"}},data:{total:0,pasien:undefined},formulas:{formatTotal:function(b){var c=b("total"),a=1;if(c.length<=5){a=2}else{if(c.length==6){a=3}else{if(c.length==7){a=1}else{if(c.length==8){a=2}else{if(c.length==9){a=3}else{if(c.length==10){a=1}else{if(c.length==11){a=2}else{if(c.length==11){a=3}}}}}}}}return Ext.util.Format.substr(c,0,a)+this.getDeskripsi(c.length)}},getDeskripsi:function(b){var a="";if(b>=5&&b<7){a="rb"}else{if(b>=7&&b<10){a="jt"}else{if(b>=10){a="m"}}}return a}},cls:"shadow-panel",border:true,firstLoad:true,layout:{type:"vbox",align:"stretch"},jenisPiutang:1,iconCls:"fas fa-file-invoice-dollar",title:"Piutang Pasien",header:{margin:0,padding:"5 10 5 10",cls:"x-color-w"},bodyPadding:5,items:[{xtype:"component",flex:1,style:"text-align: center; padding-top: 20px; font-size: 5em; font-weight: bold",bind:{html:"<h1>{formatTotal}</h1>"}}],dockedItems:[{xtype:"toolbar",dock:"bottom",items:[{flex:1,style:"border-radius:10px",text:"Pembayaran",xtype:"button",ui:"soft-red",handler:"onClickPembayaran"}]}],refresh:function(){var c=this,b=c.getViewModel(),a=b.get("pasien",a);c.getTotalPiutang(a.get("NORM")).then(function(d){b.set("total",d)})},getTotalPiutang:function(c){var e=this,g=e.jenisPiutang,d=e.getViewModel(),a=d.get("piutangPasienStore"),f=d.get("piutangPenjaminStore"),b=new Ext.Deferred();if(g==1){a.setQueryParams({NORM:c,GET_TOTAL:true});a.load({callback:function(i,h,k){if(k){var j=i[0];b.resolve(j.get("SISA_HARUS_BAYAR"))}else{b.reject("data tidak ditemukan")}}})}else{f.setQueryParams({NORM:c,GET_TOTAL:true});f.load({callback:function(i,h,k){if(k){var j=i[0];b.resolve(j.get("SISA_HARUS_BAYAR"))}else{b.reject("data tidak ditemukan")}}})}return b.promise}});Ext.define("pembayaran.tagihan.piutang.widget.InfoController",{extend:"Ext.app.ViewController",alias:"controller.pembayaran-tagihan-piutang-widget-info",onClickPembayaran:function(c){var e=this,a=e.getView(),b="pembayaran-piutang-pasien-workspace",d=e.getViewModel();if(a.jenisPiutang==2){b="pembayaran-piutang-perusahaan-workspace"}a.openDialog("",true,0,0,{title:"Pembayaran piutang Perorangan",xtype:b,showCloseButton:true},function(g,h){var f=h.down(b);f.load(d.get("pasien"));h.on("close",function(){a.refresh()})},c)}});Ext.define("pembayaran.tagihan.rincian.List",{extend:"com.Grid",alias:"widget.rincian-tagihan-list",controller:"rincian-tagihan-list",viewModel:{stores:{store:{type:"rincian-tagihan-store"}}},total:0,border:false,columns:[{xtype:"rownumberer",text:"No",align:"left",width:40},{xtype:"templatecolumn",tpl:new Ext.XTemplate('<div style="font-weight: bold; font-size: 12px; white-space:normal !important;">{[values.RUANGAN]} </div>'),text:"Unit Pelayanan",dataIndex:"RUANGAN",flex:1.3},{xtype:"templatecolumn",tpl:new Ext.XTemplate('<div style="font-weight: bold; font-size: 12px; white-space:normal !important;">{[values.LAYANAN]} </div>'),text:"Nama Pelayanan",dataIndex:"LAYANAN",flex:2},{xtype:"datecolumn",text:"Tgl Pelayanan",dataIndex:"TANGGAL",format:"d/m/Y H:i:s",width:150},{text:"JENIS RINCIAN",dataIndex:"JENIS_RINCIAN",width:150,hidden:true},{xtype:"numbercolumn",text:"Qty",dataIndex:"JUMLAH",width:60,align:"right"},{xtype:"numbercolumn",text:"Tarif/Harga (Rp)",dataIndex:"TARIF",align:"right",width:120,summaryRenderer:"onSummaryInfoRenderer"},{xtype:"numbercolumn",text:"TOTAL (Rp)",align:"right",format:"0,00",width:120,renderer:"onTotalRenderer",summaryRenderer:"onSummaryRenderer"}],features:[{ftype:"summary",dock:"bottom"}],dockedItems:[{xtype:"toolbar",dock:"top",items:["->",{xtype:"referensi-combo",reference:"filterby",triggers:{clear:{weight:0,cls:Ext.baseCSSPrefix+"form-clear-trigger",hidden:true,handler:"onClearClick"}},params:{JENIS:30},firstLoad:true,emptyText:"Filter berdasarkan:",width:300,listeners:{select:"onFilterBy",change:"onFilterByChange"}}]}],onBeforeLoad:function(c,b,a){var d=c.down("referensi-combo");c.total=0;if(a){if(a.clearFilter){a.clearFilter(true)}}d.select(null)},doAfterLoad:function(b,c,d,a){if(d){if(Ext.isArray(c)){Ext.Array.each(c,function(f){var e=f.get("JUMLAH")*f.get("TARIF");b.total+=e})}}}});Ext.define("pembayaran.tagihan.rincian.ListController",{extend:"Ext.app.ViewController",alias:"controller.rincian-tagihan-list",onTotalRenderer:function(f,d,e){var c=this,a=c.getView(),b=e.get("JUMLAH")*e.get("TARIF");return Ext.util.Format.number(b,"0,00")},onSummaryRenderer:function(d,b,c){var a='<span style="font-size: 17px; font-weight: bold">'+Ext.util.Format.number(this.getView().total,"0,00")+"</span>";return a},onSummaryInfoRenderer:function(){return'<span style="font-size: 17px; font-weight: bold">Total: </span>'},onFilterBy:function(a,b){if(b){this.doFilterBy(b);this.getReferences().filterby.getTrigger("clear").show()}},onFilterByChange:function(a,c,b){if(c==null){this.doFilterBy(c);this.getReferences().filterby.getTrigger("clear").hide();this.getReferences().filterby.select(null)}},onClearClick:function(a){this.onFilterByChange(a,null)},privates:{doFilterBy:function(d){var c=this,a=c.getView(),b=c.getStore("store");if(b){b.clearFilter(true);a.total=0;b.filterBy(function(f){if(d){var e=f.get("JENIS")==d.get("ID");if(e){a.total+=f.get("JUMLAH")*f.get("TARIF")}return e}a.total+=f.get("JUMLAH")*f.get("TARIF");return true})}}}});Ext.define("pembayaran.tagihan.rincian.Workspace",{extend:"com.Form",xtype:"workspace-rincian",controller:"workspace-rincian",layout:"fit",items:[{xtype:"rincian-tagihan-list"}],onLoadRecord:function(a,b){a.down("rincian-tagihan-list").load({RINCIAN:1,TAGIHAN:b.get("ID"),STATUS:1})}});Ext.define("pembayaran.tagihan.rincian.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.workspace-rincian"});Ext.define("pembayaran.transaksikasir.Detil",{extend:"com.Form",alias:"widget.transaksikasir-detil",controller:"transaksikasir-detil",layout:{type:"hbox",align:"stretch"},items:[{xtype:"fieldset",flex:1,defaultType:"displayfield",cls:" shadow-panel x-color-w",fieldDefaults:{labelWidth:"100%"},items:[{style:"font-size: 2em; font-weight: bold;",fieldLabel:"Unit"},{style:"font-size: 1em; font-weight: bold;",fieldLabel:"NAMA KASIR"},{xtype:"label",text:"Transaksi yang anda lakukan akan berpengaruh ke setoran kasir"}]},{xtype:"fieldset",layout:{type:"vbox",align:"stretch"},flex:1,defaultType:"displayfield",cls:" shadow-panel x-color-w",fieldDefaults:{labelWidth:"100%"},items:[{xtype:"textarea",emptyText:"[ Keterangan ]"},{xtype:"textfield",emptyText:"[ Tanggal / Jam ]"}]}]});Ext.define("pembayaran.transaksikasir.DetilController",{extend:"Ext.app.ViewController",alias:"controller.transaksikasir-detil"});Ext.define("pembayaran.transaksikasir.List",{extend:"com.Grid",alias:"widget.transaksi-kasir-list",controller:"transaksi-kasir-list",viewModel:{data:{listConfig:{filter:{enabled:false,kasir:false}}},stores:{store:{type:"transaksi-kasir-store"}}},title:"Transaksi Kasir",hideHeaders:true,tools:[{type:"refresh",callback:"onRefresh"}],dockedItems:[{xtype:"pagingtoolbar",hidden:true,bind:{store:"{store}",hidden:"{!listConfig.paging}"},dock:"bottom",beforePageText:"Hal.",afterPageText:"dari {0}",displayMsg:"Menampilkan {0} - {1} dari {2}",displayInfo:true},{xtype:"toolbar",dock:"top",overflowHandler:"menu",bind:{hidden:"{!listConfig.filter.enabled}"},items:[{xtype:"kasir-combo",reference:"kasircombo",listeners:{select:"onSelectKasirCombo"},bind:{hidden:"{!listConfig.filter.kasir}"}}]}],columns:[{xtype:"templatecolumn",flex:2,tpl:new Ext.XTemplate('<div style="font-weight: bold; font-size: 12px; white-space:normal !important;">No. {[values.NOMOR]} </div>','<div style="font-size: 12px; white-space:normal !important;"><span class="x-fa fa-folder-open"></span> {[this.tanggalFormat(values.BUKA)]}</div>','<div style="font-size: 12px; white-space:normal !important;"><span class="x-fa fa-folder"></span> {[this.tanggalFormat(values.TUTUP)]}</div>',{tanggalFormat:function(c){var d=Ext.isDate(c)?c:Ext.Date.parse(c,"Y-m-d H:i:s");return Ext.Date.format(d,"d-m-Y H:i:s")}})},{text:"Status",dataIndex:"STATUS",renderer:"onRendererStatus"}],listeners:{afterrender:"onAfterRender"}});Ext.define("pembayaran.transaksikasir.ListController",{extend:"Ext.app.ViewController",alias:"controller.transaksi-kasir-list",onRendererStatus:function(a){return a==1?"Buka":"Tutup"},onAfterRender:function(){var c=this,a=c.getView(),b=c.getReferences();b.kasircombo.setValue(a.app.usrid);b.kasircombo.load();a.setLoading(true);a.load({KASIR:a.app.usrid})},onSelectKasirCombo:function(c,e){var d=this,a=d.getView(),b=d.getReferences();if(e){a.setLoading(true);a.load({KASIR:e.get("ID")})}},onRefresh:function(){this.getView().reload()}});Ext.define("pembayaran.transaksikasir.Tab",{extend:"com.Tab",alias:"widget.listpasien-tab",viewModel:{type:"pembayaranmodel",data:{disableGrid:true}},bind:{disabled:"disableGrid"},cls:"x-br-top",border:false,items:[{title:"View Pasien Belum Bayar",layout:"fit",items:[{xtype:"pasienbelumbayar-list",reference:"pasienbelumbayarlist",showSearch:true}]}],load:function(a){var b=this.down("[reference=pasienbelumbayarlist]");b.load(a)}});Ext.define("pembayaran.widget.Info",{extend:"com.Form",alias:"widget.pembayaran-widget-info",controller:"pembayaran-widget-info",viewModel:{data:{pasien:undefined,dataFound:false},stores:{store:{type:"data-store-gabung-tagihan"}}},cls:"shadow-panel",border:true,firstLoad:true,isAfterRender:false,layout:{type:"vbox",align:"stretch"},header:{iconCls:"x-fa fa-credit-card",title:"Tagihan / Pembayaran",margin:0,padding:"5 10 5 10",cls:"x-color-w",layout:{type:"hbox",align:"middle"},items:[{xtype:"component",flex:1},{xtype:"button",iconCls:"x-fa fa-history",tooltip:"History Tagihan / Pembayaran",ui:"soft-cyan",bind:{},margin:"0 0 0 1",handler:"onHistoryTagihan"}]},bodyPadding:5,initComponent:function(){var a=this;a.items=[{xtype:"tagihan-list",viewConfig:{loadMask:false},multiSelect:true,reference:"tagihanlist",listeners:{viewtagihan:"onViewTagihan",rowcontextmenu:"onKlikKananTagihan"}}];a.callParent(arguments);a.createMenuContext()},createMenuContext:function(){var b=this,c=b.app.xpriv,a=[{text:"Gabung Tagihan",glyph:"xf05a@FontAwesome",scope:b.getController(),handler:"onGabungTagihan"}];if(c("1211",false)){a.push({text:"Batal Gabung Tagihan",glyph:"xf00d@FontAwesome",scope:b.getController(),handler:"onBatalGabungTagihan"})}b.menucontext=new Ext.menu.Menu({items:a});return b.menucontext},refresh:function(){var c=this,b=c.getViewModel(),a=c.getReferences(),d=b.get("pasien");if(a&&c.isAfterRender){if(c.firstLoad){a.tagihanlist.setGridConfig({paging:true});a.tagihanlist.setListConfig({pasienInfo:false});a.tagihanlist.loadStore({NORM:d.get("NORM")});c.firstLoad=false}else{a.tagihanlist.refresh()}}},listeners:{afterrender:"onAfterRender"}});Ext.define("pembayaran.widget.InfoController",{extend:"Ext.app.ViewController",alias:"controller.pembayaran-widget-info",tagihans:[],onViewTagihan:function(a){this.getView().fireEvent("viewtagihan",a)},onHistoryTagihan:function(h){var c=this,g=c.getViewModel(),b=g.get("pasien");this.getView().fireEvent("historytagihan",b)},onKlikKananTagihan:function(b,g,d,h,f){var c=this;refs=c.getReferences(),tagihan=refs.tagihanlist,pilihan=tagihan.getSelection();c.tagihans=[];if(pilihan.length<=2){var a=f.getXY();c.tagihans=pilihan;f.stopEvent();c.getView().menucontext.showAt(a)}},onGabungTagihan:function(c){var d=this,b=d.getReferences(),a=d.getView();a.openDialog("",true,900,220,{xtype:"workspace-gabung-tagihan",title:"Penggabungan Tagihan",ui:"panel-blue",showCloseButton:true},function(g,f){var e=f.down("workspace-gabung-tagihan");e.on("save",function(h){b.tagihanlist.refresh();f.close()});if(d.tagihans.length==2){e.createRecord({DARI:d.tagihans[0].get("ID"),KE:d.tagihans[1].get("ID"),STATUS:1,REFERENSI:{DARI:d.tagihans[0].data,KE:d.tagihans[1].data}})}else{if(d.tagihans.length==1){e.createRecord({DARI:d.tagihans[0].get("ID"),STATUS:1,REFERENSI:{DARI:d.tagihans[0].data}})}}})},onBatalGabungTagihan:function(d){var f=this,e=f.getViewModel(),c=e.get("store"),b=f.getView(),h=d.scope.tagihans?d.scope.tagihans:null,g=h?(h.length>0?h[0]:null):null,a=b.getReferensi(g.data,"TAGIHAN_PENDAFTARAN");if(g){if(g.get("STATUS")==1){if(a.length>1){c.setQueryParams({KE:g.get("ID")});c.load({scope:d,callback:function(i,j,k){if(k){if(i.length>0){b.showMessageBox({title:"Batal Gabung Tagihan",message:"Anda yakin ingin membatalkan gabung tagihan ini ?",ui:"window-warning",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,defaultButton:"no",animateTarget:d,fn:function(l){if(l==="yes"){c.removeAt(0);c.sync({callback:function(){refs.tagihanlist.refresh()}})}}})}}}})}}}},onAfterRender:function(){var b=this,a=b.getView();a.isAfterRender=true}});