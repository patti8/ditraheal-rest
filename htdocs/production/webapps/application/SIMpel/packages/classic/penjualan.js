Ext.define("penjualan.Workspace",{extend:"com.Tab",alias:"widget.penjualan-langsung-workspace",controller:"penjualan-langsung-workspace",cls:"x-br-top",ui:"nav-tab",initComponent:function(){var b=this;b.items=[{title:"Penjualan",xtype:"penjualan-workspace",listeners:{refreshitems:"onRefresh"}},{title:"History",xtype:"penjualan-history-workspace",reference:"historypenjualan"},{title:"Retur",xtype:"penjualan-retur-workspace",reference:"returpenjualan"}];b.callParent(arguments)},load:function(){var b=this.getActiveTab();if(b){b.load({})}},listeners:{tabchange:"onTabChange"}});Ext.define("penjualan.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.penjualan-langsung-workspace",onTabChange:function(c,b){if(b.load){b.load({})}},onRefresh:function(c){var d=this;d.getView().load({})}});Ext.define("penjualan.history.Detil",{extend:"com.Grid",alias:"widget.penjualan-history-detil",controller:"penjualan-history-detil",viewModel:{stores:{store:{type:"penjualan-detil-store"}}},columns:[{xtype:"rownumberer",text:"No",align:"left",width:50},{xtype:"templatecolumn",text:"Nama Obat",flex:1,sortable:false,tpl:'<div style="white-space:normal !important;">{REFERENSI.FARMASI.NAMA}</div>'},{text:"Jumlah",dataIndex:"JUMLAH",width:75},{text:"Retur",width:75,renderer:"onRenderRetur"},{text:"Aturan Pakai",xtype:"templatecolumn",flex:1,sortable:false,tpl:'<div style="white-space:normal !important;">{REFERENSI.ATURAN_PAKAI.DESKRIPSI}</div>'}]});Ext.define("penjualan.history.DetilController",{extend:"Ext.app.ViewController",alias:"controller.penjualan-history-detil",onRenderRetur:function(f,d,e){var b=this.getView(),c=0,g=b.getReferensi(e.data,"RETUR");if(g){Ext.Array.each(g,function(h){c+=Number(h.JUMLAH)})}return c}});Ext.define("penjualan.history.List",{extend:"com.Grid",alias:"widget.penjualan-history-list",controller:"penjualan-history-list",viewModel:{stores:{store:{type:"penjualan-store"}}},columns:[{xtype:"rownumberer",text:"No",align:"left",width:50},{text:"No.Transaksi",dataIndex:"NOMOR",renderer:"OnRenderStatusNomor",sortable:false,flex:1},{xtype:"datecolumn",text:"Tanggal",dataIndex:"TANGGAL",format:"d/m/Y H:i:s",sortable:false,flex:1},{xtype:"widgetcolumn",align:"center",text:"#",flex:1,widget:{xtype:"fieldcontainer",flex:1,defaults:{padding:2},items:[{xtype:"button",action:0,iconCls:"x-fa fa-print",text:"Cetak Faktur",ui:"soft-green",margin:"0 1 0 0",tooltip:"Cetak Ulang Faktur",handler:"OnCetakUlangKwitansiPenjualan"},{xtype:"button",action:0,iconCls:"x-fa fa-print",text:"Cetak Etiket",tooltip:"Cetak Ulang Etiket",handler:"OnCetakUlangEtiketPenjualan"}]}}]});Ext.define("penjualan.history.ListController",{extend:"Ext.app.ViewController",alias:"controller.penjualan-history-list",OnRenderStatusNomor:function(e,c,g){var f=g.get("NOMOR"),d=g.get("STATUS");if(d==1){return'<span style="color:black;">'+f+" - [ Belum Bayar ]</span>"}if(d==2){return'<span style="color:green;">'+f+" - [ Sudah Bayar ]</span>"}if(d==0){return'<span style="color:red;">'+f+" - [ Batal ]</span>"}},OnCetakUlangKwitansiPenjualan:function(e){var d=this,b=d.getView(),c=d.getViewModel();recs=e.ownerCt.getWidgetRecord();var f=recs.get("NOMOR");this.cetakBuktiPenjualan(f)},OnCetakUlangEtiketPenjualan:function(e){var d=this,b=d.getView(),c=d.getViewModel();recs=e.ownerCt.getWidgetRecord();var f=recs.get("NOMOR");this.cetakEtiketenjualan(f)},privates:{cetakBuktiPenjualan:function(h){var f=this,b=f.getView(),c="Word",e="docx",g=true,d="Cetak Rincian Penjualan";b.showMessageBox({title:d,message:"Tekan tombol Yes/Ya utk cetak langsung<br/>Tekan tombol No/Tidak untuk Preview",ui:"window-blue",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,defaultButton:"yes",animateTarget:f,fn:function(i){if(i!="yes"){c="Pdf";e="pdf";g=false}b.cetak({TITLE:d,NAME:"penjualan.CetakFakturPenjualan",TYPE:c,EXT:e,PARAMETER:{PTAGIHAN:h,PJENIS:4},REQUEST_FOR_PRINT:g,PRINT_NAME:"CetakResep"})}})},cetakEtiketenjualan:function(h){var f=this,b=f.getView(),c="Word",e="docx",g=true,d="Cetak Etiket Penjualan";b.showMessageBox({title:d,message:"Tekan tombol Yes/Ya utk cetak langsung<br/>Tekan tombol No/Tidak untuk Preview",ui:"window-blue",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,defaultButton:"yes",animateTarget:f,fn:function(i){if(i!="yes"){c="Pdf";e="pdf";g=false}b.cetak({TITLE:d,NAME:"penjualan.CetakEtiket",TYPE:c,EXT:e,PARAMETER:{PPENJUALAN:h},REQUEST_FOR_PRINT:g,PRINT_NAME:"CetakEtiket"})}})}}});Ext.define("penjualan.history.Workspace",{extend:"com.Form",alias:"widget.penjualan-history-workspace",controller:"penjualan-history-workspace",layout:"border",items:[{region:"center",title:"List",flex:3,xtype:"penjualan-history-list",reference:"penjualanhistorylist",listeners:{select:"onSelectedHistoryPenjualan"}},{region:"east",xtype:"penjualan-history-detil",title:"Detil",reference:"penjualanhistorydetil",flex:2,collapsible:true,split:true}],onLoadRecord:function(c,e){var d=c.down("[reference=penjualanhistorylist]"),b=c.down("[reference=penjualanhistorydetil]");d.setListConfig({paging:true});b.setListConfig({paging:true});d.loadStore({})}});Ext.define("penjualan.history.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.penjualan-history-workspace",onSelectedHistoryPenjualan:function(c,d){var b=this.getReferences();b.penjualanhistorydetil.loadStore({PENJUALAN_ID:d.get("NOMOR"),STATUS:d.get("STATUS")})}});Ext.define("penjualan.penjualan.Detil",{extend:"com.Grid",alias:"widget.penjualan-detil",controller:"penjualan-detil",viewModel:{stores:{store:{type:"penjualan-detil-store"}},data:{hide:true,pengurang:0,datatotal:0,jumlrec:0,idlap:undefined,margin:0,harga:0}},header:{iconCls:"x-fa fa-list",padding:"7px 7px 7px 7px",title:"Detail"},ui:"panel-cyan",layout:"fit",total:0,initComponent:function(){var b=this;b.cellEditing=new Ext.grid.plugin.CellEditing({clicksToEdit:1,listeners:{beforeedit:"BeforeEdit"}});b.plugins=[b.cellEditing];b.columns=[{xtype:"rownumberer",text:"No",align:"left",width:50},{xtype:"templatecolumn",text:"Nama Obat",flex:3,sortable:false,tpl:"<div>{REFERENSI.BARANG.REFERENSI.BARANG.NAMA}</div>"},{text:"Aturan Pakai",dataIndex:"ATURAN_PAKAI",sortable:false,renderer:"onRenderAturanPakai",flex:2},{text:"Qty",dataIndex:"JUMLAH",sortable:false,flex:1,editor:{xtype:"numberfield",hideTrigger:true,reference:"jumlah",name:"JUMLAH"}},{text:"Harga",format:"0,00",renderer:"Renderhargasatuan",align:"right",width:100,summaryRenderer:"onSummaryInfoRenderer"},{xtype:"numbercolumn",text:"Jumlah",align:"right",format:"0,00",width:120,renderer:"onTotalRenderer",summaryRenderer:"onSummaryRenderer"},{xtype:"widgetcolumn",align:"center",text:"#",width:70,widget:{xtype:"fieldcontainer",flex:1,defaults:{padding:2},items:[{xtype:"button",action:0,iconCls:"x-fa fa-minus-circle",ui:"soft-red",handler:"onBatalPenjualan"}]}}],b.features=[{ftype:"summary",style:"border:1px #CCC solid;background:red",dock:"bottom"}];b.callParent(arguments)},dataOperator:function(b,d){var c=this;vm=c.getViewModel();total=vm.get("datatotal");if(d=="tambah"){vm.set("datatotal",total+b)}else{if(d=="kurang"){vm.set("datatotal",total-b)}else{if(d=="nilaitotal"){vm.set("datatotal",b)}else{if(d=="reset"){vm.set("datatotal",0)}}}}},getTotal:function(){var d=this,c=d.getViewModel(),b=c.get("store"),e=0;b.each(function(i){var g=d.getReferensi(i.data,"BARANG"),f=g?d.getReferensi(g,"BARANG"):null,m=g?d.getReferensi(f,"HARGA"):null,n=m?m.HARGA_JUAL:0,h=f?f.KATEGORI:0,j=h!="10701"?(c.get("margin")*n/100):0,k=parseFloat(n)+parseFloat(j),l=i.get("JUMLAH")*k;e=e+l});return e},addRow:function(h){var e=this,b=e.getViewModel().get("store"),g=e.getReferensi(h.data,"BARANG"),d=g?e.getReferensi(g,"BARANG"):null,c=g?e.getReferensi(d,"HARGA"):null,f=h.get("JUMLAH")*(c?c.HARGA_JUAL:0);b.add(h);e.dataOperator(f,"tambah")},removeAnotherModels:function(){var f=this.getViewModel().get("store"),e=[];f.each(function(b){if(Ext.getClassName(b)!="data.model.PenjualanDetil"){e.push(b)}});var d=new Ext.util.DelayedTask(function(){f.remove(e)});d.delay(100)},setMargin:function(d){var c=this,b=c.getViewModel();b.set("margin",d.MARGIN);c.updateData(d)},updateData:function(e){var d=this,c=d.getViewModel(),b=c.get("store");b.each(function(j){var i=d.getReferensi(j.data,"BARANG"),f=i?d.getReferensi(i,"BARANG"):null,h=f?f.KATEGORI:0,g=h!="10701"?e.ID:0;j.set("MARGIN",g)})}});Ext.define("penjualan.penjualan.DetilController",{extend:"Ext.app.ViewController",alias:"controller.penjualan-detil",currentRecord:undefined,BeforeEdit:function(c,f,b){var d=this;d.currentRecord=f.record},onTotalRenderer:function(d,o,g){var k=this,j=k.getViewModel(),n=k.getView(),c=n.getReferensi(g.data,"BARANG"),b=c?n.getReferensi(c,"BARANG"):null,i=c?n.getReferensi(b,"HARGA"):null,e=b?b.KATEGORI:0,m=i?i.HARGA_JUAL:0,f=e!="10701"?(j.get("margin")*m/100):0,h=parseFloat(m)+parseFloat(f),l=g.get("JUMLAH")*h;return'<span style="color:black;"> Rp. '+Ext.util.Format.number(l,"0,00")+"</span>"},onSummaryInfoRenderer:function(d,b,c){return'<span style="color:black;"> Total </span>'},onSummaryRenderer:function(f,d,e){var c=this.getView(),b='<span style="font-size: 17px; font-weight: bold">'+Ext.util.Format.number(c.getTotal(),"0,00")+"</span>";return'<span style="color:black;"> Rp. '+b+"</span>"},Renderhargasatuan:function(d,n,g){var k=this,j=k.getViewModel(),m=k.getView(),c=m.getReferensi(g.data,"BARANG"),b=c?m.getReferensi(c,"BARANG"):null,i=c?m.getReferensi(b,"HARGA"):null,l=i?i.HARGA_JUAL:0,e=b?b.KATEGORI:0,f=e!="10701"?(j.get("margin")*l/100):0,h=parseFloat(l)+parseFloat(f);return'<span style="color:black;"> Rp. '+Ext.util.Format.number(h,"0,00")+"</span>"},onBatalPenjualan:function(e){var d=this,b=d.getView();a=d.getStore("store"),rec=e.ownerCt.getWidgetRecord(),brg=b.getReferensi(rec.data,"BARANG"),ktgrBrg=brg?b.getReferensi(brg,"BARANG"):null,hrg=brg?b.getReferensi(ktgrBrg,"HARGA"):null;hasil=rec.get("JUMLAH")*(hrg?hrg.HARGA_JUAL:0);b.dataOperator(hasil,"kurang");a.remove(rec)},onRenderAturanPakai:function(f,c,j){var i=j.get("ATURAN_PAKAI"),d=this.getView();if(Ext.isNumeric(i)){var h=d.getReferensi(j.data,"ATURANPAKAI"),e=h?h.DESKRIPSI:"";return e}else{var g=j.get("ATURAN_PAKAI");return'<span style="color:black;">'+g+"</span>"}}});Ext.define("penjualan.penjualan.Form",{extend:"com.Form",alias:"widget.penjualan-form",viewModel:{data:{formConfig:{disabledField:true}}},controller:"penjualan-form",model:"data.model.PenjualanDetil",layout:{type:"hbox"},defaultType:"textfield",ruangan:undefined,items:[{xtype:"combobox",name:"RUANGAN",allowBlank:false,enterFocus:true,flex:2,reference:"ruanganasal",margin:"0 10 0 0",displayField:"DESKRIPSI",valueField:"ID",queryMode:"local",emptyText:"[Ruangan ASAL]",store:{model:"data.model.Ruangan"},listeners:{select:"onSelectRuangan"}},{disabled:true,bind:{disabled:"{formConfig.disabledField}"},params:{STATUS:1},xtype:"barang-combo",flex:3,margin:"0 10 0 0",hideTrigger:true,reference:"barangcombo",allowBlank:false,name:"BARANG"},{xtype:"referensi-combo",params:{JENIS:41},minChars:1,name:"ATURAN_PAKAI",queryMode:"remote",queryParam:"QUERY",reference:"aturanpakai",emptyText:"[ Aturan Pakai ]",hideTrigger:true,typeAhead:true,disabled:true,bind:{disabled:"{formConfig.disabledField}"},flex:2,margin:"0 10 0 0",listeners:{beforequery:"onBeforeQuery"}},{xtype:"numberfield",name:"JUMLAH",flex:1,reference:"jumlah",emptyText:"Jumlah",allowBlank:false,hideTrigger:true,disabled:true,bind:{disabled:"{formConfig.disabledField}"},margin:"0 10 0 0",decimalPrecision:2,listeners:{specialkey:"onFocusEnter"}},{xtype:"button",iconCls:"x-fa fa-save",reference:"btnaddbarang",ui:"soft-green",handler:"onAddBarang",disabled:true,bind:{disabled:"{formConfig.disabledField}"}}],onLoadRecord:function(b,c){barangRecord=b.down("barang-combo"),storeBR=barangRecord.getViewModel().get("store"),combo=b.down("[name=RUANGAN]");if(b.ruangan==undefined){combo.select(null);combo.getStore().removeAll();b.setFormConfig({disabledField:true})}else{combo.select(b.ruangan)}combo.getStore().loadData(b.getPenggunaRuangan());b.getViewModel().set("isRuanganX",12345)},onBeforeGetRecord:function(d,e){var b=d.down("barang-combo").getSelection(),c=d.down("[reference=jumlah]").getValue(),f=d.down("[reference=aturanpakai]").getValue(),g=d.down("referensi-combo").getSelection();e.REFERENSI={RACIKAN:{ID:0,DESKRIPSI:"Non Racikan"}};e.JUMLAH=c;if(b){e.REFERENSI.BARANG=b.data}if(g){e.REFERENSI.ATURANPAKAI=g.data}},setBarangRuangan:function(e){var c=this,d=c.down("barang-combo"),b=d.getViewModel().get("store");d.select(null);b.removeAll();c.ruangan=e;c.setFormConfig({disabledField:false});b.queryParams={RUANGAN:e.get("ID"),STATUS:1};b.load();c.focus("BARANG")},getRuanganSelection:function(){var b=this,c=b.down("[name=RUANGAN]");return c.getSelection()}});Ext.define("penjualan.penjualan.FormController",{extend:"Ext.app.ViewController",alias:"controller.penjualan-form",onFocusEnter:function(b,e){if(e.getKey()===e.ENTER){this.getView().fireEvent("addbarang")}},onAddBarang:function(){var c=this,b=c.getView();if(b.getForm().isValid()){b.fireEvent("addbarang")}},onBeforeQuery:function(b){b.combo.getStore().removeAll()},onSelectRuangan:function(c,e){var d=this,b=d.getView();b.setBarangRuangan(e)}});Ext.define("penjualan.penjualan.Pengunjung",{extend:"com.Form",alias:"widget.penjualan-pengunjung",model:"data.model.Penjualan",viewModel:{data:{isResep:false}},layout:{type:"vbox",align:"stretch"},ui:"panel-cyan",border:true,header:{iconCls:"x-fa fa-file",padding:"7px 7px 7px 7px",title:"Pengunjung"},fieldDefaults:{labelAlign:"top"},items:[{xtype:"referensi-combo",params:{JENIS:78},defaultValue:2,emptyText:"[ Jenis ]",firstLoad:true,name:"JENIS",allowBlank:false,listeners:{select:"onSelectJenis"}},{hidden:true,bind:{hidden:"{!isResep}"},name:"DOKTER",reference:"dokterpemberiresep",xtype:"textfield",emptyText:"[ Dokter Pemberi Resep ]"},{name:"PENGUNJUNG",reference:"pengunjung",xtype:"textfield",emptyText:"[ Nama Pengunjung ]"},{name:"KETERANGAN",reference:"keterangan",xtype:"textarea",emptyText:"[ Keterangan ]",flex:1},{xtype:"container",layout:{type:"hbox",align:"stretch"},defaults:{margin:"0 2 1 0"},items:[{name:"TANGGAL",reference:"tanggal",flex:1,xtype:"datefield",emptyText:"[Pilih Tanggal Order]",format:"d/m/Y"},{name:"WAKTU",reference:"waktu",flex:1,xtype:"timefield",emptyText:"[Jam:Mnt:Dtk]",format:"H:i:s",hideTrigger:true}]}],buttons:[{text:"Selesaikan & Cetak",reference:"btnkirim",tooltip:"Selesai",flex:1,iconCls:"x-fa fa-save",handler:"onSimpan"}],onLoadRecord:function(e,f){try{var d=e.down("[reference=waktu]"),c=Ext.create("data.model.Referensi",{JENIS:78,ID:2,DESKRIPSI:"Non Resep"});jenis=e.down("[name=JENIS]");if(jenis.getStore().getCount()>0){jenis.select(c)}d.setValue(f.get("TANGGAL"))}catch(b){}},onBeforeGetRecord:function(c,e){var d=Ext.Date.clone(c.down("[reference=tanggal]").getValue()),b=c.down("[reference=waktu]").getValue();d.setHours(b.getHours());d.setMinutes(b.getMinutes());d.setSeconds(b.getSeconds());e.TANGGAL=d},setRuangan:function(c){var b=this.down("[reference=ruanganpenjualan]");b.setValue(c)}});Ext.define("penjualan.penjualan.Ruangan",{extend:"com.Form",alias:"widget.penjualan-ruangan",layout:{type:"vbox",align:"stretch"},bodyPadding:5,initComponent:function(){var b=this;b.items=[{xtype:"combobox",name:"RUANGAN",allowBlank:false,enterFocus:true,reference:"ruanganasal",enforceMaxLength:true,forceSelection:true,validateOnBlur:true,width:300,displayField:"DESKRIPSI",valueField:"ID",queryMode:"local",typeAhead:true,emptyText:"[Ruangan ASAL]",store:{model:"data.model.Ruangan"},listeners:{specialkey:"onFocusEnter",select:"onSelectPenjualannRuangan"}}];b.callParent(arguments)},onLoadRecord:function(d){var b=this,c=b.down("[name=RUANGAN]");c.getStore().loadData(b.getPenggunaRuangan())},getRuanganSelection:function(){var b=this,c=b.down("[name=RUANGAN]");return c.getSelection()}});Ext.define("penjualan.penjualan.RuanganController",{extend:"Ext.app.ViewController",alias:"controller.penjualan-ruangan",onAfterRender:function(){var d=this,c=d.getReferences(),b=d.getView();c.inventoryView.load();c.ruanganref.getStore().loadData(b.getPenggunaRuangan())},onFocusEnter:function(b,e){if(e.getKey()===e.ENTER){this.getView().fireEvent("addbarang")}},onSelectRuangan:function(d,b){this.getView().fireEvent("selectruangan",b,1)}});Ext.define("penjualan.penjualan.Workspace",{extend:"com.Form",alias:"widget.penjualan-workspace",controller:"penjualan-workspace",viewModel:{stores:{storesMargin:{type:"master-marginpenjaminfarmasi-store"}}},layout:{type:"hbox",align:"stretch"},items:[{flex:2,margin:"0 10px 0 0",layout:"border",items:[{region:"north",border:true,xtype:"penjualan-form",reference:"penjualanform",listeners:{addbarang:"onAddBarang"}},{region:"center",xtype:"penjualan-detil",reference:"penjualandetil"}]},{flex:1,xtype:"penjualan-pengunjung",reference:"penjualanpengunjung"}],onLoadRecord:function(b,c){pengunjung=b.down("penjualan-pengunjung"),form=b.down("penjualan-form");pengunjung.createRecord({TANGGAL:b.getSysdate()});form.createRecord({});form.focus("RUANGAN")},isCekMargin:function(b,e,f){var d=this,c=d.getViewModel().get("storesMargin");if(c){c.setQueryParams({PENJAMIN:b,JENIS:e,STATUS:1,start:0,limit:1});c.load(function(h,g,i){if(Ext.isArray(h)){f(h.length>0)}})}}});Ext.define("penjualan.penjualan.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.penjualan-workspace",margin:undefined,onSelectJenis:function(f,d){var g=this,c=g.getView(),e=g.getReferences(),b=1,h=d.get("ID");if(d){f.ownerCt.getViewModel().set("isResep",h==1);c.isCekMargin(b,h,function(m){g.margin=undefined;if(m){var i=g.getViewModel().get("storesMargin"),l=i.getAt(0),j=l?l.get("ID"):0,k=l?l.get("MARGIN"):0;e.penjualandetil.setMargin({ID:j,MARGIN:k});g.margin=l}else{e.penjualandetil.setMargin({ID:0,MARGIN:0})}})}},onAddBarang:function(k){var i=this,j=i.getView(),e=i.getReferences(),h=e.penjualanform.getRecord();if(h){if(i.margin){var d=j.getReferensi(h.data,"BARANG"),c=d?j.getReferensi(d,"BARANG"):null,f=c?c.KATEGORI:0,g=f!="10701"?i.margin.get("ID"):0;h.set("MARGIN",g)}e.penjualandetil.addRow(h);e.penjualanform.createRecord({});e.penjualanform.focus("BARANG")}},onSimpan:function(j){var e=this,g=e.getView(),f=e.getReferences(),c=f.penjualanpengunjung.getRecord(),i=f.penjualandetil.getArrayData(),b=f.penjualandetil.getTotal(),d=f.penjualanform.getRuanganSelection();if(c){if(c.get("JENIS")==1&&(c.get("DOKTER")==null||c.get("DOKTER")=="")){g.notifyMessage("Pengisian Nama Dokter tidak boleh kosong!!!");return}c.set("RUANGAN",d.get("ID"));var h=[{TOTAL:b,JENIS:4,TANGGAL:c.get("TANGGAL")}];if(c&&i.length>0){c.set("TOTAL_PENJUALAN",h);c.set("PENJUALAN_DETIL",i);f.penjualanpengunjung.save(j,{success:"Transaksi Pejualan Berhasil"},function(m,k,l){if(l){g.fireEvent("refreshitems");e.onReset(m);e.cetakBuktiPenjualan(m.get("NOMOR"));e.cetakEtiketPenjualan(m.get("NOMOR"))}})}}},onReset:function(e){var c=this,d=c.getReferences();d.penjualanform.createRecord({});d.penjualanpengunjung.createRecord({TANGGAL:c.getView().getSysdate()});d.penjualanform.focus("BARANG");d.penjualandetil.removeDataStore();d.penjualandetil.dataOperator(0,"reset")},privates:{cetakBuktiPenjualan:function(h){var f=this,b=f.getView(),c="Word",e="docx",g=true,d="Cetak Rincian Penjualan";b.showMessageBox({title:d,message:"Tekan tombol Yes/Ya utk cetak langsung<br/>Tekan tombol No/Tidak untuk Preview",ui:"window-blue",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,defaultButton:"yes",animateTarget:f,fn:function(i){if(i!="yes"){c="Pdf";e="pdf";g=false}b.cetak({TITLE:d,NAME:"penjualan.CetakFakturPenjualan",TYPE:c,EXT:e,PARAMETER:{PTAGIHAN:h,PJENIS:4},REQUEST_FOR_PRINT:g,PRINT_NAME:"CetakResep"})}})},cetakEtiketPenjualan:function(h){var f=this,b=f.getView(),c="Word",e="docx",g=true,d="Cetak Etiket Penjualan";b.showMessageBox({title:d,message:"Tekan tombol Yes/Ya utk cetak langsung<br/>Tekan tombol No/Tidak untuk Preview",ui:"window-blue",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,defaultButton:"yes",animateTarget:f,fn:function(i){if(i!="yes"){c="Pdf";e="pdf";g=false}b.cetak({TITLE:d,NAME:"penjualan.CetakEtiket",TYPE:c,EXT:e,PARAMETER:{PPENJUALAN:h},REQUEST_FOR_PRINT:g,PRINT_NAME:"CetakEtiket"})}})}}});Ext.define("penjualan.retur.DaftarObat",{extend:"com.Grid",alias:"widget.penjualan-retur-daftar-obat",viewModel:{stores:{store:{type:"penjualan-detil-store"}}},columns:[{xtype:"rownumberer",text:"No",align:"left",width:50},{xtype:"templatecolumn",text:"Nama Obat",flex:1,sortable:false,tpl:'<div style="white-space:normal !important;">{REFERENSI.FARMASI.NAMA}</div>'},{text:"Jumlah",dataIndex:"JUMLAH",hideTrigger:true,width:75}]});Ext.define("penjualan.retur.Detil",{extend:"com.Grid",alias:"widget.penjualan-retur-detil",controller:"penjualan-retur-detil",viewModel:{stores:{store:{type:"returpenjualan-store"}}},columns:[{xtype:"rownumberer",text:"No",align:"left",width:50},{text:"Jumlah",dataIndex:"JUMLAH",width:75},{xtype:"datecolumn",text:"Tanggal Retur",dataIndex:"TANGGAL",format:"d/m/Y H:i:s",flex:1}]});Ext.define("penjualan.retur.DetilController",{extend:"Ext.app.ViewController",alias:"controller.penjualan-retur-detil",onBatalReturPenjualan:function(e){var f=this,d=f.getView(),c=e.ownerCt.getWidgetRecord(),b=c.get("STATUS");c.showError=true;c.animateTarget=e;c.scope=f;d.showMessageBox({title:"Pembatalan Retur",message:"Anda yakin ingin membatalkan Retur .. ?",ui:"window-warning",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,defaultButton:"no",animateTarget:e,fn:function(g){if(g==="yes"){c.set("STATUS",0);c.save({callback:function(h,i,j){if(j){d.notifyMessage("Pembatalan Retur berhasil");d.refresh()}else{c.set("STATUS",1)}}})}else{c.set("STATUS",b==1?0:1)}}})}});Ext.define("penjualan.retur.Form",{extend:"com.Form",alias:"widget.penjualan-retur-form",model:"data.model.ReturPenjualan",controller:"penjualan-retur-form",layout:{type:"vbox",align:"stretch"},defaults:{margin:"0 2 2 0"},fieldDefaults:{labelAlign:"top",msgTarget:"side"},bodyPadding:5,items:[{xtype:"datefield",format:"Y-m-d H:m:s",margin:"0 0 3 0",hideTrigger:true,name:"TANGGAL",reference:"tanggalretur",readOnly:true},{xtype:"numberfield",hideTrigger:true,reference:"jumlahretur",margin:"0 0 3 0",name:"JUMLAH"},{xtype:"button",text:"Retur",reference:"btnreturpenjualan",ui:"soft-green",iconCls:"x-fa fa-share",handler:"onSimpan",hidden:false,bind:{hidden:"{!formConfig.simpan}"}}],onLoadRecord:function(b,c){this.down("[reference=tanggalretur]").setValue(b.getSysdate());this.down("[reference=jumlahretur]").focus(false,100)}});Ext.define("penjualan.retur.FormController",{extend:"Ext.app.ViewController",alias:"controller.penjualan-retur-form",onSimpan:function(b){var c=this;view=c.getView();view.save(b,{success:"Data berhasil di retur"})}});Ext.define("penjualan.retur.List",{extend:"com.Grid",alias:"widget.penjualan-retur-list",viewModel:{stores:{store:{type:"penjualan-store"}}},columns:[{xtype:"rownumberer",text:"No",align:"left",width:50},{text:"No.Transaksi",dataIndex:"NOMOR",sortable:false,flex:1},{text:"Nama",dataIndex:"PENGUNJUNG",flex:1,sortable:false},{xtype:"datecolumn",text:"Tanggal",dataIndex:"TANGGAL",format:"d/m/Y H:i:s",sortable:false,flex:1}]});Ext.define("penjualan.retur.Workspace",{extend:"com.Form",alias:"widget.penjualan-retur-workspace",controller:"penjualan-retur-workspace",layout:"border",items:[{region:"west",title:"List",flex:1,collapsible:true,split:true,xtype:"penjualan-retur-list",reference:"penjualanreturlist",listeners:{select:"onSelectedListreturPenjualan"}},{region:"center",title:"Daftar Obat",xtype:"penjualan-retur-daftar-obat",reference:"penjualanreturdaftarobat",flex:1,listeners:{select:"onListSelectedReturObat"}},{region:"east",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"penjualan-retur-form",title:"Form",reference:"returpenjualanobatform",listeners:{save:"onReturPenjualan"}},{xtype:"penjualan-retur-detil",title:"Riwayat Retur",flex:1,reference:"returpenjualanobatdetil"}],collapsible:true,split:true}],onLoadRecord:function(e,g){var e=this,f=e.down("penjualan-retur-list"),c=e.down("penjualan-retur-daftar-obat"),b=e.down("penjualan-retur-detil"),d=e.down("penjualan-retur-form");f.setListConfig({paging:true});c.setListConfig({paging:true});b.setListConfig({paging:true});f.loadStore({STATUS:2});c.doAfterLoad=function(){b.load({PENJUALAN_DETIL_ID:0});d.setFormConfig({simpan:false})}}});Ext.define("penjualan.retur.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.penjualan-retur-workspace",onSelectedListreturPenjualan:function(f,b,d,e){var c=this.getReferences();c.penjualanreturdaftarobat.loadStore({PENJUALAN_ID:b.get("NOMOR")})},onListSelectedReturObat:function(e,b,c,d){this.resetReturPenjualan({PENJUALAN_ID:b.get("PENJUALAN_ID"),PENJUALAN_DETIL_ID:b.get("ID"),BARANG:b.get("BARANG")})},onReturPenjualan:function(b){this.resetReturPenjualan({PENJUALAN_ID:b.get("PENJUALAN_ID"),PENJUALAN_DETIL_ID:b.get("PENJUALAN_DETIL_ID"),BARANG:b.get("BARANG")})},resetReturPenjualan:function(c){var b=this.getReferences();b.returpenjualanobatdetil.loadStore({PENJUALAN_ID:c.PENJUALAN_ID,PENJUALAN_DETIL_ID:c.PENJUALAN_DETIL_ID,BARANG:c.BARANG});b.returpenjualanobatform.setFormConfig({simpan:true});b.returpenjualanobatform.createRecord({PENJUALAN_ID:c.PENJUALAN_ID,PENJUALAN_DETIL_ID:c.PENJUALAN_DETIL_ID,BARANG:c.BARANG})}});