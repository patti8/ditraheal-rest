Ext.define("mutu.indikator.Model",{extend:"data.model.Model",serviceName:"mutu/indikator",fields:[{name:"ID",type:"int"},{name:"KODE",type:"string"},{name:"NAMA",type:"string"},{name:"DEFINISI_OPERASIONAL",type:"string"},{name:"NUMERATOR",type:"string"},{name:"DENUMERATOR",type:"string"},{name:"PENGUKURAN",type:"string"},{name:"TARGET",type:"int"},{name:"STATUS",type:"int"}],idProperty:"ID"});Ext.define("mutu.indikator.Store",{extend:"data.store.Store",model:"mutu.indikator.Model",alias:"store.mutu-indikator-store"});Ext.define("mutu.indikator.data.Model",{extend:"data.model.Model",serviceName:"mutu/indikator/data",fields:[{name:"ID",type:"int"},{name:"INDIKATOR",type:"int"},{name:"RUANGAN",type:"string"},{name:"TANGGAL",type:"date",dateFormat:"Y-m-d"},{name:"NUM",type:"int"},{name:"DENUM",type:"int"},{name:"OLEH",type:"int"},{name:"DATA_DASAR",type:"int"},{name:"STATUS",type:"int"}],idProperty:"ID"});Ext.define("mutu.indikator.data.Store",{extend:"data.store.Store",model:"mutu.indikator.data.Model",alias:"store.mutu-indikator-data-store"});Ext.define("mutu.indikator.data.dasar.Model",{extend:"data.model.Model",serviceName:"mutu/indikator/datadasar",fields:[{name:"ID",type:"int"},{name:"DATA_INDIKATOR",type:"int"},{name:"NOREG",type:"string"},{name:"NORM",type:"int"},{name:"NUM",type:"int"},{name:"DENUM",type:"int"},{name:"NILAI",type:"int"},{name:"OLEH",type:"int"},{name:"DATA_DASAR",type:"int"},{name:"STATUS",type:"int"}],idProperty:"ID"});Ext.define("mutu.indikator.data.dasar.Store",{extend:"data.store.Store",model:"mutu.indikator.data.dasar.Model",alias:"store.mutu-indikator-data-dasar-store"});Ext.define("mutu.indikator.ruangan.Model",{extend:"data.model.Model",serviceName:"mutu/indikator/ruangan",fields:[{name:"RUANGAN",type:"string"},{name:"INDIKATOR",type:"int"},{name:"STATUS",type:"int"}]});Ext.define("mutu.indikator.ruangan.Store",{extend:"data.store.Store",model:"mutu.indikator.ruangan.Model",alias:"store.mutu-indikator-ruangan-store"});Ext.define("mutu.indikator.tindaklanjut.analisa.Model",{extend:"data.model.Model",serviceName:"mutu/indikator/analisa",fields:[{name:"ID",type:"int"},{name:"INDIKATOR",type:"int"},{name:"RUANGAN",type:"string"},{name:"TANGGAL_AWAL",type:"date",dateFormat:"Y-m-d"},{name:"TANGGAL_AKHIR",type:"date",dateFormat:"Y-m-d"},{name:"ANALISA",type:"string"},{name:"STATUS",type:"int"}],idProperty:"ID"});Ext.define("mutu.indikator.tindaklanjut.analisa.Store",{extend:"data.store.Store",model:"mutu.indikator.tindaklanjut.analisa.Model",alias:"store.mutu-indikator-tindaklanjut-analisa-store"});Ext.define("mutu.indikator.tindaklanjut.laporan.Model",{extend:"data.model.Model",serviceName:"mutu/indikator/laporan",fields:[{name:"ID",type:"int"},{name:"INDIKATOR",type:"int"},{name:"RUANGAN",type:"string"},{name:"TANGGAL_AWAL",type:"date",dateFormat:"Y-m-d"},{name:"TANGGAL_AKHIR",type:"date",dateFormat:"Y-m-d"},{name:"JUDUL",type:"string"},{name:"KETERANGAN",type:"string"},{name:"STATUS",type:"int"}],idProperty:"ID"});Ext.define("mutu.indikator.tindaklanjut.laporan.Store",{extend:"data.store.Store",model:"mutu.indikator.tindaklanjut.laporan.Model",alias:"store.mutu-indikator-tindaklanjut-laporan-store"});Ext.define("mutu.indikator.tindaklanjut.pdsa.Model",{extend:"data.model.Model",serviceName:"mutu/indikator/pdsa",fields:[{name:"ID",type:"int"},{name:"ANALISA",type:"int"},{name:"PLAN",type:"string"},{name:"DO",type:"string"},{name:"STUDY",type:"string"},{name:"ACTION",type:"string"},{name:"STATUS",type:"int"}],idProperty:"ID"});Ext.define("mutu.indikator.tindaklanjut.pdsa.Store",{extend:"data.store.Store",model:"mutu.indikator.tindaklanjut.pdsa.Model",alias:"store.mutu-indikator-tindaklanjut-pdsa-store"});Ext.define("mutu.Workspace",{extend:"com.Form",xtype:"mutu-workspace",controller:"mutu-workspace",layout:"fit",bodyPadding:2,items:[{xtype:"com-form",ui:"panel-black",title:"Mutu",titleFieldConfig:{},fullscreenEnabled:true,menuConfig:{enabled:true,width:260,buttonConfig:{}},fullscreenConfig:{},header:{items:[{}]}}],load:function(a){var e=this,b=this.down("com-form");b.setMenus(e.childmenu("9002",2,2))},childmenu:function(g,f,a){var e=this,b=[];xuam=Ext.JSON.decode(Ext.util.Base64.decode(e.app.xuam));xuam.forEach(function(j,h){j=Ext.JSON.decode(Ext.util.Base64.decode(j));if(j.ID.substring(0,a+2)==g&&j.LEVEL==f+1){var k={text:j.DESKRIPSI,leaf:j.HAVE_CHILD==0,iconCls:j.ICON_CLS};if((j.HAVE_CHILD=="0")&&(j.CLASS!=null)){k.className=j.CLASS;k.idClassName=e.replaceAll(j.CLASS.toLowerCase(),".","_")}else{k.children=e.childmenu(j.ID,parseInt(j.LEVEL),a+2)}if((j.HAVE_CHILD=="1")||(j.CLASS!=null)){b.push(k)}}});return b}});Ext.define("mutu.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.mutu-workspace"});Ext.define("mutu.indikator.Combo",{extend:"com.Combo",alias:"widget.mutu-indikator-combo",viewModel:{stores:{store:{type:"mutu-indikator-store"}}},queryMode:"remote",hideTrigger:true,queryParam:"KODE",emptyText:"[INDIKATOR - CARI BERDASARKAN KODE]",displayField:"ID",valueField:"ID",minChars:2,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">','<div"><strong>{KODE} - {NAMA}</strong></div>',"</div>","</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{KODE} - {NAMA}","</tpl>")});Ext.define("mutu.indikator.Form",{extend:"com.Form",xtype:"mutu-indikator-form",controller:"mutu-indikator-form",model:"mutu.indikator.Model",layout:{type:"hbox",align:"stretch"},defaults:{border:false,margin:"2.2.2.2",flex:1},items:[{layout:{type:"vbox",align:"stretch"},defaultType:"textarea",defaults:{labelAlign:"top",margin:"2.2.2.2",bind:{readOnly:"{formConfig.viewOnly}"}},items:[{fieldLabel:"Kode",maxLength:50,name:"KODE",xtype:"textfield"},{fieldLabel:"Nama Indikator",name:"NAMA",maxLength:500},{fieldLabel:"Definisi Operasional",name:"DEFINISI_OPERASIONAL"}]},{layout:{type:"vbox",align:"stretch"},defaultType:"textarea",defaults:{labelAlign:"top",margin:"2.2.2.2"},items:[{xtype:"panel",layout:{type:"hbox",align:"stretch"},defaults:{labelAlign:"top",flex:1},border:false,items:[{fieldLabel:"Cara Pengukuran",name:"PENGUKURAN",maxLength:200,xtype:"textfield",bind:{readOnly:"{formConfig.viewOnly}"}},{fieldLabel:"Target (%)",name:"TARGET",hideTrigger:true,xtype:"numberfield",bind:{readOnly:"{formConfig.viewOnly}"}}]},{fieldLabel:"Numerator",name:"NUMERATOR",bind:{readOnly:"{formConfig.viewOnly}"}},{fieldLabel:"Denumerator",name:"DENUMERATOR",bind:{readOnly:"{formConfig.viewOnly}"}}]}],buttons:[{text:"Simpan",bind:{hidden:"{formConfig.viewOnly}"},iconCls:"x-fa fa-save",ui:"soft-blue",handler:"onClickBtnSimpan"}]});Ext.define("mutu.indikator.FormController",{extend:"Ext.app.ViewController",alias:"controller.mutu-indikator-form",onClickBtnSimpan:function(b){var e=this,a=e.getView();a.save(b)}});Ext.define("mutu.indikator.Grid",{extend:"com.Grid",xtype:"mutu-indikator-grid",controller:"mutu-indikator-grid",viewModel:{stores:{store:{type:"mutu-indikator-store"}},data:{listConfig:{paging:true}}},singleColumn:false,initComponent:function(){var a=this;if(a.singleColumn){a.columns=[{xtype:"templatecolumn",dataIndex:"KODE",text:"Indikator Mutu",menuDisabled:true,sortable:false,align:"left",flex:1,tpl:new Ext.XTemplate('<div class="thumb-wrap">','<div class="thumb">',"<div !important;><b>Kode :</b> {KODE}</div>","<div !important;><b>Nama :</b> {NAMA}</div>",'<div style="white-space:normal !important;color:black"><b>Defenisi Operasional :</b> {DEFINISI_OPERASIONAL}</div>',"</div>","</div>",{})}]}else{a.columns=[{xtype:"rownumberer",text:"No",menuDisabled:true,sortable:false,align:"left",width:70},{text:"Kode",dataIndex:"KODE",flex:0.5},{text:"Nama Indikator",dataIndex:"NAMA",flex:1},{text:"Definisi Operasional",dataIndex:"DEFINISI_OPERASIONAL",flex:1},{text:"Numerator",dataIndex:"NUMERATOR",flex:1},{text:"Denumerator",dataIndex:"DENUMERATOR",flex:1},{text:"Cara Pengukuran",dataIndex:"PENGUKURAN",flex:1},{text:"Target (%)",dataIndex:"TARGET",flex:1},{xtype:"checkcolumn",header:"STATUS",dataIndex:"STATUS",menuDisabled:true,sortable:false,width:90,listeners:{checkchange:"onChangeStatus"}}]}a.callParent(arguments)}});Ext.define("mutu.indikator.GridController",{extend:"Ext.app.ViewController",alias:"controller.mutu-indikator-grid",onChangeStatus:function(g,a,k){var j=this,b=j.getView(),h=j.getViewModel(),e=h.get("store"),f=e.getAt(a);f.set("STATUS",k?1:0);f.scope=j;f.save({callback:function(l,m,n){if(n){b.notifyMessage("Status indikator di"+(k==true?"Aktifkan":"Non Aktifkan "),"danger-blue")}}})}});Ext.define("mutu.indikator.Wokrspace",{extend:"com.Form",xtype:"mutu-indikator-workspace",controller:"mutu-indikator-workspace",layout:{type:"border"},defaults:{border:true},header:{items:[{xtype:"search-field",flex:1,emptyText:"[ Cari Berdasakan Kode ]",listeners:{change:"onChange"}},{xtype:"button",iconCls:"x-fa fa-plus",ui:"soft-black",handler:"onBtnAddIndikator"}]},title:"Indikator Mutu",ui:"panel-cyan",iconCls:"x-fa fa-book",bodyPadding:0,items:[{region:"center",reference:"gridindikator",flex:1,xtype:"mutu-indikator-grid",listeners:{itemdblclick:"itmDBClickGrid"}}],load:function(e){var b=this,a=b.down("mutu-indikator-grid");a.load()}});Ext.define("mutu.indikator.WokrspaceController",{extend:"Ext.app.ViewController",alias:"controller.mutu-indikator-workspace",kode:"",privates:{showForm:function(e,b,g){var f=this,a=f.getView();a.openDialog("",true,950,400,{xtype:"mutu-indikator-form",showCloseButton:true,ui:"panel-black",iconCls:"x-fa fa-edit",title:"Form Indikator"},function(h,k){var j=k.down("mutu-indikator-form");if(b){j.createRecord(g)}else{j.loadRecord(g)}j.on("save",function(l){console.log("ad");a.load();k.close()})},e)},searchIndikator:function(){var f=this,b=f.getReferences(),e=b.gridindikator,g=e.getStore(),a=e.down("pagingtoolbar");if(f.kode==""){delete g.queryParams.KODE}else{e.setParams({KODE:f.kode})}if(a){a.moveFirst()}else{e.load()}}},onBtnAddIndikator:function(a){var b=this;b.showForm(a,true,{STATUS:1})},itmDBClickGrid:function(b,f,a){var e=this;e.showForm(b,false,f)},onChange:function(a,b){this.kode=b;this.searchIndikator()}});Ext.define("mutu.indikator.data.Form",{extend:"com.Form",xtype:"mutu-indikator-data-form",controller:"mutu-indikator-data-form",layout:{type:"vbox",align:"strecth"},defaults:{margin:"2.2.2.2",width:"100%"},items:[{xtype:"fieldset",title:"Ruangan",defaults:{width:"99%",margin:"2.2.2.2"},collapsible:true,defaultType:"ruangan-combo",items:[{xtype:"combobox",name:"RUANGAN",allowBlank:false,enterFocus:true,enforceMaxLength:true,forceSelection:true,validateOnBlur:true,flex:1,displayField:"DESKRIPSI",valueField:"ID",queryMode:"local",typeAhead:true,emptyText:"[Ruangan]",store:{model:"data.model.Ruangan"},listeners:{select:"onSelectRuangan"}}]},{xtype:"fieldset",title:"Periode",collapsible:true,defaults:{width:"99%",margin:"2.2.2.2"},items:[{xtype:"monthpicker",reference:"monthpickerperiode",showButtons:false}]},{xtype:"mutu-indikator-ruangan-combo",reference:"cmbIndikatorRuangan",emptyText:"[ Indikator berdasarkan ruangan]"},{layout:{type:"hbox",align:"strecth"},defaultType:"button",border:false,items:[{text:"Detail Indikator",ui:"soft-red",width:"50%",iconCls:"x-fa fa-list",handler:"onClickBtnDetail"},{text:"Data Indikator",ui:"soft-blue",width:"50%",iconCls:"x-fa fa-eye",handler:"onClickBtnLihat"}]}],loadRuangan:function(){var a=this,e=a.down("[name=RUANGAN]"),b=a.getPenggunaRuangan();e.getStore().loadData(b)}});Ext.define("mutu.indikator.data.FormController",{extend:"Ext.app.ViewController",alias:"controller.mutu-indikator-data-form",ruangan:undefined,privates:{loadCombo:function(g,f){var e=this,a=e.getView(),b=g.getStore();b.removeAll();b.setQueryParams(f);b.load()},blurRuangan:function(e,b){var f=b+1,a=e.nextJenis;if(f!=a){e.getStore().removeAll()}e.select(null)}},onSelectRuangan:function(f,j,e){var h=this,a=h.getView(),b=h.getReferences(),g=b.cmbIndikatorRuangan.getStore();h.ruangan=j.get("ID");g.removeAll();g.setQueryParams({RUANGAN:j.get("ID"),STATUS:1});g.load()},onBlurRuangan:function(b){var f=this,e=b.nextJenis+1;view=f.getView();for(i=e;i<=6;i++){f.blurRuangan(view.down("[nextJenis="+i+"]"),b.nextJenis)}},onClickBtnLihat:function(f){var g=this,a=g.getView(),e=g.getReferences(),b=e.cmbIndikatorRuangan.getValue(),k=e.monthpickerperiode.getValue();if(!g.ruangan){a.notifyMessage("Silahkan memilih ruangan terlebih dahulu ","danger-red")}else{if(!k[0]&&k[0]!=0){a.notifyMessage("Silahkan memilih bulan terlebih dahulu ","danger-red")}else{if(!k[1]){a.notifyMessage("Silahkan memilih tahun terlebih dahulu ","danger-red")}else{if(!b){a.notifyMessage("Silahkan memilih indikator terlebih dahulu ","danger-red")}else{var j=k[0]+1,h=(j>9)?j:"0"+j;a.fireEvent("sendParams",{RUANGAN:g.ruangan,TANGGAL:k[1]+"-"+h,sortperiode:true,INDIKATOR:b})}}}}},onClickBtnDetail:function(e){var f=this,a=f.getView(),b=f.getReferences(),g=b.cmbIndikatorRuangan.getSelection();if(!g){a.notifyMessage("Silahkan memilih indikator terlebih dahulu ","danger-red")}else{data=g.getData();a.openDialog("",true,950,400,{xtype:"mutu-indikator-form",showCloseButton:true,ui:"panel-black",title:"Detail Indikator"},function(j,h){form=h.down("mutu-indikator-form");form.setFormConfig({viewOnly:true});form.createRecord(data.REFERENSI.INDIKATOR)},e)}}});Ext.define("mutu.indikator.data.Grid",{extend:"com.Grid",xtype:"mutu-indikator-data-grid",controller:"mutu-indikator-data-grid",viewModel:{stores:{store:{type:"mutu-indikator-data-store"}},data:{tnum:0,tdenum:0}},features:[{ftype:"groupingsummary",groupHeaderTpl:"TOTAL :",hideGroupedHeader:true,enableGroupingMenu:true},{ftype:"summary",dock:"bottom"}],initComponent:function(){var a=this;a.cellEditing=new Ext.grid.plugin.CellEditing({clicksToEdit:1,listeners:{beforeedit:"onBeforeEdit",afteredit:"onAfterEdit"}});a.plugins=[a.cellEditing];a.columns=[{xtype:"datecolumn",format:"Y-m-d",text:"Tanggal",dataIndex:"TANGGAL",flex:0.7,align:"center"},{text:"Nilai",flex:1,columns:[{text:"Num",align:"right",dataIndex:"NUM",flex:0.5,editor:{xtype:"numberfield",hideTrigger:true},summaryType:"sum"},{text:"Denum",dataIndex:"DENUM",flex:0.5,align:"right",editor:{xtype:"numberfield",hideTrigger:true},summaryType:"sum"}]}];a.callParent(arguments)},dockedItems:[{xtype:"toolbar",dock:"bottom",items:["->",{xtype:"button",text:"Simpan",ui:"soft-blue",iconCls:"x-fa fa-save",handler:"onClickBtnSimpan"}]}],doAfterLoad:function(e,b,f,a){if(!f){if(b.length==0){e.showMessageBox({title:"Perhatian",message:"Data mutu belum dibuat<br> apakah anda ingin membuat data mutu ?",ui:"window-red",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(g){if(g==="yes"){e.otomaticInsertRecord()}}})}}},otomaticInsertRecord:function(){var h=this,f=h.getViewModel(),b=f.get("store"),j=b.getQueryParams(),a=j.TANGGAL,g=new Date(a+"-01"),e=Ext.Date.format(g,"m");i=0;h.setLoading(true);while(e==Ext.Date.format(Ext.Date.subtract(g,Ext.Date.DAY,-i),"m")){tanggal=Ext.Date.subtract(g,Ext.Date.DAY,-i);b.insert(b.getCount(),{TANGGAL:tanggal,INDIKATOR:j.INDIKATOR,RUANGAN:j.RUANGAN,NUM:0,DENUM:0,STATUS:1});i++}b.sync({callback:function(m,l,k){h.setLoading(false);h.reload()}})}});Ext.define("mutu.indikator.data.GridController",{extend:"Ext.app.ViewController",alias:"controller.mutu-indikator-data-grid",onClickBtnSimpan:function(e){var g=this,f=g.getViewModel(),a=g.getView(),b=f.get("store");a.showMessageBox({title:"Simpan Data Indikator",message:"Anda yakin ingin menyimpan data indikator?",ui:"window-red",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,animateTarget:e,fn:function(h){if(h==="yes"){if(b.getModifiedRecords().length>0){a.setLoading(true);b.sync({callback:function(l,k,j){a.notifyMessage("Data Mutu Indikator Telah Tersimpan");a.setLoading(false)}})}else{a.notifyMessage("Data Mutu Indikator Telah Tersimpan")}}}})},onBeforeEdit:function(b,a){var f=a.record,e=f.get("DATA_DASAR")==1?true:false;a.cancel=e},onAfterEdit:function(b,a){var e=a.record;if(e.get("NUM")<0){e.set("NUM",0)}if(e.get("DENUM")<0){e.set("DENUM",0)}}});Ext.define("mutu.indikator.data.Worksapce",{extend:"com.Form",xtype:"mutu-indikator-data-workspace",controller:"mutu-indikator-data-workspace",layout:{type:"border"},title:"Data Indikator",ui:"panel-blue",defaults:{margin:"1.1.1.1",border:true},iconCls:"x-fa fa-table",bodyPadding:0,items:[{title:"Form",region:"west",width:355,scrollable:true,xtype:"mutu-indikator-data-form",listeners:{sendParams:"onSendParams"}},{region:"center",flex:1,title:"Data Indikator",reference:"gridMutuIndikatorData",xtype:"mutu-indikator-data-grid",listeners:{select:"onSelectDataIndikatorGrid"}},{region:"east",flex:1,title:"Data Dasar",reference:"gridDataDasar",xtype:"mutu-indikator-data-dasar-grid",listeners:{reloadGrid:"onReloadGrid"}}],load:function(){var b=this,a=b.down("mutu-indikator-data-form");a.loadRuangan()}});Ext.define("mutu.indikator.data.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.mutu-indikator-data-workspace",onSendParams:function(g){var e=this,b=e.getReferences(),f=b.gridMutuIndikatorData,a=b.gridDataDasar;f.load(g);a.getStore().removeAll();a.removeDataIndikator()},onSelectDataIndikatorGrid:function(e,g,b){var f=this,a=f.getReferences();grdatadasar=a.gridDataDasar;grdatadasar.load({DATA_INDIKATOR:g.get("ID")});grdatadasar.setDataIndikator(g)},onReloadGrid:function(){var b=this,a=b.getReferences();a.gridMutuIndikatorData.reload()}});Ext.define("mutu.indikator.data.dasar.Form",{extend:"com.Form",xtype:"mutu-indikator-data-dasar-form",controller:"mutu-indikator-data-dasar-form",model:"mutu.indikator.data.dasar.Model",viewModel:{formulas:{getNamaLengkap:function(f){var e=f("pasien.GELAR_DEPAN")||"",g=f("pasien.GELAR_BELAKANG")||"";e=e==""?"":e+". ";g=g==""?"":", "+g;return e+f("pasien.NAMA")+g},getTglLahir:function(b){return Ext.Date.format(b("pasien.TANGGAL_LAHIR"),"d F Y")},getJenisKelamin:function(a){var e=a("pasien.REFERENSI"),b=e?(e.JENISKELAMIN?e.JENISKELAMIN.DESKRIPSI:""):"";return b}},data:{pasien:null}},layout:{type:"hbox"},defaults:{margin:"2 2 2 2",border:false},items:[{layout:{type:"vbox"},width:"55%",defaults:{margin:"2 2 2 2",width:"100%",border:false},items:[{xtype:"numberfield",hideTrigger:true,fieldLabel:"No.RM",name:"NORM",reference:"txtnorm",margin:"2 2 2 2",emptyText:"[ Masukkan NORM ]",listeners:{blur:"onBlurNorm"}},{layout:{type:"hbox"},defaults:{margin:"2 2 2 2"},items:[{fieldLabel:"No.Pendaftaran",reference:"txtnoreg",xtype:"textfield",width:"80%",readOnly:true,name:"NOREG",emptyText:"[ No. Pendaftaran ]"},{xtype:"button",width:"20%",iconCls:"x-fa fa-search",handler:"onClickBtnPendaftaran"}]},{layout:{type:"hbox"},defaults:{margin:"0 0 2 2"},items:[{xtype:"numberfield",fieldLabel:"Nilai",width:"80%",hideTrigger:true,name:"NILAI",emptyText:"[ Masukkan Nilai ]"},{xtype:"checkbox",reference:"pegawai",width:"20%",name:"NUM",inputValue:1,value:0,uncheckedValue:0,boxLabel:"Num",name:"NUM"}]}]},{layout:"vbox",width:"45%",defaults:{margin:"2 2 2 2",width:"100%",border:false},items:[{html:"<b>Detail Pasien </b> <hr>"},{bind:{html:"<b>No. RM : {pasien.NORM}</b>"}},{bind:{html:"Nama : {getNamaLengkap}"}},{bind:{html:"Jenis Kelamin : {getJenisKelamin}"}},{bind:{html:"Tgl. Lahir : {getTglLahir}"}},{bind:{html:"Alamat : {pasien.ALAMAT}"}}]}],buttons:[{xtype:"label",style:"color:red",text:"* Pilih nomor pendaftaran sebelum menyimpan"},"->",{text:"Simpan",ui:"soft-cyan",iconCls:"x-fa fa-save",handler:"onClickBtnSave"}]});Ext.define("mutu.indikator.data.dasar.FormController",{extend:"Ext.app.ViewController",alias:"controller.mutu-indikator-data-dasar-form",onClickBtnPendaftaran:function(f){var g=this,b=g.getReferences(),e=b.txtnorm.getValue(),a=b.txtnoreg;view=g.getView();if(e){view.openDialog("",true,900,400,{xtype:"pendaftaran-list",showCloseButton:true,ui:"panel-cyan",checkboxModel:true,selModel:{selType:"checkboxmodel",checkOnly:false,mode:"Single"},title:"Pendaftaran"},function(k,j){var h=j.down("pendaftaran-list");h.setGridConfig({paging:true});h.loadStore({NORM:e});h.getHeaderContainer().remove(9);h.on("select",function(m,n,l){a.setValue(n.get("NOMOR"))})},f)}else{view.showMessageBox({title:"Warning",message:"Masukkan NORM terlebih dahulu",ui:"window-red",buttons:Ext.Msg.OK,animateTarget:f})}},onBlurNorm:function(e,h,g){var f=this,b=e.getValue(),a=f.getReferences();noreg=a.txtnoreg,view=f.getView(),vm=f.getViewModel();if(b){view.setLoading(true);noreg.setValue(null);data.model.Pasien.load(b,{success:function(k,j){vm.set("pasien",k);view.setLoading(false)},failure:function(k,j){view.showMessageBox({title:"Warning",message:"Data pasien Tidak ditemukan",ui:"window-red",buttons:Ext.Msg.OK,animateTarget:e});vm.set("pasien",null);view.setLoading(false)}})}},onClickBtnSave:function(b){var e=this,a=e.getView(),f=a.getRecord();if(f.get("NOREG")){a.setLoading(true);a.save(b,{success:"Data pasien telah tersimpan",failed:"Gagal menyimpan data pasien"})}else{a.notifyMessage("Pilih nomor pendaftaran terlebih dahulu","danger-red")}}});Ext.define("mutu.indikator.data.dasar.Grid",{extend:"com.Grid",xtype:"mutu-indikator-data-dasar-grid",controller:"mutu-indikator-data-dasar-grid",viewModel:{stores:{store:{type:"mutu-indikator-data-dasar-store"}},data:{dtIndikator:undefined}},features:[{ftype:"groupingsummary",groupHeaderTpl:"TOTAL :",hideGroupedHeader:true,enableGroupingMenu:true},{ftype:"summary",dock:"bottom"}],columns:[{xtype:"templatecolumn",text:"Identitas Pasien",width:250,locked:true,tpl:new Ext.XTemplate('<div style="white-space:normal !important;">No.RM : {NORM}</div>','<div style="white-space:normal !important;">No.Pendaftaran : {NOREG}</div>','<div style="white-space:normal !important;">Nama : {[this.getNamaLengkap(values.REFERENSI.PASIEN)]}</div>','<div style="white-space:normal !important;">J.Kelamin : {[this.getJenisKelamin(values.REFERENSI.PASIEN)]}</div>','<div style="white-space:normal !important;">Tgl.Lahir : {[this.getTglLahir(values.REFERENSI.PASIEN)]}</div>',{getNamaLengkap:function(e){var a=e.GELAR_DEPAN||"",f=e.GELAR_BELAKANG||"";a=a==""?"":a+". ";f=f==""?"":", "+f;return a+e.NAMA+f},getJenisKelamin:function(e){var b=e.REFERENSI,a=b?(b.JENISKELAMIN?b.JENISKELAMIN.DESKRIPSI:""):"";return a},getTglLahir:function(b){var a=Ext.Date.format(new Date(b.TANGGAL_LAHIR),"d F Y");return a}})},{text:"Nilai",flex:1,columns:[{text:"Num",align:"right",dataIndex:"NUM",width:80,summaryType:"sum"},{text:"Denum",align:"right",dataIndex:"DENUM",summaryType:"sum",width:80}]},{text:"Nilai",align:"right",dataIndex:"NILAI",summaryType:"sum",width:80},{xtype:"datecolumn",format:"Y-m-d h:i:s",text:"Tanggal",dataIndex:"TANGGAL",width:140}],dockedItems:[{xtype:"toolbar",dock:"bottom",items:["->",{xtype:"button",text:"Tambah Pasien",ui:"soft-red",iconCls:"x-fa fa-plus",handler:"onClickBtnTambahPasien"}]}],getSumDataGrid:function(){var g=this,f=g.getViewModel(),b=f.get("store"),e=0,a=0;b.each(function(j,h){e=e+j.get("NUM");a=a+j.get("DENUM")});return{NUM:e,DENUM:a}},setDataIndikator:function(a){this.getViewModel().set("dtIndikator",a)},removeDataIndikator:function(){this.getViewModel().set("dtIndikator",undefined)}});Ext.define("mutu.indikator.data.dasar.GridController",{extend:"Ext.app.ViewController",alias:"controller.mutu-indikator-data-dasar-grid",onClickBtnTambahPasien:function(e){var g=this,a=g.getView(),f=g.getViewModel(),b=f.get("dtIndikator"),h=a.getStore().getQueryParams();if(b){a.openDialog("",true,650,270,{xtype:"mutu-indikator-data-dasar-form",showCloseButton:true,ui:"panel-red",iconCls:"x-fa fa-plus",title:"Tambah Pasien"},function(l,k){var j=k.down("mutu-indikator-data-dasar-form");j.createRecord({STATUS:1,DENUM:1,DATA_INDIKATOR:b.get("ID")});j.on("save",function(m){j.createRecord({STATUS:1,DENUM:1,DATA_INDIKATOR:b.get("ID")});j.setLoading(false);j.getViewModel().set("pasien",null);a.reload()});k.on("close",function(m){sumData=a.getSumDataGrid();if((sumData.NUM!=0)||(sumData.DENUM!=0)){b.set("DATA_DASAR",1);b.set("NUM",sumData.NUM);b.set("DENUM",sumData.DENUM);b.save({callback:function(p,n,o){a.fireEvent("reloadGrid",true)}})}})},e)}else{a.notifyMessage("Pilih tanggal terlebih dahulu","danger-red")}}});Ext.define("mutu.indikator.data.dasar.Workspace",{extend:"com.Form",xtype:"mutu-indikator-data-dasar-workspace",controller:"mutu-indikator-data-dasar-workspace",layout:{type:"border"},initComponent:function(){var a=this;a.items=[{region:"center",border:false,xtype:"mutu-indikator-data-dasar-form",flex:1}];a.callParent(arguments)}});Ext.define("mutu.indikator.data.dasar.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.mutu-indikator-data-dasar-workspace"});Ext.define("mutu.indikator.ruangan.Combo",{extend:"com.Combo",alias:"widget.mutu-indikator-ruangan-combo",viewModel:{stores:{store:{type:"mutu-indikator-ruangan-store"}}},emptyText:"[INDIKATOR]",displayField:"INDIKATOR",valueField:"INDIKATOR",minChars:2,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">','<div"><strong>{REFERENSI.INDIKATOR.KODE} - {REFERENSI.INDIKATOR.NAMA}</strong></div>',"</div>","</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{REFERENSI.INDIKATOR.KODE} - {REFERENSI.INDIKATOR.NAMA}","</tpl>")});Ext.define("mutu.indikator.ruangan.Grid",{extend:"com.Grid",xtype:"mutu-indikator-ruangan-grid",controller:"mutu-indikator-ruangan-grid",viewModel:{stores:{store:{type:"mutu-indikator-ruangan-store"}},data:{listConfig:{paging:true}}},header:{items:[{xtype:"search-field",emptyText:"Cari Berdasakan Indikator",flex:1,listeners:{search:"onSearch",clear:"onClear"}}]},columns:[{xtype:"rownumberer",text:"No",menuDisabled:true,sortable:false,align:"left",width:70},{xtype:"templatecolumn",text:"Indikator",dataIndex:"INDIKATOR",flex:1,tpl:new Ext.XTemplate("<div>{REFERENSI.INDIKATOR.KODE} - {REFERENSI.INDIKATOR.NAMA}</div>",{})},{xtype:"checkcolumn",header:"STATUS",dataIndex:"STATUS",menuDisabled:true,sortable:false,width:90,listeners:{checkchange:"onChangeStatus"}}]});Ext.define("mutu.indikator.ruangan.GridController",{extend:"Ext.app.ViewController",alias:"controller.mutu-indikator-ruangan-grid",query:"",privates:{pencarian:function(){var e=this,a=e.getView(),b=a.getStore();paging=a.down("pagingtoolbar");if(e.query==""){delete b.queryParams.QUERY}else{a.setParams({QUERY:e.query})}if(paging){paging.moveFirst()}else{a.load()}}},onSearch:function(a,b){this.query=b;this.pencarian()},onClear:function(a,b){this.query="";this.pencarian()},onChangeStatus:function(g,a,k){var j=this,b=j.getView(),h=j.getViewModel(),e=h.get("store"),f=e.getAt(a);f.set("STATUS",k?1:0);f.setId(f.get("RUANGAN")+"-"+f.get("INDIKATOR"));f.scope=j;f.save({callback:function(l,m,n){if(n){b.notifyMessage("Status indikator ruangan di"+(k==true?"Aktifkan":"Non Aktifkan "),"danger-blue")}}})}});Ext.define("mutu.indikator.ruangan.Workspace",{extend:"com.Form",xtype:"mutu-indikator-ruangan-workspace",controller:"mutu-indikator-ruangan-workspace",viewModel:{data:{ruangan:undefined}},layout:{type:"border"},bodyPadding:0,border:true,title:"Indikator Ruangan",ui:"panel-cyan",iconCls:"x-fa fa-th-list",defaults:{margin:"2 2 2 2 "},initComponent:function(){var b=this;b.items=[{xtype:"com-form",region:"west",flex:1,reference:"cardLayout",layout:{type:"card"},items:[{region:"west",header:{},xtype:"ruangan-tree",title:"Ruangan",collapsible:false,reference:"treeRuangan",flex:1,listeners:{select:"onSelectTreeRuangan"}},{header:{items:[{xtype:"search-field",flex:1,emptyText:"[ Cari Berdasakan Kode ]",listeners:{scope:b.getController(),change:"onChange"}}]},reference:"gridindikator",title:"Indikator",singleColumn:true,xtype:"mutu-indikator-grid",region:"center",flex:1,viewConfig:{plugins:{ptype:"gridviewdragdrop",enableDrop:false},copy:true}}],bbar:[{width:300,style:"color:#020202; font-weight:bold;",bind:{html:"{ruangan.DESKRIPSI}"}},"->",{text:"&laquo;  Kembali ke Ruangan",idxBtn:0,hidden:true,handler:"pageLayoutChange"},{text:"Master Indikator &raquo;",idxBtn:1,handler:"pageLayoutChange"}]},{region:"center",title:"Indikator Ruangan",reference:"gridIndikatorRuangan",flex:1,xtype:"mutu-indikator-ruangan-grid",viewConfig:{plugins:{ptype:"gridviewdragdrop",enableDrag:false},listeners:{scope:b.getController(),drop:"onDropIndikator"}}}];b.callParent(arguments);var a=b.down("ruangan-tree");gridInd=b.down("mutu-indikator-grid");gridInd.getHeaderContainer().add({xtype:"actioncolumn",width:80,align:"center",items:[{xtype:"tool",tooltip:"Tambah Indikator Ruangan",iconCls:"x-fa fa-plus-circle x-color-red",scope:b.getController(),handler:"onClickAddIndikator"}]});gridInd.setGridConfig({paging:false})},load:function(){var a=this,b=a.down("mutu-indikator-grid")}});Ext.define("mutu.indikator.ruangan.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.mutu-indikator-ruangan-workspace",kode:"",privates:{layoutChange:function(f,a,k){var j=this,b=j.getView(),e=j.getReferences(),h=e.cardLayout,g=h.getLayout();f.setHidden(true);b.down("[idxBtn = "+k+"]").setHidden(false);g.setActiveItem(a)},searchIndikator:function(){var f=this,b=f.getReferences(),e=b.gridindikator,g=e.getStore(),a=e.down("pagingtoolbar");if(f.kode==""){delete g.queryParams.KODE}else{e.setParams({KODE:f.kode})}if(a){a.moveFirst()}else{e.load()}},saveMappingIndikator:function(f,e){var h=this,a=h.getView(),g=h.getViewModel(),j=g.get("ruangan"),b=h.getReferences();e.showError=true;e.save({callback:function(m,k,l){if(l){a.notifyMessage("Data indikator telah ditambakan ke ruangan : "+j.get("DESKRIPSI"),"danger-blue");b.gridIndikatorRuangan.reload()}}})}},onSelectTreeRuangan:function(b,h){var f=this,a=f.getReferences(),e=f.getViewModel(),g=a.gridIndikatorRuangan;g.load({RUANGAN:h.get("ID")});e.set("ruangan",h)},pageLayoutChange:function(b){var e=b.idxBtn?0:1,a=this.getReferences();if(b.idxBtn==1){a.gridindikator.load({start:0,limit:500})}this.layoutChange(b,b.idxBtn,e)},onClickAddIndikator:function(l,m,b,k,h,e){var j=this,a=j.getViewModel(),f=a.get("ruangan");model=Ext.create("mutu.indikator.ruangan.Model",{RUANGAN:f.get("ID"),STATUS:1,INDIKATOR:e.get("ID")});j.saveMappingIndikator(l,model)},onDropIndikator:function(m,j,l,a){var k=this,e=k.getViewModel(),n=e.get("ruangan");d=Ext.Array.clone(j.records);c=0;Ext.Array.each(d,function(b){model=Ext.create("mutu.indikator.ruangan.Model",{RUANGAN:n.get("ID"),STATUS:1,INDIKATOR:b.get("ID")});c++;k.saveMappingIndikator(m,model)})},onChange:function(a,b){this.kode=b;this.searchIndikator()}});Ext.define("mutu.indikator.tindaklanjut.Form",{extend:"com.Form",xtype:"mutu-indikator-tindaklanjut-form",controller:"mutu-indikator-tindaklanjut-form",layout:{type:"hbox",align:"stretch"},defaults:{width:"50%",border:true},items:[{title:"Ruangan",defaults:{width:"100%",margin:"2 10 2 10"},layout:{type:"vbox"},defaultType:"ruangan-combo",items:[{fieldLabel:"Direktorat",params:{JENIS:1},firstLoad:true,nextCombo:"direksi",nextJenis:2,listeners:{select:"onSelectRuangan",blur:"onBlurRuangan"}},{fieldLabel:"Direktorat",reference:"direksi",nextCombo:"instalasi",nextJenis:3,listeners:{select:"onSelectRuangan",blur:"onBlurRuangan"}},{fieldLabel:"Instalasi",reference:"instalasi",nextCombo:"unit",nextJenis:4,listeners:{select:"onSelectRuangan",blur:"onBlurRuangan"}},{fieldLabel:"Unit",reference:"unit",nextCombo:"subunit",nextJenis:5,listeners:{select:"onSelectRuangan",blur:"onBlurRuangan"}},{fieldLabel:"Sub Unit",nextJenis:6,reference:"subunit",listeners:{select:"onSelectRuangan"}}]},{title:"Indikator & Periode",defaults:{width:"100%",margin:"2 10 2 10"},layout:{type:"vbox"},items:[{fieldLabel:"Indikator",firstLoad:true,xtype:"mutu-indikator-combo",reference:"cmbIndikatorRuangan",emptyText:"[ Indikator berdasarkan ruangan]",listeners:{select:"onSelectIndikator"}},{fieldLabel:"Tanggal Awal",xtype:"datefield",format:"Y-m-d",name:"TANGGAL_AWAL",emptyText:"[ Indikator berdasarkan ruangan]"},{fieldLabel:"Tanggal Akhir",xtype:"datefield",name:"TANGGAL_AKHIR",format:"Y-m-d",emptyText:"[ Indikator berdasarkan ruangan]"}]}],getValueFilter:function(){var e=this,a=e.down("[name = TANGGAL_AWAL]").getValue(),b=e.down("[name = TANGGAL_AKHIR]").getValue();obj={},title="",send=false;cnt=e.getController();if(!cnt.ruangan){title="Ruangan"}else{if(!cnt.indikator){title="Indikator"}else{if(!a||!b){title="Periode"}else{send=true}}}if(send){obj.RUANGAN=cnt.ruangan.getData();obj.INDIKATOR=cnt.indikator.getData();obj.PERIODE={AWAL:Ext.Date.format(a,"Y-m-d"),AKHIR:Ext.Date.format(b,"Y-m-d")};return obj}else{e.notifyMessage(title+" Tidak boleh kosong","danger-red");return false}}});Ext.define("mutu.indikator.tindaklanjut.FormController",{extend:"Ext.app.ViewController",alias:"controller.mutu-indikator-tindaklanjut-form",ruangan:undefined,indikator:undefined,privates:{loadCombo:function(g,f){var e=this,a=e.getView(),b=g.getStore();b.removeAll();b.setQueryParams(f);b.load()},blurRuangan:function(e,b){var f=b+1,a=e.nextJenis;if(f!=a){e.getStore().removeAll()}e.select(null)}},onSelectRuangan:function(f,j,e){var g=this,a=g.getView(),b=g.getReferences(),h=(f.nextCombo)?a.down("[reference="+f.nextCombo+"]"):false;if(h){g.loadCombo(h,{ID:j.get("ID"),JENIS:f.nextJenis,STATUS:1})}g.ruangan=j},onBlurRuangan:function(b){var f=this,e=b.nextJenis+1;view=f.getView(),rec=b.getSelection();f.ruangan=rec;for(i=e;i<=6;i++){f.blurRuangan(view.down("[nextJenis="+i+"]"),b.nextJenis)}},onSelectIndikator:function(a,b){this.indikator=b}});Ext.define("mutu.indikator.tindaklanjut.Workspace",{extend:"com.Form",xtype:"mutu-indikator-tindaklanjut-workspace",controller:"mutu-indikator-tindaklanjut-workspace",layout:{type:"card",align:"stretch"},bodyPadding:0,defaults:{border:true},border:true,items:[{title:"Indikator & Periode",iconCls:"x-fa fa-archive",ui:"panel-red",reference:"formindikator",xtype:"mutu-indikator-tindaklanjut-form"},{title:"Grafik",iconCls:"x-fa fa-area-chart",ui:"panel-blue",reference:"grafiklayout",xtype:"mutu-indikator-tindaklanjut-chart-workspace"},{title:"Analisa",iconCls:"x-fa fa-file",ui:"panel-green",reference:"analisalayout",xtype:"mutu-indikator-tindaklanjut-analisa-workspace"},{title:"Laporan & Balasan",iconCls:"x-fa fa-comments",ui:"panel-black",reference:"laporanlayout",xtype:"mutu-indikator-tindaklanjut-laporan-workspace"}],bbar:["->",{text:"Indikator & Periode",iconCls:"x-fa fa-archive x-color-red",idxBtn:0,handler:"onClickCard",disabled:true},{text:"Grafik",iconCls:"x-fa fa-area-chart x-color-blue",idxBtn:1,handler:"onClickCard"},{text:"Analisa",idxBtn:2,iconCls:"x-fa fa-file x-color-green",handler:"onClickCard"},{text:"Laporan & Balasan",idxBtn:3,iconCls:"x-fa fa-comments",handler:"onClickCard"},{text:"Cetak Grafik",iconCls:"x-fa fa-print x-color-red",handler:"onClickCetakGrafik"}],load:function(b){var f=this,g=webservice.app.xpriv,e=f.down("[idxBtn = 2]"),a=f.down("[idxBtn = 3]");e.setHidden(!g("90020301",true));a.setHidden(!g("90020303",true))}});Ext.define("mutu.indikator.tindaklanjut.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.mutu-indikator-tindaklanjut-workspace",jenisCetak:undefined,onClickCard:function(e){var g=this,a=g.getView(),b=g.getReferences(),f=a.getLayout(),h=b.formindikator.getValueFilter();if(h){f.setActiveItem(e.idxBtn);if(e.idxBtn==1){b.grafiklayout.load(h)}if(e.idxBtn==2){b.analisalayout.load(h)}if(e.idxBtn==3){b.laporanlayout.load(h)}a.down("[idxBtn = 0]").setDisabled(e.idxBtn==0);a.down("[idxBtn = 1]").setDisabled(e.idxBtn==1);a.down("[idxBtn = 2]").setDisabled(e.idxBtn==2);a.down("[idxBtn = 3]").setDisabled(e.idxBtn==3)}},onClickCetakGrafik:function(e){var f=this,a=f.getView(),b=f.getReferences(),g=b.formindikator.getValueFilter();if(g){a.openDialog("",400,180,true,{xtype:"com-form",showCloseButton:true,title:"Jenis Format Cetak",iconCls:"x-fa fa-print",ui:"panel-red",items:[{xtype:"combo",width:"100%",store:Ext.create("data.store.Store",{fields:["DESK","NAME"],data:[{DESK:"Grafik",NAME:"plugins.mutu.cetakGrafikIndikator"},{DESK:"Grafik, Analisa & PDSA",NAME:"plugins.mutu.cetakGrafikIndikatorAnalisa"}]}),displayField:"DESK",valueField:"NAME"}],buttons:[{scope:f,text:"Cetak",ui:"soft-black",handler:"onCetak"}]},function(h,j){var k=j.down("combo");k.on("select",function(m,n,l){f.jenisCetak=n});j.on("close",function(l){f.jenisCetak=undefined})},e)}},onCetak:function(e){var f=this,a=f.getView(),b=f.getReferences(),g=b.formindikator.getValueFilter(),h=f.jenisCetak;if(f.jenisCetak){a.cetak({NAME:h.get("NAME"),TYPE:"Pdf",EXT:"pdf",PARAMETER:{PINDIKATOR:g.INDIKATOR.ID,PRUANGAN:g.RUANGAN.ID,PTGL_AWAL:g.PERIODE.AWAL,PTGL_AKHIR:g.PERIODE.AKHIR},REQUEST_FOR_PRINT:false,PRINT_NAME:"CetakHasil"},function(j){a.printPreview(h.get("DESK"),j)})}}});Ext.define("mutu.indikator.tindaklanjut.analisa.Form",{extend:"com.Form",xtype:"mutu-indikator-tindaklanjut-analisa-form",controller:"mutu-indikator-tindaklanjut-analisa-form",model:"mutu.indikator.tindaklanjut.analisa.Model",bodyPadding:0,items:[{xtype:"textarea",width:"100%",name:"ANALISA",emptyText:"[ Analisa Berdasarakan Periode ]",allowBlank:false}],bbar:["->",{xtype:"button",ui:"soft-blue",text:"Simpan",iconCls:"x-fa fa-save",handler:"onClickBtnSave"}]});Ext.define("mutu.indikator.tindaklanjut.analisa.FormController",{extend:"Ext.app.ViewController",alias:"controller.mutu-indikator-tindaklanjut-analisa-form",onClickBtnSave:function(b){var e=this,a=e.getView();a.setLoading(true);a.save(b,{},function(h,f,g){a.setLoading(false)})}});Ext.define("mutu.indikator.tindaklanjut.analisa.Grid",{extend:"com.Grid",xtype:"mutu-indikator-tindaklanjut-analisa-grid",controller:"mutu-indikator-tindaklanjut-analisa-grid",viewModel:{stores:{store:{type:"mutu-indikator-tindaklanjut-analisa-store"}}},columns:[{xtype:"templatecolumn",text:"Ruangan",dataIndex:"RUANGAN",flex:0.5,tpl:new Ext.XTemplate('<div style="white-space:normal !important;">{REFERENSI.RUANGAN.DESKRIPSI}</div>',{})},{xtype:"templatecolumn",text:"Indikator",dataIndex:"INDIKATOR",flex:0.5,tpl:new Ext.XTemplate('<div style="white-space:normal !important;">{REFERENSI.INDIKATOR.KODE} - {REFERENSI.INDIKATOR.NAMA}</div>',{})},{text:"Tanggal",flex:0.7,columns:[{xtype:"datecolumn",align:"center",format:"Y-m-d",text:"Awal",dataIndex:"TANGGAL_AWAL",flex:1},{text:"Akhir",align:"center",xtype:"datecolumn",format:"Y-m-d",dataIndex:"TANGGAL_AKHIR",flex:1},{text:"Input",align:"center",xtype:"datecolumn",format:"Y-m-d H:i:s",dataIndex:"TANGGAL",flex:1}]},{text:"Analisa",dataIndex:"ANALISA",flex:1},{sortable:false,align:"center",xtype:"widgetcolumn",width:100,widget:{xtype:"button",style:"border-radius: 50px",ui:"soft-asperages",padding:2,text:"PDSA",iconCls:"x-fa fa-briefcase",handler:"onClickAddPDSA"}}]});Ext.define("mutu.indikator.tindaklanjut.analisa.GridController",{extend:"Ext.app.ViewController",alias:"controller.mutu-indikator-tindaklanjut-analisa-grid",onClickAddPDSA:function(b){var f=this,a=f.getView(),e=f.getViewModel();rec=b.getWidgetRecord();a.openDialog("",true,0,0,{xtype:"mutu-indikator-tindaklanjut-pdsa-workspace",showCloseButton:true,iconCls:"x-fa fa-briefcase",ui:"panel-cyan",title:"Form PDSA"},function(j,h){var g=h.down("mutu-indikator-tindaklanjut-pdsa-workspace");g.load(rec)},b)}});Ext.define("mutu.indikator.tindaklanjut.analisa.Workspace",{extend:"com.Form",xtype:"mutu-indikator-tindaklanjut-analisa-workspace",controller:"mutu-indikator-tindaklanjut-analisa-workspace",viewModel:{data:{deskripsi:null}},layout:{type:"vbox"},defaults:{width:"100%",border:false,margin:"0 0 0 0"},defaultType:"component",items:[{bind:{html:"<center><h2>Analisa Indikator : {deskripsi.INDIKATOR.KODE} - {deskripsi.INDIKATOR.NAMA}<h2><center>"}},{bind:{html:"<center>Ruangan : {deskripsi.RUANGAN.DESKRIPSI}, Periode : {deskripsi.PERIODE.AWAL} s/d {deskripsi.PERIODE.AKHIR}<center>"},margin:"0 0 5 0"},{border:true,xtype:"mutu-indikator-tindaklanjut-analisa-form",title:"Form Analisa",listeners:{save:"onSaveForm"}},{border:true,xtype:"mutu-indikator-tindaklanjut-analisa-grid",title:"Daftar Analisa",scrollable:true,flex:1}],load:function(g){var e=this,f=webservice.app.xpriv,b=e.down("mutu-indikator-tindaklanjut-analisa-form"),a=e.down("mutu-indikator-tindaklanjut-analisa-grid");if(!f("90020302",true)){a.getHeaderContainer().remove(4)}if(g){this.getViewModel().set("deskripsi",g);b.createRecord({RUANGAN:g.RUANGAN.ID,INDIKATOR:g.INDIKATOR.ID,TANGGAL_AWAL:g.PERIODE.AWAL,TANGGAL_AKHIR:g.PERIODE.AKHIR,STATUS:1});a.load({sortperiode:true,RUANGAN:g.RUANGAN.ID,INDIKATOR:g.INDIKATOR.ID,TANGGAL_AWAL:g.PERIODE.AWAL,TANGGAL_AKHIR:g.PERIODE.AKHIR})}}});Ext.define("mutu.indikator.tindaklanjut.analisa.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.mutu-indikator-tindaklanjut-analisa-workspace",onSaveForm:function(a){var e=this,b=e.getViewModel();e.getView().load(b.get("deskripsi"))}});Ext.define("mutu.indikator.tindaklanjut.chart.Form",{extend:"com.Form",alias:"widget.mutu-indikator-tindaklanjut-chart-form",controller:"mutu-indikator-tindaklanjut-chart-form",viewModel:{stores:{store:{type:"mutu-indikator-data-store"}}},items:[{xtype:"cartesian",reference:"chart",width:"100%",height:500,legend:{type:"sprite",docked:"right"},bind:{store:"{store}"},colors:["#df202f","#3282ba","#24db40"],insetPadding:40,axes:[{type:"numeric",fields:["TARGET","REALISASI","RATA_RATA"],position:"left",grid:true,minimum:0,maximum:100,renderer:"onAxisLabelRender"},{type:"category",fields:"GROUP_BULAN",position:"bottom",grid:true,label:{rotate:{degrees:-45}}}],series:[{type:"line",title:"Target",xField:"GROUP_BULAN",yField:"TARGET",marker:{type:"square",radius:4,lineWidth:2,fx:{duration:200,easing:"backOut"}},highlightCfg:{scaling:2},tooltip:{trackMouse:true,renderer:"onSeriesTooltipRender"}},{type:"line",title:"Realisasi",xField:"GROUP_BULAN",yField:"REALISASI",marker:{radius:4,lineWidth:2,fx:{duration:200,easing:"backOut"}},highlightCfg:{scaling:2},tooltip:{trackMouse:true,renderer:"onSeriesTooltipRender"}},{type:"line",title:"Rata-Rata",xField:"GROUP_BULAN",yField:"RATA_RATA",marker:{type:"triangle",radius:4,lineWidth:2,fx:{duration:200,easing:"backOut"}},highlightCfg:{scaling:2},tooltip:{trackMouse:true,renderer:"onSeriesTooltipRender"}}]}],load:function(f){var e=this,b=e.getViewModel(),a=b.get("store");a.removeAll();a.setQueryParams(f);a.load()}});Ext.define("mutu.indikator.tindaklanjut.chart.FormController",{extend:"Ext.app.ViewController",alias:"controller.mutu-indikator-tindaklanjut-chart-form",onAxisLabelRender:function(e,b,a){return a.renderer(b)+"%"},onSeriesTooltipRender:function(e,a,b){e.setHtml("Bulan : "+a.get("GROUP_BULAN")+"<br> Target : "+a.get("TARGET")+"% <br> Realisasi : "+a.get("REALISASI")+"% <br> Rata-rata  : "+a.get("RATA_RATA")+"%<br> Num : "+a.get("T_NUM")+"<br> Denum"+a.get("T_DENUM"))},onItemHighlightChange:function(b,e,a){this.setSeriesLineWidth(e,4);this.setSeriesLineWidth(a,2)},setSeriesLineWidth:function(b,a){if(b){b.series.setStyle({lineWidth:a})}}});Ext.define("mutu.indikator.tindaklanjut.chart.Workspace",{extend:"com.Form",xtype:"mutu-indikator-tindaklanjut-chart-workspace",viewModel:{data:{deskripsi:null}},layout:{type:"vbox",background:"white"},defaults:{width:"100%",border:true},items:[{xtype:"component",bind:{html:"<center><h2>Grafik Indikator : {deskripsi.INDIKATOR.KODE} - {deskripsi.INDIKATOR.NAMA}<h2><center>"}},{xtype:"component",bind:{html:"<center>Ruangan : {deskripsi.RUANGAN.DESKRIPSI}, Periode : {deskripsi.PERIODE.AWAL} s/d {deskripsi.PERIODE.AKHIR}<center>"},margin:"0 0 5 0"},{xtype:"mutu-indikator-tindaklanjut-chart-form",scrollable:true,flex:1}],load:function(b){var a=this;chart=a.down("mutu-indikator-tindaklanjut-chart-form");if(b){this.getViewModel().set("deskripsi",b);chart.load({GRAFIK:true,INDIKATOR:b.INDIKATOR.ID,RUANGAN:b.RUANGAN?b.RUANGAN.ID:0,TANGGAL_AWAL:b.PERIODE.AWAL,TANGGAL_AKHIR:b.PERIODE.AKHIR})}}});Ext.define("mutu.indikator.tindaklanjut.laporan.Form",{extend:"com.Form",xtype:"mutu-indikator-tindaklanjut-laporan-form",controller:"mutu-indikator-tindaklanjut-laporan-form",model:"mutu.indikator.tindaklanjut.laporan.Model",bodyPadding:0,defaults:{margin:"2 2 2 2",width:"99%"},items:[{labelAlign:"top",fieldLabel:"JUDUL ",xtype:"textfield",name:"JUDUL",emptyText:"[ Judul ]"},{labelAlign:"top",fieldLabel:"KETERANGAN ",xtype:"htmleditor",name:"KETERANGAN"}],bbar:["->",{xtype:"filefield",width:250,reference:"file",emptyText:"[ Dokumen ]",reference:"filerca",buttonConfig:{text:"",iconCls:"x-fa fa-upload",ui:"soft-purple",tooltip:"Upload Document"},buttonOnly:false,listeners:{change:"onUpload"}},{xtype:"button",text:"Simpan",iconCls:"x-fa fa-save",ui:"soft-blue",handler:"onClickBtnSave"}]});Ext.define("mutu.indikator.tindaklanjut.laporan.FormController",{extend:"Ext.app.ViewController",alias:"controller.mutu-indikator-tindaklanjut-laporan-form",filedata:undefined,onClickBtnSave:function(b){var e=this,a=e.getView(),f=a.getRecord();if(e.filedata){f.set("DOCUMENT",e.filedata);a.setLoading(true);a.save(b,{},function(j,g,h){a.setLoading(false)})}else{Ext.Msg.show({title:"Perhatian",ui:"panel-red",message:"Anda belum mengupload dokument <br> Apakah anda yakin ingin melanjutkan menyimpan data ini?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,animateTarget:b,fn:function(g){a.setLoading(true);a.save(b,{},function(k,h,j){a.setLoading(false)})}})}},onUpload:function(f){var j=this,b=j.getView(),g=j.getViewModel(),h=f.fileInputEl.dom.files,e=h[0],a=new FileReader();Ext.Msg.show({title:"Perhatian",message:"Apakah anda yakin memilih file ini?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,animateTarget:f,fn:function(k){if(k==="yes"){a.readAsDataURL(e);a.onload=function(l){j.filedata=Ext.util.Base64.encode(l.target.result);delete a}}}})}});Ext.define("mutu.indikator.tindaklanjut.laporan.Grid",{extend:"com.Grid",xtype:"mutu-indikator-tindaklanjut-laporan-grid",controller:"mutu-indikator-tindaklanjut-laporan-grid",viewModel:{stores:{store:{type:"mutu-indikator-tindaklanjut-laporan-store"}}},columns:[{xtype:"templatecolumn",text:"Ruangan",dataIndex:"RUANGAN",flex:0.5,tpl:new Ext.XTemplate('<div style="white-space:normal !important;">{REFERENSI.RUANGAN.DESKRIPSI}</div>',{})},{xtype:"templatecolumn",text:"Indikator",dataIndex:"INDIKATOR",flex:0.5,tpl:new Ext.XTemplate('<div style="white-space:normal !important;">{REFERENSI.INDIKATOR.KODE} - {REFERENSI.INDIKATOR.NAMA}</div>',{})},{text:"Tanggal",flex:1,columns:[{xtype:"datecolumn",align:"center",format:"Y-m-d",text:"Awal",dataIndex:"TANGGAL_AWAL",flex:1},{text:"Akhir",align:"center",xtype:"datecolumn",format:"Y-m-d",dataIndex:"TANGGAL_AKHIR",flex:1},{text:"Input",align:"center",xtype:"datecolumn",format:"Y-m-d H:i:s",dataIndex:"TANGGAL",flex:1}]},{text:"Judul",dataIndex:"JUDUL",flex:1},{text:"Keterangan",dataIndex:"KETERANGAN",flex:1},{text:"#",menuDisabled:true,sortable:false,width:50,xtype:"actioncolumn",items:[{xtype:"tool",toolTip:"Lihat File",iconCls:"x-fa fa-file",handler:"onClickToolShowFile"}]}]});Ext.define("mutu.indikator.tindaklanjut.laporan.GridController",{extend:"Ext.app.ViewController",alias:"controller.mutu-indikator-tindaklanjut-laporan-grid",onClickToolShowFile:function(l,m,e,k,h,f){var j=this,a="";view=j.getView();if((f.get("TYPE")=="")||!f.get("TYPE")){view.notifyMessage("File tidak ditemukan","danger-red")}else{var b=Ext.util.Base64.encode(f.get("ID")+"-simP3LF1l3"+f.get("TYPE")+"simP3LF1l3"+f.get("JUDUL")+"simP3LF1l3"+f.get("KETERANGAN"));a=webservice.location+"mutu/indikator/laporan/"+b;if(f.get("TYPE")=="application/pdf"){j.getView().printPreview("Preview",a)}else{window.open(a)}}}});Ext.define("mutu.indikator.tindaklanjut.laporan.Workspace",{extend:"com.Form",xtype:"mutu-indikator-tindaklanjut-laporan-workspace",controller:"mutu-indikator-tindaklanjut-laporan-workspace",viewModel:{data:{deskripsi:null}},layout:{type:"vbox"},defaults:{width:"100%",border:false,margin:"0 0 0 0"},defaultType:"component",initComponent:function(){var a=this;a.items=[{bind:{html:"<center><h2>Laporan & Balasan Indikator : {deskripsi.INDIKATOR.KODE} - {deskripsi.INDIKATOR.NAMA}<h2><center>"}},{bind:{html:"<center>Ruangan : {deskripsi.RUANGAN.DESKRIPSI}, Periode : {deskripsi.PERIODE.AWAL} s/d {deskripsi.PERIODE.AKHIR}<center>"},margin:"0 0 5 0"},{xtype:"mutu-indikator-tindaklanjut-laporan-grid",header:{items:{xtype:"button",ui:"soft-blue",iconCls:"x-fa fa-plus x-color-blue",scope:a.getController(),handler:"onClickAddLaporan"}},title:"Daftar Laporan & Balasan Berdasakan Periode",flex:1,border:true}];a.callParent(arguments)},load:function(e){var b=this,a=b.down("mutu-indikator-tindaklanjut-laporan-grid");if(e){b.getViewModel().set("deskripsi",e);a.load({sortperiode:true,RUANGAN:e.RUANGAN.ID,INDIKATOR:e.INDIKATOR.ID,TANGGAL_AWAL:e.PERIODE.AWAL,TANGGAL_AKHIR:e.PERIODE.AKHIR})}}});Ext.define("mutu.indikator.tindaklanjut.laporan.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.mutu-indikator-tindaklanjut-laporan-workspace",onClickAddLaporan:function(e){var g=this,f=g.getViewModel(),b=g.getView(),a=f.get("deskripsi");b.openDialog("",true,700,400,{xtype:"mutu-indikator-tindaklanjut-laporan-form",showCloseButton:true,title:"Form Laporan & Balasan",iconCls:"x-fa fa-edit",ui:"panel-blue"},function(j,k){var h=k.down("mutu-indikator-tindaklanjut-laporan-form");h.createRecord({RUANGAN:a.RUANGAN.ID,INDIKATOR:a.INDIKATOR.ID,TANGGAL_AWAL:a.PERIODE.AWAL,TANGGAL_AKHIR:a.PERIODE.AKHIR,STATUS:1});h.on("save",function(){k.close();b.load(a)})},e)}});Ext.define("mutu.indikator.tindaklanjut.pdsa.Form",{extend:"com.Form",xtype:"mutu-indikator-tindaklanjut-pdsa-form",model:"mutu.indikator.tindaklanjut.pdsa.Model",controller:"mutu-indikator-tindaklanjut-pdsa-form",layout:{type:"hbox",align:"stretch"},defaults:{margin:"0 2 0 2",width:"50%",border:false},items:[{layout:"vbox",defaultType:"textarea",defaults:{margin:"0 0 2 0",allowBlank:false,width:"100%"},items:[{emptyText:"[ Plan ]",name:"PLAN"},{emptyText:"[ Do ]",name:"DO"}]},{layout:"vbox",defaults:{margin:"0 0 2 0",allowBlank:false,width:"100%"},defaultType:"textarea",items:[{emptyText:"[ Study ]",name:"STUDY"},{emptyText:"[ Action ]",name:"ACTION"}]}],bbar:["->",{xtype:"button",ui:"soft-blue",text:"Simpan",iconCls:"x-fa fa-save x-color-red",handler:"onClickBtnSave"}]});Ext.define("mutu.indikator.tindaklanjut.pdsa.FormController",{extend:"Ext.app.ViewController",alias:"controller.mutu-indikator-tindaklanjut-pdsa-form",onClickBtnSave:function(b){var e=this,a=e.getView();a.setLoading(true);a.save(b,{},function(h,f,g){a.setLoading(false)})}});Ext.define("mutu.indikator.tindaklanjut.pdsa.Grid",{extend:"com.Grid",xtype:"mutu-indikator-tindaklanjut-pdsa-grid",viewModel:{stores:{store:{type:"mutu-indikator-tindaklanjut-pdsa-store"}}},columns:[{xtype:"datecolumn",format:"Y-m-d H:i:s",align:"center",text:"Tanggal Input",dataIndex:"TANGGAL",flex:0.4},{text:"P D S A",flex:1,columns:[{text:"Plan",dataIndex:"PLAN",flex:1},{text:"Do",dataIndex:"DO",flex:1},{text:"Study",dataIndex:"STUDY",flex:1},{text:"Action",dataIndex:"ACTION",flex:1}]}]});Ext.define("mutu.indikator.tindaklanjut.pdsa.Workspace",{extend:"com.Form",xtype:"mutu-indikator-tindaklanjut-pdsa-workspace",controller:"mutu-indikator-tindaklanjut-pdsa-workspace",viewModel:{data:{analisa:null}},layout:{type:"vbox"},defaults:{width:"100%",border:false},items:[{xtype:"textarea",readOnly:true,bind:{value:"{analisa.ANALISA}"},margin:"0 0 5 0"},{border:true,xtype:"mutu-indikator-tindaklanjut-pdsa-form",title:"Form PDSA",listeners:{save:"onSaveForm"}},{border:true,xtype:"mutu-indikator-tindaklanjut-pdsa-grid",title:"Daftar PDSA",scrollable:true,flex:1}],load:function(f){var e=this,b=e.down("mutu-indikator-tindaklanjut-pdsa-form"),a=e.down("mutu-indikator-tindaklanjut-pdsa-grid");if(f){this.getViewModel().set("analisa",f);b.createRecord({ANALISA:rec.get("ID"),STATUS:1});a.load({ANALISA:rec.get("ID")})}}});Ext.define("mutu.indikator.tindaklanjut.pdsa.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.mutu-indikator-tindaklanjut-pdsa-workspace",onSaveForm:function(a){var e=this,b=e.getViewModel();e.getView().load(b.get("analisa"))}});