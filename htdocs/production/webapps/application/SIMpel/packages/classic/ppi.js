Ext.define("ppi.alasan.Model",{extend:"data.model.Model",serviceName:"ppi/alasan",fields:[{name:"ID",type:"int"},{name:"DESKRIPSI",type:"string"},{name:"STATUS_ETC",type:"int"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("ppi.alasan.Store",{extend:"data.store.Store",model:"ppi.alasan.Model",alias:"store.ppi-alasan-store"});Ext.define("ppi.audit.cucitangan.Model",{extend:"data.model.Model",serviceName:"ppi/cucitangan",fields:[{name:"ID",type:"int"},{name:"PROFESI",type:"int"},{name:"TANGGAL_BUAT",type:"date",dateFormat:"Y-m-d"},{name:"TANGGA",type:"date",dateFormat:"Y-m-d h:i:s"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("ppi.audit.cucitangan.Store",{extend:"data.store.Store",model:"ppi.audit.cucitangan.Model",alias:"store.ppi-audit-cucitangan-store"});Ext.define("ppi.audit.cucitangan.detail.Model",{extend:"data.model.Model",serviceName:"ppi/cucitangan/detail",fields:[{name:"ID",type:"int"},{name:"CUCI_TANGAN",type:"int"},{name:"ID_PEG",type:"string"},{name:"MOMENT_1",type:"int"},{name:"MOMENT_2",type:"int"},{name:"MOMENT_3",type:"int"},{name:"MOMENT_4",type:"int"},{name:"MOMENT_5",type:"int"},{name:"KETERANGAN",type:"string"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("ppi.audit.cucitangan.detail.Store",{extend:"data.store.Store",model:"ppi.audit.cucitangan.detail.Model",alias:"store.ppi-audit-cucitangan-detail-store"});Ext.define("ppi.audit.individu.Model",{extend:"data.model.Model",serviceName:"ppi/audit/individu",fields:[{name:"ID",type:"int"},{name:"PROFESI",type:"int"},{name:"GROUP",type:"int"},{name:"TANGGAL_BUAT",type:"date",dateFormat:"Y-m-d"},{name:"TANGGAL",type:"date",dateFormat:"Y-m-d h:i:s"},{name:"PEGAWAI",type:"int"},{name:"OLEH",type:"int"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("ppi.audit.individu.Store",{extend:"data.store.Store",model:"ppi.audit.individu.Model",alias:"store.ppi-audit-individu-store"});Ext.define("ppi.audit.individu.xample.Model",{extend:"data.model.Model",serviceName:"ppi/xampleindividu",fields:[{name:"ID",type:"int"},{name:"PERIODE",type:"int"},{name:"NIP",type:"string"},{name:"NAMA",type:"string"},{name:"OLEH",type:"int"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("ppi.audit.individu.xample.Store",{extend:"data.store.Store",model:"ppi.audit.individu.xample.Model",alias:"store.ppi-audit-individu-xample-store"});Ext.define("ppi.audit.individu.xample.detial.Model",{extend:"data.model.Model",serviceName:"ppi/xample/detail",fields:[{name:"ID",type:"int"},{name:"XAMPLE",type:"int"},{name:"KEGIATAN",type:"int"},{name:"CHECK",type:"int"},{name:"ALASAN",type:"int"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("ppi.audit.individu.xample.detail.Store",{extend:"data.store.Store",model:"ppi.audit.individu.xample.detial.Model",alias:"store.ppi-audit-individu-xample-detail-store"});Ext.define("ppi.hais.flebitis.Model",{extend:"data.model.Model",serviceName:"ppi/hais/flebitis",fields:[{name:"ID",type:"int"},{name:"KUNJUNGAN",type:"string"},{name:"NOPEN",type:"string"},{name:"NORM",type:"int"},{name:"RUANGAN",type:"string"},{name:"USIA",type:"string"},{name:"ANTIBIOTIK",type:"int"},{name:"TANGGAL_PAKAI_ANTIBIOTIK",type:"date",dateFormat:"Y-m-d"},{name:"TANGGAL_BERHENTI_ANTIBIOTIK",type:"date",dateFormat:"Y-m-d"},{name:"TANGGAL_PASANG",type:"date",dateFormat:"Y-m-d"},{name:"TANGGAL_LEPAS",type:"date",dateFormat:"Y-m-d"},{name:"LAMA_HARI",type:"int"},{name:"INFEKSI_LAIN",type:"string"},{name:"JENIS_PEMERIKSAAN_KULTUR",type:"int"},{name:"HASIL_KULTUR",type:"string"},{name:"LABORATORIUM",type:"string"},{name:"PEMAKAIAN_ALAT",type:"int"},{name:"STATUS_HAIS",type:"int"},{name:"TANGGAL_KEJADIAN",type:"date",dateFormat:"Y-m-d"},{name:"OLEH",type:"int"},{name:"TANGGAL",type:"date"},{name:"STATUS",type:"int"}],idProperty:"ID"});Ext.define("ppi.hais.flebitis.Store",{extend:"data.store.Store",model:"ppi.hais.flebitis.Model",alias:"store.ppi-hais-flebitis-store"});Ext.define("ppi.hais.isk.Model",{extend:"data.model.Model",serviceName:"ppi/hais/isk",fields:[{name:"ID",type:"int"},{name:"KUNJUNGAN",type:"string"},{name:"NOPEN",type:"string"},{name:"NORM",type:"int"},{name:"RUANGAN",type:"string"},{name:"USIA",type:"string"},{name:"ANTIBIOTIK",type:"int"},{name:"TANGGAL_PAKAI_ANTIBIOTIK",type:"date",dateFormat:"Y-m-d"},{name:"TANGGAL_BERHENTI_ANTIBIOTIK",type:"date",dateFormat:"Y-m-d"},{name:"TANGGAL_PASANG",type:"date",dateFormat:"Y-m-d"},{name:"TANGGAL_LEPAS",type:"date",dateFormat:"Y-m-d"},{name:"LAMA_HARI",type:"int"},{name:"INFEKSI_LAIN",type:"string"},{name:"JENIS_PEMERIKSAAN_KULTUR",type:"int"},{name:"HASIL_KULTUR",type:"string"},{name:"LABORATORIUM",type:"string"},{name:"PEMAKAIAN_ALAT",type:"int"},{name:"STATUS_HAIS",type:"int"},{name:"TANGGAL_KEJADIAN",type:"date",dateFormat:"Y-m-d"},{name:"OLEH",type:"int"},{name:"TANGGAL",type:"date"},{name:"STATUS",type:"int"}],idProperty:"ID"});Ext.define("ppi.hais.isk.Store",{extend:"data.store.Store",model:"ppi.hais.isk.Model",alias:"store.ppi-hais-isk-store"});Ext.define("ppi.hais.vap.Model",{extend:"data.model.Model",serviceName:"ppi/hais/vap",fields:[{name:"ID",type:"int"},{name:"KUNJUNGAN",type:"string"},{name:"NOPEN",type:"string"},{name:"NORM",type:"int"},{name:"RUANGAN",type:"string"},{name:"USIA",type:"string"},{name:"ANTIBIOTIK",type:"int"},{name:"TANGGAL_PAKAI_ANTIBIOTIK",type:"date",dateFormat:"Y-m-d"},{name:"TANGGAL_BERHENTI_ANTIBIOTIK",type:"date",dateFormat:"Y-m-d"},{name:"TANGGAL_PASANG",type:"date",dateFormat:"Y-m-d"},{name:"TANGGAL_LEPAS",type:"date",dateFormat:"Y-m-d"},{name:"LAMA_HARI",type:"int"},{name:"INFEKSI_LAIN",type:"string"},{name:"JENIS_PEMERIKSAAN_KULTUR",type:"int"},{name:"HASIL_KULTUR",type:"string"},{name:"LABORATORIUM",type:"string"},{name:"PEMAKAIAN_ALAT",type:"int"},{name:"STATUS_HAIS",type:"int"},{name:"TANGGAL_KEJADIAN",type:"date",dateFormat:"Y-m-d"},{name:"OLEH",type:"int"},{name:"TANGGAL",type:"date"},{name:"STATUS",type:"int"}],idProperty:"ID"});Ext.define("ppi.hais.vap.Store",{extend:"data.store.Store",model:"ppi.hais.vap.Model",alias:"store.ppi-hais-vap-store"});Ext.define("ppi.ido.Model",{extend:"data.model.Model",serviceName:"ppi/ido",fields:[{name:"ID",type:"int"},{name:"KUNJUNGAN",type:"string"},{name:"ID_OPERASI",type:"int"},{name:"NORM",type:"int"},{name:"TANGGAL_OPERASI",type:"date",dateFormat:"Y-m-d"},{name:"USIA",type:"string"},{name:"RUANGAN",type:"string"},{name:"SUHU",type:"string"},{name:"JENIS_OPERASI",type:"int"},{name:"ASA_SCORE",type:"int"},{name:"KLP",type:"int"},{name:"OPERASI",type:"int"},{name:"STATUS_IDO",type:"int"},{name:"ANTIBIOTIK",type:"int"},{name:"HASIL_KULTUR",type:"string"},{name:"OLEH",type:"int"},{name:"TANGGAL",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("ppi.ido.Store",{extend:"data.store.Store",model:"ppi.ido.Model",alias:"store.ppi-ido-store"});Ext.define("ppi.ido.gejala.Model",{extend:"data.model.Model",serviceName:"ppi/gejalaido",fields:[{name:"ID",type:"int"},{name:"IDO",type:"int"},{name:"GEJALA_IDO",type:"int"},{name:"CHECK",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("ppi.ido.gejala.Store",{extend:"data.store.Store",model:"ppi.ido.gejala.Model",alias:"store.ppi-ido-gejala-store"});Ext.define("ppi.kegiatan.Model",{extend:"data.model.Model",serviceName:"ppi/kegiatan",fields:[{name:"ID",type:"int"},{name:"DESKRIPSI",type:"string"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("ppi.kegiatan.Store",{extend:"data.store.Store",model:"ppi.kegiatan.Model",alias:"store.ppi-kegiatan-store"});Ext.define("ppi.kegiatan.alasan.Model",{extend:"data.model.Model",serviceName:"ppi/kegiatan/alasan",fields:[{name:"ID",type:"int"},{name:"KAGIATAN",type:"int"},{name:"ALASAN",type:"int"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("ppi.kegiatan.alasan.Store",{extend:"data.store.Store",model:"ppi.kegiatan.alasan.Model",alias:"store.ppi-kegiatan-alasan-store"});Ext.define("ppi.kegiatan.group.Model",{extend:"data.model.Model",serviceName:"ppi/groupevaluasi",fields:[{name:"ID",type:"int"},{name:"DESKRIPSI",type:"string"},{name:"JENIS",type:"int"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("ppi.kegiatan.group.Store",{extend:"data.store.Store",model:"ppi.kegiatan.group.Model",alias:"store.ppi-kegiatan-group-store"});Ext.define("ppi.kegiatan.group.detail.Model",{extend:"data.model.Model",serviceName:"ppi/kegiatan/group",fields:[{name:"ID",type:"int"},{name:"KEGIATAN",type:"int"},{name:"GROUP",type:"int"},{name:"KELOMPOK",type:"int"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("ppi.kegiatan.group.detail.Store",{extend:"data.store.Store",model:"ppi.kegiatan.group.detail.Model",alias:"store.ppi-kegiatan-group-detail-store"});Ext.define("ppi.kegiatan.group.detail.kelompok.Model",{extend:"data.model.Model",serviceName:"ppi/kelompok",fields:[{name:"ID",type:"int"},{name:"KET",type:"string"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("ppi.kegiatan.group.detail.kelompok.Store",{extend:"data.store.Store",model:"ppi.kegiatan.group.detail.kelompok.Model",alias:"store.ppi-kegiatan-group-detail-kelompok-store"});Ext.define("ppi.pelaporan.limbahinfeksius.Model",{extend:"data.model.Model",serviceName:"ppi/limbahinfeksius",fields:[{name:"ID",type:"int"},{name:"RUANGAN",type:"string"},{name:"NAMA_TERLAPOR",type:"string"},{name:"TANGGAL_KEJADIAN",type:"date",dateFormat:"Y-m-d h:i:s"},{name:"KATEGORI",type:"int"},{name:"HASIL_LAB",type:"string"},{name:"KETERANGAN",type:"string"},{name:"OLEH",type:"int"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("ppi.pelaporan.limbahinfeksius.Store",{extend:"data.store.Store",model:"ppi.pelaporan.limbahinfeksius.Model",alias:"store.ppi-pelaporan-limbahinfeksius-store"});Ext.define("ppi.pelaporan.tertusukjarum.Model",{extend:"data.model.Model",serviceName:"ppi/tertusukjarum",fields:[{name:"ID",type:"int"},{name:"RUANGAN",type:"string"},{name:"NAMA_TERLAPOR",type:"string"},{name:"TANGGAL_KEJADIAN",type:"date",dateFormat:"Y-m-d h:i:s"},{name:"KATEGORI",type:"int"},{name:"HASIL_LAB",type:"string"},{name:"KETERANGAN",type:"string"},{name:"OLEH",type:"int"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("ppi.pelaporan.tertusukjarum.Store",{extend:"data.store.Store",model:"ppi.pelaporan.tertusukjarum.Model",alias:"store.ppi-pelaporan-tertusukjarum-store"});Ext.define("ppi.penilaian.harian.Model",{extend:"data.model.Model",serviceName:"ppi/penilaian/kegiatanharian",fields:[{name:"ID",type:"int"},{name:"RUANGAN",type:"string"},{name:"GROUP",type:"int"},{name:"BULAN",type:"int"},{name:"TAHUN",type:"date",dateFormat:"Y"},{name:"USER",type:"int"},{name:"TANGGAL",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("ppi.penilaian.harian.Store",{extend:"data.store.Store",model:"ppi.penilaian.harian.Model",alias:"store.ppi-penilaian-harian-store"});Ext.define("ppi.penilaian.harian.detail.Model",{extend:"data.model.Model",serviceName:"ppi/penilaian/kegiatanharian/detail",fields:[{name:"ID",type:"int"},{name:"PK_HARIAN",type:"int"},{name:"KEGIATAN",type:"int"},{name:"MINGGU",type:"int"},{name:"HARIAN",type:"int"},{name:"CHECK",type:"int"},{name:"TANGGAL",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("ppi.penilaian.harian.detail.Store",{extend:"data.store.Store",model:"ppi.penilaian.harian.detail.Model",alias:"store.ppi-penilaian-harian-detail-store"});Ext.define("ppi.penilaian.kegiatan.Model",{extend:"data.model.Model",serviceName:"ppi/penilaiankegiatan",fields:[{name:"ID",type:"int"},{name:"TANGGAL_BUAT",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"RUANGAN",type:"string"},{name:"GROUP",type:"int"},{name:"USER",type:"int"},{name:"TANGGAL",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("ppi.penilaian.kegiatan.Store",{extend:"data.store.Store",model:"ppi.penilaian.kegiatan.Model",alias:"store.ppi-penilaian-kegiatan-store"});Ext.define("ppi.penilaian.kegiatan.detail.Model",{extend:"data.model.Model",serviceName:"ppi/penilaiankegiatan/detail",fields:[{name:"PENILAIAN",type:"int"},{name:"KEGIATAN",type:"int"},{name:"CHECK",type:"int"},{name:"ALASAN",type:"int"},{name:"KET",type:"string"},{name:"RTL",type:"string"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("ppi.penilaian.kegiatan.detail.Store",{extend:"data.store.Store",model:"ppi.penilaian.kegiatan.detail.Model",alias:"store.ppi-penilaian-kegiatan-detail-store"});Ext.define("ppi.penilaian.tindaklanjut.Model",{extend:"data.model.Model",serviceName:"ppi/tindaklanjut",fields:[{name:"ID",type:"int"},{name:"GROUP",type:"int"},{name:"BULAN",type:"int"},{name:"TAHUN",type:"date",dateFormat:"Y"},{name:"PLAN",type:"string"},{name:"DO",type:"string"},{name:"CHECK",type:"string"},{name:"TANGGAL",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"OLEH",type:"int"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("ppi.penilaian.tindaklanjut.Store",{extend:"data.store.Store",model:"ppi.penilaian.tindaklanjut.Model",alias:"store.ppi-penilaian-tindaklanjut-store"});Ext.define("ppi.Link",{extend:"com.Form",xtype:"ppi-link",controller:"ppi-link",layout:"fit",bodyPadding:2,items:[{xtype:"com-form",ui:"panel-red",title:"PPI",titleFieldConfig:{},fullscreenEnabled:true,menuConfig:{enabled:true,width:260,buttonConfig:{}},fullscreenConfig:{},header:{items:[{}]}}],load:function(a){var d=this,c=this.down("com-form");c.setMenus(d.childmenu("9001",2,2))},childmenu:function(f,e,a){var d=this,c=[];xuam=Ext.JSON.decode(Ext.util.Base64.decode(d.app.xuam));xuam.forEach(function(h,g){h=Ext.JSON.decode(Ext.util.Base64.decode(h));if(h.ID.substring(0,a+2)==f&&h.LEVEL==e+1){var j={text:h.DESKRIPSI,leaf:h.HAVE_CHILD==0,iconCls:h.ICON_CLS};if(h.HAVE_CHILD==0||h.CLASS){j.className=h.CLASS;j.idClassName=d.replaceAll(h.CLASS.toLowerCase(),".","_")}else{j.children=d.childmenu(h.ID,parseInt(h.LEVEL),a+2)}c.push(j)}});return c}});Ext.define("ppi.LinkController",{extend:"Ext.app.ViewController",alias:"controller.ppi-link",onTabChange:function(c,a){if(a.load){a.load({})}},onRefresh:function(a){var c=this;c.getView().loadStore({})}});Ext.define("ppi.Workspace",{extend:"com.Form",xtype:"ppi-workspace",layout:"border",border:false,items:[{region:"center",html:"test"}],load:function(a){}});Ext.define("ppi.audit.Link",{extend:"com.Tab",xtype:"ppi-audit-link",controller:"ppi-audit-link",activeTab:0,cls:"x-br-top",ui:"header-tab",rec:undefined,initComponent:function(){var a=this;a.items=[{title:"Individu",xtype:"ppi-audit-individu-workspace"},{title:"Ruangan",xtype:"ppi-audit-ruangan-workspace"}];a.callParent(arguments)},loadStore:function(d){var c=this,a=this.getActiveTab();c.rec=d;if(a){a.onLoadRecord({})}else{if(c.items.getCount()>0){c.setActiveTab(0)}}},listeners:{tabchange:"onTabChange"}});Ext.define("ppi.audit.LinkController",{extend:"Ext.app.ViewController",alias:"controller.ppi-audit-link",onTabChange:function(c,a){if(a.load){a.load({})}}});Ext.define("ppi.audit.cucitangan.Form",{extend:"com.Form",xtype:"ppi-audit-cucitangan-form",controller:"ppi-audit-cucitangan-form",model:"ppi.audit.cucitangan.Model",defaults:{margin:"2.2.2.2"},layout:"hbox",items:[{xtype:"referensi-combo",width:"40%",name:"PROFESI",enterFocus:true,enforceMaxLength:true,params:{JENIS:36,STATUS:1},firstLoad:true,displayField:"DESKRIPSI",valueField:"ID",typeAhead:true,allowBlank:false,emptyText:"[Jenis Profesi]"},{xtype:"datefield",width:"35%",format:"Y-m-d",allowBlank:false,name:"TANGGAL_BUAT"},{xtype:"button",text:"Create",ui:"soft-blue",handler:"onCreate"}]});Ext.define("ppi.audit.cucitangan.FormController",{extend:"Ext.app.ViewController",alias:"controller.ppi-audit-cucitangan-form",onCreate:function(d){var e=this,a=e.getView(),c=a.down("[name = PROFESI]"),f=c.getSelection();rec=a.getRecord();if(a.getForm().isValid()){a.openDialog("",true,900,500,{xtype:"ppi-audit-cucitangan-detail-form",ui:"panel-gray",title:"AUDIT CUCI TANGAN *"+f.get("DESKRIPSI")+"  ("+Ext.Date.format(rec.get("TANGGAL_BUAT"),"Y-m-d")+")*",iconCls:"x-fa fa-edit",showCloseButton:true},function(h,j){var g=j.down("ppi-audit-cucitangan-detail-form");g.setCuciTangan(rec);g.on("success",function(){j.close();a.fireEvent("loadForm",true)})},d)}}});Ext.define("ppi.audit.cucitangan.List",{extend:"com.Grid",xtype:"ppi-audit-cucitangan-list",controller:"ppi-audit-cucitangan-list",viewModel:{stores:{store:{type:"ppi-audit-cucitangan-store"}},data:{listConfig:{paging:true}}},columns:[{text:"Profesi",xtype:"templatecolumn",dataIndex:"PROFESI",tpl:'<div style="white-space:normal !important;color:black">{REFERENSI.PROFESI.DESKRIPSI}</div>',flex:1},{text:"Tanggal",xtype:"datecolumn",dataIndex:"TANGGAL_BUAT",format:"d/m/Y",flex:0.3},{xtype:"widgetcolumn",text:"#",align:"center",width:100,widget:{xtype:"fieldcontainer",defaultType:"button",layout:{type:"vbox",align:"stretch"},defaults:{padding:2,margin:"0 2 1 0"},items:[{text:"Detail",ui:"soft-black",menu:[{text:"Cetak",action:1,iconCls:"x-fa fa-print",handler:"onDetail"},{text:"Edit",action:2,iconCls:"x-fa fa-edit",handler:"onEdit"}]}]}}]});Ext.define("ppi.audit.cucitangan.ListController",{extend:"Ext.app.ViewController",alias:"controller.ppi-audit-cucitangan-list",onDetail:function(c){var d=this,a=d.getView(),e=true,f=c.ownerCt.ownerCmp.ownerCt.getWidgetRecord();d.getView().cetak({NAME:"ppi.lapAuditCuciTangan",TYPE:e?"Pdf":"Word",EXT:e?"pdf":"docx",PARAMETER:{PID:f.get("ID")},REQUEST_FOR_PRINT:!e,PRINT_NAME:"CetakHasil"},function(g){if(e){d.getView().printPreview("Preview",g)}})},onEdit:function(c){var d=this,a=d.getView(),e=true,f=c.ownerCt.ownerCmp.ownerCt.getWidgetRecord();a.openDialog("",true,900,500,{xtype:"ppi-audit-cucitangan-detail-form",ui:"panel-gray",title:"AUDIT CUCI TANGAN *"+f.get("REFERENSI").PROFESI.DESKRIPSI+"  ("+Ext.Date.format(f.get("TANGGAL_BUAT"),"Y-m-d")+")*",iconCls:"x-fa fa-edit",showCloseButton:true},function(h,j){var g=j.down("ppi-audit-cucitangan-detail-form");g.setCuciTangan(f);g.on("success",function(){j.close();a.fireEvent("loadForm",true)})},c)}});Ext.define("ppi.audit.cucitangan.Workspace",{extend:"com.Form",xtype:"ppi-audit-cucitangan-workspace",controller:"ppi-audit-cucitangan-workspace",bodyPadding:0,layout:"border",items:[{region:"north",xtype:"ppi-audit-cucitangan-form",listeners:{loadForm:"onLoadForm"}},{region:"center",flex:1,xtype:"ppi-audit-cucitangan-list"}],load:function(){var a=this;a.down("ppi-audit-cucitangan-list").load({});a.down("ppi-audit-cucitangan-form").createRecord({STATUS:1})}});Ext.define("ppi.audit.cucitangan.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.ppi-audit-cucitangan-workspace",onLoadForm:function(){var c=this,a=c.getView();a.load()}});Ext.define("ppi.audit.cucitangan.detail.Form",{extend:"com.Form",xtype:"ppi-audit-cucitangan-detail-form",controller:"ppi-audit-cucitangan-detail-form",viewModel:{data:{cucitangan:undefined}},model:"ppi.audit.cucitangan.detail.Model",items:[{region:"north",border:false,layout:"vbox",defaults:{margin:"2.2.2.2",border:false},items:[{layout:"hbox",width:"99%",defaults:{margin:"5.5.5.5"},items:[{xtype:"pegawai-combo",width:"49%",name:"ID_PEG"},{xtype:"textfield",emptyText:"[ KETERANGAN ]",width:"49%",name:"KETERANGAN"}]},{layout:"hbox",width:"99%",defaults:{margin:"5.5.5.5"},items:[{xtype:"checkbox",inputValue:1,uncheckedValue:0,boxLabel:"MOMENT 1",name:"MOMENT_1"},{xtype:"checkbox",inputValue:1,uncheckedValue:0,boxLabel:"MOMENT 2",name:"MOMENT_2"},{xtype:"checkbox",inputValue:1,uncheckedValue:0,boxLabel:"MOMENT 3",name:"MOMENT_3"},{xtype:"checkbox",inputValue:1,uncheckedValue:0,boxLabel:"MOMENT 4",name:"MOMENT_4"},{xtype:"checkbox",inputValue:1,uncheckedValue:0,boxLabel:"MOMENT 5",name:"MOMENT_5"},{xtype:"button",ui:"soft-green",iconCls:"x-fa fa-plus",handler:"onAddPegawai"}]}]},{region:"center",flex:1,layout:"fit",xtype:"ppi-audit-cucitangan-detail-list"}],buttons:[{text:"Simpan",ui:"soft-blue",iconCls:"x-fa fa-save",handler:"onSimpan"}],setCuciTangan:function(f){var d=this,a=d.down("[name = ID_PEG]"),e=d.down("ppi-audit-cucitangan-detail-list"),c=d.getViewModel();a.params.PROFESI=f.get("PROFESI");c.set("cucitangan",f);d.createRecord({STATUS:1});if(Ext.isNumeric(f.get("ID"))){e.load({CUCI_TANGAN:f.get("ID")})}}});Ext.define("ppi.audit.cucitangan.detail.FormController",{extend:"Ext.app.ViewController",alias:"controller.ppi-audit-cucitangan-detail-form",onAddPegawai:function(e){var g=this,a=g.getView(),d=a.down("[name =  ID_PEG]"),f=d.getSelection(),h=a.down("ppi-audit-cucitangan-detail-list"),j=a.getRecord(),c=h.getStore();if(f){find=c.findRecord("ID_PEG",j.get("ID_PEG"),0,false,true,true);if(find){a.notifyMessage("Pegawai sudah dimputkan sebelumnya","danger-red")}else{j.set("REFERENSI",{PEGAWAI:f.getData()});c.insert(0,j);a.createRecord({STATUS:1})}}},onSimpan:function(d){var g=this,c=g.getView(),f=g.getViewModel(),h=c.down("ppi-audit-cucitangan-detail-list"),e=h.getData(),a=f.get("cucitangan");if(e.length>0){a.set("DETAIL",e);a.scope=this;a.save({callback:function(m,n,l){if(l){c.notifyMessage("Data audit cuci tangan berhasil disimpan","danger-blue");c.fireEvent("success",true)}else{c.notifyMessage("Gagal menyimpan data","danger-red")}}})}}});Ext.define("ppi.audit.cucitangan.detail.List",{extend:"com.Grid",xtype:"ppi-audit-cucitangan-detail-list",viewModel:{stores:{store:{type:"ppi-audit-cucitangan-detail-store"}}},columns:[{xtype:"templatecolumn",text:"PEGAWAI",dataIndex:"ID_PEG",flex:1,tpl:'<div style="white-space:normal !important;color:black">{ID_PEG} - {REFERENSI.PEGAWAI.NAMA}</div>'},{text:"5 MOMENT CUCI TANGAN",columns:[{text:"1",dataIndex:"MOMENT_1",width:50},{text:"2",dataIndex:"MOMENT_2",width:50},{text:"3",dataIndex:"MOMENT_3",width:50},{text:"4",dataIndex:"MOMENT_4",width:50},{text:"5",dataIndex:"MOMENT_5",width:50}]},{text:"KET",flex:1,dataIndex:"KETERANGAN"}],getData:function(){var d=this,c=d.getViewModel().get("store"),a=[];c.each(function(f,e){a.push(f.getData())});return a}});Ext.define("ppi.audit.individu.Form",{extend:"com.Form",xtype:"ppi-audit-individu-form",controller:"ppi-audit-individu-form",model:"ppi.audit.individu.Model",defaults:{margin:"2.2.2.2"},layout:"hbox",items:[{xtype:"ppi-kegiatan-group-combo",emptyText:"[ GROUP PENILAIAN  ]",params:{STATUS:1},width:"30%",name:"GROUP"},{xtype:"referensi-combo",name:"PROFESI",enterFocus:true,enforceMaxLength:true,params:{JENIS:36,STATUS:1},firstLoad:true,displayField:"DESKRIPSI",valueField:"ID",width:"30%",typeAhead:true,allowBlank:false,emptyText:"[Jenis Profesi]"},{xtype:"datefield",format:"Y-m-d",allowBlank:false,name:"TANGGAL_BUAT"},{xtype:"checkbox",reference:"pegawai",inputValue:1,value:1,uncheckedValue:0,boxLabel:"Pegawai",name:"PEGAWAI"},{xtype:"button",text:"Create",ui:"soft-blue",handler:"onCreate"}],loadCombo:function(){var c=this.down("ppi-kegiatan-group-combo"),a=c.getStore();a.setQueryParams({STATUS:1,JENIS:2});a.load()}});Ext.define("ppi.audit.individu.FormController",{extend:"Ext.app.ViewController",alias:"controller.ppi-audit-individu-form",onCreate:function(e){var f=this,d=f.getReferences(),g=d.pegawai.getValue(),c=(g)?1:0,a=f.getView();a.save(e)}});Ext.define("ppi.audit.individu.List",{extend:"com.Grid",xtype:"ppi-audit-individu-list",controller:"ppi-audit-individu-list",viewModel:{stores:{store:{type:"ppi-audit-individu-store"}},data:{listConfig:{paging:true}}},iconCls:"x-fa fa-user",title:"Individu",ui:"panel-blue",btnEditHidden:true,initComponent:function(){var a=this;a.columns=[{text:"Group",xtype:"templatecolumn",dataIndex:"GROUP_KEGIATAN",tpl:'<div style="white-space:normal !important;color:black">{REFERENSI.GROUP.DESKRIPSI}</div>',flex:1},{text:"Profesi",xtype:"templatecolumn",dataIndex:"PROFESI",tpl:'<div style="white-space:normal !important;color:black">{REFERENSI.PROFESI.DESKRIPSI}</div>',flex:1},{text:"Tanggal",xtype:"datecolumn",dataIndex:"TANGGAL_BUAT",format:"Y-m-d",flex:0.3},{text:"Status",dataIndex:"STATUS",flex:0.5,xtype:"templatecolumn",tpl:new Ext.XTemplate('<div class="thumb-wrap">','<div class="thumb">','<div style="color : {[this.deskColorStatus(values.STATUS)]} ;align : center; white-space:normal !important;">{[this.deskStatus(values.STATUS)]}</div>',"</div>","</div>",{deskStatus:function(c){return(c==1)?"Belum Final":(c==2)?"Final":"Dihapus"},deskColorStatus:function(c){return(c==1)?"green":(c==2)?"red":"black"}})},{text:"Object dinilai",dataIndex:"PEGAWAI",flex:0.5,xtype:"templatecolumn",tpl:new Ext.XTemplate('<div class="thumb-wrap">','<div class="thumb">','<div style="align : center; white-space:normal !important;">{[this.deskStatus(values.PEGAWAI)]}</div>',"</div>","</div>",{deskStatus:function(c){return(c==1)?"Pegawai":" Bukan Pegawai"},deskColorStatus:function(c){return(c==1)?"green":(c==2)?"red":"black"}})},{xtype:"widgetcolumn",text:"#",align:"center",width:100,widget:{xtype:"fieldcontainer",defaultType:"button",layout:{type:"vbox",align:"stretch"},defaults:{padding:2,margin:"0 2 1 0"},items:[{text:"Detail",action:"btn",ui:"soft-black",menu:[{text:"Final",action:2,iconCls:"x-fa fa-cog",hidden:!a.btnEditHidden,handler:"onClickFinal"},{text:"Batal Final",action:1,hidden:!a.btnEditHidden,iconCls:"x-fa fa-cog",handler:"onClickFinal"},{text:"Add Xample",iconCls:"x-fa fa-edit",hidden:a.btnEditHidden,handler:"onAddXample"},{text:"Hapus",action:3,hidden:a.btnEditHidden,iconCls:"x-fa fa-trash",handler:"onHapus"},"-",{text:"Cetak",iconCls:"x-fa fa-print",handler:"onDetail"}]}]},onWidgetAttach:"onWidgetAttach"}];a.callParent(arguments)},dockedItems:[{xtype:"pagingtoolbar",hidden:true,bind:{store:"{store}",hidden:"{!listConfig.paging}"},dock:"bottom",beforePageText:"Hal.",afterPageText:"dari {0}",displayMsg:"Menampilkan {0} - {1} dari {2}",displayInfo:true,items:[{xtype:"ppi-kegiatan-group-combo",flex:1,emptyText:"[ GROUP PENILAIAN  ]",name:"GROUP",params:{STATUS:1,JENIS:2},firstLoad:true,listeners:{select:"onSelectGroupKegiatan"}}]}]});Ext.define("ppi.audit.individu.ListController",{extend:"Ext.app.ViewController",alias:"controller.ppi-audit-individu-list",onDetail:function(c){var d=this,a=d.getView(),e=true,f=c.ownerCt.ownerCmp.ownerCt.getWidgetRecord();d.getView().cetak({NAME:"plugins.ppi.cetakAuditIndividu",TYPE:e?"Pdf":"Word",EXT:e?"pdf":"docx",PARAMETER:{PID:f.get("ID")},REQUEST_FOR_PRINT:!e,PRINT_NAME:"CetakHasil"},function(g){if(e){d.getView().printPreview("Preview",g)}})},onSelectGroupKegiatan:function(c,e){var d=this,a=d.getView();a.load({GROUP:e.get("ID")})},onWidgetAttach:function(h,c,g){var e=this,f=c.down("[action = btn]"),a=f.menu.items.items[0];btnbatal=f.menu.items.items[1];btnhapus=f.menu.items.items[3];if(e.getView().btnEditHidden){btnbatal.setHidden(g.get("STATUS")==1);a.setHidden(g.get("STATUS")==2)}else{btnhapus.setHidden(g.get("STATUS")==2)}},onAddXample:function(c){var d=this,a=d.getView(),e=true,f=c.ownerCt.ownerCmp.ownerCt.getWidgetRecord();a.openDialog("",true,"80%","70%",{xtype:"ppi-audit-individu-xample-workspace",ui:"panel-gray",title:f.get("REFERENSI").GROUP.DESKRIPSI+"  *("+f.get("REFERENSI").PROFESI.DESKRIPSI+")*",iconCls:"x-fa fa-edit",showCloseButton:true},function(h,j){var g=j.down("ppi-audit-individu-xample-workspace");g.load(f);g.on("success",function(){j.close();a.fireEvent("loadForm",true)})},c)},onHapus:function(c){var d=this,a=d.getView(),e=true,f=c.ownerCt.ownerCmp.ownerCt.getWidgetRecord();if(f.get("STATUS")!=2){a.showMessageBox({title:"Peringatan",message:"Anda yakin ingin menghapus periode ini ?",ui:"window-red",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,animateTarget:c,fn:function(g){if(g==="yes"){f.set("STATUS",0);f.showError=true;f.animateTarget=c;f.scope=d;f.save({callback:function(j,h,k){if(k){a.notifyMessage("Data telah terhapus");a.reload()}}})}}})}else{a.showMessageBox({title:"Peringatan",message:"Periode ini telah difinalkan oleh petugas periode tidak dapat dihapus",ui:"window-red",buttons:Ext.Msg.OK,animateTarget:c})}},onClickFinal:function(d){var e=this,c=e.getView(),f=true,a=d.action;desk=(a==2)?"finalkan":"batalkan",rec=d.ownerCt.ownerCmp.ownerCt.getWidgetRecord();if(rec.get("STATUS")===0){c.notifyMessage("Data telah dihapus sebelumnya")}else{if(a===rec.get("STATUS")){c.notifyMessage("Data telah di"+desk+" sebelumnya")}else{c.showMessageBox({title:"Peringatan",message:"Anda yakin ingin mem"+desk+" periode ini ?",ui:"window-red",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,animateTarget:d,fn:function(g){if(g==="yes"){rec.set("STATUS",a);rec.showError=true;rec.animateTarget=d;rec.scope=e;rec.save({callback:function(j,h,k){if(k){c.notifyMessage("Data telah di"+desk);c.reload()}}})}}})}}}});Ext.define("ppi.audit.individu.Workspace",{extend:"com.Form",xtype:"ppi-audit-individu-workspace",controller:"ppi-audit-individu-workspace",bodyPadding:0,layout:"border",title:"Audit Individu",ui:"panel-cyan",iconCls:"x-fa fa-user",items:[{region:"north",xtype:"ppi-audit-individu-form",listeners:{save:"onSave"}},{region:"center",title:"Periode Audit Penilaian",ui:"panel-cyan",btnEditHidden:false,flex:1,xtype:"ppi-audit-individu-list"}],load:function(){var c=this,a=c.down("ppi-audit-individu-form");c.down("ppi-audit-individu-list").load({STATUS:"1,2"});a.loadCombo();a.createRecord({STATUS:1,PEGAWAI:1})}});Ext.define("ppi.audit.individu.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.ppi-audit-individu-workspace",onSave:function(){this.getView().load()},onLoadForm:function(){var c=this,a=c.getView();a.load()}});Ext.define("ppi.audit.individu.xample.List",{extend:"com.Grid",xtype:"ppi-audit-individu-xample-list",controller:"ppi-audit-individu-xample-list",viewModel:{stores:{store:{type:"ppi-audit-individu-xample-store"}},data:{listConfig:{paging:true},periode:undefined,pegawai:true}},initComponent:function(){var a=this;a.cellEditing=new Ext.grid.plugin.CellEditing({clicksToEdit:1,listeners:{afteredit:"onAfterEdit",beforeedit:"onBeforeEdit"}});a.plugins=[a.cellEditing];a.cmbPegawai=Ext.create("master.pegawai.Combo",{listeners:{select:"onSelectPegawai"}});a.columns=[{text:"Pegawai",xtype:"templatecolumn",dataIndex:"NIP",bind:{hidden:"{!pegawai}"},tpl:'<div style="white-space:normal !important;color:black">{NIP}-{REFERENSI.PEGAWAI.NAMA}</div>',flex:1,editor:a.cmbPegawai},{text:"Pegawai",xtype:"templatecolumn",dataIndex:"NAMA",bind:{hidden:"{pegawai}"},tpl:'<div style="white-space:normal !important;color:black">{NAMA}</div>',flex:1,editor:{xtype:"textfield",name:"NAMA"}}];a.callParent(arguments)},loadCombo:function(f){var d=this,c=d.getViewModel(),e=d.cmbPegawai,a=e.getStore();if(f){c.set("pegawai",(f.get("PEGAWAI"))?true:false);c.set("periode",f);a.setQueryParams({STATUS:1,PROFESI:f.get("PROFESI")});a.load()}}});Ext.define("ppi.audit.individu.xample.ListController",{extend:"Ext.app.ViewController",alias:"controller.ppi-audit-individu-xample-list",pegawai:undefined,onSelectPegawai:function(a,d){var c=this;c.pegawai=d},onBeforeEdit:function(d,a){var e=this,c=e.getViewModel(),f=c.get("periode");if(f){if(f.get("STATUS")==2){a.cancel=true}}},onAfterEdit:function(f,d){var g=this,a=g.getView(),e=g.getViewModel(),h=d.record,c=g.pegawai;if(c){h.set("REFERENSI",{PEGAWAI:c.getData()});h.save({callback:function(j,k,l){if(l){a.fireEvent("reloadGrid")}}});g.pegawai=undefined}else{if(!e.get("pegawai")){h.save({callback:function(j,k,l){if(l){a.fireEvent("reloadGrid")}}})}}}});Ext.define("ppi.audit.individu.xample.Workspace",{extend:"com.Form",xtype:"ppi-audit-individu-xample-workspace",controller:"ppi-audit-individu-xample-workspace",viewModel:{data:{periode:undefined,btnHidden:false}},bodyPadding:0,defaults:{margin:"2.2.2.2"},layout:"border",initComponent:function(){var a=this;a.items=[{region:"center",checkboxModel:true,selModel:{selType:"checkboxmodel",checkOnly:false,mode:"SINGLE"},header:{items:[{xtype:"button",text:"Add",bind:{hidden:"{btnHidden}"},ui:"soft-black",iconCls:"x-fa fa-plus",scope:a.getController(),handler:"addPegawai"}]},hideHeaders:true,title:"Daftar Pegawai",ui:"panel-cyan",flex:1,xtype:"ppi-audit-individu-xample-list",listeners:{select:"onSelectPegawai",reloadGrid:"onreloadGrid"}},{region:"east",hideHeaders:true,title:"Item Penilaian",ui:"panel-cyan",header:{items:[{xtype:"button",text:"Save",bind:{hidden:"{btnHidden}"},ui:"soft-blue",iconCls:"x-fa fa-save",scope:a.getController(),handler:"onSave"}]},flex:1,xtype:"ppi-audit-individu-xample-detail-grid"}];a.callParent(arguments)},load:function(e){var c=this,d=c.down("ppi-audit-individu-xample-list"),a=c.getViewModel();console.log(e);a.set("btnHidden",(e.get("STATUS")==2)?true:false);a.set("periode",e);d.load({STATUS:1,PERIODE:e.get("ID")});d.loadCombo(e)}});Ext.define("ppi.audit.individu.xample.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.ppi-audit-individu-xample-workspace",addPegawai:function(c){var e=this,a=e.getView(),d=e.getViewModel(),f=d.get("periode");model=Ext.create("ppi.audit.individu.xample.Model",{PERIODE:f.get("ID"),STATUS:1});model.save({callback:function(j,g,h){if(h){a.load(f)}}})},onreloadGrid:function(){var c=this,a=c.getView();list=a.down("ppi-audit-individu-xample-list");list.reload()},onSave:function(c){var e=this,a=e.getView(),d=a.down("ppi-audit-individu-xample-detail-grid");d.saveDataGrid(c)},onSelectPegawai:function(c,h){var f=this,a=f.getView(),e=a.down("ppi-audit-individu-xample-detail-grid"),d=f.getViewModel(),g=d.get("periode");e.loadDetailNilai(h,g)}});Ext.define("ppi.audit.individu.xample.detail.Grid",{extend:"com.Grid",xtype:"ppi-audit-individu-xample-detail-grid",controller:"ppi-audit-individu-xample-detail-grid",viewModel:{stores:{store:{type:"ppi-audit-individu-xample-detail-store"},kegiatanStore:{type:"ppi-kegiatan-group-detail-store"}},data:{periode:undefined,xample:undefined}},initComponent:function(){var a=this;a.columns=[{xtype:"templatecolumn",text:"Jenis Kegiatan",dataIndex:"KEGIATAN",flex:1,tpl:'<div style="white-space:normal !important;color:black">{REFERENSI.GROUP_DETAIL.REFERENSI.KEGIATAN.DESKRIPSI}</div>'},{xtype:"checkcolumn",header:"YA",dataIndex:"CHECK",width:50,listeners:{checkchange:"onChange"}}];a.callParent(arguments)},doAfterLoad:function(e,c,f,a){var d=e.getViewModel();if(!f){if(c.length==0){e.setKegiatanGroup(d.get("periode"))}}},loadDetailNilai:function(a,d){var c=this.getViewModel();c.set("periode",d);c.set("xample",a);this.load({XAMPLE:a.get("ID")})},setKegiatanGroup:function(e){var d=this,c=d.getViewModel(),a=c.get("kegiatanStore");xample=c.get("xample");store=c.get("store");a.setQueryParams({STATUS:1,GROUP:e.get("GROUP")});d.setLoading(true);a.load({callback:function(g,f,h){if(h){a.each(function(k,j){model=Ext.create("ppi.audit.individu.xample.detial.Model",{XAMPLE:xample.get("ID"),KEGIATAN:k.get("ID"),CHECK:1,STATUS:1,REFERENSI:{GROUP_DETAIL:k.getData()}});store.insert(store.getCount(),model)});d.setLoading(false)}else{d.setLoading(false)}}})},saveDataGrid:function(c){var e=this,d=e.getViewModel(),a=d.get("store");e.setLoading(true);a.sync({callback:function(f,g,h){e.notifyMessage("Item Penilaian Telah Tersimpan");e.setLoading(false)}})},getData:function(){var d=this,c=d.getViewModel().get("store"),a=[];c.each(function(f,e){a.push(f.getData())});return a}});Ext.define("ppi.audit.individu.xample.detail.GridController",{extend:"Ext.app.ViewController",alias:"controller.ppi-audit-individu-xample-detail-grid",onChange:function(l,a,k){var h=this,g=h.getViewModel(),e=g.get("store"),c=h.getView(),j=e.getAt(a);j.set("CHECK",k?1:0)}});Ext.define("ppi.audit.ruangan.Workspace",{extend:"com.Form",xtype:"ppi-audit-ruangan-workspace",controller:"ppi-audit-ruangan-workspace",bodyPadding:0,layout:"border",items:[{region:"center",bodyPadding:0,ui:"panel-cyan",flex:1,layout:"border",header:{items:[{xtype:"button",text:"History",iconCls:"x-fa fa-history",ui:"soft-black",padding:5,listeners:{click:"onClickHistory"}}]},title:"Audit Ruangan",iconCls:"x-fa fa-bed",items:[{region:"north",reference:"form",xtype:"ppi-penilaian-form",listeners:{sendGroup:"onGetSendGroup"}},{title:"Detail Kegiatan",ui:"panel-cyan",region:"center",reference:"detailList",xtype:"ppi-penilaian-detail-list"}],buttons:[{text:"Simpan",iconCls:"x-fa fa-save",ui:"soft-blue",padding:5,listeners:{click:"onClickSimpan"}},{text:"Reset",iconCls:"x-fa fa-refresh",ui:"soft-red",padding:5,listeners:{click:"onClickReset"}}]}],load:function(e){var d=this,c=d.down("ppi-penilaian-form"),a=d.down("ppi-penilaian-detail-list");c.reset();a.getStore().removeAll();c.loadCombo();c.createRecord({STATUS:1})}});Ext.define("ppi.audit.ruangan.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.ppi-audit-ruangan-workspace",onClickHistory:function(c){var d=this,a=d.getView();a.openDialog("",true,"80%","60%",{xtype:"ppi-penilaian-List",ui:"panel-black",title:"History",btnEditHidden:false,showCloseButton:true,iconCls:"x-fa fa-history"},function(e,g){var f=g.down("ppi-penilaian-List");f.load({STATUS:"1,2"});f.on("editRecord",function(h){d.onEditRecord(h);g.close()})},c)},onGetSendGroup:function(f){var e=this,a=e.getView(),c=e.getReferences(),d=c.detailList;d.getStore().removeAll();d.setKegiatanGroup(f);d.setLoading(true)},onClickSimpan:function(k){var f=this,h=f.getView(),g=f.getReferences(),a=g.form,d=a.getRecord(),c=(a.down("[name=DIREKTORAT]").getSelection())?true:false,j=d.get("GROUP")?true:false,e=g.detailList;if((c)&&(j)){if(e.getData().length){if(d.get("STATUS")===1){d.set("DETAIL",e.getData());a.save(k,{},function(m,l,n){if(n){a.reset();e.getStore().removeAll();h.load()}})}else{h.showMessageBox({title:"Peringatan",message:"Periode ini telah difinalkan oleh petugas",ui:"window-red",buttons:Ext.Msg.OK,animateTarget:k})}}else{h.notifyMessage("Silahkan pilih group yang memiliki detail","danger-red")}}else{h.notifyMessage("Pilih Group dan Ruangan terlebih dahulu","danger-red")}},onClickReset:function(c){var d=this,a=d.getView();a.load()},onEditRecord:function(g){var f=this,a=f.getView(),c=f.getReferences(),e=c.form,d=c.detailList;e.reset();d.getStore().removeAll();d.load({PENILAIAN:g.get("ID")});e.setForm(g)}});Ext.define("ppi.hais.Workspace",{extend:"com.Form",xtype:"ppi-hais-workspace",controller:"ppi-hais-workspace",viewModel:{toFormatNorm:function(d){var e=Ext.String.leftPad(d,8,"0"),f=Ext.String.insert(Ext.String.insert(Ext.String.insert(e,".",2),".",5),".",8);return f},formulas:{getNamaLengkap:function(e){var d=e("pasien.GELAR_DEPAN")||"",f=e("pasien.GELAR_BELAKANG")||"";d=d==""?"":d+". ";f=f==""?"":", "+f;return d+e("pasien.NAMA")+f},getTglLahir:function(c){return Ext.Date.format(c("pasien.TANGGAL_LAHIR"),"d F Y")},getJenisKelamin:function(a){var d=a("pasien.REFERENSI"),c=d?(d.JENISKELAMIN?d.JENISKELAMIN.DESKRIPSI:""):"";return c},getFormatNorm:function(d){var c=d("pasien.NORM")||0;return this.toFormatNorm(c)}},data:{pasien:null}},layout:{type:"border"},defaults:{border:true,margin:"2 2 2 2"},border:true,bodyPadding:0,items:[{region:"west",ui:"panel-black",iconCls:"x-fa fa-user",header:{height:38},title:"Identitas Pasien",layout:"vbox",flex:0.5,defaultType:"component",defaults:{width:"100%",margin:"2 5 0 5"},items:[{html:"<b>Detail Identitas Pasien </b> <hr>"},{bind:{html:"<b>No. RM : {getFormatNorm}</b>"}},{bind:{html:"<b>Nama : </b>{getNamaLengkap}"}},{bind:{html:"<b>Jenis Kelamin : </b>{getJenisKelamin}"}},{bind:{html:"<b>Tgl. Lahir : </b>{getTglLahir}"}},{bind:{html:"<b>Alamat : </b>{pasien.ALAMAT}"}},{xtype:"button",text:"Kontak",ui:"soft-red",iconCls:"x-fa fa-phone",handler:"onBtnKontakClick"}],buttons:[{xtype:"search-field",hideTrigger:true,width:"100%",name:"NORM",reference:"txtnorm",emptyText:"[ Masukkan NORM Pasien dan tekan ENTER ]",listeners:{search:"onClickCari"}}]},{region:"center",flex:1,iconCls:"x-fa fa-list",ui:"panel-black",reference:"kunjungangrid",title:"Kunjungan Pasien",xtype:"kunjungan-list"}],initComponent:function(){var c=this;c.callParent(arguments);var a=c.down("kunjungan-list");a.getHeaderContainer().remove(9);a.getHeaderContainer().add({xtype:"widgetcolumn",text:"Action",align:"center",width:90,widget:{xtype:"fieldcontainer",defaultType:"button",layout:{type:"vbox",align:"stretch"},items:[{text:"HAIs",padding:2,margin:"0 2 1 0",ui:"soft-blue",menu:[{text:"FLEBITIS",targetForm:"ppi-hais-flebitis-form",scope:c.getController(),conf:{panel:"panel-cyan"},handler:"onClickMenuKjgn"},{text:"VENTILATOR AQUIRED PNEUMONIA (VAP)",targetForm:"ppi-hais-vap-form",scope:c.getController(),conf:{panel:"panel-red"},handler:"onClickMenuKjgn"},{text:"INFEKSI SALURAN KEMIH (ISK)",targetForm:"ppi-hais-isk-form",scope:c.getController(),conf:{panel:"panel-green"},handler:"onClickMenuKjgn"},{text:"INFEKSI DAERAH OPERASI (IDO)",conf:{width:"100%",height:"100%",panel:"panel-black"},targetForm:"ppi-ido-workspace",scope:c.getController(),handler:"onClickMenuKjgn"}]}]}});a.setGridConfig({hiddenPencarian:true});a.setListConfig({paging:true,filter:{status:{enabled:true}}})},load:function(){var c=this,a=c.down("kunjungan-list");a.loadStore({NORM:0})}});Ext.define("ppi.hais.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.ppi-hais-workspace",onBtnKontakClick:function(c){var f=this,a=f.getView(),e=f.getViewModel(),d=e.get("pasien");if(d){a.openDialog("",true,450,300,{xtype:"com-form",title:"NORM : "+e.get("getFormatNorm"),ui:"panel-red",showCloseButton:true,items:[{xtype:"form-kontak"}]},function(k,j){var g=j.down("form-kontak"),h=g.tools[0];h.setHidden(true);g.loadRecord(d)},c)}else{a.notifyMessage("Silahkan cari pasien terlebih dahulu","danger-red")}},onClickCari:function(c){var d=this,a=d.getReferences();norm=a.txtnorm.getValue(),kjgngrd=a.kunjungangrid,view=d.getView(),vm=d.getViewModel();if(norm){view.setLoading(true);data.model.Pasien.load(norm,{success:function(f,e){vm.set("pasien",f);view.setLoading(false);kjgngrd.loadStore({NORM:norm,HISTORY:1})},failure:function(f,e){view.showMessageBox({title:"Warning",message:"Data pasien Tidak ditemukan",ui:"window-red",buttons:Ext.Msg.OK,animateTarget:c});vm.set("pasien",null);view.setLoading(false)}})}},onClickMenuKjgn:function(e){var g=this,d=e.conf?e.conf:false,j=e.ownerCt.ownerCmp.ownerCt.getWidgetRecord(),c=g.getView(),a=d?d.width?d.width:"60%":"60%",f=d?d.height?d.width:"70%":"70%";c.openDialog("",true,a,f,{xtype:e.targetForm,title:e.text,showCloseButton:true,ui:d.panel},function(k,l){var h=l.down(e.targetForm);h.load(j);h.on("save",function(){l.close()})},e)}});Ext.define("ppi.hais.flebitis.Form",{extend:"com.Form",xtype:"ppi-hais-flebitis-form",controller:"ppi-hais-flebitis-form",viewModel:{stores:{flebitisStore:{type:"ppi-hais-flebitis-store"}},data:{kunjungan:undefined},formulas:{getUmur:function(d){var f=d("kunjungan.REFERENSI.PENDAFTARAN.REFERENSI.PASIEN"),c=this.getTglToUmur(new Date(),Ext.Date.parse(f.TANGGAL_LAHIR,"Y-m-d")),e=Ext.util.Format.format("{0}Thn {1}bln {2}hr",c.thn,c.bln,c.hr);return e}},getTglToUmur:function(c,d){var a=Ext.Date.diff(d,c,Ext.Date.DAY);thn=Math.floor(a/365);bln=Math.floor((a%365)/30);hr=Math.floor((a%365)%30);return{thn:thn,bln:bln,hr:hr}}},model:"ppi.hais.flebitis.Model",scrollable:true,layout:"vbox",defaults:{margin:"2 2 2 2",width:"100%"},defaultType:"fieldset",items:[{title:"Waktu pemasangan",layout:{type:"hbox"},defaultType:"datefield",defaults:{width:"25%",margin:"1.1.1.1",allowBlank:false},items:[{xtype:"checkbox",inputValue:1,uncheckedValue:0,margin:"5.1.1.1",width:"32%",boxLabel:"PEMASANGAN INTRA VENA LINE (IVL) ",name:"PEMAKAIAN_ALAT",listeners:{change:"onChangeStatusPemasangan"}},{emptyText:"Awal Pemasangan",format:"Y-m-d",reference:"txtawal",name:"TANGGAL_PASANG",disabled:true,listeners:{blur:"onBlurTxtTgl"}},{emptyText:"Akhir Pemasangan",format:"Y-m-d",name:"TANGGAL_LEPAS",reference:"txtakhir",disabled:true,listeners:{blur:"onBlurTxtTgl"}},{xtype:"numberfield",name:"LAMA_HARI",width:"10%",readOnly:true,align:"right",reference:"txtlamahari",value:0,disabled:true,minValue:0}]},{title:"Kejadian HAIs : ",layout:"hbox",defaults:{margin:"5.1.10.1"},items:[{xtype:"checkbox",inputValue:1,uncheckedValue:0,boxLabel:"FLEBITIS",name:"STATUS_HAIS",listeners:{change:"onChangeStatusHais"}},{xtype:"datefield",disabled:true,width:"40%",emptyText:"Tanggal Kejadian",format:"Y-m-d",reference:"tglkejadian",name:"TANGGAL_KEJADIAN"}]},{title:"Antibiotik",layout:"hbox",defaults:{margin:"1.1.1.1"},items:[{xtype:"referensi-combo",params:{JENIS:128,STATUS:1},firstLoad:true,name:"ANTIBIOTIK",width:"60%",emptyText:"Antibiotik",listeners:{blur:"onBlurAntibiotik"}},{xtype:"datefield",disabled:true,width:"19%",emptyText:"Tanggal Pakai",format:"Y-m-d",reference:"tglpakai",name:"TANGGAL_PAKAI_ANTIBIOTIK"},{xtype:"datefield",disabled:true,width:"19%",emptyText:"Tanggal Berhenti",format:"Y-m-d",reference:"tglberhenti",name:"TANGGAL_BERHENTI_ANTIBIOTIK"}]},{title:"Pemeriksaan Kultur",layout:"vbox",defaultType:"textarea",defaults:{width:"100%",margin:"1.1.1.1"},items:[{xtype:"referensi-combo",params:{JENIS:152,STATUS:1},firstLoad:true,margin:"1.1.1.1",name:"JENIS_PEMERIKSAAN_KULTUR",emptyText:"Jenis Pemeriksaan Kultur"},{xtype:"textarea",emptyText:"Hasil Kultur",name:"HASIL_KULTUR"}]},{title:"Keterangan Tambahan",layout:"hbox",defaultType:"textarea",defaults:{width:"50%",margin:"1.1.1.1"},items:[{emptyText:"Infeksi Lain",name:"INFEKSI_LAIN"},{emptyText:"Laboratorium",name:"LABORATORIUM"}]}],buttons:[{text:"Simpan",iconCls:"x-fa fa-save",ui:"soft-purple",reference:"btnSimpan",disabled:true,handler:"onClickBtnSimpan"}],load:function(d){var e=this,c=e.getViewModel(),a=e.down("[name=TANGGAL_PASANG]"),g=e.down("[name=TANGGAL_LEPAS]"),k=e.down("[name=TANGGAL_KEJADIAN]"),h=e.down("[name=TANGGAL_PAKAI_ANTIBIOTIK]"),f=e.down("[name=TANGGAL_BERHENTI_ANTIBIOTIK]"),j=c.get("flebitisStore");c.set("kunjungan",d);e.setLoading(true);j.setQueryParams({KUNJUNGAN:d.get("NOMOR"),STATUS:1});a.setMinValue(d.get("MASUK"));a.setMaxValue((d.get("KELUAR"))?d.get("KELUAR"):e.getSysdate());g.setMinValue(d.get("MASUK"));g.setMaxValue((d.get("KELUAR"))?d.get("KELUAR"):e.getSysdate());k.setMinValue(d.get("MASUK"));k.setMaxValue((d.get("KELUAR"))?d.get("KELUAR"):e.getSysdate());h.setMinValue(d.get("MASUK"));h.setMaxValue((d.get("KELUAR"))?d.get("KELUAR"):e.getSysdate());f.setMinValue(d.get("MASUK"));f.setMaxValue((d.get("KELUAR"))?d.get("KELUAR"):e.getSysdate());j.load({callback:function(p,l,q){e.setLoading(false);if(q){e.loadRecord(p[0])}else{var o=d.get("MASUK"),n=(d.get("KELUAR"))?d.get("KELUAR"):e.getSysdate(),m=Ext.Date.diff(o,n,Ext.Date.DAY);e.createRecord({KUNJUNGAN:d.get("NOMOR"),NOPEN:d.get("NOPEN"),NORM:d.get("REFERENSI").PENDAFTARAN.NORM,RUANGAN:d.get("RUANGAN"),STATUS:1,TANGGAL_LEPAS:d.get("STATUS")==2?d.get("KELUAR"):e.getSysdate(),TANGGAL_PASANG:d.get("MASUK"),STATUS_HAIS:0,LAMA_HARI:m+1,PEMAKAIAN_ALAT:1})}}})}});Ext.define("ppi.hais.flebitis.FormController",{extend:"Ext.app.ViewController",alias:"controller.ppi-hais-flebitis-form",onClickBtnSimpan:function(d){var f=this,a=f.getView(),e=f.getViewModel(),g=e.get("record"),c=e.get("getUmur");if(!Ext.isNumeric(g.get("ID"))){g.set("USIA",c)}a.setLoading(true);a.save(d,{},function(k,h,j){a.setLoading(false)})},onBlurTxtTgl:function(e,h){var g=this,d=g.getReferences(),a=d.txtawal,f=d.txtakhir,c=d.txtlamahari;c.setValue(Ext.Date.diff(a.getValue(),f.getValue(),Ext.Date.DAY))},onChangeStatusHais:function(c,f,e){var d=this,a=d.getReferences();a.tglkejadian.setDisabled(!f)},onChangeStatusPemasangan:function(c,f,e){var d=this,a=d.getReferences();a.txtawal.setDisabled(!f);a.txtakhir.setDisabled(!f);a.txtlamahari.setDisabled(!f);a.btnSimpan.setDisabled(!f)},onBlurAntibiotik:function(e,h){var f=this,d=f.getReferences(),g=d.tglpakai,a=d.tglberhenti,c=e.getSelection()?false:true;g.setDisabled(c);a.setDisabled(c)}});Ext.define("ppi.hais.isk.Form",{extend:"com.Form",xtype:"ppi-hais-isk-form",controller:"ppi-hais-isk-form",viewModel:{stores:{iskStore:{type:"ppi-hais-isk-store"}},data:{kunjungan:undefined},formulas:{getUmur:function(d){var f=d("kunjungan.REFERENSI.PENDAFTARAN.REFERENSI.PASIEN"),c=this.getTglToUmur(new Date(),Ext.Date.parse(f.TANGGAL_LAHIR,"Y-m-d")),e=Ext.util.Format.format("{0}Thn {1}bln {2}hr",c.thn,c.bln,c.hr);return e}},getTglToUmur:function(c,d){var a=Ext.Date.diff(d,c,Ext.Date.DAY);thn=Math.floor(a/365);bln=Math.floor((a%365)/30);hr=Math.floor((a%365)%30);return{thn:thn,bln:bln,hr:hr}}},model:"ppi.hais.isk.Model",scrollable:true,layout:"vbox",defaults:{margin:"2 2 2 2",width:"100%"},defaultType:"fieldset",items:[{title:"Waktu pemasangan",layout:{type:"hbox"},defaultType:"datefield",defaults:{width:"25%",margin:"5.1.1.1",allowBlank:false},items:[{xtype:"checkbox",inputValue:1,uncheckedValue:0,width:"32%",boxLabel:"PEMASANGAN URINE KATETER (UC) ",name:"PEMAKAIAN_ALAT",listeners:{change:"onChangeStatusPemasangan"}},{emptyText:"Awal Pemasangan",format:"Y-m-d",reference:"txtawal",name:"TANGGAL_PASANG",disabled:true,listeners:{blur:"onBlurTxtTgl"}},{emptyText:"Akhir Pemasangan",format:"Y-m-d",name:"TANGGAL_LEPAS",reference:"txtakhir",disabled:true,listeners:{blur:"onBlurTxtTgl"}},{xtype:"numberfield",name:"LAMA_HARI",width:"10%",readOnly:true,reference:"txtlamahari",value:0,minValue:0}]},{title:"Kejadian HAIs",layout:"hbox",defaults:{margin:"5.1.10.1"},items:[{xtype:"checkbox",inputValue:1,uncheckedValue:0,boxLabel:"ISK (INFEKSI SALURAN KEMIH)",name:"STATUS_HAIS",listeners:{change:"onChangeStatusHais"}},{xtype:"datefield",disabled:true,width:"40%",emptyText:"Tanggal Kejadian",format:"Y-m-d",reference:"tglkejadian",name:"TANGGAL_KEJADIAN"}]},{title:"Antibiotik",layout:"hbox",defaults:{margin:"1.1.1.1"},items:[{xtype:"referensi-combo",params:{JENIS:128,STATUS:1},firstLoad:true,name:"ANTIBIOTIK",width:"60%",emptyText:"Antibiotik",listeners:{blur:"onBlurAntibiotik"}},{xtype:"datefield",disabled:true,width:"19%",emptyText:"Tanggal Pakai",format:"Y-m-d",reference:"tglpakai",name:"TANGGAL_PAKAI_ANTIBIOTIK"},{xtype:"datefield",disabled:true,width:"19%",emptyText:"Tanggal Berhenti",format:"Y-m-d",reference:"tglberhenti",name:"TANGGAL_BERHENTI_ANTIBIOTIK"}]},{title:"Pemeriksaan Kultur",layout:"vbox",defaultType:"textarea",defaults:{width:"100%",margin:"1.1.1.1"},items:[{xtype:"referensi-combo",params:{JENIS:152,STATUS:1},firstLoad:true,margin:"1.1.1.1",name:"JENIS_PEMERIKSAAN_KULTUR",emptyText:"Jenis Pemeriksaan Kultur"},{xtype:"textarea",emptyText:"Hasil Kultur",name:"HASIL_KULTUR"}]},{title:"Keterangan Tambahan",layout:"hbox",defaultType:"textarea",defaults:{width:"50%",margin:"1 1 1 1"},items:[{emptyText:"Infeksi Lain",name:"INFEKSI_LAIN"},{emptyText:"Laboratorium",name:"LABORATORIUM"}]}],buttons:[{text:"Simpan",iconCls:"x-fa fa-save",ui:"soft-purple",reference:"btnSimpan",disabled:true,handler:"onClickBtnSimpan"}],load:function(e){var f=this,d=f.getViewModel(),c=f.down("[name=TANGGAL_PASANG]"),h=f.down("[name=TANGGAL_LEPAS]"),k=f.down("[name=TANGGAL_KEJADIAN]"),j=f.down("[name=TANGGAL_PAKAI_ANTIBIOTIK]"),g=f.down("[name=TANGGAL_BERHENTI_ANTIBIOTIK]"),a=d.get("iskStore");d.set("kunjungan",e);f.setLoading(true);a.setQueryParams({KUNJUNGAN:e.get("NOMOR"),STATUS:1});c.setMinValue(e.get("MASUK"));c.setMaxValue((e.get("KELUAR"))?e.get("KELUAR"):f.getSysdate());h.setMinValue(e.get("MASUK"));h.setMaxValue((e.get("KELUAR"))?e.get("KELUAR"):f.getSysdate());k.setMinValue(e.get("MASUK"));k.setMaxValue((e.get("KELUAR"))?e.get("KELUAR"):f.getSysdate());j.setMinValue(e.get("MASUK"));j.setMaxValue((e.get("KELUAR"))?e.get("KELUAR"):f.getSysdate());g.setMinValue(e.get("MASUK"));g.setMaxValue((e.get("KELUAR"))?e.get("KELUAR"):f.getSysdate());a.load({callback:function(p,l,q){f.setLoading(false);if(q){f.loadRecord(p[0])}else{var o=e.get("MASUK"),n=(e.get("KELUAR"))?e.get("KELUAR"):f.getSysdate(),m=Ext.Date.diff(o,n,Ext.Date.DAY);f.createRecord({KUNJUNGAN:e.get("NOMOR"),NOPEN:e.get("NOPEN"),NORM:e.get("REFERENSI").PENDAFTARAN.NORM,RUANGAN:e.get("RUANGAN"),STATUS:1,TANGGAL_LEPAS:e.get("STATUS")==2?e.get("KELUAR"):f.getSysdate(),TANGGAL_PASANG:e.get("MASUK"),STATUS_HAIS:0,LAMA_HARI:m+1,PEMAKAIAN_ALAT:1})}}})}});Ext.define("ppi.hais.isk.FormController",{extend:"Ext.app.ViewController",alias:"controller.ppi-hais-isk-form",onClickBtnSimpan:function(d){var f=this,a=f.getView(),e=f.getViewModel(),g=e.get("record"),c=e.get("getUmur");if(!Ext.isNumeric(g.get("ID"))){g.set("USIA",c)}a.setLoading(true);a.save(d,{},function(k,h,j){a.setLoading(false)})},onBlurTxtTgl:function(e,h){var g=this,d=g.getReferences(),a=d.txtawal,f=d.txtakhir,c=d.txtlamahari;c.setValue(Ext.Date.diff(a.getValue(),f.getValue(),Ext.Date.DAY))},onChangeStatusHais:function(c,f,e){var d=this,a=d.getReferences();a.tglkejadian.setDisabled(!f)},onChangeStatusPemasangan:function(c,f,e){var d=this,a=d.getReferences();a.txtawal.setDisabled(!f);a.txtakhir.setDisabled(!f);a.txtlamahari.setDisabled(!f);a.btnSimpan.setDisabled(!f)},onBlurAntibiotik:function(e,h){var f=this,d=f.getReferences(),g=d.tglpakai,a=d.tglberhenti,c=e.getSelection()?false:true;g.setDisabled(c);a.setDisabled(c)}});Ext.define("ppi.hais.vap.Form",{extend:"com.Form",xtype:"ppi-hais-vap-form",controller:"ppi-hais-vap-form",viewModel:{stores:{vapStore:{type:"ppi-hais-vap-store"}},data:{kunjungan:undefined},formulas:{getUmur:function(d){var f=d("kunjungan.REFERENSI.PENDAFTARAN.REFERENSI.PASIEN"),c=this.getTglToUmur(new Date(),Ext.Date.parse(f.TANGGAL_LAHIR,"Y-m-d")),e=Ext.util.Format.format("{0}Thn {1}bln {2}hr",c.thn,c.bln,c.hr);return e}},getTglToUmur:function(c,d){var a=Ext.Date.diff(d,c,Ext.Date.DAY);thn=Math.floor(a/365);bln=Math.floor((a%365)/30);hr=Math.floor((a%365)%30);return{thn:thn,bln:bln,hr:hr}}},model:"ppi.hais.vap.Model",scrollable:true,layout:"vbox",defaults:{margin:"2 2 2 2",width:"100%"},defaultType:"fieldset",items:[{title:"Waktu pemasangan",layout:{type:"hbox"},defaultType:"datefield",defaults:{width:"25%",margin:"5.1.1.1",allowBlank:false},items:[{xtype:"checkbox",inputValue:1,uncheckedValue:0,width:"32%",boxLabel:"PEMASANGAN VENTILATOR",name:"PEMAKAIAN_ALAT",listeners:{change:"onChangeStatusPemasangan"}},{emptyText:"Awal Pemasangan",format:"Y-m-d",reference:"txtawal",name:"TANGGAL_PASANG",listeners:{blur:"onBlurTxtTgl"}},{emptyText:"Akhir Pemasangan",format:"Y-m-d",name:"TANGGAL_LEPAS",reference:"txtakhir",listeners:{blur:"onBlurTxtTgl"}},{xtype:"numberfield",name:"LAMA_HARI",width:"10%",readOnly:true,reference:"txtlamahari",value:0,minValue:0}]},{title:"Kejadian HAIs",layout:"hbox",defaults:{margin:"5.1.10.1"},items:[{xtype:"checkbox",inputValue:1,uncheckedValue:0,boxLabel:"VAP (VENTILATOR AQUIRED PNEUMONIA)",name:"STATUS_HAIS",listeners:{change:"onChangeStatusHais"}},{xtype:"datefield",disabled:true,width:"40%",emptyText:"Tanggal Kejadian",format:"Y-m-d",reference:"tglkejadian",name:"TANGGAL_KEJADIAN"}]},{title:"Antibiotik",layout:"hbox",defaults:{margin:"1.1.1.1"},items:[{xtype:"referensi-combo",params:{JENIS:128,STATUS:1},firstLoad:true,name:"ANTIBIOTIK",width:"60%",emptyText:"Antibiotik",listeners:{blur:"onBlurAntibiotik"}},{xtype:"datefield",disabled:true,width:"19%",emptyText:"Tanggal Pakai",format:"Y-m-d",reference:"tglpakai",name:"TANGGAL_PAKAI_ANTIBIOTIK"},{xtype:"datefield",disabled:true,width:"19%",emptyText:"Tanggal Berhenti",format:"Y-m-d",reference:"tglberhenti",name:"TANGGAL_BERHENTI_ANTIBIOTIK"}]},{title:"Pemeriksaan Kultur",layout:"vbox",defaultType:"textarea",defaults:{width:"100%",margin:"1.1.1.1"},items:[{xtype:"referensi-combo",params:{JENIS:152,STATUS:1},firstLoad:true,margin:"1.1.1.1",name:"JENIS_PEMERIKSAAN_KULTUR",emptyText:"Jenis Pemeriksaan Kultur"},{xtype:"textarea",emptyText:"Hasil Kultur",name:"HASIL_KULTUR"}]},{title:"Keterangan Tambahan",layout:"hbox",defaultType:"textarea",defaults:{width:"50%",margin:"1 1 1 1"},items:[{emptyText:"Infeksi Lain",name:"INFEKSI_LAIN"},{emptyText:"Laboratorium",name:"LABORATORIUM"}]}],buttons:[{text:"Simpan",iconCls:"x-fa fa-save",ui:"soft-purple",reference:"btnSimpan",disabled:true,handler:"onClickBtnSimpan"}],load:function(e){var f=this,c=f.getViewModel(),a=f.down("[name=TANGGAL_PASANG]"),h=f.down("[name=TANGGAL_LEPAS]"),k=f.down("[name=TANGGAL_KEJADIAN]"),j=f.down("[name=TANGGAL_PAKAI_ANTIBIOTIK]"),g=f.down("[name=TANGGAL_BERHENTI_ANTIBIOTIK]"),d=c.get("vapStore");c.set("kunjungan",e);f.setLoading(true);d.setQueryParams({KUNJUNGAN:e.get("NOMOR"),STATUS:1});a.setMinValue(e.get("MASUK"));a.setMaxValue((e.get("KELUAR"))?e.get("KELUAR"):f.getSysdate());h.setMinValue(e.get("MASUK"));h.setMaxValue((e.get("KELUAR"))?e.get("KELUAR"):f.getSysdate());k.setMinValue(e.get("MASUK"));k.setMaxValue((e.get("KELUAR"))?e.get("KELUAR"):f.getSysdate());j.setMinValue(e.get("MASUK"));j.setMaxValue((e.get("KELUAR"))?e.get("KELUAR"):f.getSysdate());g.setMinValue(e.get("MASUK"));g.setMaxValue((e.get("KELUAR"))?e.get("KELUAR"):f.getSysdate());d.load({callback:function(p,l,q){f.setLoading(false);if(q){f.loadRecord(p[0])}else{var o=e.get("MASUK"),n=(e.get("KELUAR"))?e.get("KELUAR"):f.getSysdate(),m=Ext.Date.diff(o,n,Ext.Date.DAY);f.createRecord({KUNJUNGAN:e.get("NOMOR"),NOPEN:e.get("NOPEN"),NORM:e.get("REFERENSI").PENDAFTARAN.NORM,RUANGAN:e.get("RUANGAN"),STATUS:1,TANGGAL_LEPAS:e.get("STATUS")==2?e.get("KELUAR"):f.getSysdate(),TANGGAL_PASANG:e.get("MASUK"),STATUS_HAIS:0,LAMA_HARI:m+1,PEMAKAIAN_ALAT:1})}}})}});Ext.define("ppi.hais.vap.FormController",{extend:"Ext.app.ViewController",alias:"controller.ppi-hais-vap-form",onClickBtnSimpan:function(d){var f=this,a=f.getView(),e=f.getViewModel(),g=e.get("record"),c=e.get("getUmur");if(!Ext.isNumeric(g.get("ID"))){g.set("USIA",c)}a.setLoading(true);a.save(d,{},function(k,h,j){a.setLoading(false)})},onBlurTxtTgl:function(e,h){var g=this,d=g.getReferences(),a=d.txtawal,f=d.txtakhir,c=d.txtlamahari;c.setValue(Ext.Date.diff(a.getValue(),f.getValue(),Ext.Date.DAY))},onChangeStatusHais:function(c,f,e){var d=this,a=d.getReferences();a.tglkejadian.setDisabled(!f)},onChangeStatusPemasangan:function(c,f,e){var d=this,a=d.getReferences();a.txtawal.setDisabled(!f);a.txtakhir.setDisabled(!f);a.txtlamahari.setDisabled(!f);a.btnSimpan.setDisabled(!f)},onBlurAntibiotik:function(e,h){var f=this,d=f.getReferences(),g=d.tglpakai,a=d.tglberhenti,c=e.getSelection()?false:true;g.setDisabled(c);a.setDisabled(c)}});Ext.define("ppi.ido.Form",{extend:"com.Form",xtype:"ppi-ido-form",controller:"ppi-ido-form",viewModel:{stores:{idoStore:{type:"ppi-ido-store"},jenisOpt:Ext.create("Ext.data.Store",{fields:["val","desk"],data:[{val:1,desk:"B - Bersih"},{val:2,desk:"BT - Bersih Tercemar"},{val:3,desk:"K - Kotor"}]}),klasifikasiOpt:Ext.create("Ext.data.Store",{fields:["val","desk"],data:[{val:1,desk:"ILS - Infeksi Luka Superficial  "},{val:2,desk:"ILD - Infeksi Luka Dalam"},{val:3,desk:"ILO - Infeksi Luka Organ"}]}),antibiotik:{type:"referensi-store",queryParams:{JENIS:128,STATUS:1},autoLoad:true},operasi:Ext.create("Ext.data.Store",{fields:["val","desk"],data:[{val:1,desk:"CITO"},{val:2,desk:"ELEKTIF"}]})},data:{pasien:undefined},formulas:{getFormatNorm:function(d){var c=d("pasien.NORM")||0;return this.toFormatNorm(c)},getNamaLengkap:function(e){var d=e("pasien.GELAR_DEPAN")||"",f=e("pasien.GELAR_BELAKANG")||"";d=d==""?"":d+". ";f=f==""?"":", "+f;return d+e("pasien.NAMA")+f},getTempatLahir:function(c){var a=c("pasien.TEMPAT_LAHIR"),e=c("pasien.REFERENSI"),d=e?(e.TEMPATLAHIR?e.TEMPATLAHIR.DESKRIPSI:"-"):"-";return Ext.isNumeric(a)?d:a},getTglLahir:function(c){return Ext.Date.format(c("pasien.TANGGAL_LAHIR"),"d F Y")},getUmur:function(d){var c=this.getTglToUmur(new Date(),d("pasien.TANGGAL_LAHIR")),e=(d("record.USIA"))?d("record.USIA"):Ext.util.Format.format("{0}Thn {1}bln {2}hr",c.thn,c.bln,c.hr);return e},getJenisKelamin:function(c){var d=c("pasien.JENIS_KELAMIN");return(d==1)?"Laki - Laki":"Perempuan"}},toFormatNorm:function(d){var e=Ext.String.leftPad(d,8,"0"),f=Ext.String.insert(Ext.String.insert(Ext.String.insert(e,".",2),".",5),".",8);return f},getTglToUmur:function(c,d){var a=Ext.Date.diff(d,c,Ext.Date.DAY);thn=Math.floor(a/365);bln=Math.floor((a%365)/30);hr=Math.floor((a%365)%30);return{thn:thn,bln:bln,hr:hr}}},defaults:{width:"100%",border:false},model:"ppi.ido.Model",items:[{layout:"hbox",title:"IDENTITAS PASIEN",ui:"panel-cyan",defaults:{margin:"2.2.2.2",width:"16%",labelAlign:"top"},items:[{xtype:"textfield",fieldLabel:"NORM",name:"NORMX",readOnly:true,bind:{value:"{getFormatNorm}"}},{xtype:"textfield",fieldLabel:"NAMA LENGKAP",name:"NAMA",readOnly:true,bind:{value:"{getNamaLengkap}"}},{xtype:"textfield",fieldLabel:"TEMPAT / TANGGAL LAHIR",readOnly:true,name:"LAHIR",bind:{value:"{getTempatLahir} / {getTglLahir}"}},{xtype:"textfield",fieldLabel:"JENIS KELAMIN",name:"JK",readOnly:true,bind:{value:"{getJenisKelamin}"}},{xtype:"textfield",fieldLabel:"UMUR",name:"USIA",readOnly:true,bind:{value:"{getUmur}"}}]},{layout:"hbox",title:"OPERASI",ui:"panel-cyan",defaults:{margin:"2.2.2.2",labelAlign:"top"},items:[{xtype:"textarea",readOnly:true,width:"50%",height:130,name:"DX_OPERASI",fieldLabel:"DX OPERASI - DIAGNOSA MEDIS"},{layout:"vbox",width:"15%",border:false,defaults:{margin:"2.2.2.2",width:"100%",labelAlign:"top"},items:[{xtype:"timefield",readOnly:true,format:"H:i:s",name:"LAMA_OPERASI",fieldLabel:"LAMA OPERASI"},{xtype:"datefield",readOnly:true,format:"Y-m-d",name:"TANGGAL_OPERASI",fieldLabel:"TANGGAL OPERASI"}]}]},{layout:"hbox",title:"LAPORAN INFEKSI LUKA DAERAH OPERASI IDO",ui:"panel-cyan",defaults:{margin:"2.2.2.2",width:"20%",labelAlign:"top"},items:[{xtype:"textfield",name:"SUHU",fieldLabel:"SUHU"},{xtype:"combobox",bind:{store:"{jenisOpt}"},displayField:"desk",valueField:"val",name:"JENIS_OPERASI",fieldLabel:"JENIS OPERASI"},{xtype:"numberfield",hideTrigger:true,minValue:1,maxValue:5,emptyText:"[1 S/D 5]",name:"ASA_SCORE",fieldLabel:"ASA SCORE - (1 S/D 5)"}]},{layout:"hbox",defaults:{margin:"2.2.2.2",width:"30%",labelAlign:"top"},items:[{xtype:"combobox",name:"KLP",displayField:"desk",valueField:"val",bind:{store:"{klasifikasiOpt}"},fieldLabel:"KLASIFIKASI LUKA OPERASI"},{xtype:"combobox",name:"ANTIBIOTIK",bind:{store:"{antibiotik}"},displayField:"DESKRIPSI",valueField:"ID",fieldLabel:"ANTIBIOTIK"},{xtype:"combobox",name:"OPERASI",bind:{store:"{operasi}"},displayField:"desk",valueField:"val",fieldLabel:"OPERASI"}]},{layout:"hbox",defaults:{margin:"2.2.2.2",width:"90%",labelAlign:"top"},items:[{xtype:"textarea",name:"HASIL_KULTUR",fieldLabel:"HASIL KULTUR"}]}],buttons:[{xtype:"label",text:"* Isi Gejala Ido sebelum menyimpan"},{text:"Syarat / Gejala IDO",ui:"soft-black",iconCls:"x-fa fa-arrow-circle-right",handler:"onClickGejalaIdo"},{xtype:"checkbox",readOnly:true,inputValue:1,uncheckedValue:0,boxLabel:"STATUS IDO",name:"STATUS_IDO"},"->",{text:"Simpan",ui:"soft-blue",iconCls:"x-fa fa-save",handler:"onSimpanIDO"}],formExecution:function(d){var c=this,a=d.get("REFERENSI");norm=a.KUNJUNGAN.REFERENSI.PENDAFTARAN.NORM,vm=c.getViewModel(),store=vm.get("idoStore");c.setLoading(true);data.model.Pasien.load(norm,{success:function(f,e){vm.set("pasien",f)}});store.setQueryParams({ID_OPERASI:d.get("ID")});store.load({callback:function(f,e,g){if(g){record=f[0];record.set("LAMA_OPERASI",d.get("DURASI"));record.set("DX_OPERASI",d.get("PRA_BEDAH"));c.loadRecord(record)}else{c.createRecord({STATUS:1,NORM:norm,ASA_SCORE:1,KUNJUNGAN:d.get("KUNJUNGAN"),RUANGAN:a.KUNJUNGAN.RUANGAN,ID_OPERASI:d.get("ID"),DX_OPERASI:d.get("PRA_BEDAH"),LAMA_OPERASI:d.get("DURASI"),TANGGAL_OPERASI:d.get("TANGGAL")})}c.setLoading(false)}})}});Ext.define("ppi.ido.FormController",{extend:"Ext.app.ViewController",alias:"controller.ppi-ido-form",dataGejala:[],onSimpanIDO:function(c){var d=this,e=d.dataGejala,a=d.getView(),f=a.getRecord();if(a.getForm().isValid()){f.set("GEJALA_IDO",e);if(f.set("STATUS_IDO")==1){a.save(c)}else{a.showMessageBox({title:"Peringatan",message:"Anda yakin ingin menyimpan data ini ? <br> data ini tidak termasuk IDO ",ui:"window-red",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,animateTarget:c,fn:function(g){if(g==="yes"){a.save(c)}}})}}},onClickGejalaIdo:function(d){var e=this,c=e.getView(),a=c.down("[name = STATUS_IDO]"),f=c.getRecord();c.openDialog("",true,450,300,{xtype:"ppi-ido-gejala-list",ui:"panel-blue",title:"Syarat / Gejala IDO",iconCls:"x-fa fa-arrow-circle-right",showCloseButton:true},function(g,j){var h=j.down("ppi-ido-gejala-list");if(Ext.isNumeric(f.get("ID"))){h.load({IDO:f.get("ID")})}else{h.setReferensi()}h.on("sendNilai",function(l,k){if((k!=0)&&(k==l.length)){a.setValue(1)}else{a.setValue(0)}e.dataGejala=l;j.close()})},d)}});Ext.define("ppi.ido.List",{extend:"com.Grid",xtype:"ppi-ido-list",controller:"ppi-ido-list",viewModel:{stores:{store:{type:"ppi-ido-store"}},data:{listConfig:{paging:true}}},header:{items:[{xtype:"button",ui:"soft-blue",iconCls:"x-fa fa-print",tooltip:"Cetak Laporan IDO",handler:"onClickCetak"}]},columns:[{xtype:"rownumberer",text:"No",align:"left",width:50},{text:"NO.RM",dataIndex:"NORM",sortable:false,width:100},{xtype:"templatecolumn",text:"Nama",dataIndex:"NORM",sortable:false,width:140,tpl:'<div style="white-space:normal !important;color:black">{REFERENSI.PASIEN.NAMA}</div>'},{xtype:"templatecolumn",text:"Ruangan",dataIndex:"RUANGAN",sortable:false,tpl:'<div style="white-space:normal !important;color:black">{REFERENSI.RUANGAN.DESKRIPSI}</div>'},{xtype:"datecolumn",text:"Tanggal Operasi",format:"d/m/Y",dataIndex:"TANGGAL_OPERASI",sortable:false,width:140},{text:"Usia",dataIndex:"USIA",sortable:false,width:130},{text:"Suhu",dataIndex:"SUHU",sortable:false,width:80},{text:"Jenis Operasi",dataIndex:"JENIS_OPERASI",sortable:false,width:140,xtype:"templatecolumn",tpl:new Ext.XTemplate('<div class="thumb-wrap">','<div class="thumb">','<div style=" white-space:normal !important;">{[this.getDeskripsi(values.JENIS_OPERASI)]}</div>',"</div>","</div>",{getDeskripsi:function(c){var a=(c==1)?"B - Bersih":(c==2)?"BT - Bersih Tercemar":"K - Kotor";return a}})},{text:"Asa Score",dataIndex:"ASA_SCORE",sortable:false,width:140},{text:"Klasifikasi",dataIndex:"KLP",sortable:false,width:140,xtype:"templatecolumn",tpl:new Ext.XTemplate('<div class="thumb-wrap">','<div class="thumb">','<div style=" white-space:normal !important;">{[this.getDeskripsi(values.KLP)]}</div>',"</div>","</div>",{getDeskripsi:function(c){var a=(c==1)?"ILS - Infeksi Luka Superficial":(c==2)?"ILD - Infeksi Luka Dalam":"ILO - Infeksi Luka Organ";return a}})},{text:"Antibiotik",dataIndex:"ANTIBIOTIK",sortable:false,width:140,xtype:"templatecolumn",tpl:new Ext.XTemplate('<div class="thumb-wrap">','<div class="thumb">','<div style=" white-space:normal !important;">{[this.getDeskripsi(values.KLP)]}</div>',"</div>","</div>",{getDeskripsi:function(c){var a=(c==1)?"PROPIL":"TERAPI";return a}})},{text:"Operasi",dataIndex:"OPERASI",sortable:false,width:140,xtype:"templatecolumn",tpl:new Ext.XTemplate('<div class="thumb-wrap">','<div class="thumb">','<div style=" white-space:normal !important;">{[this.getDeskripsi(values.OPERASI)]}</div>',"</div>","</div>",{getDeskripsi:function(c){var a=(c==1)?"CITO":"ELEKTIF";return a}})},{text:"Hasil Kultur",xtype:"templatecolumn",dataIndex:"HASIL_KULTUR",sortable:false,width:350,tpl:'<div style="white-space:normal !important;color:black">{HASIL_KULTUR}</div>'},{text:"S. IDO",dataIndex:"STATUS_IDO",sortable:false,width:100,xtype:"templatecolumn",tpl:new Ext.XTemplate('<div class="thumb-wrap">','<div class="thumb">','<div style=" white-space:normal !important;">{[this.getDeskripsi(values.STATUS_IDO)]}</div>',"</div>","</div>",{getDeskripsi:function(c){var a=(c==1)?"IDO":"-";return a}})},{xtype:"widgetcolumn",align:"center",text:"Aksi",widget:{xtype:"fieldcontainer",defaults:{padding:2,margin:"0 2 1 0"},items:[{xtype:"button",action:0,text:"Gejala Ido",iconCls:"x-fa fa-arrow-circle-right",ui:"soft-blue",handler:"onGejalaIdo"}]}}]});Ext.define("ppi.ido.ListController",{extend:"Ext.app.ViewController",alias:"controller.ppi-ido-list",onClickCetak:function(c){var d=this,a=d.getView();a.openDialog("",true,200,80,{xtype:"ppi-ido-laporan-form",ui:"panel-blue",title:"CETAK",iconCls:"x-fa fa-print",showCloseButton:true},function(e,f){},c)},onGejalaIdo:function(c){var d=this,e=c.ownerCt.getWidgetRecord(),a=d.getView();a.openDialog("",true,450,300,{xtype:"ppi-ido-gejala-list",ui:"panel-blue",title:"Gejala IDO",iconCls:"x-fa fa-arrow-circle-right",showCloseButton:true},function(f,h){var g=h.down("ppi-ido-gejala-list");vmlist=g.getViewModel();vmlist.set("hiddenButton",true);g.load({IDO:e.get("ID")})},c)}});Ext.define("ppi.ido.ListOperasi",{extend:"com.Grid",xtype:"ppi-ido-listoperasi",controller:"ppi-ido-listoperasi",viewModel:{stores:{store:{type:"operasi-store"}},data:{listConfig:{paging:true}}},header:{items:[{xtype:"button",text:"HISTORY",ui:"soft-black",iconCls:"x-fa fa-history",handler:"onClickHistori"},{xtype:"datefield",flex:1,format:"Y-m-d",emptyText:"[ FILTER TANGGAL ]",listeners:{select:"onSelectTanggal"}}]},columns:[{xtype:"rownumberer",text:"No",align:"left",width:50},{text:"Nomor",dataIndex:"ID",sortable:false,width:90},{xtype:"templatecolumn",text:"No. RM",dataIndex:"ID",sortable:false,width:140,tpl:'<div style="white-space:normal !important;color:black">{REFERENSI.KUNJUNGAN.REFERENSI.PENDAFTARAN.NORM}</div>'},{xtype:"templatecolumn",text:"Nama",dataIndex:"ID",sortable:false,width:140,tpl:'<div style="white-space:normal !important;color:black">{REFERENSI.KUNJUNGAN.REFERENSI.PENDAFTARAN.REFERENSI.PASIEN.NAMA}</div>'},{xtype:"datecolumn",text:"Tgl. Laporan",dataIndex:"DIBUAT_TANGGAL",format:"d/m/Y H:i:s",sortable:false,width:140},{text:"Nama Operasi",dataIndex:"NAMA_OPERASI",sortable:false,flex:1},{xtype:"datecolumn",text:"Tgl. Operasi",dataIndex:"TANGGAL",format:"d/m/Y",sortable:false,width:90},{xtype:"widgetcolumn",align:"center",text:"Aksi",widget:{xtype:"fieldcontainer",defaultType:"button",layout:{type:"vbox",align:"stretch"},defaults:{padding:2,margin:"0 2 1 0"},items:[{text:"IDO",action:"btn",ui:"soft-black",handler:"onInputIdo"}]}}]});Ext.define("ppi.ido.ListOperasiController",{extend:"Ext.app.ViewController",alias:"controller.ppi-ido-listoperasi",onInputIdo:function(a){var c=this,d=a.ownerCt.getWidgetRecord();recref=d.get("REFERENSI"),view=c.getView();view.openDialog("",true,0,0,{xtype:"ppi-ido-form",ui:"panel-gray",title:"Surveilans Harian Infeksi Luka Daerah Operasi (IDO) - "+a.text,iconCls:"x-fa fa-edit",showCloseButton:true},function(f,g){var e=g.down("ppi-ido-form");e.formExecution(d);e.on("save",function(){g.close();view.reload()})},a)},onClickHistori:function(c){var d=this,a=d.getView();a.openDialog("",true,0,0,{xtype:"ppi-ido-list",ui:"panel-gray",title:"HISTORI HARIAN INFEKSI LUKA DAERAH OPERASI (IDO)",iconCls:"x-fa fa-list",showCloseButton:true},function(f,g){var e=g.down("ppi-ido-list");e.load({})},c)},onSelectTanggal:function(c,e){var d=this,a=d.getView();a.load({TANGGAL:Ext.Date.format(e,"Y-m-d")})}});Ext.define("ppi.ido.Workspace",{extend:"com.Form",xtype:"ppi-ido-workspace",bodyPadding:0,layout:"border",items:[{title:"Daftar Operasi",ui:"panel-cyan",region:"center",xtype:"ppi-ido-listoperasi"}],load:function(a){this.down("ppi-ido-listoperasi").loadStore({KUNJUNGAN:a.get("NOMOR")})}});Ext.define("ppi.ido.gejala.List",{extend:"com.Grid",xtype:"ppi-ido-gejala-list",controller:"ppi-ido-gejala-list",viewModel:{stores:{store:{type:"ppi-ido-gejala-store"},referensi:{type:"referensi-store"}},data:{hiddenButton:false}},columns:[{xtype:"templatecolumn",text:"Gejala",dataIndex:"GEJALA_IDO",flex:1,tpl:'<div style="white-space:normal !important;color:black">{REFERENSI.GEJALA_IDO.DESKRIPSI}</div>'},{xtype:"checkcolumn",header:"CHECK",dataIndex:"CHECK",width:80,listeners:{checkchange:"onChange"}}],doAfterLoad:function(e,c,f,a){var d=e.getViewModel();if(!f){if(c.length==0){e.setReferensi()}}},setReferensi:function(){var d=this,a=d.getViewModel(),c=a.get("referensi");store=a.get("store");c.setQueryParams({STATUS:1,JENIS:125});d.setLoading(true);c.load({callback:function(f,e,g){if(g){c.each(function(j,h){model=Ext.create("ppi.ido.gejala.Model",{GEJALA_IDO:j.get("ID"),CHECK:0,REFERENSI:{GEJALA_IDO:j.getData()}});store.insert(store.getCount(),model)});d.setLoading(false)}else{d.setLoading(false)}}})},buttons:[{text:"Simpan",bind:{hidden:"{hiddenButton}"},handler:"onSendNilai"}],getData:function(){var d=this,c=d.getViewModel(),a=c.get("store"),e=[];a.each(function(g,f){e.push(g.getData())});return e},getStatusIdo:function(){var e=this,d=e.getViewModel(),c=d.get("store"),a=0;c.each(function(g,f){if(g.get("CHECK")!=0){a=a+1}});return a}});Ext.define("ppi.ido.gejala.ListController",{extend:"Ext.app.ViewController",alias:"controller.ppi-ido-gejala-list",onChange:function(l,a,k){var h=this,g=h.getViewModel(),e=g.get("store"),c=h.getView(),j=e.getAt(a);j.set("CHECK",k?1:0)},onSendNilai:function(c){var d=this,a=d.getView();a.fireEvent("sendNilai",a.getData(),a.getStatusIdo())}});Ext.define("ppi.ido.laporan.Form",{extend:"com.Form",xtype:"ppi-ido-laporan-form",controller:"ppi-ido-laporan-form",layout:"hbox",defaults:{margin:"2.2.2.2",format:"Y-m-d",width:"49%"},items:[{xtype:"combobox",store:Ext.create("Ext.data.Store",{fields:["id","deskripsi"],data:[{id:"01",deskripsi:"January"},{id:"02",deskripsi:"February"},{id:"03",deskripsi:"Maret"},{id:"04",deskripsi:"April"},{id:"05",deskripsi:"Mei"},{id:"06",deskripsi:"Juni"},{id:"07",deskripsi:"Juli"},{id:"08",deskripsi:"Agustus"},{id:"09",deskripsi:"September"},{id:"10",deskripsi:"Oktober"},{id:"11",deskripsi:"November"},{id:"12",deskripsi:"Desember"}]}),name:"PBULAN",queryMode:"local",allowBlank:false,reference:"bulan",displayField:"deskripsi",valueField:"id",emptyText:"[BULAN ]"},{xtype:"textfield",name:"PTAHUN",emptyText:"[ TAHUN ]"}],buttons:[{text:"Cetak",iconCls:"x-fa fa-print",ui:"soft-blue",handler:"onClickCetak"}]});Ext.define("ppi.ido.laporan.FormController",{extend:"Ext.app.ViewController",alias:"controller.ppi-ido-laporan-form",onClickCetak:function(d){var e=this,a=e.getView(),f=true,g=a.down("[name=PBULAN]").getValue(),c=a.down("[name=PTAHUN]").getValue();a.cetak({NAME:"plugins.ppi.laporanSurveilansHarianIDO",TYPE:f?"Pdf":"Word",EXT:f?"pdf":"docx",PARAMETER:{PPERIODE:c+"-"+g},REQUEST_FOR_PRINT:!f,PRINT_NAME:"CetakHasil"},function(h){if(f){e.getView().printPreview("Preview",h)}})}});Ext.define("ppi.kegiatan.Form",{extend:"com.Form",xtype:"ppi-kegiatan-form",controller:"ppi-kegiatan-form",model:"ppi.kegiatan.Model",defaults:{margin:"2.2.2.2"},layout:"hbox",items:[{xtype:"textfield",width:"100%",allowBlank:false,name:"DESKRIPSI",emptyText:"[KEGIATAN ]"}],buttons:[{text:"Tambah",iconCls:"x-fa fa-save",ui:"soft-black",handler:"onClickSimpan"}]});Ext.define("ppi.kegiatan.FormController",{extend:"Ext.app.ViewController",alias:"controller.ppi-kegiatan-form",onClickSimpan:function(c){var d=this,a=d.getView();if(a.getForm().isValid()){a.save(c)}}});Ext.define("ppi.kegiatan.List",{extend:"com.Grid",xtype:"ppi-kegiatan-list",controller:"ppi-kegiatan-list",viewModel:{stores:{store:{type:"ppi-kegiatan-store"},detailStore:{type:"ppi-kegiatan-group-detail-store"}},data:{group:undefined}},columns:[{xtype:"rownumberer",text:"No",menuDisabled:true,sortable:false,align:"left",width:50},{text:"Indokator Penilaian",dataIndex:"DESKRIPSI",flex:1},{xtype:"widgetcolumn",text:"#",align:"center",width:100,widget:{xtype:"fieldcontainer",defaultType:"button",layout:{type:"vbox",align:"stretch"},defaults:{padding:2,margin:"0 2 1 0"},items:[{text:"Aktifkan",action:0,ui:"soft-black",handler:"onAktifkan"},{text:"NonAktif",action:1,ui:"soft-red",handler:"onAktifkan"},{text:"add",action:2,ui:"soft-blue",handler:"onAddKegiatan"}]},onWidgetAttach:"onWidgetAttach"}],sendGroup:function(a){this.getViewModel().set("group",a);this.load({})}});Ext.define("ppi.kegiatan.ListController",{extend:"Ext.app.ViewController",alias:"controller.ppi-kegiatan-list",onWidgetAttach:function(m,j,k){var h=this,f=j.down("[action=0]"),e=j.down("[action=1]"),n=j.down("[action=2]");f.setHidden(k.get("STATUS")==1);e.setHidden(k.get("STATUS")!=1);n.setHidden(k.get("STATUS")!=1)},onAktifkan:function(c){var d=this,a=d.getView();val=(c.action==1)?0:1,rec=c.ownerCt.getWidgetRecord();rec.set("STATUS",val);rec.scope=this;rec.save({callback:function(f,g,e){if(e){a.notifyMessage("Status di"+(val==1?"Aktifkan":"NonAktifkan "),"danger-blue");a.reload()}}})},onAddKegiatan:function(c){var d=this,a=d.getView();rec=c.ownerCt.getWidgetRecord(),vm=d.getViewModel(),detailStore=vm.get("detailStore");group=vm.get("group"),model=Ext.create("ppi.kegiatan.group.detail.Model",{STATUS:1,KEGIATAN:rec.get("ID"),GROUP:group.get("ID")});detailStore.setQueryParams({KEGIATAN:rec.get("ID"),GROUP:group.get("ID")});detailStore.load({callback:function(f,e,g){if(g){data=f[0];data.set("STATUS",1);data.scope=this;data.save({callback:function(l,m,h){if(h){a.notifyMessage("Kegiatan telah ditambahkan","danger-blue")}}})}else{model.scope=this;model.save({callback:function(l,m,h){if(h){a.notifyMessage("Kegiatan telah ditambahkan","danger-blue")}}})}}})}});Ext.define("ppi.kegiatan.Workspace",{extend:"com.Form",xtype:"ppi-kegiatan-workspace",controller:"ppi-kegiatan-workspace",viewModel:{data:{group:undefined}},layout:"border",bodyPadding:0,initComponent:function(){var a=this;a.items=[{region:"center",flex:1,ui:"panel-cyan",title:"Daftar Kegiatan",header:{items:[{xtype:"search-field",cls:"x-text-border",emptyText:"Pencarian",flex:1,listeners:{scope:a.getController(),search:"onsearch",clear:"onClear"}},{xtype:"button",text:"Add",ui:"soft-black",iconCls:"x-fa fa-plus",scope:a.getController(),handler:"addKegiatan"}]},reference:"kegiatanppi",xtype:"ppi-kegiatan-list"}];a.callParent(arguments)},load:function(a){this.getViewModel().set("group",a);this.down("ppi-kegiatan-list").sendGroup(a);this.down("ppi-kegiatan-list").setGridConfig({paging:true})}});Ext.define("ppi.kegiatan.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.ppi-kegiatan-workspace",addKegiatan:function(c){var e=this,a=e.getView(),d=e.getViewModel();a.openDialog("",true,500,150,{xtype:"ppi-kegiatan-form",ui:"panel-gray",title:"Form Kegiatan",showCloseButton:true,iconCls:"x-fa fa-plus"},function(g,h){var f=h.down("ppi-kegiatan-form");f.createRecord({STATUS:1});f.on("save",function(j){f.createRecord({STATUS:1})});h.on("close",function(){a.load(d.get("group"))})},c)},onsearch:function(h,g){var d=this,a=d.getReferences(),e=a.kegiatanppi;e.load({DESKRIPSI:g})},onClear:function(){var c=this,a=c.getReferences(),d=a.kegiatanppi;b=d.getStore("store");delete b.queryParams.DESKRIPSI;d.load({})}});Ext.define("ppi.kegiatan.alasan.Combo",{extend:"com.Combo",alias:"widget.ppi-kegiatan-alasan-combo",viewModel:{stores:{store:{type:"ppi-kegiatan-alasan-store"}}},valueField:"ID",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">','<div"><strong>{REFERENSI.ALASAN.DESKRIPSI}</strong></div>',"</div>","</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{REFERENSI.ALASAN.DESKRIPSI}","</tpl>")});Ext.define("ppi.kegiatan.group.Combo",{extend:"com.Combo",alias:"widget.ppi-kegiatan-group-combo",viewModel:{stores:{store:{type:"ppi-kegiatan-group-store"}}},displayField:"DESKRIPSI",valueField:"ID"});Ext.define("ppi.kegiatan.group.Form",{extend:"com.Form",xtype:"ppi-kegiatan-group-form",controller:"ppi-kegiatan-group-form",model:"ppi.kegiatan.group.Model",layout:"hbox",defaults:{margin:"1.1.1.1"},items:[{xtype:"textfield",width:"49%",allowBlank:false,name:"DESKRIPSI",emptyText:"[ NAMA GROUP ]"},{xtype:"combobox",width:"49%",allowBlank:false,name:"JENIS",store:Ext.create("Ext.data.Store",{fields:["id"],data:[{id:"1",desk:"RUANGAN"},{id:"2",desk:"INDIVIDU"}]}),displayField:"desk",valueField:"id",emptyText:"[ OBJECK PENILAIAN ]"}],buttons:[{text:"Simpan",ui:"soft-black",handler:"onSimpan"}]});Ext.define("ppi.kegiatan.group.FormController",{extend:"Ext.app.ViewController",alias:"controller.ppi-kegiatan-group-form",onSimpan:function(c){var d=this,a=d.getView();if(a.getForm().isValid()){a.save(c)}}});Ext.define("ppi.kegiatan.group.List",{extend:"com.Grid",xtype:"ppi-kegiatan-group-list",controller:"ppi-kegiatan-group-list",viewModel:{stores:{store:{type:"ppi-kegiatan-group-store"}}},columns:[{xtype:"rownumberer",text:"No",menuDisabled:true,sortable:false,align:"left",width:50},{text:"Group",dataIndex:"DESKRIPSI",flex:1},{text:"Object",dataIndex:"JENIS",flex:1,renderer:"onRenderJenis"},{xtype:"checkcolumn",header:"STATUS",dataIndex:"STATUS",width:90,listeners:{checkchange:"onChange"}}]});Ext.define("ppi.kegiatan.group.ListController",{extend:"Ext.app.ViewController",alias:"controller.ppi-kegiatan-group-list",onChange:function(o,a,l){var m=this,j=m.getView(),n=m.getViewModel(),p=n.get("store"),k=p.getAt(a);k.set("STATUS",l?1:0);k.scope=this;k.save({callback:function(d,e,c){if(c){j.notifyMessage("Status di"+(l==true?"Aktifkan":"NonAktifkan "),"danger-blue")}}})},onRenderJenis:function(c,a){return c==1?"Ruangan":"Individu"}});Ext.define("ppi.kegiatan.group.Workspace",{extend:"com.Form",xtype:"ppi-kegiatan-group-workspace",controller:"ppi-kegiatan-group-workspace",viewModel:{data:{group:undefined}},layout:"border",bodyPadding:0,defaults:{margin:"2.2.2.2"},initComponent:function(){var a=this;a.items=[{xtype:"ppi-kegiatan-group-list",region:"center",reference:"groupkegiatan",flex:1,header:{items:[{xtype:"button",text:"Tambah",ui:"soft-black",iconCls:"x-fa fa-object-ungroup",scope:a.getController(),handler:"addGroup"}]},ui:"panel-cyan",title:"Group Kegiatan",listeners:{select:"onSelectGroup"}},{xtype:"ppi-kegiatan-group-detail-list",region:"east",flex:1,header:{items:[{xtype:"button",text:"MENU",ui:"soft-blue",menu:[{text:"Tambah Kegiatan",iconCls:"x-fa fa-plus",scope:a.getController(),handler:"addDetailGroup"},{text:"Tambah Kelompok",iconCls:"x-fa fa-plus",scope:a.getController(),handler:"addKelompokGroup"}]}]},ui:"panel-cyan",reference:"detailgroup",title:"Daftar Kegiatan"}];a.callParent(arguments)},load:function(d){var c=this,a=c.down("ppi-kegiatan-group-list");c.down("ppi-kegiatan-group-detail-list").loadKelompok();a.load()}});Ext.define("ppi.kegiatan.group.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.ppi-kegiatan-group-workspace",addGroup:function(d){var e=this,c=e.getReferences(),a=e.getView();a.openDialog("",true,500,150,{xtype:"ppi-kegiatan-group-form",ui:"panel-black",title:"Form Group",showCloseButton:true,iconCls:"x-fa fa-object-ungroup"},function(g,h){var f=h.down("ppi-kegiatan-group-form");f.createRecord({STATUS:1});f.on("save",function(){f.createRecord({STATUS:1})});h.on("close",function(){c.groupkegiatan.reload()})},d)},addDetailGroup:function(d){var f=this,c=f.getReferences(),e=f.getViewModel(),g=c.groupkegiatan.getSelection(),a=f.getView();if(g.length>0){a.openDialog("",true,950,600,{xtype:"ppi-kegiatan-workspace",ui:"panel-blue",title:e.get("group").get("DESKRIPSI"),showCloseButton:true,iconCls:"x-fa fa-list"},function(h,k){var j=k.down("ppi-kegiatan-workspace");j.load(e.get("group"));k.on("close",function(){c.detailgroup.reload()})},d)}else{a.notifyMessage("Pilih group terlebih dahulu","danger-red")}},addKelompokGroup:function(d){var e=this,c=e.getReferences(),f=c.groupkegiatan.getSelection(),a=e.getView();if(f.length>0){a.openDialog("",true,750,500,{xtype:"ppi-kegiatan-group-detail-kelompok-workspace",ui:"panel-blue",title:"Form",showCloseButton:true,iconCls:"x-fa fa-edit"},function(h,j){var g=j.down("ppi-kegiatan-group-detail-kelompok-workspace");g.load();j.on("close",function(){c.detailgroup.loadKelompok()})},d)}else{a.notifyMessage("Pilih group terlebih dahulu","danger-red")}},onSelectGroup:function(e,h,d){var g=this,a=g.getReferences(),f=g.getViewModel(),c=a.detailgroup;f.set("group",h);c.setTitle(h.get("DESKRIPSI"));c.load({GROUP:h.get("ID")})}});Ext.define("ppi.kegiatan.group.detail.List",{extend:"com.Grid",xtype:"ppi-kegiatan-group-detail-list",controller:"ppi-kegiatan-group-detail-list",viewModel:{stores:{store:{type:"ppi-kegiatan-group-detail-store"},kelompok:{type:"ppi-kegiatan-group-detail-kelompok-store",queryParams:{STATUS:1}}}},initComponent:function(){var a=this;a.cellEditing=new Ext.grid.plugin.CellEditing({clicksToEdit:1,listeners:{afteredit:"onAfterEdit"}});a.plugins=[a.cellEditing];a.columns=[{xtype:"rownumberer",text:"No",menuDisabled:true,sortable:false,align:"left",width:50},{text:"Kegiatan",flex:1,dataIndex:"KEGIATAN",xtype:"templatecolumn",tpl:'<div style="white-space:normal !important;">{REFERENSI.KEGIATAN.DESKRIPSI}</div>'},{text:"Kelompok",flex:1,dataIndex:"KELOMPOK",xtype:"templatecolumn",tpl:'<div style="white-space:normal !important;">{REFERENSI.KELOMPOK.KET}</div>',editor:{xtype:"combobox",name:"KELOMPOK",bind:{store:"{kelompok}"},displayField:"KET",valueField:"ID"}},{xtype:"checkcolumn",header:"STATUS",dataIndex:"STATUS",width:90,listeners:{checkchange:"onChange"}}];a.callParent(arguments)},loadKelompok:function(){this.getViewModel().get("kelompok").load()}});Ext.define("ppi.kegiatan.group.detail.ListController",{extend:"Ext.app.ViewController",alias:"controller.ppi-kegiatan-group-detail-list",onAfterEdit:function(e,c){var f=this,d=f.getViewModel(),a=f.getView(),g=c.record;g.scope=f;g.save({callback:function(l,m,h){if(h){a.notifyMessage("Data berhasil disimpan","danger-blue");a.reload()}}})},onChange:function(o,a,l){var m=this,j=m.getView(),n=m.getViewModel(),p=n.get("store"),k=p.getAt(a);k.set("STATUS",l?1:0);k.scope=this;k.save({callback:function(d,e,c){if(c){j.notifyMessage("Status di"+(l==true?"Aktifkan":"NonAktifkan "),"danger-blue")}}})}});Ext.define("ppi.kegiatan.group.detail.kelompok.Form",{extend:"com.Form",xtype:"ppi-kegiatan-group-detail-kelompok-form",controller:"ppi-kegiatan-group-detail-kelompok-form",model:"ppi.kegiatan.group.detail.kelompok.Model",items:[{xtype:"textfield",width:"100%",emptyText:"[ DESKRIPSI ]",allowBlank:false,flex:1,name:"KET"}],buttons:[{text:"Simpan",iconCls:"x-fa fa-save",ui:"soft-black",handler:"onSimpan"}]});Ext.define("ppi.kegiatan.group.detail.kelompok.FormController",{extend:"Ext.app.ViewController",alias:"controller.ppi-kegiatan-group-detail-kelompok-form",onSimpan:function(c){var d=this,a=d.getView();a.save(c)}});Ext.define("ppi.kegiatan.group.detail.kelompok.Grid",{extend:"com.Grid",xtype:"ppi-kegiatan-group-detail-kelompok-grid",controller:"ppi-kegiatan-group-detail-kelompok-grid",viewModel:{stores:{store:{type:"ppi-kegiatan-group-detail-kelompok-store"}}},columns:[{xtype:"rownumberer",text:"No",menuDisabled:true,sortable:false,align:"left",width:50},{text:"Kelompok",dataIndex:"KET",flex:1},{xtype:"checkcolumn",header:"STATUS",dataIndex:"STATUS",width:90,listeners:{checkchange:"onChange"}}]});Ext.define("ppi.kegiatan.group.detail.kelompok.GridController",{extend:"Ext.app.ViewController",alias:"controller.ppi-kegiatan-group-detail-kelompok-grid",onChange:function(o,a,l){var m=this,j=m.getView(),n=m.getViewModel(),p=n.get("store"),k=p.getAt(a);k.set("STATUS",l?1:0);k.scope=this;k.save({callback:function(d,e,c){if(c){j.notifyMessage("Status di"+(l==true?"Aktifkan":"NonAktifkan "),"danger-blue")}}})}});Ext.define("ppi.kegiatan.group.detail.kelompok.Workspace",{extend:"com.Form",xtype:"ppi-kegiatan-group-detail-kelompok-workspace",controller:"ppi-kegiatan-group-detail-kelompok-workspace",viewModel:{data:{group:undefined}},layout:"border",bodyPadding:0,defaults:{margin:"2.2.2.2"},initComponent:function(){var a=this;a.items=[{xtype:"ppi-kegiatan-group-detail-kelompok-grid",region:"center",reference:"groupkegiatan",flex:1,ui:"panel-cyan",title:"Daftar Kelompok"},{xtype:"ppi-kegiatan-group-detail-kelompok-form",region:"north",ui:"panel-cyan",title:"Form",listeners:{save:"onSave"}}];a.callParent(arguments)},load:function(d){var c=this,a=c.down("ppi-kegiatan-group-detail-kelompok-form");grid=c.down("ppi-kegiatan-group-detail-kelompok-grid");grid.load();a.createRecord({STATUS:1})}});Ext.define("ppi.kegiatan.group.detail.kelompok.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.ppi-kegiatan-group-detail-kelompok-workspace",onSave:function(c){var d=this,a=d.getView();a.load()}});Ext.define("ppi.laporan.DataView",{extend:"Ext.view.View",xtype:"ppi-laporan-dataview",viewModel:{stores:{store:{data:[{title:"Grafik Hasil Audit",xtype:"ppi-laporan-audit-form",ireport:""}]}}},autoScroll:true,cls:"laporan-main laporan-dataview",bind:{store:"{store}"},itemSelector:"div.thumb-wrap-info",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="thumb-wrap-info">','<a class="thumb" href="#">','<div class="thumb-icon"></div>','<div class="thumb-title-container">','<div class="thumb-title"><strong>{title}</strong></div>',"</div>","</a>","</div>","</tpl>")});Ext.define("ppi.laporan.Workspace",{extend:"com.Form",xtype:"ppi-laporan-workspace",controller:"ppi-laporan-workspace",layout:"border",cls:"x-br-top",border:false,initComponent:function(){var c=this;c.items=[{region:"west",width:300,layout:{type:"vbox",align:"stretch"},defaults:{margin:5},border:false,items:[{xtype:"laporan-filter",reference:"filter"},{xtype:"combobox",reference:"jenisLapGrafik",emptyText:"[Jenis]",store:Ext.create("data.store.Store",{field:["ID","DESKRIPSI"],data:[{ID:1,DESKRIPSI:"Kejadian HAIs VAP (Ventilator Aquired Pneumonia)"},{ID:2,DESKRIPSI:"Kejadian HAIs Flebitis"},{ID:3,DESKRIPSI:"Kejadian HAIs ISK (Infeksi Saluran Kemih)"},{ID:4,DESKRIPSI:"Kejadian HAIs IDO (Infeksi Daerah Operasi)"}]}),displayField:"DESKRIPSI",valueField:"ID"},{xtype:"referensi-combo",reference:"ruanganref",params:{JENIS:15},firstLoad:true,emptyText:"[Jenis Ruangan]",listeners:{select:"onSelectRuangan"}},{xtype:"ruangan-tree",reference:"treeRuangan",flex:1},{xtype:"laporan-button-doc",height:30,reference:"doctype"}]},{region:"center",xtype:"laporan-data-view",viewModel:{stores:{store:{type:"laporan-detil-store",queryParams:{JENIS:"25",STATUS:1}}}},border:false,reference:"ppiView",listeners:{select:"onSelectReport"}}];c.callParent(arguments)},listeners:{afterrender:"onAfterRender"}});Ext.define("ppi.laporan.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.ppi-laporan-workspace",onAfterRender:function(){var c=this.getReferences();c.ppiView.load()},onSelectRuangan:function(f,h){var j=this,k=j.getViewModel(),g=j.getReferences();g.treeRuangan.setParams({JENIS_KUNJUNGAN:h.get("ID")});g.treeRuangan.loadStore()},onSelectReport:function(k,r,l){var o=this.getReferences(),t=o.filter.getParameters(),n=o.ruanganref.getSelection()?o.ruanganref.getSelection().get("ID"):"0",p=o.jenisLapGrafik.getSelection()?o.jenisLapGrafik.getSelection().get("ID"):"0",q=o.treeRuangan.getSelection().length>0?o.treeRuangan.getSelection()[0].get("ID"):"0",s=Ext.JSON.decode(r.get("REPORT_PARAMS")),m=o.doctype.getDocType();t.PARAMETER.PRUANGAN=q;t.PARAMETER.PJENIS=n;t.PARAMETER.PJENISGRAFIK=p;s=Ext.apply(s,t);s=Ext.apply(s,m);this.getView().fireEvent("requestreport",r.get("DESKRIPSI"),s,true);o.ppiView.deselect(l)}});Ext.define("ppi.laporan..kegiatan.audit.Form",{extend:"com.Form",xtype:"ppi-laporan-kegiatan-audit-form",controller:"ppi-laporan-kegiatan-audit-form",layout:"border",defaults:{margin:"1.1.1.1"},items:[{region:"north",layout:"hbox",defaults:{width:"20%",margin:"1.1.1.1"},items:[{xtype:"ppi-kegiatan-group-combo",name:"GROUP",width:"58%",allowBlank:false,listeners:{select:"onSelectGroup"}},{xtype:"combobox",allowBlank:false,store:Ext.create("Ext.data.Store",{fields:["id","deskripsi"],data:[{id:"01",deskripsi:"January"},{id:"02",deskripsi:"February"},{id:"03",deskripsi:"Maret"},{id:"04",deskripsi:"April"},{id:"05",deskripsi:"Mei"},{id:"06",deskripsi:"Juni"},{id:"07",deskripsi:"Juli"},{id:"08",deskripsi:"Agustus"},{id:"09",deskripsi:"September"},{id:"10",deskripsi:"Oktober"},{id:"11",deskripsi:"November"},{id:"12",deskripsi:"Desember"}]}),name:"BULAN",queryMode:"local",displayField:"deskripsi",valueField:"id",emptyText:"[ BULAN ]"},{xtype:"numberfield",hideTrigger:true,name:"TAHUN",allowBlank:false,emptyText:"[ TAHUN  ]",name:"TAHUN"}]},{region:"center",layout:"card",reference:"layoutcard",xtype:"container",items:[{layout:"border",xtype:"container",items:[{xtype:"ruangan-tree",ui:"panel-blue",layout:"fit",selModel:{selType:"checkboxmodel",checkOnly:false,mode:"Multi"},region:"center",title:"Ruangan"}]},{layout:"border",xtype:"container",items:[{xtype:"master-referensi-grid",ui:"panel-blue",flex:1,selModel:{selType:"checkboxmodel",checkOnly:false,mode:"Multi"},layout:"fit",region:"center",title:"Profesi"}]}]}],buttons:[{text:"Print",ui:"soft-black",menu:[{handler:"onCetak",text:"PDF",preview:true,iconCls:"x-fa fa-file-pdf-o",TYPE:"Pdf",EXT:"pdf"},{handler:"onCetak",text:"WORD",preview:true,iconCls:"x-fa fa-file-word-o",TYPE:"Word",EXT:"doc"},{handler:"onCetak",text:"EXCEL",preview:true,iconCls:"x-fa fa-file-excel-o",TYPE:"Excel",EXT:"xls"}]}],load:function(){var d=this,e=d.down("ppi-kegiatan-group-combo"),c=e.getStore(),a=d.down("ruangan-tree");referensilist=d.down("master-referensi-grid");head=referensilist.getHeaderContainer();itmHead=head.items.items[3];c.setQueryParams({STATUS:1});c.load();a.setParams({STATUS:1});a.loadStore();referensilist.load({STATUS:1,JENIS:36});referensilist.getHeaderContainer().remove(itmHead)}});Ext.define("ppi.laporan.kegiatan.audit.FormController",{extend:"Ext.app.ViewController",alias:"controller.ppi-laporan-kegiatan-audit-form",group:undefined,onSelectGroup:function(e,h){var f=this,c=f.getView(),d=c.down("[reference = layoutcard]"),a=h.get("JENIS")-1,g=d.getLayout();f.group=h;g.setActiveItem(a)},onCetak:function(l){var f=this,e=l.preview,j=f.group,g=f.getView(),k=g.down("[name=BULAN]").getValue(),a=g.down("[name=TAHUN]").getValue(),d=g.down("ruangan-tree"),h=g.down("master-referensi-grid"),c={};files="plugins.ppi.cetakAuditGrafikRuangan",id="";if(g.getForm().isValid()){if(j){deskpars=(j.get("JENIS")==1)?d.getSelection():h.getSelection();deskpars.forEach(function(m){if(id==""){id=m.get("ID")}else{id=id+","+m.get("ID")}});if(j.get("JENIS")==1){c={PRUANGAN:id,PGROUP:j.get("ID"),PPERIODE:a+"-"+k}}else{files="plugins.ppi.cetakAuditGrafikIndividu",c={PPROFESI:id,PGROUP:j.get("ID"),PPERIODE:a+"-"+k}}g.cetak({NAME:files,TYPE:l.TYPE,EXT:l.EXT,PARAMETER:c,REQUEST_FOR_PRINT:!e,PRINT_NAME:"CetakHasil"},function(m){if(e){f.getView().printPreview("Preview",m)}})}}}});Ext.define("ppi.laporan.kegiatan.DataView",{extend:"Ext.view.View",xtype:"ppi-laporan-kegiatan-dataview",viewModel:{stores:{store:{data:[{title:"Grafik Hasil Audit",xtype:"ppi-laporan-kegiatan-audit-form",ireport:""}]}}},autoScroll:true,cls:"laporan-main laporan-dataview",bind:{store:"{store}"},itemSelector:"div.thumb-wrap-info",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="thumb-wrap-info">','<a class="thumb" href="#">','<div class="thumb-icon"></div>','<div class="thumb-title-container">','<div class="thumb-title"><strong>{title}</strong></div>',"</div>","</a>","</div>","</tpl>")});Ext.define("ppi.laporan.kegiatan.Workspace",{extend:"com.Form",xtype:"ppi-laporan-kegiatan-workspace",controller:"ppi-laporan-kegiatan-workspace",layout:"border",items:[{region:"center",title:"Daftar Laporan",xtype:"ppi-laporan-kegiatan-dataview",listeners:{select:"onSelectLaporan"}}],load:function(){}});Ext.define("ppi.laporan.kegiatan.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.ppi-laporan-kegiatan-workspace",onSelectLaporan:function(c,e){var d=this,a=d.getView();a.openDialog("",true,"60%","70%",{xtype:e.get("xtype"),ui:"panel-black",title:e.get("title"),btnEditHidden:false,showCloseButton:true,iconCls:"x-fa fa-print"},function(g,h){var f=h.down(e.get("xtype"));f.load(e)},c);c.deselect(e)}});Ext.define("ppi.pelaporan.Link",{extend:"com.Tab",xtype:"ppi-pelaporan-link",controller:"ppi-pelaporan-link",activeTab:0,cls:"x-br-top",ui:"header-tab",rec:undefined,initComponent:function(){var a=this;a.callParent(arguments);a.add({title:"Tertusuk Jarum",xtype:"ppi-tertusukjarum-workspace"},{title:"Limbah Infeksius",xtype:"ppi-pelaporan-limbainfeksius-workspace"})},loadStore:function(d){var c=this,a=this.getActiveTab();c.rec=d;if(a){a.onLoadRecord({})}else{if(c.items.getCount()>0){c.setActiveTab(0)}}},listeners:{tabchange:"onTabChange"}});Ext.define("ppi.pelaporan.LinkController",{extend:"Ext.app.ViewController",alias:"controller.ppi-pelaporan-link",onTabChange:function(c,a){if(a.load){a.load({})}}});Ext.define("ppi.pelaporan.limbainfaksius.Form",{extend:"com.Form",xtype:"ppi-pelaporan-limbahinfeksius-form",viewModel:{stores:{kategori:Ext.create("Ext.data.Store",{fields:["val","desk"],data:[{val:1,desk:"LIMBAH CAIR"},{val:2,desk:"LIMBAH PADAT"}]})}},controller:"ppi-pelaporan-limbahinfeksius-form",model:"ppi.pelaporan.limbahinfeksius.Model",items:[{layout:"hbox",title:"Ruangan",defaults:{margin:"2.2.2.2"},items:[{xtype:"ruangan-combo",emptyText:"[ DIREKTORAT  ]",params:{JENIS:2},firstLoad:true,width:"25%",name:"DIREKTORAT",nextCombo:"instalasi",nextJenis:3,listeners:{select:"onSelectRuangan",blur:"onBlurRuangan"}},{xtype:"ruangan-combo",emptyText:"[ INSTALASI  ]",width:"25%",name:"INSTALASI",reference:"instalasi",nextCombo:"unit",nextJenis:4,listeners:{select:"onSelectRuangan",blur:"onBlurRuangan"}},{xtype:"ruangan-combo",emptyText:"[ UNIT  ]",width:"25%",name:"UNIT",reference:"unit",nextCombo:"subunit",nextJenis:5,listeners:{select:"onSelectRuangan",blur:"onBlurRuangan"}},{xtype:"ruangan-combo",emptyText:"[ SUBUNIT  ]",width:"24%",name:"SUBUNIT",nextJenis:6,reference:"subunit",listeners:{select:"onSelectRuangan"}}]},{layout:"hbox",title:"Laporan",defaults:{margin:"2.2.2.2",width:"30%"},items:[{xtype:"textfield",emptyText:"[ NAMA TERLAPOR ]",width:"39%",name:"NAMA_TERLAPOR"},{xtype:"datetimefield",format:"Y-m-d h:i:s",emptyText:"[ TANGGAL KEJADIAN ]",name:"TANGGAL_KEJADIAN"},{xtype:"combobox",bind:{store:"{kategori}"},displayField:"desk",valueField:"val",name:"KATEGORI",emptyText:"[ KATEGORI ]"}]},{layout:"hbox",title:"Hasil Lab & Keterangan",defaults:{margin:"2.2.2.2",width:"49%"},items:[{xtype:"textarea",emptyText:"[ HASIL LAB ]",name:"HASIL_LAB"},{xtype:"textarea",emptyText:"[ KETERANGAN ]",name:"KETERANGAN"}]}],buttons:[{text:"Simpan",iconCls:"x-fa fa-save",ui:"soft-blue",handler:"onSimpan"}],setForm:function(g){var f=this,c=f.getViewModel(),e=Ext.util.Format.substr(g.get("RUANGAN"),0,3),a=Ext.util.Format.substr(g.get("RUANGAN"),0,5),d=Ext.util.Format.substr(g.get("RUANGAN"),0,7),h=Ext.util.Format.substr(g.get("RUANGAN"),0,9);cmbDir=f.down("[name=DIREKTORAT]"),cmbIns=f.down("[name=INSTALASI]"),cmbRng=f.down("[name=UNIT]"),cmbSbn=f.down("[name=SUBUNIT]"),dirStore=cmbDir.getStore();cmbDir.setValue(e);f.loaValueForm(cmbIns,{ID:e,STATUS:1,JENIS:3},a);f.loaValueForm(cmbRng,{ID:a,STATUS:1,JENIS:4},d);f.loaValueForm(cmbSbn,{ID:d,STATUS:1,JENIS:5},h);f.loadRecord(g)},loaValueForm:function(c,d,e){var a=c.getStore();if(d){c.setSelection(null);if(d.ID!=e){a.setQueryParams(d);a.load({callback:function(h,f,g){if(g){find=a.findRecord("ID",e,0,false,true,true);c.setValue(e)}}})}}else{c.setValue(1)}}});Ext.define("ppi.pelaporan.limbainfaksius.FormController",{extend:"Ext.app.ViewController",alias:"controller.ppi-pelaporan-limbahinfeksius-form",privates:{loadCombo:function(f,e){var d=this,a=d.getView(),c=f.getStore();c.removeAll();c.setQueryParams(e);c.load()},blurRuangan:function(d,c){var e=c+1,a=d.nextJenis;if(e!=a){d.getStore().removeAll()}d.select(null)}},onSelectRuangan:function(e,g,d){var f=this,c=f.getView(),a=c.getRecord();cmb=(e.nextCombo)?c.down("[reference="+e.nextCombo+"]"):false;if(cmb){f.loadCombo(cmb,{ID:g.get("ID"),JENIS:e.nextJenis,STATUS:1})}a.set("RUANGAN",g.get("ID"))},onBlurRuangan:function(c){var e=this,d=c.nextJenis+1;view=e.getView();for(i=d;i<=6;i++){e.blurRuangan(view.down("[nextJenis="+i+"]"),c.nextJenis)}},onSimpan:function(c){var d=this,a=d.getView();a.save(c)}});Ext.define("ppi.pelaporan.limbainfeksius.List",{extend:"com.Grid",xtype:"ppi-pelaporan-limbainfeksius-list",controller:"ppi-pelaporan-limbainfeksius-list",viewModel:{stores:{store:{type:"ppi-pelaporan-limbahinfeksius-store"}},data:{listConfig:{paging:true}}},columns:[{xtype:"rownumberer",text:"No",align:"left",width:50},{xtype:"templatecolumn",text:"RUANGAN",flex:0.5,tpl:'<div style="white-space:normal !important;color:black">{REFERENSI.RUANGAN.DESKRIPSI}</div>'},{text:"NAMA TERLAPOR",dataIndex:"NAMA_TERLAPOR",flex:0.5},{xtype:"datecolumn",format:"h:i:s d/m/Y",dataIndex:"TANGGAL_KEJADIAN",text:"TANGGAL KEJADIAN",flex:0.5},{text:"KATEGORI LIMBAH",dataIndex:"KATEGORI",flex:0.5,xtype:"templatecolumn",tpl:new Ext.XTemplate('<div class="thumb-wrap">','<div class="thumb">','<div style=" white-space:normal !important;">{[this.getDeskripsi(values.KATEGORI)]}</div>',"</div>","</div>",{getDeskripsi:function(c){var a=(c==1)?"BEKAS":"BARU";return a}})},{text:"HASIL LAB",dataIndex:"HASIL_LAB",flex:1},{text:"KETERANGAN",dataIndex:"KETERANGAN",flex:1},{xtype:"widgetcolumn",text:"#",align:"center",width:100,widget:{xtype:"fieldcontainer",defaultType:"button",layout:{type:"vbox",align:"stretch"},defaults:{padding:2,margin:"0 2 1 0"},items:[{text:"Edit",ui:"soft-red",iconCls:"x-fa fa-edit",handler:"onClickEdit"}]}}]});Ext.define("ppi.pelaporan.limbainfeksius.ListController",{extend:"Ext.app.ViewController",alias:"controller.ppi-pelaporan-limbainfeksius-list",onClickEdit:function(c){var d=this,a=d.getView(),e=c.ownerCt.getWidgetRecord();a.openDialog("",true,800,370,{xtype:"ppi-pelaporan-limbahinfeksius-form",ui:"panel-gray",title:"FORM PELAPORAN TERPAPAR LIMBAH INFEKSIUS",iconCls:"x-fa fa-edit",showCloseButton:true},function(g,h){var f=h.down("ppi-pelaporan-limbahinfeksius-form");f.setForm(e);f.on("save",function(){h.close();a.reload()})},c)}});Ext.define("ppi.pelaporan.limbainfeksius.Workspace",{extend:"com.Form",xtype:"ppi-pelaporan-limbainfeksius-workspace",controller:"ppi-pelaporan-limbainfeksius-workspace",bodyPadding:0,layout:"border",initComponent:function(){var a=this;a.items=[{header:{items:[{xtype:"button",text:"CETAK",iconCls:"x-fa fa-print",ui:"soft-red",scope:a.getController(),handler:"onClickCetak"},{xtype:"button",text:"TAMBAH",iconCls:"x-fa fa-plus",ui:"soft-black",scope:a.getController(),handler:"onClickAdd"}]},title:"Daftar Laporan Terpapar Limbah Infeksius",ui:"panel-cyan",region:"center",xtype:"ppi-pelaporan-limbainfeksius-list"}];a.callParent(arguments)},load:function(){var a=this;a.down("ppi-pelaporan-limbainfeksius-list").load({})}});Ext.define("ppi.pelaporan.limbainfeksius.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.ppi-pelaporan-limbainfeksius-workspace",onClickAdd:function(c){var d=this,a=d.getView();a.openDialog("",true,800,370,{xtype:"ppi-pelaporan-limbahinfeksius-form",ui:"panel-gray",title:"FORM PELAPORAN TERPAPAR LIMBAH INFEKSIUS",iconCls:"x-fa fa-edit",showCloseButton:true},function(f,g){var e=g.down("ppi-pelaporan-limbahinfeksius-form");e.createRecord({STATUS:1});e.on("save",function(){e.createRecord({STATUS:1})});g.on("close",function(){a.load()})},c)},onClickCetak:function(c){var d=this,a=d.getView();a.openDialog("",true,200,80,{xtype:"ppi-pelaporan-tertusukjarum-laporan-form",ui:"panel-red",laporan:"plugins.ppi.laporanLimbahInfeksius",title:"CETAK",iconCls:"x-fa fa-print",showCloseButton:true},function(e,f){},c)}});Ext.define("ppi.pelaporan.tertusukjarum.Form",{extend:"com.Form",xtype:"ppi-pelaporan-tertusukjarum-form",viewModel:{stores:{kategori:Ext.create("Ext.data.Store",{fields:["val","desk"],data:[{val:1,desk:"BEKAS"},{val:2,desk:"BARU"}]})}},controller:"ppi-pelaporan-tertusukjarum-form",model:"ppi.pelaporan.tertusukjarum.Model",items:[{layout:"hbox",title:"Ruangan",defaults:{margin:"2.2.2.2"},items:[{xtype:"ruangan-combo",emptyText:"[ DIREKTORAT  ]",params:{JENIS:2},firstLoad:true,width:"25%",name:"DIREKTORAT",nextCombo:"instalasi",nextJenis:3,listeners:{select:"onSelectRuangan",blur:"onBlurRuangan"}},{xtype:"ruangan-combo",emptyText:"[ INSTALASI  ]",width:"25%",name:"INSTALASI",reference:"instalasi",nextCombo:"unit",nextJenis:4,listeners:{select:"onSelectRuangan",blur:"onBlurRuangan"}},{xtype:"ruangan-combo",emptyText:"[ UNIT  ]",width:"25%",name:"UNIT",reference:"unit",nextCombo:"subunit",nextJenis:5,listeners:{select:"onSelectRuangan",blur:"onBlurRuangan"}},{xtype:"ruangan-combo",emptyText:"[ SUBUNIT  ]",width:"24%",name:"SUBUNIT",nextJenis:6,reference:"subunit",listeners:{select:"onSelectRuangan"}}]},{layout:"hbox",title:"Laporan",defaults:{margin:"2.2.2.2",width:"30%"},items:[{xtype:"textfield",emptyText:"[ NAMA TERLAPOR ]",width:"39%",name:"NAMA_TERLAPOR"},{xtype:"datetimefield",format:"Y-m-d h:i:s",emptyText:"[ TANGGAL KEJADIAN ]",name:"TANGGAL_KEJADIAN"},{xtype:"combobox",bind:{store:"{kategori}"},displayField:"desk",valueField:"val",name:"KATEGORI",emptyText:"[ KATEGORI ]"}]},{layout:"hbox",title:"Hasil Lab & Keterangan",defaults:{margin:"2.2.2.2",width:"49%"},items:[{xtype:"textarea",emptyText:"[ HASIL LAB ]",name:"HASIL_LAB"},{xtype:"textarea",emptyText:"[ KETERANGAN ]",name:"KETERANGAN"}]}],buttons:[{text:"Simpan",iconCls:"x-fa fa-save",ui:"soft-blue",handler:"onSimpan"}],setForm:function(g){var f=this,c=f.getViewModel(),e=Ext.util.Format.substr(g.get("RUANGAN"),0,3),a=Ext.util.Format.substr(g.get("RUANGAN"),0,5),d=Ext.util.Format.substr(g.get("RUANGAN"),0,7),h=Ext.util.Format.substr(g.get("RUANGAN"),0,9);cmbDir=f.down("[name=DIREKTORAT]"),cmbIns=f.down("[name=INSTALASI]"),cmbRng=f.down("[name=UNIT]"),cmbSbn=f.down("[name=SUBUNIT]"),dirStore=cmbDir.getStore();cmbDir.setValue(e);f.loaValueForm(cmbIns,{ID:e,STATUS:1,JENIS:3},a);f.loaValueForm(cmbRng,{ID:a,STATUS:1,JENIS:4},d);f.loaValueForm(cmbSbn,{ID:d,STATUS:1,JENIS:5},h);f.loadRecord(g)},loaValueForm:function(c,d,e){var a=c.getStore();if(d){c.setSelection(null);if(d.ID!=e){a.setQueryParams(d);a.load({callback:function(h,f,g){if(g){find=a.findRecord("ID",e,0,false,true,true);c.setValue(e)}}})}}else{c.setValue(1)}}});Ext.define("ppi.pelaporan.tertusukjarum.FormController",{extend:"Ext.app.ViewController",alias:"controller.ppi-pelaporan-tertusukjarum-form",privates:{loadCombo:function(f,e){var d=this,a=d.getView(),c=f.getStore();c.removeAll();c.setQueryParams(e);c.load()},blurRuangan:function(d,c){var e=c+1,a=d.nextJenis;if(e!=a){d.getStore().removeAll()}d.select(null)}},onSelectRuangan:function(e,g,d){var f=this,c=f.getView(),a=c.getRecord();cmb=(e.nextCombo)?c.down("[reference="+e.nextCombo+"]"):false;if(cmb){f.loadCombo(cmb,{ID:g.get("ID"),JENIS:e.nextJenis,STATUS:1})}a.set("RUANGAN",g.get("ID"))},onBlurRuangan:function(c){var e=this,d=c.nextJenis+1;view=e.getView();for(i=d;i<=6;i++){e.blurRuangan(view.down("[nextJenis="+i+"]"),c.nextJenis)}},onSimpan:function(c){var d=this,a=d.getView();a.save(c)}});Ext.define("ppi.pelaporan.tertusukjarum.List",{extend:"com.Grid",xtype:"ppi-pelaporan-tertusukjarum-list",controller:"ppi-pelaporan-tertusukjarum-list",viewModel:{stores:{store:{type:"ppi-pelaporan-tertusukjarum-store"}},data:{listConfig:{paging:true}}},columns:[{xtype:"rownumberer",text:"No",align:"left",width:50},{xtype:"templatecolumn",text:"RUANGAN",flex:0.5,tpl:'<div style="white-space:normal !important;color:black">{REFERENSI.RUANGAN.DESKRIPSI}</div>'},{text:"NAMA TERLAPOR",dataIndex:"NAMA_TERLAPOR",flex:0.5},{xtype:"datecolumn",format:"h:i:s d/m/Y",dataIndex:"TANGGAL_KEJADIAN",text:"TANGGAL KEJADIAN",flex:0.5},{text:"KATEGORI JARUM",dataIndex:"KATEGORI",flex:0.5,xtype:"templatecolumn",tpl:new Ext.XTemplate('<div class="thumb-wrap">','<div class="thumb">','<div style=" white-space:normal !important;">{[this.getDeskripsi(values.KATEGORI)]}</div>',"</div>","</div>",{getDeskripsi:function(c){var a=(c==1)?"BEKAS":"BARU";return a}})},{text:"HASIL LAB",dataIndex:"HASIL_LAB",flex:1},{text:"KETERANGAN",dataIndex:"KETERANGAN",flex:1},{xtype:"widgetcolumn",text:"#",align:"center",width:100,widget:{xtype:"fieldcontainer",defaultType:"button",layout:{type:"vbox",align:"stretch"},defaults:{padding:2,margin:"0 2 1 0"},items:[{text:"Edit",ui:"soft-red",iconCls:"x-fa fa-edit",handler:"onClickEdit"}]}}]});Ext.define("ppi.pelaporan.tertusukjarum.ListController",{extend:"Ext.app.ViewController",alias:"controller.ppi-pelaporan-tertusukjarum-list",onClickEdit:function(c){var d=this,a=d.getView(),e=c.ownerCt.getWidgetRecord();a.openDialog("",true,800,370,{xtype:"ppi-pelaporan-tertusukjarum-form",ui:"panel-gray",title:"FORM PELAPORAN TERTUSUK JARUM DAN BENDA TAJAM",iconCls:"x-fa fa-edit",showCloseButton:true},function(g,h){var f=h.down("ppi-pelaporan-tertusukjarum-form");f.setForm(e);f.on("save",function(){h.close();a.reload()})},c)}});Ext.define("ppi.pelaporan.tertusukjarum.Workspace",{extend:"com.Form",xtype:"ppi-tertusukjarum-workspace",controller:"ppi-pelaporan-tertusukjarum-workspace",bodyPadding:0,layout:"border",initComponent:function(){var a=this;a.items=[{header:{items:[{xtype:"button",text:"CETAK",iconCls:"x-fa fa-print",ui:"soft-red",scope:a.getController(),handler:"onClickCetak"},{xtype:"button",text:"TAMBAH",iconCls:"x-fa fa-plus",ui:"soft-black",scope:a.getController(),handler:"onClickAdd"}]},title:"Daftar Laporan Tertusuk Jarum dan Benda Tajam",ui:"panel-cyan",region:"center",xtype:"ppi-pelaporan-tertusukjarum-list"}];a.callParent(arguments)},load:function(){var a=this;a.down("ppi-pelaporan-tertusukjarum-list").load({})}});Ext.define("ppi.pelaporan.tertusukjarum.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.ppi-pelaporan-tertusukjarum-workspace",onClickAdd:function(c){var d=this,a=d.getView();a.openDialog("",true,800,370,{xtype:"ppi-pelaporan-tertusukjarum-form",ui:"panel-gray",title:"FORM PELAPORAN TERTUSUK JARUM DAN BENDA TAJAM",iconCls:"x-fa fa-edit",showCloseButton:true},function(f,g){var e=g.down("ppi-pelaporan-tertusukjarum-form");e.createRecord({STATUS:1});e.on("save",function(){e.createRecord({STATUS:1})});g.on("close",function(){a.load()})},c)},onClickCetak:function(c){var d=this,a=d.getView();a.openDialog("",true,200,80,{xtype:"ppi-pelaporan-tertusukjarum-laporan-form",ui:"panel-red",laporan:"plugins.ppi.laporanTertusukJarum",title:"CETAK",iconCls:"x-fa fa-print",showCloseButton:true},function(e,f){},c)}});Ext.define("ppi.pelaporan.tertusukjarum.laporan.Form",{extend:"com.Form",xtype:"ppi-pelaporan-tertusukjarum-laporan-form",controller:"ppi-pelaporan-tertusukjarum-laporan-form",layout:"hbox",defaults:{margin:"2.2.2.2",format:"Y-m-d",width:"49%"},items:[{xtype:"datefield",name:"PAWAL",emptyText:"[ AWAL ]"},{xtype:"datefield",name:"PAKHIR",emptyText:"[ AKHIR ]"}],buttons:[{text:"Cetak",iconCls:"x-fa fa-print",ui:"soft-blue",handler:"onClickCetak"}]});Ext.define("ppi.pelaporan.tertusukjarum.laporan.FormController",{extend:"Ext.app.ViewController",alias:"controller.ppi-pelaporan-tertusukjarum-laporan-form",onClickCetak:function(d){var f=this,c=f.getView(),g=true,a=Ext.Date.format(c.down("[name=PAWAL]").getValue(),"Y-m-d"),e=Ext.Date.format(c.down("[name=PAKHIR]").getValue(),"Y-m-d");c.cetak({NAME:c.laporan,TYPE:g?"Pdf":"Word",EXT:g?"pdf":"docx",PARAMETER:{PAWAL:a,PAKHIR:e},REQUEST_FOR_PRINT:!g,PRINT_NAME:"CetakHasil"},function(h){if(g){f.getView().printPreview("Preview",h)}})}});Ext.define("ppi.penilaian.Form",{extend:"com.Form",xtype:"ppi-penilaian-form",controller:"ppi-penilaian-form",model:"ppi.penilaian.kegiatan.Model",defaults:{margin:"2.2.2.2",border:false,width:"100%"},layout:"vbox",items:[{layout:"hbox",defaults:{margin:"2.2.2.2"},items:[{xtype:"ppi-kegiatan-group-combo",emptyText:"[ GROUP PENILAIAN  ]",width:"50%",params:{STATUS:1},name:"GROUP",listeners:{select:"onSeleceGroup"}},{xtype:"datetimefield",width:"49%",name:"TANGGAL_BUAT",format:"Y-m-d H:i:s",emptyText:"[ TANGGAL ]"}]},{layout:"hbox",defaults:{margin:"2.2.2.2"},items:[{xtype:"ruangan-combo",emptyText:"[ DIREKTORAT  ]",params:{JENIS:2},firstLoad:true,width:"25%",name:"DIREKTORAT",nextCombo:"instalasi",nextJenis:3,listeners:{select:"onSelectRuangan",blur:"onBlurRuangan"}},{xtype:"ruangan-combo",emptyText:"[ INSTALASI  ]",width:"25%",name:"INSTALASI",reference:"instalasi",nextCombo:"unit",nextJenis:4,listeners:{select:"onSelectRuangan",blur:"onBlurRuangan"}},{xtype:"ruangan-combo",emptyText:"[ UNIT  ]",width:"25%",name:"UNIT",reference:"unit",nextCombo:"subunit",nextJenis:5,listeners:{select:"onSelectRuangan",blur:"onBlurRuangan"}},{xtype:"ruangan-combo",emptyText:"[ SUBUNIT  ]",width:"24%",name:"SUBUNIT",nextJenis:6,reference:"subunit",listeners:{select:"onSelectRuangan"}}]}],setForm:function(g){var f=this,c=f.getViewModel(),e=Ext.util.Format.substr(g.get("RUANGAN"),0,3),a=Ext.util.Format.substr(g.get("RUANGAN"),0,5),d=Ext.util.Format.substr(g.get("RUANGAN"),0,7),h=Ext.util.Format.substr(g.get("RUANGAN"),0,9);cmbDir=f.down("[name=DIREKTORAT]"),cmbIns=f.down("[name=INSTALASI]"),cmbRng=f.down("[name=UNIT]"),cmbSbn=f.down("[name=SUBUNIT]"),dirStore=cmbDir.getStore();cmbDir.setValue(e);f.loaValueForm(cmbIns,{ID:e,STATUS:1,JENIS:3},a);f.loaValueForm(cmbRng,{ID:a,STATUS:1,JENIS:4},d);f.loaValueForm(cmbSbn,{ID:d,STATUS:1,JENIS:5},h);f.loadRecord(g)},loaValueForm:function(c,d,e){var a=c.getStore();if(d){c.setSelection(null);if(d.ID!=e){a.setQueryParams(d);a.load({callback:function(h,f,g){if(g){find=a.findRecord("ID",e,0,false,true,true);c.setValue(e)}}})}}else{c.setValue(1)}},loadCombo:function(){var c=this.down("ppi-kegiatan-group-combo"),a=c.getStore();a.setQueryParams({STATUS:1,JENIS:1});a.load()}});Ext.define("ppi.penilaian.FormController",{extend:"Ext.app.ViewController",alias:"controller.ppi-penilaian-form",privates:{loadCombo:function(f,e){var d=this,a=d.getView(),c=f.getStore();c.removeAll();c.setQueryParams(e);c.load()},blurRuangan:function(d,c){var e=c+1,a=d.nextJenis;if(e!=a){d.getStore().removeAll()}d.select(null)}},onSelectRuangan:function(e,g,d){var f=this,c=f.getView(),a=c.getRecord();cmb=(e.nextCombo)?c.down("[reference="+e.nextCombo+"]"):false;if(cmb){f.loadCombo(cmb,{ID:g.get("ID"),JENIS:e.nextJenis,STATUS:1})}a.set("RUANGAN",g.get("ID"))},onSeleceGroup:function(d,f,c){var e=this,a=e.getView();a.fireEvent("sendGroup",f)},onBlurRuangan:function(c){var e=this,d=c.nextJenis+1;view=e.getView();for(i=d;i<=6;i++){e.blurRuangan(view.down("[nextJenis="+i+"]"),c.nextJenis)}}});Ext.define("ppi.penilaian.List",{extend:"com.Grid",xtype:"ppi-penilaian-List",controller:"ppi-penilaian-list",viewModel:{stores:{store:{type:"ppi-penilaian-kegiatan-store"}}},iconCls:"x-fa fa-bed",title:"Ruangan",ui:"panel-black",btnEditHidden:true,initComponent:function(){var a=this;a.columns=[{text:"RUANGAN",dataIndex:"ID",flex:1,xtype:"templatecolumn",tpl:new Ext.XTemplate('<div class="thumb-wrap">','<div class="thumb">','<div style="align : center; white-space:normal !important;">{REFERENSI.RUANGAN.DESKRIPSI}</div>',"</div>","</div>",{})},{text:"Group penilaian",dataIndex:"GROUP",flex:1,xtype:"templatecolumn",tpl:new Ext.XTemplate('<div class="thumb-wrap">','<div class="thumb">','<div style="white-space:normal !important;">{REFERENSI.GROUP.DESKRIPSI}</div>',"</div>","</div>",{})},{text:"Tanggal Buat",dataIndex:"TANGGAL_BUAT",flex:0.5,xtype:"datecolumn",format:"Y-m-d H:i:s"},{text:"Status",dataIndex:"STATUS",flex:0.5,xtype:"templatecolumn",tpl:new Ext.XTemplate('<div class="thumb-wrap">','<div class="thumb">','<div style="color : {[this.deskColorStatus(values.STATUS)]} ;align : center; white-space:normal !important;">{[this.deskStatus(values.STATUS)]}</div>',"</div>","</div>",{deskStatus:function(c){return(c==1)?"Belum Final":(c==2)?"Final":"Dihapus"},deskColorStatus:function(c){return(c==1)?"green":(c==2)?"red":"black"}})},{xtype:"widgetcolumn",text:"#",hidden:!a.btnEditHidden,align:"center",width:100,widget:{xtype:"fieldcontainer",defaultType:"button",layout:{type:"vbox",align:"stretch"},defaults:{padding:2,margin:"0 2 1 0"},items:[{text:"Action",action:"btn",ui:"soft-black",menu:[{text:"Final",action:2,iconCls:"x-fa fa-cog",handler:"onClickFinal"},{text:"Batal Final",action:1,iconCls:"x-fa fa-cog",handler:"onClickFinal"},{text:"Hapus",action:3,iconCls:"x-fa fa-trash",handler:"onHapus"},"-",{text:"Cetak Format 1",action:1,iconCls:"x-fa fa-print",handler:"onClikCetak"},{text:"Cetak Format 2",action:2,iconCls:"x-fa fa-print",handler:"onClikCetak"}]}]},onWidgetAttach:"onWidgetAttach"},{xtype:"widgetcolumn",text:"#",hidden:a.btnEditHidden,align:"center",width:100,widget:{xtype:"fieldcontainer",defaultType:"button",layout:{type:"vbox",align:"stretch"},defaults:{padding:2,margin:"0 2 1 0"},items:[{text:"Edit",ui:"soft-red",handler:"onClickEdit"}]}}];a.callParent(arguments);a.setGridConfig({paging:true})},dockedItems:[{xtype:"pagingtoolbar",hidden:true,bind:{store:"{store}",hidden:"{!listConfig.paging}"},dock:"bottom",beforePageText:"Hal.",afterPageText:"dari {0}",displayMsg:"Menampilkan {0} - {1} dari {2}",displayInfo:true,items:[{xtype:"ppi-kegiatan-group-combo",flex:1,reference:"group",emptyText:"[ GROUP PENILAIAN  ]",name:"GROUP",params:{STATUS:1,JENIS:1},firstLoad:true,listeners:{select:"onSelectGroupKegiatan"}},{xtype:"combobox",allowBlank:false,reference:"bulan",store:Ext.create("Ext.data.Store",{fields:["id","deskripsi"],data:[{id:"01",deskripsi:"January"},{id:"02",deskripsi:"February"},{id:"03",deskripsi:"Maret"},{id:"04",deskripsi:"April"},{id:"05",deskripsi:"Mei"},{id:"06",deskripsi:"Juni"},{id:"07",deskripsi:"Juli"},{id:"08",deskripsi:"Agustus"},{id:"09",deskripsi:"September"},{id:"10",deskripsi:"Oktober"},{id:"11",deskripsi:"November"},{id:"12",deskripsi:"Desember"}]}),name:"BULAN",value:"01",queryMode:"local",flex:1,displayField:"deskripsi",valueField:"id",emptyText:"[ BULAN ]"},{xtype:"search-field",name:"TAHUN",reference:"tahun",flex:1,listeners:{search:"onsearch",clear:"onClear"}}]}]});Ext.define("ppi.penilaian.ListController",{extend:"Ext.app.ViewController",alias:"controller.ppi-penilaian-list",onDetail:function(c){var d=this,e=c.ownerCt.getWidgetRecord(),a=d.getView();a.fireEvent("detailSend",e)},onSelectGroupKegiatan:function(d,g){var f=this,a=f.getView(),e=f.getReferences(),c=e.group.getValue();th=e.tahun.getValue();bln=e.bulan.getValue();if(th){PARAMS.TANGGAL_BUAT=th+"-"+bln}a.load({GROUP:g.get("ID")})},onsearch:function(m,j){var k=this,l=k.getViewModel(),a=k.getView(),h=k.getReferences(),g=h.group.getValue();th=h.tahun.getValue();bln=h.bulan.getValue();b=l.get("store");PARAMS={TANGGAL_BUAT:th+"-"+bln};if(g){PARAMS.GROUP=g}a.load(PARAMS)},onClear:function(){},onWidgetAttach:function(h,c,g){var e=this,f=c.down("[action = btn]"),a=f.menu.items.items[0];btnbatal=f.menu.items.items[1];btnhapus=f.menu.items.items[2];a.setHidden(g.get("STATUS")==2);btnhapus.setHidden(g.get("STATUS")==2);btnbatal.setHidden(g.get("STATUS")==1)},onClikCetak:function(a){var c=this,e=true,d=(a.action==1)?"cetakMonitoringDanEvaluasi":"cetakMonitoringDanEvaluasKelompok",f=a.ownerCt.ownerCmp.ownerCt.getWidgetRecord();c.getView().cetak({NAME:"plugins.ppi."+d,TYPE:e?"Pdf":"Word",EXT:e?"pdf":"docx",PARAMETER:{PID:f.get("ID")},REQUEST_FOR_PRINT:!e,PRINT_NAME:"CetakHasil"},function(g){if(e){c.getView().printPreview("Preview",g)}})},onClickFinal:function(d){var e=this,c=e.getView(),f=true,a=d.action;desk=(a==2)?"finalkan":"batalkan",rec=d.ownerCt.ownerCmp.ownerCt.getWidgetRecord();if(a===rec.get("STATUS")){c.notifyMessage("Data telah di"+desk+" sebelumnya")}else{c.showMessageBox({title:"Peringatan",message:"Anda yakin ingin mem"+desk+" periode ini ?",ui:"window-red",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,animateTarget:d,fn:function(g){if(g==="yes"){rec.set("STATUS",a);rec.showError=true;rec.animateTarget=d;rec.scope=e;rec.save({callback:function(j,h,k){if(k){c.notifyMessage("Data telah di"+desk);c.reload()}}})}}})}},onClickEdit:function(c){var d=this,a=d.getView(),e=c.ownerCt.getWidgetRecord();a.fireEvent("editRecord",e)},onHapus:function(c){var d=this,a=d.getView(),e=true,f=c.ownerCt.ownerCmp.ownerCt.getWidgetRecord();if(f.get("STATUS")!=2){a.showMessageBox({title:"Peringatan",message:"Anda yakin ingin menghapus periode ini ?",ui:"window-red",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,animateTarget:c,fn:function(g){if(g==="yes"){f.set("STATUS",0);f.showError=true;f.animateTarget=c;f.scope=d;f.save({callback:function(j,h,k){if(k){a.notifyMessage("Data telah terhapus");a.reload()}}})}}})}else{a.showMessageBox({title:"Peringatan",message:"Periode ini telah difinalkan oleh petugas periode tidak dapat dihapus",ui:"window-red",buttons:Ext.Msg.OK,animateTarget:c})}}});Ext.define("ppi.penilaian.Workspace",{extend:"com.Tab",xtype:"ppi-penilaian-workspace",controller:"ppi-penilaian-workspace",bodyPadding:0,layout:"border",items:[{title:"Individu",ui:"panel-cyan",flex:1,xtype:"ppi-audit-individu-list"},{xtype:"ppi-penilaian-List",ui:"panel-cyan",flex:1,title:"Ruangan"},{xtype:"ppi-penilaian-tindaklanjut-workspace",ui:"panel-cyan",flex:1,title:"Saran dan Tindak Lanjut"}],load:function(d){var c=this,a=this.getActiveTab();c.rec=d;if(a){a.load({STATUS:"1,2"})}},listeners:{tabchange:"onTabChange"}});Ext.define("ppi.penilaian.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.ppi-penilaian-workspace",onTabChange:function(c,a){if(a.load){a.load({STATUS:"1,2"})}},onRefresh:function(a){var c=this;c.getView().loadStore({})}});Ext.define("ppi.penilaian.detail.List",{extend:"com.Grid",xtype:"ppi-penilaian-detail-list",controller:"ppi-penilaian-detail-list",viewModel:{stores:{store:{type:"ppi-penilaian-kegiatan-detail-store"},kegiatanStore:{type:"ppi-kegiatan-group-detail-store"}}},initComponent:function(){var a=this;a.cellEditing=new Ext.grid.plugin.CellEditing({clicksToEdit:1});a.plugins=[a.cellEditing];a.columns=[{xtype:"templatecolumn",text:"Jenis Kegiatan",dataIndex:"KEGIATAN",flex:1,tpl:'<div style="white-space:normal !important;color:black">{REFERENSI.GROUP_DETAIL.REFERENSI.KEGIATAN.DESKRIPSI}</div>'},{xtype:"checkcolumn",header:"YA",dataIndex:"CHECK",width:50,listeners:{checkchange:"onChange"}},{xtype:"templatecolumn",text:"Alasan",dataIndex:"ALASAN",flex:0.5,tpl:'<div style="white-space:normal !important;color:black">{REFERENSI.KEGIATANALASAN.REFERENSI.ALASAN.DESKRIPSI}</div>'},{text:"Temuan",flex:0.5,xtype:"templatecolumn",tpl:'<div style="white-space:normal !important;color:black">{KET}</div>',dataIndex:"KET",editor:{xtype:"textarea",name:"KET"}},{text:"RTL",flex:0.5,dataIndex:"RTL",xtype:"templatecolumn",tpl:'<div style="white-space:normal !important;color:black">{RTL}</div>',editor:{xtype:"textarea",name:"RTL"}}];a.callParent(arguments)},setKegiatanGroup:function(e){var d=this,c=d.getViewModel(),a=c.get("kegiatanStore");store=c.get("store");a.setQueryParams({STATUS:1,GROUP:e.get("ID")});a.load({callback:function(g,f,h){if(h){a.each(function(k,j){model=Ext.create("ppi.penilaian.kegiatan.detail.Model",{KEGIATAN:k.get("ID"),CHECK:1,KET:"",STATUS:1,REFERENSI:{GROUP_DETAIL:k.getData()}});store.insert(store.getCount(),model)});d.setLoading(false)}else{d.setLoading(false)}}})},getData:function(){var d=this,c=d.getViewModel().get("store"),a=[];c.each(function(f,e){a.push(f.getData())});return a}});Ext.define("ppi.penilaian.detail.ListController",{extend:"Ext.app.ViewController",alias:"controller.ppi-penilaian-detail-list",onChange:function(l,a,k){var h=this,g=h.getViewModel(),e=g.get("store"),c=h.getView(),j=e.getAt(a);j.set("CHECK",k?1:0);if(k){cnf=j.get("REFERENSI")||{};delete cnf.KEGIATANALASAN;j.set("REFERENSI",cnf);j.set("ALASAN",0)}else{c.openDialog("",true,500,150,{xtype:"ppi-penilaian-detail-alasan-form",ui:"panel-blue",title:"TENTUKAN ALASAN",showCloseButton:true,iconCls:"x-fa fa-object-ungroup"},function(f,m){var d=m.down("ppi-penilaian-detail-alasan-form");d.loadCombo(j.get("KEGIATAN"));d.on("setAlasan",function(n){m.close();if(n){obj={KEGIATANALASAN:n.getData()},cnf=j.get("REFERENSI")||{};cnf=Ext.apply(cnf,obj);j.set("REFERENSI",cnf);j.set("ALASAN",n.get("ID"))}})},l)}}});Ext.define("ppi.penilaian.detail.alasan.Form",{extend:"com.Form",xtype:"ppi-penilaian-detail-alasan-form",controller:"ppi-penilaian-detail-alasan-form",defaults:{margin:"2.2.2.2"},layout:"hbox",items:[{xtype:"ppi-kegiatan-alasan-combo",width:"100%",allowBlank:false,name:"ALASAN",emptyText:"[ALASAN ]"}],buttons:[{text:"Simpan",iconCls:"x-fa fa-save",ui:"soft-blue",handler:"onClickSimpan"}],loadCombo:function(d){var c=this.down("ppi-kegiatan-alasan-combo"),a=c.getStore();a.setQueryParams({STATUS:1,KEGIATAN:d});a.load()}});Ext.define("ppi.penilaian.detail.alasan.FormController",{extend:"Ext.app.ViewController",alias:"controller.ppi-penilaian-detail-alasan-form",onClickSimpan:function(c){var d=this,a=d.getView(),f=a.down("[name = ALASAN]"),e=f.getSelection();if(e){a.fireEvent("setAlasan",e)}}});Ext.define("ppi.penilaian.harian.Form",{extend:"com.Form",xtype:"ppi-penilaian-harian-form",controller:"ppi-penilaian-harian-form",model:"ppi.penilaian.harian.Model",defaults:{border:false,margin:"2.2.2.2"},items:[{layout:"hbox",xtype:"fieldset",collapsible:false,border:true,style:"background : #fffff",title:"PERIODE",defaults:{margin:"2.2.2.2",allowBlank:false,width:"35%"},items:[{xtype:"ppi-kegiatan-group-combo",emptyText:"[ GROUP PENILAIAN  ]",name:"GROUP"},{xtype:"combobox",store:Ext.create("Ext.data.Store",{fields:["id","deskripsi"],data:[{id:"1",deskripsi:"January"},{id:"2",deskripsi:"February"},{id:"3",deskripsi:"Maret"},{id:"4",deskripsi:"April"},{id:"5",deskripsi:"Mei"},{id:"6",deskripsi:"Juni"},{id:"7",deskripsi:"Juli"},{id:"8",deskripsi:"Agustus"},{id:"9",deskripsi:"September"},{id:"10",deskripsi:"Oktober"},{id:"11",deskripsi:"November"},{id:"12",deskripsi:"Desember"}]}),name:"BULAN",queryMode:"local",displayField:"deskripsi",valueField:"id",emptyText:"[ BULAN ]"},{xtype:"textfield",emptyText:"[ TAHUN  ]",width:"29%",name:"TAHUN"}]},{layout:"hbox",xtype:"fieldset",collapsible:false,border:true,style:"background : #fffff",title:"RUANGAN",defaults:{margin:"2.2.2.2",width:"25%"},items:[{xtype:"combobox",name:"RUANGAN",allowBlank:false,enterFocus:true,reference:"ruanganasal",enforceMaxLength:true,forceSelection:true,validateOnBlur:true,flex:1,displayField:"DESKRIPSI",valueField:"ID",queryMode:"local",typeAhead:true,emptyText:"[Ruangan ASAL]",store:{model:"data.model.Ruangan"}}]}],buttons:[{text:"Simpan",ui:"soft-blue",iconCls:"x-fa fa-save",handler:"onSimpan"}],loadCombo:function(){var a=this,e=a.down("[name=RUANGAN]");e.getStore().loadData(a.getPenggunaRuangan());var d=this.down("ppi-kegiatan-group-combo"),c=d.getStore();c.setQueryParams({STATUS:1,JENIS:1});c.load()}});Ext.define("ppi.penilaian.harian.FormController",{extend:"Ext.app.ViewController",alias:"controller.ppi-penilaian-harian-form",privates:{loadCombo:function(f,e){var d=this,a=d.getView(),c=f.getStore();c.removeAll();c.setQueryParams(e);c.load()},blurRuangan:function(d,c){var e=c+1,a=d.nextJenis;if(e!=a){d.getStore().removeAll()}d.select(null)}},onSelectRuangan:function(e,g,d){var f=this,c=f.getView(),a=c.getRecord();cmb=(e.nextCombo)?c.down("[reference="+e.nextCombo+"]"):false;if(cmb){f.loadCombo(cmb,{ID:g.get("ID"),JENIS:e.nextJenis,STATUS:1})}a.set("RUANGAN",g.get("ID"))},onBlurRuangan:function(c){var e=this,d=c.nextJenis+1;view=e.getView();for(i=d;i<=6;i++){e.blurRuangan(view.down("[nextJenis="+i+"]"),c.nextJenis)}},onSimpan:function(c){var d=this,a=d.getView();a.setLoading(true);a.save(c,{},function(f,e,g){if(g){a.setLoading(false)}else{a.setLoading(false)}})}});Ext.define("ppi.penilaian.harian.List",{extend:"com.Grid",xtype:"ppi-penilaian-harian-list",controller:"ppi-penilaian-harian-list",viewModel:{stores:{store:{type:"ppi-penilaian-harian-store"}}},ui:"panel-cyan",title:"Kegiatan harian",iconCls:"x-fa fa-calendar",columns:[{text:"RUANGAN",xtype:"templatecolumn",tpl:'<div style="white-space:normal !important;color:black">{REFERENSI.RUANGAN.DESKRIPSI}</div>',flex:1},{text:"GROUP",xtype:"templatecolumn",tpl:'<div style="white-space:normal !important;color:black">{REFERENSI.GROUP.DESKRIPSI}</div>',flex:1},{text:"PERIODE",flex:1,columns:[{text:"BULAN",align:"center",dataIndex:"BULAN",flex:1},{text:"TAHUN",align:"center",dataIndex:"TAHUN",xtype:"datecolumn",format:"Y",flex:1}]},{xtype:"widgetcolumn",text:"#",align:"center",width:100,widget:{xtype:"fieldcontainer",defaultType:"button",layout:{type:"vbox",align:"stretch"},defaults:{padding:2,margin:"0 2 1 0"},items:[{text:"Menu",ui:"soft-black",menu:[{text:"Input Detail",action:1,iconCls:"x-fa fa-edit",handler:"onClikDetail"},{text:"Cetak Laporan",action:2,iconCls:"x-fa fa-print",handler:"onClikCetak"},{text:"Hapus",action:2,iconCls:"x-fa fa-trash",handler:"onClikHapus"}]}]}}]});Ext.define("ppi.penilaian.harian.ListController",{extend:"Ext.app.ViewController",alias:"controller.ppi-penilaian-harian-list",onClikDetail:function(c){var d=this,a=d.getView(),e=c.ownerCt.ownerCmp.ownerCt.getWidgetRecord();a.openDialog("",true,750,550,{xtype:"ppi-penilaian-harian-detail-list",ui:"panel-gray",title:"Detail",showCloseButton:true,iconCls:"x-fa fa-list"},function(h,g){var f=g.down("ppi-penilaian-harian-detail-list");f.loadData(e,1,1);f.on("save",function(){g.close();a.reload()})},c)},onClikHapus:function(c){var d=this,a=d.getView(),e=c.ownerCt.ownerCmp.ownerCt.getWidgetRecord();a.showMessageBox({title:"Hapus",message:"Anda yakin ingin menghapus kegiatan ini ",ui:"window-red",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,animateTarget:c,fn:function(g){if(g==="yes"){e.set("STATUS",0);e.scope=this;e.save({callback:function(h,l,f){if(f){a.notifyMessage("Kegiatan telah dihapus ","danger-red");a.reload()}}})}}})},onClikCetak:function(a){var c=this,d=true,e=a.ownerCt.ownerCmp.ownerCt.getWidgetRecord();c.getView().cetak({NAME:"plugins.ppi.cetakKegiatanHarian",TYPE:d?"Pdf":"Word",EXT:d?"pdf":"docx",PARAMETER:{PID:e.get("ID")},REQUEST_FOR_PRINT:!d,PRINT_NAME:"CetakHasil"},function(f){if(d){c.getView().printPreview("Preview",f)}})}});Ext.define("ppi.penilaian.harian.Workspace",{extend:"com.Form",xtype:"ppi-penilaian-harian-workspace",controller:"ppi-penilaian-harian-workspace",layout:"border",border:false,bodyPadding:0,initComponent:function(){var a=this;a.items=[{header:{items:[{xtype:"combobox",name:"RUANGAN",allowBlank:false,enterFocus:true,reference:"ruanganasal",enforceMaxLength:true,forceSelection:true,validateOnBlur:true,flex:1,displayField:"DESKRIPSI",valueField:"ID",queryMode:"local",typeAhead:true,emptyText:"[Ruangan ASAL]",store:{model:"data.model.Ruangan"},listeners:{scope:a.getController(),select:"onSelectRuangan"}},{xtype:"button",text:"Tambah",iconCls:"x-fa fa-plus",ui:"soft-blue",scope:a.getController(),handler:"onClickTambah"}]},reference:"listpenilaianharian",xtype:"ppi-penilaian-harian-list",region:"center",flex:1}];a.callParent(arguments)},load:function(){var a=this,e=a.down("[name=RUANGAN]"),d=a.getPenggunaRuangan(),c=a.down("ppi-penilaian-harian-list");e.getStore().loadData(d);if(d.length>0){e.setSelection(e.getStore().getAt(0))}c.setGridConfig({paging:true})}});Ext.define("ppi.penilaian.harian.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.ppi-penilaian-harian-workspace",onClickTambah:function(d){var e=this,c=e.getReferences(),a=e.getView();a.openDialog("",true,800,300,{xtype:"ppi-penilaian-harian-form",ui:"panel-blue",title:"Form",showCloseButton:true,iconCls:"x-fa fa-plus"},function(g,h){var f=h.down("ppi-penilaian-harian-form");f.createRecord({STATUS:1});f.loadCombo();f.on("save",function(){c.listpenilaianharian.reload();h.close()})},d)},onSelectRuangan:function(c,f){var e=this,a=e.getView(),d=a.down("ppi-penilaian-harian-list");d.load({RUANGAN:f.get("ID")})}});Ext.define("ppi.penilaian.harian.detail.List",{extend:"com.Grid",xtype:"ppi-penilaian-harian-detail-list",controller:"ppi-penilaian-harian-detail-list",viewModel:{stores:{store:{type:"ppi-penilaian-harian-detail-store"},kegiatanStore:{type:"ppi-kegiatan-group-detail-store"}},data:{pk:undefined}},dockedItems:[{xtype:"toolbar",dock:"top",items:["->",{xtype:"combobox",emptyText:"[ FILTER MINGGU ]",displayField:"id",valueField:"id",name:"MINGGU",value:1,fieldLabel:"Minggu",store:Ext.create("Ext.data.Store",{fields:["id"],data:[{id:"1"},{id:"2"},{id:"3"},{id:"4"},{id:"5"}]}),listeners:{select:"onSelect"}},{xtype:"combobox",emptyText:"[ FILTER HARI ]",name:"HARI",fieldLabel:"Hari",displayField:"id",value:1,valueField:"id",store:Ext.create("Ext.data.Store",{fields:["id"],data:[{id:"1"},{id:"2"},{id:"3"},{id:"4"},{id:"5"},{id:"6"},{id:"7"}]}),listeners:{select:"onSelect"}}]},{xtype:"toolbar",dock:"bottom",items:["->",{xtype:"button",text:"Simpan",ui:"soft-blue",handler:"onSimpan"}]}],columns:[{text:"KEGIATAN",xtype:"templatecolumn",dataIndex:"KEGIATAN",flex:1,tpl:'<div style="white-space:normal !important;color:black">{REFERENSI.GROUP_DETAIL.REFERENSI.KEGIATAN.DESKRIPSI}</div>'},{xtype:"checkcolumn",header:"CHECK",dataIndex:"CHECK",width:80,listeners:{checkchange:"onChange"}}],setKegiatanGroup:function(g,j,e){var f=this,d=f.getViewModel(),c=f.down("[name = MINGGU]"),h=f.down("[name = HARI]"),a=d.get("kegiatanStore");store=d.get("store");f.setLoading(true);a.setQueryParams({STATUS:1,GROUP:g.get("GROUP")});a.load({callback:function(l,k,m){if(m){a.each(function(o,n){model=Ext.create("ppi.penilaian.kegiatan.detail.Model",{PK_HARIAN:g.get("ID"),KEGIATAN:o.get("ID"),CHECK:0,MINGGU:j,HARIAN:e,STATUS:1,REFERENSI:{GROUP_DETAIL:o.getData()}});store.insert(store.getCount(),model)});f.setLoading(false)}else{f.setLoading(false)}}})},loadData:function(e,f,c){var d=this,a=d.getStore();d.getViewModel().set("pk",e);a.setQueryParams({PK_HARIAN:e.get("ID"),MINGGU:f,HARIAN:c});a.load({callback:function(h,g,j){if(!j){d.setKegiatanGroup(e,f,c)}}})}});Ext.define("ppi.penilaian.harian.detail.ListController",{extend:"Ext.app.ViewController",alias:"controller.ppi-penilaian-harian-detail-list",onSimpan:function(d){var e=this,a=e.getView(),c=a.getStore();c.sync({callback:function(k,j,h){a.notifyMessage("Data Telah Tersimpan");a.fireEvent("save",true)}})},onChange:function(k,a,j){var g=this,e=g.getViewModel(),c=e.get("store"),h=c.getAt(a);h.set("CHECK",j?1:0)},onSelect:function(c,g){var e=this,a=e.getView(),d=a.down("[name = MINGGU]").getValue(),f=a.down("[name = HARI]").getValue();a.loadData(e.getViewModel().get("pk"),d,f)}});Ext.define("ppi.penilaian.tindaklanjut.Form",{extend:"com.Form",xtype:"ppi-penilaian-tindaklanjut-form",model:"ppi.penilaian.tindaklanjut.Model",controller:"ppi-penilaian-tindaklanjut-form",items:[{layout:"hbox",xtype:"fieldset",collapsible:false,border:true,style:"background : #fffff",title:"PERIODE",defaults:{margin:"2.2.2.2",allowBlank:false,width:"35%"},items:[{xtype:"ppi-kegiatan-group-combo",emptyText:"[ GROUP PENILAIAN  ]",name:"GROUP"},{xtype:"combobox",store:Ext.create("Ext.data.Store",{fields:["id","deskripsi"],data:[{id:"1",deskripsi:"January"},{id:"2",deskripsi:"February"},{id:"3",deskripsi:"Maret"},{id:"4",deskripsi:"April"},{id:"5",deskripsi:"Mei"},{id:"6",deskripsi:"Juni"},{id:"7",deskripsi:"Juli"},{id:"8",deskripsi:"Agustus"},{id:"9",deskripsi:"September"},{id:"10",deskripsi:"Oktober"},{id:"11",deskripsi:"November"},{id:"12",deskripsi:"Desember"}]}),name:"BULAN",queryMode:"local",displayField:"deskripsi",valueField:"id",emptyText:"[ BULAN ]"},{xtype:"textfield",emptyText:"[ TAHUN  ]",width:"29%",name:"TAHUN"}]},{layout:"hbox",xtype:"fieldset",collapsible:false,border:true,style:"background : #fffff",title:"Plan & Do",defaults:{margin:"2.2.2.2",width:"49%"},items:[{xtype:"textarea",name:"PLAN",emptyText:"[ PLAN  ]"},{xtype:"textarea",name:"DO",emptyText:"[ DO  ]"}]},{layout:"hbox",xtype:"fieldset",collapsible:false,border:true,style:"background : #fffff",title:"Check & Action",defaults:{margin:"2.2.2.2",width:"49%"},items:[{xtype:"textarea",name:"CHECK",emptyText:"[ CHECK  ]"},{xtype:"textarea",name:"ACTION",emptyText:"[ ACTION  ]"}]}],buttons:[{text:"Simpan",ui:"soft-blue",iconCls:"x-fa fa-save",handler:"onSimpan"}],loadCombo:function(){var c=this.down("ppi-kegiatan-group-combo"),a=c.getStore();a.setQueryParams({STATUS:1});a.load()}});Ext.define("ppi.penilaian.tindaklanjut.FormController",{extend:"Ext.app.ViewController",alias:"controller.ppi-penilaian-tindaklanjut-form",onSimpan:function(c){var d=this,a=d.getView();a.save(c)}});Ext.define("ppi.penilaian.tindaklanjut.Grid",{extend:"com.Grid",xtype:"ppi-penilaian-tindaklanjut-grid",controller:"ppi-penilaian-tindaklanjut-grid",viewModel:{stores:{store:{type:"ppi-penilaian-tindaklanjut-store"}},data:{listConfig:{paging:true}}},title:"Daftar Tindak Lanjut",iconCls:"x-fa fa-stack-exchange",ui:"panel-cyan",columns:[{text:"Group penilaian",dataIndex:"GROUP",flex:1,xtype:"templatecolumn",tpl:new Ext.XTemplate('<div class="thumb-wrap">','<div class="thumb">','<div style="white-space:normal !important;">{REFERENSI.GROUP.DESKRIPSI}</div>',"</div>","</div>",{})},{text:"Periode",dataIndex:"TAHUN",flex:1,xtype:"templatecolumn",tpl:new Ext.XTemplate('<div class="thumb-wrap">','<div class="thumb">','<div style="white-space:normal !important;">{[this.deskPeriode(values.TAHUN,values.BULAN)]}</div>',"</div>","</div>",{deskPeriode:function(a,c){return Ext.Date.format(a,"Y")+" - "+c}})},{text:"Plan",dataIndex:"PLAN",flex:1,xtype:"templatecolumn",tpl:new Ext.XTemplate('<div class="thumb-wrap">','<div class="thumb">','<div style="white-space:normal !important;">{PLAN}</div>',"</div>","</div>",{})},{text:"Do",dataIndex:"DO",flex:1,xtype:"templatecolumn",tpl:new Ext.XTemplate('<div class="thumb-wrap">','<div class="thumb">','<div style="white-space:normal !important;">{DO}</div>',"</div>","</div>",{})},{text:"Check",dataIndex:"CHECK",flex:1,xtype:"templatecolumn",tpl:new Ext.XTemplate('<div class="thumb-wrap">','<div class="thumb">','<div style="white-space:normal !important;">{CHECK}</div>',"</div>","</div>",{})},{text:"Action",dataIndex:"ACTION",flex:1,xtype:"templatecolumn",tpl:new Ext.XTemplate('<div class="thumb-wrap">','<div class="thumb">','<div style="white-space:normal !important;">{ACTION}</div>',"</div>","</div>",{})},{text:"Status",dataIndex:"STATUS",flex:0.5,xtype:"templatecolumn",tpl:new Ext.XTemplate('<div class="thumb-wrap">','<div class="thumb">','<div style="color : {[this.deskColorStatus(values.STATUS)]} ;align : center; white-space:normal !important;">{[this.deskStatus(values.STATUS)]}</div>',"</div>","</div>",{deskStatus:function(a){return(a==1)?"Belum Final":(a==2)?"Final":"Dihapus"},deskColorStatus:function(a){return(a==1)?"green":(a==2)?"red":"black"}})},{xtype:"widgetcolumn",text:"#",align:"center",width:100,widget:{xtype:"fieldcontainer",defaultType:"button",layout:{type:"vbox",align:"stretch"},defaults:{padding:2,margin:"0 2 1 0"},items:[{text:"Action",action:"btn",ui:"soft-black",menu:[{text:"Final",action:2,iconCls:"x-fa fa-cog",handler:"onClickFinal"},{text:"Batal Final",action:1,iconCls:"x-fa fa-cog",handler:"onClickFinal"},{text:"Edit",iconCls:"x-fa fa-cog",handler:"onClickEdit"},{text:"Hapus",action:3,iconCls:"x-fa fa-trash",handler:"onHapus"}]}]},onWidgetAttach:"onWidgetAttach"}]});Ext.define("ppi.penilaian.tindaklanjut.GridController",{extend:"Ext.app.ViewController",alias:"controller.ppi-penilaian-tindaklanjut-grid",onWidgetAttach:function(h,c,g){var e=this,f=c.down("[action = btn]"),a=f.menu.items.items[0];btnbatal=f.menu.items.items[1];btnedit=f.menu.items.items[2];btnhapus=f.menu.items.items[3];a.setHidden(g.get("STATUS")==2);btnedit.setHidden(g.get("STATUS")==2);btnhapus.setHidden(g.get("STATUS")==2);btnbatal.setHidden(g.get("STATUS")==1)},onHapus:function(c){var d=this,a=d.getView(),e=true,f=c.ownerCt.ownerCmp.ownerCt.getWidgetRecord();if(f.get("STATUS")!=2){a.showMessageBox({title:"Peringatan",message:"Anda yakin ingin menghapus periode ini ?",ui:"window-red",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,animateTarget:c,fn:function(g){if(g==="yes"){f.set("STATUS",0);f.showError=true;f.animateTarget=c;f.scope=d;f.save({callback:function(j,h,k){if(k){a.notifyMessage("Data telah terhapus");a.reload()}}})}}})}else{a.showMessageBox({title:"Peringatan",message:"Periode ini telah difinalkan oleh petugas periode tidak dapat dihapus",ui:"window-red",buttons:Ext.Msg.OK,animateTarget:c})}},onClickFinal:function(d){var e=this,c=e.getView(),f=true,a=d.action;desk=(a==2)?"finalkan":"batalkan",rec=d.ownerCt.ownerCmp.ownerCt.getWidgetRecord();if(a===rec.get("STATUS")){c.notifyMessage("Data telah di"+desk+" sebelumnya")}else{c.showMessageBox({title:"Peringatan",message:"Anda yakin ingin mem"+desk+" periode ini ?",ui:"window-red",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,animateTarget:d,fn:function(g){if(g==="yes"){rec.set("STATUS",a);rec.showError=true;rec.animateTarget=d;rec.scope=e;rec.save({callback:function(j,h,k){if(k){c.notifyMessage("Data telah di"+desk);c.reload()}}})}}})}},onClickEdit:function(c){var d=this,a=d.getView(),e=c.ownerCt.ownerCmp.ownerCt.getWidgetRecord();a.openDialog("",true,"80%","70%",{xtype:"ppi-penilaian-tindaklanjut-form",ui:"panel-black",title:"Tindak Lanjut",showCloseButton:true,iconCls:"x-fa fa-edit"},function(g,h){var f=h.down("ppi-penilaian-tindaklanjut-form");f.loadRecord(e);f.loadCombo();f.on("save",function(){a.load();h.close()})},c)}});Ext.define("ppi.penilaian.tindaklanjut.Workspace",{extend:"com.Form",xtype:"ppi-penilaian-tindaklanjut-workspace",controller:"ppi-penilaian-tindaklanjut-workspace",layout:"border",border:false,bodyPadding:0,initComponent:function(){var a=this;a.items=[{header:{items:[{xtype:"button",text:"Tambah",iconCls:"x-fa fa-edit",ui:"soft-blue",scope:a.getController(),handler:"onClickTambah"}]},xtype:"ppi-penilaian-tindaklanjut-grid",region:"center",flex:1}];a.callParent(arguments)},load:function(){var a=this,c=a.down("ppi-penilaian-tindaklanjut-grid");c.load({STATUS:"1,2"})}});Ext.define("ppi.penilaian.tindaklanjut.WorkspaceController",{extend:"Ext.app.ViewController",alias:"controller.ppi-penilaian-tindaklanjut-workspace",onClickTambah:function(c){var d=this,a=d.getView();a.openDialog("",true,"80%","70%",{xtype:"ppi-penilaian-tindaklanjut-form",ui:"panel-blue",title:"Tindak Lanjut",showCloseButton:true,iconCls:"x-fa fa-edit"},function(f,g){var e=g.down("ppi-penilaian-tindaklanjut-form");e.createRecord({STATUS:1});e.loadCombo();e.on("save",function(){a.load();g.close()})},c)}});