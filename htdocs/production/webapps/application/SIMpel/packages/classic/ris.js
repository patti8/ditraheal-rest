Ext.define(null,{override:"layanan.tindakanmedis.Workspace",onBeforeCallParentInitComponent:function(a){a.bbar={xtype:"toolbar",items:["->",{text:"Kirim Worklist",xtype:"button",ui:"soft-green",iconCls:"x-fa fa-send",handler:"onKirimWorklist"}],bind:{hidden:"{!formConfig.isRad}"}}},load:function(a){this.callParent([a]);if(a){this.setFormConfig({isRad:false});if(a.get("STATUS")==1){this.setFormConfig({isRad:a.get("JENIS_KUNJUNGAN")==5&&this.app.xpriv("900401")})}}}});Ext.define(null,{override:"layanan.tindakanmedis.WorkspaceController",ris:{integrasi:undefined,service:undefined},init:function(){var b=this,a=b.getView(),c=a.getPropertyConfig("10")=="TRUE";b.callParent();b.ris.integrasi=a.app.xitr("ID",7);if(b.ris.integrasi){b.ris.service=Ext.create(b.ris.integrasi.NAMA_KLAS,{})}},onKirimWorklist:function(b){var c=this,a=c.getView();if(!c.ris.service){return}a.showMessageBox({title:"Worklist",message:"Anda yakin ingin kirim worklist?",ui:"window-red",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,animateTarget:b,fn:function(e){if(e==="yes"){var f=a.down("tindakan-medis-list"),d=f.getArrayData(),g=[];Ext.Array.each(d,function(h){if(h.STATUS==1){g.push(h.ID)}});c.ris.service.kirimWorklist(g,function(i,j,h){if(i){a.notifyMessage("Berhasil kirim Worklist")}})}}})}});Ext.define("ris.logs.Model",{extend:"data.model.Model",serviceName:"ris/logs",fields:[{name:"ID",type:"int"},{name:"TINDAKAN_MEDIS",type:"string"},{name:"JENIS",type:"int",defaultValue:0},{name:"TGL_REQUEST",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"REQUEST",type:"string"},{name:"TGL_RESPONSE",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"RESPONSE",type:"string"},{name:"KIRIM",type:"int",defaultValue:0},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("ris.logs.Store",{extend:"data.store.Store",model:"ris.logs.Model",alias:"store.ris-logs-store"});Ext.define("ris.modality.Model",{extend:"data.model.Model",serviceName:"ris/modality",fields:[{name:"ID",type:"int"},{name:"NAMA",type:"string"}],idProperty:"ID"});Ext.define("ris.modality.Store",{extend:"data.store.Store",model:"ris.modality.Model",alias:"store.ris-modality-store"});Ext.define("ris.modality.tindakan.Model",{extend:"data.model.Model",serviceName:"ris/modality-tindakan",fields:[{name:"ID",type:"int"},{name:"TINDAKAN",type:"int"},{name:"MODALITY",type:"int"},{name:"STATUS",type:"int",defaultValue:1}],idProperty:"ID"});Ext.define("ris.modality.tindakan.Store",{extend:"data.store.Store",model:"ris.modality.tindakan.Model",alias:"store.ris-modality-tindakan-store"});Ext.define("ris.Service",{extend:"com.Service",xtype:"ris-service",serviceName:"ris",supportViewerWithIframe:function(a){this.request("viewer/supportViewerWithIframe","GET","",a)},getViewerUrl:function(a){return webservice.location+this.serviceName+"/viewer/"+a},openViewer:function(a){window.open(this.getViewerUrl(a),"_blank","toolbar=no,location=no,scrollbars=yes,resizable=yes,fullscreen=yes")},kirimWorklist:function(a,b){this.request("order/kirim","POST",a,b)},batalWorklist:function(a,b){this.request("order/batal","POST",a,b)}});Ext.define("ris.Workspace",{extend:"com.Form",xtype:"ris-workspace",layout:"fit",bodyPadding:0,items:[{xtype:"com-form",ui:"panel-black",title:"RIS",titleFieldConfig:{},fullscreenEnabled:true,menuConfig:{enabled:true,width:257,buttonConfig:{}},fullscreenConfig:{},header:{items:[{}]}}],load:function(a){var d=this,c=this.down("com-form");var e=[],b=Ext.JSON.decode(Ext.util.Base64.decode(d.app.xuam));b.forEach(function(g,f){g=Ext.JSON.decode(Ext.util.Base64.decode(g));if(g.ID.substring(0,6)=="900403"&&g.LEVEL==4){e.push({text:g.DESKRIPSI,leaf:true,iconCls:g.ICON_CLS,className:g.CLASS,idClassName:d.replaceAll(g.CLASS.toLowerCase(),".","_")})}});c.setMenus(e)}});Ext.define("ris.logs.Grid",{extend:"com.Grid",xtype:"ris-logs-grid",controller:"ris-logs-grid",viewModel:{data:{listConfig:{paging:true}},stores:{store:{type:"ris-logs-store"}}},columns:[{xtype:"rownumberer",text:"No",menuDisabled:true,sortable:false,align:"left",width:70},{text:"Jenis",sortable:false,align:"center",width:65,renderer:"onRendererJenis"},{text:"Tindakan Medis<br>Acc. Number",menuDisabled:true,sortable:false,dataIndex:"TINDAKAN_MEDIS",align:"center",width:130},{text:"Request",menuDisabled:true,sortable:false,flex:1,columns:[{text:"Tanggal",xtype:"datecolumn",format:"Y-m-d H:i:s",dataIndex:"TGL_REQUEST",menuDisabled:true,sortable:false,align:"center",width:140},{text:"Data",dataIndex:"REQUEST",menuDisabled:true,sortable:false,editor:{xtype:"textfield",readOnly:true},flex:1}]},{text:"Response",menuDisabled:true,sortable:false,flex:1,columns:[{text:"Tanggal",xtype:"datecolumn",format:"Y-m-d H:i:s",dataIndex:"TGL_RESPONSE",menuDisabled:true,sortable:false,align:"center",width:140},{text:"Data",dataIndex:"RESPONSE",menuDisabled:true,sortable:false,editor:{xtype:"textfield",readOnly:true},flex:1}]},{text:"Kirim",sortable:false,align:"center",width:110,renderer:"onRendererKirim"},{text:"Status",sortable:false,align:"center",width:110,renderer:"onRendererStatus"}],plugins:{ptype:"cellediting",clicksToEdit:1}});Ext.define("ris.logs.GridController",{extend:"Ext.app.ViewController",alias:"controller.ris-logs-grid",query:"",onSearch:function(a,b){this.query=b;this.cari()},onClear:function(){this.query="";this.cari()},onChange:function(b,d){var c=this,a=c.getView();if(d==""){b.onClearClick()}},onRendererJenis:function(g,e,f,d,c,b,a){return f.get("JENIS")==0?"ORM":"ORU"},onRendererKirim:function(g,e,f,d,c,b,a){return f.get("KIRIM")==0?"Blm. Terkirim":"Terkirim"},onRendererStatus:function(g,e,f,d,c,b,a){e.tdStyle=f.get("STATUS")==1?"color: green; font-weight: bold":"color: red;";return f.get("STATUS")==1?"Aktif":"Batal"},privates:{cari:function(){var c=this,a=c.getView(),b=a.down("pagingtoolbar"),e=a.down("[reference=jenispencarian]").getSelection();if(c.query==""){delete a.getStore().queryParams.QUERY;delete a.getStore().queryParams.JENIS}else{var d={};d.QUERY=c.query;d.JENIS=e.get("ID");a.setParams(d)}if(b){b.moveFirst()}else{a.load()}}}});Ext.define("ris.modality.Combo",{extend:"com.Combo",alias:"widget.ris-modality-combo",viewModel:{stores:{store:{type:"ris-modality-store"}}},displayField:"NAMA"});Ext.define("ris.modality.Form",{extend:"com.Form",xtype:"ris-modality-form",controller:"ris-modality-form",model:"ris.modality.Model",layout:{type:"vbox",align:"stretch"},isCreate:false,bodyPadding:15,scrollable:"y",defaults:{margin:"0 0 0 0"},items:[{xtype:"textfield",labelAlign:"top",fieldLabel:"Nama Modality",name:"NAMA",emptyText:"[Nama Modality]",bind:{readOnly:"{formConfig.viewOnly}",value:"{record.NAMA}"},allowBlank:false,maxLength:15,enforceMaxLength:true}],buttons:[{iconCls:"x-fa fa-save",ui:"soft-green",text:"Simpan",formBind:true,action:1,handler:"onSimpan"},{iconCls:"x-fa fa-save",ui:"soft-cyan",text:"Simpan & Tutup",formBind:true,action:2,handler:"onSimpan"}]});Ext.define("ris.modality.FormController",{extend:"Ext.app.ViewController",alias:"controller.ris-modality-form",onSimpan:function(b){var a=this.getView();a.save(b,{success:"Data modality berhasil disimpan"},function(e,c,d){if(d){if(b.action==2){a.fireEvent("save",e,true)}}})}});Ext.define("ris.modality.Grid",{extend:"com.Grid",xtype:"ris-modality-grid",controller:"ris-modality-grid",viewModel:{data:{listConfig:{paging:true}},stores:{store:{type:"ris-modality-store"}}},header:{items:[{xtype:"search-field",bind:{emptyText:"Cari Nama"},flex:1,listeners:{search:"onSearch",clear:"onClear",change:"onChange"}},{xtype:"button",iconCls:"x-fa fa-plus",ui:"soft-cerulen",handler:"onTambah",tooltip:"Tambah Modality",bind:{hidden:"{!listConfig.tambah}"}}]},actions:{edit:{iconCls:"x-fa fa-edit",tooltip:"Edit Modality",handler:"onEdit"}},columns:[{text:"ID",menuDisabled:true,sortable:false,dataIndex:"ID",align:"center",width:140},{text:"Nama",menuDisabled:true,sortable:false,dataIndex:"NAMA",flex:1},{menuDisabled:true,sortable:false,align:"center",xtype:"actioncolumn",text:"#",width:50,items:["@edit"],bind:{hidden:"{!listConfig.edit}"}}],listeners:{itemdblclick:"onItemDblclick"},initContext:false,onBeforeLoad:function(c,b,a){if(!c.initContext){if(c.setMenuContext){c.setMenuContext([{text:"Edit",iconCls:"x-fa fa-edit",scope:c.getController(),handler:"onMenuEdit"}]);c.initContext=true}}}});Ext.define("ris.modality.GridController",{extend:"Ext.app.ViewController",alias:"controller.ris-modality-grid",query:"",onSearch:function(a,b){this.query=b;this.cari()},onClear:function(){this.query="";this.cari()},onChange:function(b,d){var c=this,a=c.getView();if(d==""){b.onClearClick()}},onTambah:function(b){var c=this,a=c.getView();this.openWindow(b,true,{})},onEdit:function(b,e,a,f,c,d){this.openWindow(b,false,d)},onMenuEdit:function(b){var a=this.getView(),c=a.getSelection();if(c.length==0){return}this.openWindow(b,false,c[0])},onItemDblclick:function(d,a,f,b,g,c){this.openWindow(d,false,a)},privates:{cari:function(){var c=this,a=c.getView(),b=a.down("pagingtoolbar");if(c.query==""){delete a.getStore().queryParams.NAMA}else{var d={};d.NAMA=c.query;a.setParams(d)}if(b){b.moveFirst()}else{a.load()}},openWindow:function(c,b,e){var d=this,a=d.getView();a.openDialog("",true,350,190,{xtype:"ris-modality-form",ui:"panel-cyan",showCloseButton:true,title:(b?"Tambah":"Ubah")+" Modality",isCreate:b},function(f,g){form=g.down("ris-modality-form");if(b){form.createRecord(e)}else{form.loadRecord(e)}form.on("save",function(i,h){if(h){g.close()}d.cari()});form.focus("NAMA")})}}});Ext.define("ris.modality.tindakan.Form",{extend:"com.Form",xtype:"ris-modality-tindakan-form",controller:"ris-modality-tindakan-form",model:"ris.modality.tindakan.Model",layout:{type:"vbox",align:"stretch"},isCreate:false,bodyPadding:15,scrollable:"y",defaults:{margin:"0 0 0 0"},items:[{xtype:"ris-modality-combo",labelAlign:"top",fieldLabel:"Pilih Modality",name:"MODALITY",params:{start:0,limit:3000},firstLoad:true,emptyText:"[Pilih Modality]",bind:{readOnly:"{formConfig.viewOnly}",value:"{record.MODALITY}"},allowBlank:false},{xtype:"tindakan-combo",labelAlign:"top",fieldLabel:"Pilih Tindakan",name:"TINDAKAN",params:{JENIS_KUNJUNGAN:5,STATUS:1},emptyText:"[Masukkan Nama Tindakan]",bind:{readOnly:"{formConfig.viewOnly}",value:"{record.TINDAKAN}"},allowBlank:false},{xtype:"checkbox",fieldLabel:"Status",name:"STATUS",inputValue:1,bind:{readOnly:"{formConfig.viewOnly}"}}],buttons:[{iconCls:"x-fa fa-save",ui:"soft-green",text:"Simpan",formBind:true,action:1,handler:"onSimpan"},{iconCls:"x-fa fa-save",ui:"soft-cyan",text:"Simpan & Tutup",formBind:true,action:2,handler:"onSimpan"}],onBeforeGetRecord:function(b,c){var a=b.down("[name=STATUS]").getValue();c.STATUS=a?1:0},onLoadRecord:function(b,c){var a=b.down("[name=TINDAKAN]");if(!b.isCreate){a.select(c.get("TINDAKAN"));a.load()}}});Ext.define("ris.modality.tindakan.FormController",{extend:"Ext.app.ViewController",alias:"controller.ris-modality-tindakan-form",onSimpan:function(b){var a=this.getView();a.save(b,{success:"Data modality tindakan berhasil disimpan"},function(e,c,d){if(d){if(b.action==2){a.fireEvent("save",e,true)}}})}});Ext.define("ris.modality.tindakan.Grid",{extend:"com.Grid",xtype:"ris-modality-tindakan-grid",controller:"ris-modality-tindakan-grid",viewModel:{data:{listConfig:{paging:true}},stores:{store:{type:"ris-modality-tindakan-store"}}},header:{items:[{xtype:"combo",store:{data:[{ID:1,DESKRIPSI:"Tindakan"},{ID:2,DESKRIPSI:"Modality"}]},value:"Modality",displayField:"DESKRIPSI",reference:"jenispencarian",publishes:"value",valueField:"DESKRIPSI",width:120,editable:false},{xtype:"search-field",bind:{emptyText:"Cari {jenispencarian.value}"},flex:1,listeners:{search:"onSearch",clear:"onClear",change:"onChange"}},{xtype:"button",iconCls:"x-fa fa-plus",ui:"soft-cerulen",handler:"onTambah",tooltip:"Tambah Modality",bind:{hidden:"{!listConfig.tambah}"}}]},actions:{edit:{iconCls:"x-fa fa-edit",tooltip:"Edit Modality",handler:"onEdit"}},columns:[{xtype:"rownumberer",text:"No",menuDisabled:true,sortable:false,align:"left",width:70},{text:"ID",menuDisabled:true,sortable:false,dataIndex:"ID",align:"center",width:140},{text:"Tindakan",xtype:"templatecolumn",menuDisabled:true,sortable:false,tpl:"{REFERENSI.TINDAKAN.NAMA}",flex:1},{text:"Modality",xtype:"templatecolumn",menuDisabled:true,sortable:false,dataIndex:"MODALITY",tpl:"{REFERENSI.MODALITY.NAMA}",flex:1},{text:"Status",sortable:false,align:"center",width:110,renderer:"onRendererStatus"},{menuDisabled:true,sortable:false,align:"center",xtype:"actioncolumn",width:50,items:["@edit"],bind:{hidden:"{!listConfig.edit}"}}],listeners:{itemdblclick:"onItemDblclick"},initContext:false,onBeforeLoad:function(c,b,a){if(!c.initContext){c.setMenuContext([{text:"Edit",iconCls:"x-fa fa-edit",scope:c.getController(),handler:"onMenuEdit"}]);c.initContext=true}}});Ext.define("ris.modality.tindakan.GridController",{extend:"Ext.app.ViewController",alias:"controller.ris-modality-tindakan-grid",query:"",onSearch:function(a,b){this.query=b;this.cari()},onClear:function(){this.query="";this.cari()},onChange:function(b,d){var c=this,a=c.getView();if(d==""){b.onClearClick()}},onTambah:function(b){var c=this,a=c.getView();this.openWindow(b,true,{})},onEdit:function(b,e,a,f,c,d){this.openWindow(b,false,d)},onMenuEdit:function(b){var a=this.getView(),c=a.getSelection();if(c.length==0){return}this.openWindow(b,false,c[0])},onItemDblclick:function(d,a,f,b,g,c){this.openWindow(d,false,a)},onRendererStatus:function(g,e,f,d,c,b,a){e.tdStyle=f.get("STATUS")==1?"color: green; font-weight: bold":"color: red;";return f.get("STATUS")==1?"Aktif":"Tdk Aktif"},privates:{cari:function(){var c=this,a=c.getView(),b=a.down("pagingtoolbar"),e=a.down("[reference=jenispencarian]").getSelection();if(c.query==""){delete a.getStore().queryParams.QUERY;delete a.getStore().queryParams.JENIS}else{var d={};d.QUERY=c.query;d.JENIS=e.get("ID");a.setParams(d)}if(b){b.moveFirst()}else{a.load()}},openWindow:function(c,b,e){var d=this,a=d.getView();a.openDialog("",true,600,350,{xtype:"ris-modality-tindakan-form",ui:"panel-cyan",showCloseButton:true,title:(b?"Tambah":"Ubah")+" Modality Tindakan",isCreate:b},function(f,g){form=g.down("ris-modality-tindakan-form");if(b){form.createRecord(e)}else{form.loadRecord(e)}form.on("save",function(i,h){if(h){g.close()}d.cari()});form.focus("MODALITY")})}}});